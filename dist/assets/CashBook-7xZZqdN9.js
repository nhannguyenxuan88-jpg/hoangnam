import{u as B,h as A,a9 as R,r as n,j as e,i as p,l as L,s as C}from"./index-9wxNecOd.js";import{u as q}from"./usePaymentSourcesRepository-C79TLCiR.js";const F=()=>{const{cashTransactions:o,paymentSources:g,currentBranchId:l,setCashTransactions:y,setPaymentSources:w}=B();A();const S=R(),T=q(),[b,k]=n.useState("all"),[x,f]=n.useState("all"),[v,N]=n.useState("month"),[D,j]=n.useState(!1),i=n.useMemo(()=>{let t=o.filter(s=>s.branchId===l);b!=="all"&&(t=t.filter(s=>s.type===b)),x!=="all"&&(t=t.filter(s=>s.paymentSourceId===x));const a=new Date,h=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(v){case"today":t=t.filter(u=>new Date(u.date)>=h);break;case"week":const s=new Date(h);s.setDate(s.getDate()-7),t=t.filter(u=>new Date(u.date)>=s);break;case"month":const r=new Date(h);r.setMonth(r.getMonth()-1),t=t.filter(u=>new Date(u.date)>=r);break}return t.sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime())},[o,l,b,x,v]),c=t=>t==="income"||t==="deposit",m=n.useMemo(()=>{var u,_;const t=i.filter(d=>c(d.type)).reduce((d,M)=>d+Math.abs(M.amount),0),a=i.filter(d=>d.type==="expense").reduce((d,M)=>d+Math.abs(M.amount),0),h=t-a,s=((u=g.find(d=>d.id==="cash"))==null?void 0:u.balance[l])||0,r=((_=g.find(d=>d.id==="bank"))==null?void 0:_.balance[l])||0;return{income:t,expense:-a,balance:h,cashBalance:s,bankBalance:r,totalBalance:s+r}},[i,g,l]);return e.jsxs("div",{className:"h-full flex flex-col bg-slate-50 dark:bg-slate-900",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Sổ quỹ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Theo dõi thu chi tiền mặt và chuyển khoản"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Thêm giao dịch"})]})]})}),e.jsxs("div",{className:"p-3 md:p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3 mb-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400 text-xs font-medium mb-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})}),e.jsx("span",{children:"Thu"})]}),e.jsx("div",{className:"text-green-900 dark:text-green-100 text-xl font-bold",children:p(m.income)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-3 border-2 border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 text-xs font-medium mb-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})}),e.jsx("span",{children:"Chi"})]}),e.jsx("div",{className:"text-red-900 dark:text-red-100 text-xl font-bold",children:p(m.expense)})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-blue-600 dark:text-blue-400 text-xs font-medium mb-1",children:"Chênh lệch"}),e.jsx("div",{className:`text-xl font-bold ${m.balance>=0?"text-blue-900 dark:text-blue-100":"text-red-600 dark:text-red-400"}`,children:p(m.balance)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3 border-2 border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-xs font-medium mb-1",children:"Tiền mặt"}),e.jsx("div",{className:"text-amber-900 dark:text-amber-100 text-xl font-bold",children:p(m.cashBalance)})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 border-2 border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-400 text-xs font-medium mb-1",children:"Ngân hàng"}),e.jsx("div",{className:"text-purple-900 dark:text-purple-100 text-xl font-bold",children:p(m.bankBalance)})]})]}),e.jsxs("div",{className:"md:hidden space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Loại"}),e.jsxs("select",{value:b,onChange:t=>k(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"income",children:"Thu"}),e.jsx("option",{value:"expense",children:"Chi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Nguồn tiền"}),e.jsxs("select",{value:x,onChange:t=>f(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"cash",children:"Tiền mặt"}),e.jsx("option",{value:"bank",children:"Ngân hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Thời gian"}),e.jsxs("select",{value:v,onChange:t=>N(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"today",children:"Hôm nay"}),e.jsx("option",{value:"week",children:"7 ngày qua"}),e.jsx("option",{value:"month",children:"30 ngày qua"}),e.jsx("option",{value:"all",children:"Tất cả"})]})]})]}),e.jsx("div",{className:"hidden md:block bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Loại:"}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"Tất cả"},{value:"income",label:"Thu"},{value:"expense",label:"Chi"}].map(t=>e.jsx("button",{onClick:()=>k(t.value),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${b===t.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t.label},t.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Nguồn tiền:"}),e.jsxs("select",{value:x,onChange:t=>f(t.target.value),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-sm text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"cash",children:"Tiền mặt"}),e.jsx("option",{value:"bank",children:"Ngân hàng"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Thời gian:"}),e.jsx("div",{className:"flex gap-2",children:[{value:"today",label:"Hôm nay"},{value:"week",label:"7 ngày"},{value:"month",label:"30 ngày"},{value:"all",label:"Tất cả"}].map(t=>e.jsx("button",{onClick:()=>N(t.value),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${v===t.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t.label},t.value))})]})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:i.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:"Không có giao dịch nào"}):i.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:I(t.category)}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:L(new Date(t.date))})]}),e.jsxs("div",{className:`font-bold ${c(t.type)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[c(t.type)?"+":"-",p(Math.abs(t.amount))]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 truncate max-w-[60%]",children:t.notes||"--"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:(()=>{const a=t.paymentSourceId||t.paymentsource||t.paymentSource;return a==="cash"?"Tiền mặt":a==="bank"?"Ngân hàng":a||"--"})()})]})]},t.id))}),e.jsx("div",{className:"hidden md:block bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Ngày"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Loại"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Danh mục"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Đối tượng"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Nội dung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Nguồn tiền"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Số tiền"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Thao tác"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-slate-500 dark:text-slate-400",children:"Không có giao dịch nào"})}):i.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100",children:L(new Date(t.date))}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${c(t.type)?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:c(t.type)?"↑ Thu":"↓ Chi"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:I(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100 font-medium",children:t.recipient||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:t.notes||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:(()=>{const a=t.paymentSourceId||t.paymentsource||t.paymentSource;return a==="cash"?"Tiền mặt":a==="bank"?"Ngân hàng":a||"--"})()}),e.jsxs("td",{className:`px-4 py-3 text-right text-sm font-semibold ${c(t.type)?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[c(t.type)?"+":"-",p(Math.abs(t.amount))]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},t.id))})]})})]}),D&&e.jsx(H,{onClose:()=>j(!1),onSave:async t=>{if(!t.amount||t.amount<=0){C.warning("Số tiền phải > 0");return}try{const a=await S.mutateAsync({type:t.type,amount:t.amount,branchId:l,paymentSourceId:t.paymentSourceId,date:t.date,notes:t.notes,category:t.category,recipient:t.recipient});if(a!=null&&a.ok){y(s=>[a.data,...s]);const h=t.type==="income"?t.amount:-t.amount;await T.mutateAsync({id:t.paymentSourceId,branchId:l,delta:h}),w(s=>s.map(r=>r.id===t.paymentSourceId?{...r,balance:{...r.balance,[l]:(r.balance[l]||0)+h}}:r)),C.success("Đã thêm giao dịch sổ quỹ"),j(!1)}else a!=null&&a.error&&C.error(a.error.message||"Ghi giao dịch thất bại")}catch(a){C.error((a==null?void 0:a.message)||"Lỗi không xác định")}}})]})},I=o=>o?{sale_income:"Bán hàng",service_income:"Dịch vụ",other_income:"Thu khác",inventory_purchase:"Mua hàng",salary:"Lương nhân viên",loan_payment:"Trả nợ vay",debt_collection:"Thu nợ khách hàng",debt_payment:"Trả nợ nhà cung cấp",sale_refund:"Hoàn trả",other_expense:"Chi khác",outsourcing:"Gia công ngoài",service_deposit:"Đặt cọc dịch vụ",general_income:"Thu chung",general_expense:"Chi chung"}[o]||o:"--",H=({onClose:o,onSave:g})=>{const[l,y]=n.useState("income"),[w,S]=n.useState("0"),[T,b]=n.useState(""),[k,x]=n.useState("cash"),[f,v]=n.useState(""),[N,D]=n.useState(""),[j,i]=n.useState(new Date().toISOString().split("T")[0]),c=a=>{a.preventDefault(),g({type:l,amount:parseFloat(w),category:T,paymentSourceId:k,recipient:f,notes:N,date:new Date(j).toISOString()})},m=[{value:"sale_income",label:"Tiền bán hàng"},{value:"service_income",label:"Tiền dịch vụ"},{value:"other_income",label:"Thu nhập khác"}],t=[{value:"inventory_purchase",label:"Mua hàng"},{value:"salary",label:"Lương nhân viên"},{value:"rent",label:"Tiền thuê mặt bằng"},{value:"utilities",label:"Điện nước"},{value:"sale_refund",label:"Hoàn trả khách hàng"},{value:"other_expense",label:"Chi phí khác"}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Thêm giao dịch"})}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Loại giao dịch"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"income",checked:l==="income",onChange:a=>y(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Thu tiền"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"expense",checked:l==="expense",onChange:a=>y(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Chi tiền"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Số tiền"}),e.jsx("input",{type:"number",value:w,onChange:a=>S(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh mục"}),e.jsxs("select",{value:T,onChange:a=>b(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Chọn danh mục"}),(l==="income"?m:t).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Đối tượng"}),e.jsx("input",{type:"text",value:f,onChange:a=>v(a.target.value),placeholder:l==="income"?"Thu tiền từ ai?":"Chi tiền cho ai?",className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nguồn tiền"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"cash",checked:k==="cash",onChange:a=>x(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Tiền mặt"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"bank",checked:k==="bank",onChange:a=>x(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Ngân hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ngày giao dịch"}),e.jsx("input",{type:"date",value:j,onChange:a=>i(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nội dung"}),e.jsx("textarea",{value:N,onChange:a=>D(a.target.value),rows:3,className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",placeholder:"Ghi chú về giao dịch..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-lg font-medium transition-colors",children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Lưu giao dịch"})]})]})]})})};export{F as default};
