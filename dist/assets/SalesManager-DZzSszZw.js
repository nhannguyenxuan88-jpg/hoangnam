const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D9g1RJTX.js","assets/index-murgTbCy.css"])))=>i.map(i=>d[i]);
import{c as Xe,r,u as At,a as Bt,b as os,d as is,e as _t,f as cs,g as xs,s as b,h as qt,j as e,B as Ee,S as dt,i as x,k as Ht,l as it,R as $t,m as ct,n as Dt,_ as jt,o as Et}from"./index-D9g1RJTX.js";import{B as ms,c as hs}from"./BarcodeScannerModal-BDvsJ4e9.js";import{p as It}from"./print-TOU0k1YY.js";import{P as Wt,X as Kt}from"./Icons-DTFKuh_b.js";import{u as us,a as gs}from"./useDebtsRepository-BXDYcaYw.js";import{H as zt}from"./history-D40uoO4z.js";import{P as bs}from"./printer-Bx_EVBLG.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=Xe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=Xe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=Xe("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=Xe("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=Xe("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);function vs(G,m,o=5){return r.useMemo(()=>{const K=Array.isArray(G)?G:[],F=m||"",p=K.filter(R=>{var ne;return(((ne=R.stock)==null?void 0:ne[F])??0)<=0}),L=K.filter(R=>{var T;const ne=((T=R.stock)==null?void 0:T[F])??0;return ne>0&&ne<=o});return{lowStock:L,outOfStock:p,lowStockCount:L.length,outOfStockCount:p.length}},[G,m,o])}const ot=5,ys=({isOpen:G,onClose:m,sale:o,onPrint:K})=>{if(!G||!o)return null;const F=o.items.reduce((L,R)=>L+R.quantity*R.sellingPrice,0),p=F-o.total;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Chi tiáº¿t Ä‘Æ¡n hÃ ng"}),e.jsx("button",{onClick:m,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"MÃ£ Ä‘Æ¡n hÃ ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:o.sale_code||ct(o.id)||o.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"NgÃ y táº¡o"}),e.jsxs("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:[it(new Date(o.date),!1)," ",new Date(o.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"KhÃ¡ch hÃ ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:o.customer.name}),o.customer.phone&&e.jsx("div",{className:"text-sm text-slate-500",children:o.customer.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"NhÃ¢n viÃªn bÃ¡n hÃ ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:o.username||o.userName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"PhÆ°Æ¡ng thá»©c thanh toÃ¡n"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:o.paymentMethod==="cash"?"Tiá»n máº·t":"Chuyá»ƒn khoáº£n"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"Sáº£n pháº©m"}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"TÃªn sáº£n pháº©m"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"SL"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"ÄÆ¡n giÃ¡"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"ThÃ nh tiá»n"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:o.items.map((L,R)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100",children:[L.partName,L.sku&&e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",L.sku]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-900 dark:text-slate-100",children:L.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-900 dark:text-slate-100",children:x(L.sellingPrice)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-slate-900 dark:text-slate-100",children:x(L.quantity*L.sellingPrice)})]},R))})]})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Táº¡m tÃ­nh:"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:x(F)})]}),p>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Giáº£m giÃ¡:"}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:["-",x(p)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-slate-200 dark:border-slate-700 pt-2",children:[e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:"Tá»•ng cá»™ng:"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:x(o.total)})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"ÄÃ³ng"}),e.jsxs("button",{onClick:()=>{K(o),m()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"In hÃ³a Ä‘Æ¡n"]})]})]})})},Ns=({isOpen:G,onClose:m,sale:o,onSave:K})=>{const{customers:F,upsertCustomer:p}=At(),{data:L=[]}=_t(),R=Bt(),{profile:ne}=qt(),[T,q]=r.useState([]),[Ye,we]=r.useState({id:"",name:"",phone:""}),[U,he]=r.useState("cash"),[Ce,Ze]=r.useState(0),[ue,V]=r.useState(""),[ge,Se]=r.useState(!1),[Te,Me]=r.useState(!1),[Le,Pe]=r.useState(""),[De,be]=r.useState(""),[J,de]=r.useState(""),[H,pe]=r.useState(!1);if(r.useEffect(()=>{o&&(q([...o.items]),we({id:o.customer.id||"",name:o.customer.name,phone:o.customer.phone||""}),de(o.customer.name),he(o.paymentMethod),Ze(o.discount||0))},[o]),!G||!o)return null;const Q=T.reduce((l,u)=>l+u.quantity*u.sellingPrice,0),fe=Q-Ce,M=L.filter(l=>l.name.toLowerCase().includes(ue.toLowerCase())||l.sku.toLowerCase().includes(ue.toLowerCase())),Ie=F.filter(l=>{var y;const u=J.toLowerCase();return l.name.toLowerCase().includes(u)||((y=l.phone)==null?void 0:y.toLowerCase().includes(u))||l.vehicles&&l.vehicles.some(a=>{var c;return(c=a.licensePlate)==null?void 0:c.toLowerCase().includes(u)})}),X=l=>{const u=typeof l.stock=="object"?l.stock[o.branchId]||0:l.stock,y=typeof l.retailPrice=="object"?l.retailPrice[o.branchId]||0:l.retailPrice||0,a=T.find(c=>c.partId===l.id);q(a?T.map(c=>c.partId===l.id?{...c,quantity:c.quantity+1}:c):[...T,{partId:l.id,partName:l.name,sku:l.sku,quantity:1,sellingPrice:y,stockSnapshot:typeof u=="number"?u:0}]),V(""),Se(!1)},_=l=>{we({id:l.id,name:l.name,phone:l.phone||""}),de(l.name),pe(!1)},We=async()=>{if(!Le.trim()){b.error("Vui lÃ²ng nháº­p tÃªn khÃ¡ch hÃ ng");return}try{const l={id:crypto.randomUUID(),name:Le,phone:De||void 0,email:"",created_at:new Date().toISOString()};await p(l),we({id:l.id,name:l.name,phone:l.phone||""}),de(l.name),Me(!1),Pe(""),be(""),b.success("ThÃªm khÃ¡ch hÃ ng thÃ nh cÃ´ng")}catch(l){console.error("Error adding customer:",l),b.error("Lá»—i khi thÃªm khÃ¡ch hÃ ng")}},k=(l,u)=>{u<=0?q(T.filter(y=>y.partId!==l)):q(T.map(y=>y.partId===l?{...y,quantity:u}:y))},Je=(l,u)=>{q(T.map(y=>y.partId===l?{...y,sellingPrice:u}:y))},ke=l=>{q(T.filter(u=>u.partId!==l))},te=async()=>{if(T.length===0){b.error("Vui lÃ²ng cÃ³ Ã­t nháº¥t má»™t sáº£n pháº©m");return}if(!Ye.name){b.error("Vui lÃ²ng nháº­p tÃªn khÃ¡ch hÃ ng");return}try{await K({id:o.id,items:T,customer:Ye,paymentMethod:U,discount:Ce}),R.invalidateQueries({queryKey:["salesRepoPaged"]}),m()}catch(l){console.error("Error saving sale:",l)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:["âœï¸ [Chá»‰nh sá»­a] ÄÆ¡n Xuáº¥t BÃ¡n ",o.sale_code||ct(o.id)]}),e.jsx("button",{onClick:m,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl leading-none",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Thá»i gian bÃ¡n hÃ ng:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:it(new Date(o.date),!1),disabled:!0,className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("input",{type:"text",value:new Date(o.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),disabled:!0,className:"w-24 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-center"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"KhÃ¡ch hÃ ng: â„¹ï¸"}),Te?e.jsxs("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg p-3 space-y-2",children:[e.jsx("input",{type:"text",value:Le,onChange:l=>Pe(l.target.value),placeholder:"TÃªn khÃ¡ch hÃ ng",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("input",{type:"tel",value:De,onChange:l=>be(l.target.value),placeholder:"Sá»‘ Ä‘iá»‡n thoáº¡i (tÃ¹y chá»n)",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:We,className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"LÆ°u"}),e.jsx("button",{onClick:()=>{Me(!1),Pe(""),be("")},className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300",children:"Há»§y"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:J,onChange:l=>{de(l.target.value),pe(!0)},onFocus:()=>pe(!0),placeholder:"TÃ¬m kiáº¿m vÃ  chá»n má»™t khÃ¡ch hÃ ng",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),H&&Ie.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto z-10",children:Ie.slice(0,10).map(l=>e.jsxs("button",{onClick:()=>_(l),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-600 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.name}),l.phone&&e.jsx("div",{className:"text-xs text-slate-500",children:l.phone})]},l.id))})]}),e.jsxs("button",{onClick:()=>Me(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Wt,{className:"w-4 h-4"}),"ThÃªm má»›i"]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Chi tiáº¿t sáº£n pháº©m:"})}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",value:ue,onChange:l=>{V(l.target.value),Se(!0)},onFocus:()=>Se(!0),placeholder:"TÃ¬m kiáº¿m vÃ  thÃªm sáº£n pháº©m...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),ge&&ue&&M.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-10",children:M.slice(0,10).map(l=>e.jsxs("button",{onClick:()=>X(l),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-600 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",l.sku]})]},l.id))})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-2 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-8",children:"-"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"TÃªn"}),e.jsx("th",{className:"text-center px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-20",children:"SL"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-24",children:"ÄÆ¡n giÃ¡"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-28",children:"ThÃ nh tiá»n"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:T.map((l,u)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 text-center text-sm text-slate-900 dark:text-slate-100",children:u+1}),e.jsxs("td",{className:"px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.partName}),e.jsx("div",{className:"text-xs text-slate-500",children:l.sku})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:l.quantity,onChange:y=>k(l.partId,parseInt(y.target.value)||0),min:"1",className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center text-sm bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:l.sellingPrice,onChange:y=>Je(l.partId,parseFloat(y.target.value)||0),min:"0",step:"1000",className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right text-sm bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-3 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:x(l.quantity*l.sellingPrice)}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("button",{onClick:()=>ke(l.partId),className:"text-slate-400 hover:text-red-600 transition-colors",children:e.jsx(Kt,{className:"w-5 h-5"})})})]},l.partId))})]})}),T.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"ChÆ°a cÃ³ sáº£n pháº©m nÃ o"}),T.length>0&&e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Tá»”NG:"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:x(Q)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Chá»n nhÃ¢n viÃªn bÃ¡n hÃ ng"}),e.jsx("select",{disabled:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:e.jsx("option",{children:o.username||o.userName})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"CÃ´ng ná»£:"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:"KhÃ¡ch hÃ ng pháº£i thanh toÃ¡n"}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:"Tá»”NG PHáº¢I THU:"}),e.jsx("span",{className:"text-lg font-bold text-green-700 dark:text-green-400",children:x(fe)})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0}),e.jsx("span",{children:"ÄÃ£ thanh toÃ¡n Ä‘á»§"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-2",children:"- Thá»i gian NgÆ°á»i thu - Ghi chÃº"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>he("cash"),className:`flex-1 py-2 rounded-lg border transition-colors text-sm font-medium ${U==="cash"?"bg-green-600 text-white border-green-600":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Tiá»n máº·t"}),e.jsx("button",{onClick:()=>he("bank"),className:`flex-1 py-2 rounded-lg border transition-colors text-sm font-medium ${U==="bank"?"bg-blue-600 text-white border-blue-600":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Chuyá»ƒn khoáº£n"})]})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-2 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"-"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"Thá»i gian"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"NgÆ°á»i thu - Ghi chÃº"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"Sá»‘ tiá»n"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 text-center text-slate-900 dark:text-slate-100",children:"1"}),e.jsxs("td",{className:"px-3 py-2",children:[e.jsxs("div",{className:"text-slate-900 dark:text-slate-100",children:[new Date(o.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})," ",it(new Date(o.date),!1)]}),e.jsx("div",{className:"text-xs text-slate-500",children:"(Tiá»n máº·t)"})]}),e.jsx("td",{className:"px-3 py-2 text-slate-900 dark:text-slate-100",children:o.username||o.userName}),e.jsx("td",{className:"px-3 py-2 text-right text-slate-900 dark:text-slate-100",children:x(fe)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Tá»•ng Ä‘Ã£ thu"}),e.jsx("div",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:x(fe)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700",children:[e.jsx("button",{onClick:m,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors font-medium",children:"ÄÃ“NG"}),e.jsx("button",{onClick:te,disabled:T.length===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-semibold",children:"LÆ¯U"})]})]})})},ws=({isOpen:G,onClose:m,sales:o,currentBranchId:K,onPrintReceipt:F,onEditSale:p,onDeleteSale:L,page:R,totalPages:ne,total:T,hasMore:q,pageSize:Ye,onPrevPage:we,onNextPage:U,onPageSizeChange:he,search:Ce,onSearchChange:Ze,fromDate:ue,toDate:V,onDateRangeChange:ge,status:Se="all",onStatusChange:Te,paymentMethodFilter:Me="all",onPaymentMethodFilterChange:Le,keysetMode:Pe=!1,onToggleKeyset:De,customerDebts:be=[]})=>{const[J,de]=r.useState("7days"),[H,pe]=r.useState(""),[Q,fe]=r.useState(""),[M,Ie]=r.useState(""),[X,_]=r.useState(null),[We,k]=r.useState(!1),[Je,ke]=r.useState(!1),[te,l]=r.useState(null);r.useEffect(()=>{const a=new Date,c=new Date(a.getFullYear(),a.getMonth(),a.getDate()),z=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999);let w,A;switch(J){case"today":w=c,A=z;break;case"week":{const g=a.getDay(),Y=g===0?-6:1-g,P=new Date(a);P.setDate(a.getDate()+Y),w=new Date(P.getFullYear(),P.getMonth(),P.getDate()),A=z;break}case"month":{w=new Date(a.getFullYear(),a.getMonth(),1),A=z;break}case"7days":{const g=new Date(a);g.setDate(g.getDate()-6),w=new Date(g.getFullYear(),g.getMonth(),g.getDate()),A=z;break}case"30days":{const g=new Date(a);g.setDate(g.getDate()-29),w=new Date(g.getFullYear(),g.getMonth(),g.getDate()),A=z;break}case"custom":{Q&&M&&(w=new Date(Q),A=new Date(M+"T23:59:59"));break}case"all":w=void 0,A=void 0;break}ge(w?w.toISOString():void 0,A?A.toISOString():void 0)},[J,Q,M,ge]);const u=r.useMemo(()=>{let a=o.filter(c=>c.branchId===K||c.branchid===K);return H&&(a=a.filter(c=>c.id.toLowerCase().includes(H.toLowerCase())||(c.sale_code||"").toLowerCase().includes(H.toLowerCase())||c.customer.name.toLowerCase().includes(H.toLowerCase())||(c.username||c.userName||"").toLowerCase().includes(H.toLowerCase()))),a.sort((c,z)=>new Date(z.date).getTime()-new Date(c.date).getTime()),a},[o,K,H]),y=r.useMemo(()=>u.reduce((a,c)=>a+c.total,0),[u]);return r.useEffect(()=>{const a=c=>{c.target.closest(".dropdown-menu-container")||l(null)};if(te)return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[te]),G?e.jsxs($t.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex md:items-center md:justify-center items-end justify-center p-0 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full md:max-w-7xl max-h-[95vh] md:rounded-2xl rounded-t-3xl shadow-2xl overflow-hidden flex flex-col animate-slide-up-bottom",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-white/95 dark:bg-slate-900/70 backdrop-blur",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"Lá»‹ch sá»­ bÃ¡n hÃ ng"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Theo dÃµi giao dá»‹ch gáº§n Ä‘Ã¢y"})]}),e.jsx("button",{onClick:m,className:"text-slate-500 hover:text-slate-900 dark:hover:text-white text-2xl leading-none px-2","aria-label":"ÄÃ³ng lá»‹ch sá»­ bÃ¡n hÃ ng",children:"Ã—"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-thin",children:[{key:"7days",label:"7 ngÃ y qua"},{key:"week",label:"Tuáº§n"},{key:"month",label:"ThÃ¡ng"},{key:"30days",label:"30 ngÃ y qua"},{key:"custom",label:"TÃ¹y chá»n"},{key:"all",label:"Táº¥t cáº£"}].map(a=>e.jsx("button",{onClick:()=>de(a.key),className:`px-4 py-2 rounded-2xl text-sm font-medium whitespace-nowrap border transition-all min-w-[96px] ${J===a.key?"bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-500/30":"bg-slate-100 dark:bg-slate-800/80 text-slate-700 dark:text-slate-200 border-transparent"}`,children:a.label},a.key))}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"w-full md:flex-1 relative",children:[e.jsx("input",{type:"text",value:H,onChange:a=>pe(a.target.value),placeholder:"TÃ¬m hÃ³a Ä‘Æ¡n, khÃ¡ch hÃ ng hoáº·c mÃ£ phiáº¿u",className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500"}),e.jsxs("svg",{className:"w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 19a8 8 0 100-16 8 8 0 000 16z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-4.3-4.3"})]})]}),e.jsx("div",{className:"flex items-center justify-between md:justify-end gap-4 w-full md:w-auto",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Tá»•ng doanh thu"}),e.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:x(y)})]})})]}),J==="custom"&&e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("label",{className:"text-sm text-slate-600 dark:text-slate-400 flex items-center gap-2",children:["Tá»«",e.jsx("input",{type:"date",value:Q,onChange:a=>fe(a.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 text-sm"})]}),e.jsxs("label",{className:"text-sm text-slate-600 dark:text-slate-400 flex items-center gap-2",children:["Äáº¿n",e.jsx("input",{type:"date",value:M,onChange:a=>Ie(a.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 text-sm"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"KhÃ´ng cÃ³ hÃ³a Ä‘Æ¡n nÃ o"}):e.jsxs("div",{children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-3 bg-slate-100 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600 sticky top-0 z-10",children:[e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"MÃ£ phiáº¿u"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"KhÃ¡ch hÃ ng"}),e.jsx("div",{className:"col-span-4 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Chi tiáº¿t"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thanh toÃ¡n"}),e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thao tÃ¡c"})]}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:u.map(a=>{var ze,se,ae,$,ye,D;const c=new Date(a.date);a.items.reduce((C,Z)=>C+Z.quantity*Z.sellingPrice,0);const z=(be||[]).find(C=>{var Z;return(Z=C.description)==null?void 0:Z.includes(a.sale_code||a.id)}),w=z?z.totalAmount-z.remainingAmount:a.total,A=(z==null?void 0:z.remainingAmount)||0,g=A>0,P=a.items.slice(0,3),je=a.items.length-P.length,ve=c.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),xt=c.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),mt=(((se=(ze=a.customer)==null?void 0:ze.name)==null?void 0:se.charAt(0))||"K").toUpperCase(),Ke=a.paymentMethod==="cash"?"Tiá»n máº·t":"Chuyá»ƒn khoáº£n";return e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"md:hidden flex flex-col gap-3 bg-white dark:bg-slate-800/60 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[a.sale_code&&e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-blue-600 dark:text-blue-300",children:[e.jsx(ks,{className:"w-4 h-4"}),a.sale_code]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx(ps,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[ve," Â· ",xt]})]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-300",children:"NV"}),e.jsx("span",{children:a.userName||a.username||"N/A"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Tá»•ng tiá»n"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:x(a.total)}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 justify-end mt-1",children:[a.paymentMethod==="cash"?e.jsx(Ht,{className:"w-4 h-4"}):e.jsx(Vt,{className:"w-4 h-4"}),e.jsx("span",{children:Ke})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-900/30 rounded-2xl p-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-200 font-semibold",children:mt}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-white",children:((ae=a.customer)==null?void 0:ae.name)||"KhÃ¡ch vÃ£ng lai"}),(($=a.customer)==null?void 0:$.phone)&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2 5.5C2 4.119 3.12 3 4.5 3h1.76c.636 0 1.197.4 1.39 1.005l.8 2.47a1.5 1.5 0 01-.35 1.46L7.11 8.94a12.044 12.044 0 005.95 5.95l1.006-1.002a1.5 1.5 0 011.46-.349l2.469.8c.606.193 1.005.754 1.005 1.39V19.5c0 1.38-1.119 2.5-2.5 2.5h-.25C8.268 22 2 15.732 2 7.75v-.25z"})}),a.customer.phone]})]})]}),e.jsxs("div",{className:"space-y-2",children:[P.map((C,Z)=>e.jsxs("div",{className:"flex items-start justify-between text-sm text-slate-700 dark:text-slate-200",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[C.quantity," x ",C.partName]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[x(C.sellingPrice||0)," ","/ sáº£n pháº©m"]})]}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:x(C.quantity*(C.sellingPrice||0))})]},Z)),je>0&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["+",je," sáº£n pháº©m khÃ¡c"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[g?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["âš ï¸ CÃ²n ná»£ ",x(A)]}):e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200",children:"âœ“ ÄÃ£ thanh toÃ¡n"}),e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200",children:Ke})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>F(a),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"In hoÃ¡ Ä‘Æ¡n"}),e.jsx("button",{onClick:()=>{_(a),k(!0)},className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Xem chi tiáº¿t"}),e.jsx("button",{onClick:()=>{_(a),ke(!0)},className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Chá»‰nh sá»­a"}),e.jsx("button",{onClick:()=>L(a.id),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 text-sm font-medium",children:"XÃ³a Ä‘Æ¡n"})]})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-start",children:[e.jsx("div",{className:"col-span-1 flex items-start pt-1",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[a.sale_code&&e.jsx("div",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:a.sale_code}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[c.getDate(),"/",c.getMonth()+1,"/",c.getFullYear()," ",String(c.getHours()).padStart(2,"0"),":",String(c.getMinutes()).padStart(2,"0")]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"NV:"})," ",a.userName||a.username||"N/A"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:((ye=a.customer)==null?void 0:ye.name)||"KhÃ¡ch vÃ£ng lai"}),((D=a.customer)==null?void 0:D.phone)&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["ðŸ“ž ",a.customer.phone]})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"space-y-1",children:a.items.map((C,Z)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:[e.jsxs("span",{className:"font-medium",children:[C.quantity," x"]})," ",C.partName,e.jsxs("span",{className:"text-slate-400 ml-1",children:["(",x(C.sellingPrice||0),")"]})," = ",e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:x(C.quantity*(C.sellingPrice||0))})]},Z))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Tá»•ng tiá»n:"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:x(a.total)}),g?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["ÄÃ£ tráº£: ",x(w)]}),e.jsxs("div",{className:"text-xs font-semibold text-red-600 dark:text-red-400",children:["CÃ²n ná»£: ",x(A)]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"âš ï¸ CÃ²n ná»£"})]}):e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:"âœ“ ÄÃ£ thanh toÃ¡n"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:a.paymentMethod==="cash"?"ðŸ’µ Tiá»n máº·t":"ðŸ¦ Chuyá»ƒn khoáº£n"})]})}),e.jsxs("div",{className:"col-span-1 flex items-start justify-end gap-2 pt-1",children:[e.jsx("button",{onClick:()=>{_(a),ke(!0)},className:"p-1.5 text-slate-400 hover:text-amber-600 dark:hover:text-amber-400 transition-colors",title:"Chá»‰nh sá»­a",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsxs("div",{className:"relative dropdown-menu-container",children:[e.jsx("button",{onClick:()=>l(te===a.id?null:a.id),className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:"TÃ¹y chá»n",children:e.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"5",r:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"}),e.jsx("circle",{cx:"12",cy:"19",r:"2"})]})}),te===a.id&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[e.jsxs("button",{onClick:()=>{F(a),l(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2 rounded-t-lg",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"In láº¡i hÃ³a Ä‘Æ¡n"]}),e.jsxs("button",{onClick:()=>{_(a),k(!0),l(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Xem chi tiáº¿t"]}),e.jsxs("button",{onClick:()=>{L&&L(a.id),l(null)},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2 rounded-b-lg",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"XÃ³a hÃ³a Ä‘Æ¡n"]})]})]})]})]})]},a.id)})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex items-center justify-between",children:e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Hiá»ƒn thá»‹ ",u.length," Ä‘Æ¡n hÃ ng"]})})]})}),e.jsx(ys,{isOpen:We,onClose:()=>{k(!1),_(null)},sale:X,onPrint:F}),e.jsx(Ns,{isOpen:Je,onClose:()=>{ke(!1),_(null)},sale:X,onSave:async a=>{try{const{supabase:c}=await jt(async()=>{const{supabase:Y}=await import("./index-D9g1RJTX.js").then(P=>P.bm);return{supabase:Y}},__vite__mapDeps([0,1])),{profile:z}=await jt(async()=>{const{profile:Y}=await import("./index-D9g1RJTX.js").then(P=>P.bn);return{profile:Y}},__vite__mapDeps([0,1])).then(Y=>({profile:null})),A=a.items.reduce((Y,P)=>Y+P.quantity*P.sellingPrice,0)-a.discount,{error:g}=await c.from("sales").update({items:a.items,customer:a.customer,paymentmethod:a.paymentMethod,discount:a.discount,total:A}).eq("id",a.id);if(g)throw g;await Et(null,{action:"sale_update",tableName:"sales",recordId:a.id,newData:{items:a.items,customer:a.customer,paymentMethod:a.paymentMethod,discount:a.discount,total:A}}),queryClient.invalidateQueries({queryKey:["salesRepo"]}),queryClient.invalidateQueries({queryKey:["salesRepoPaged"]}),queryClient.invalidateQueries({queryKey:["salesRepoKeyset"]}),b.success("ÄÃ£ cáº­p nháº­t Ä‘Æ¡n hÃ ng thÃ nh cÃ´ng"),ke(!1),_(null)}catch(c){console.error("Error updating sale:",c),b.error("Lá»—i khi cáº­p nháº­t Ä‘Æ¡n hÃ ng: "+c.message)}}})]}):null},Is=()=>{const{upsertCustomer:G,cartItems:m,setCartItems:o,clearCart:K,deleteSale:F,currentBranchId:p,finalizeSale:L,setCashTransactions:R,setPaymentSources:ne}=At(),T=Bt(),{data:q=[],isLoading:Ye}=os(),we=is(),{data:U=[],isLoading:he,error:Ce}=_t(),{data:Ze=[]}=us(),[ue,V]=r.useState(1),[ge,Se]=r.useState(20),[Te,Me]=r.useState(""),[Le,Pe]=r.useState(""),[De,be]=r.useState(),[J,de]=r.useState(),[H,pe]=r.useState("all"),[Q,fe]=r.useState("all"),[M,Ie]=r.useState(!1),[X,_]=r.useState(null),We={branchId:p,page:M?void 0:ue,pageSize:ge,search:Le||void 0,fromDate:De,toDate:J,mode:M?"keyset":"offset",afterDate:M?X==null?void 0:X.afterDate:void 0,afterId:M?X==null?void 0:X.afterId:void 0,status:H==="all"?void 0:H==="cancelled"?"refunded":H==="completed"?"completed":H,paymentMethod:Q==="all"?void 0:Q},{data:k,isLoading:Je,error:ke}=cs(We),te=(k==null?void 0:k.data)||[],l=(k==null?void 0:k.meta)||{page:1,totalPages:1,total:te.length,hasMore:!1};r.useEffect(()=>{var t;M&&((t=k==null?void 0:k.meta)==null?void 0:t.mode)==="keyset"&&_({afterDate:k.meta.nextAfterDate,afterId:k.meta.nextAfterId})},[M,k]);const{mutateAsync:u}=xs(),y=gs(),a=r.useCallback(()=>V(t=>Math.max(1,t-1)),[]),c=r.useCallback(()=>V(t=>t+1),[]),z=r.useCallback(t=>{Se(t),V(1),M&&_(null)},[]);r.useEffect(()=>{const t=setTimeout(()=>{Pe(Te),V(1)},300);return()=>clearTimeout(t)},[Te]);const[w,A]=r.useState(""),[g,Y]=r.useState("all"),[P,je]=r.useState(""),[ve,xt]=r.useState(!1),[mt,Ke]=r.useState(!1),ze=r.useRef(null),[se,ae]=r.useState(""),[$,ye]=r.useState("products"),[D,C]=r.useState(null),[Z,Ve]=r.useState(!1),[ee,Ae]=r.useState(0),[Be,vt]=r.useState("amount"),[yt,et]=r.useState(0),[Ot,tt]=r.useState(!1),[Ft,Oe]=r.useState(!1),[E,Ne]=r.useState({name:"",phone:"",vehicleModel:"",licensePlate:""}),[Nt,wt]=r.useState(""),[_e,ht]=r.useState(""),[oe,ut]=r.useState(""),[Fe,Ct]=r.useState([]),[st,St]=r.useState(0),[re,gt]=r.useState(null),[O,at]=r.useState(null),[qe,rt]=r.useState(0),[Tt,Rt]=r.useState(!1);r.useEffect(()=>{var t;ve&&((t=ze.current)==null||t.focus())},[ve]);const[Gt,bt]=r.useState(!1),[I,pt]=r.useState(null),[f,Ut]=r.useState(null);r.useEffect(()=>{(async()=>{try{const{data:s,error:n}=await Dt.from("store_settings").select("store_name, address, phone, email, logo_url, bank_qr_url, bank_name, bank_account_number, bank_account_holder, bank_branch").order("created_at",{ascending:!1}).limit(1).single();if(n){console.error("Error fetching store settings:",n);return}Ut(s)}catch(s){console.error("Failed to fetch store settings:",s)}})()},[]);const Re=r.useCallback(t=>{var i,h;const s=((i=t.retailPrice)==null?void 0:i[p])??0,n=((h=t.stock)==null?void 0:h[p])??0,d=m.find(v=>v.partId===t.id);if(d){const v=d.quantity+1;if(v>n){b.error(`KhÃ´ng Ä‘á»§ hÃ ng! Tá»“n kho: ${n}`);return}o(B=>B.map(S=>S.partId===t.id?{...S,quantity:v}:S))}else{if(n<1){b.error("Sáº£n pháº©m Ä‘Ã£ háº¿t hÃ ng!");return}const v={partId:t.id,partName:t.name,sku:t.sku,quantity:1,sellingPrice:s,stockSnapshot:n,discount:0};o(B=>[...B,v])}},[m,o,p]),lt=r.useCallback(t=>{o(s=>s.filter(n=>n.partId!==t))},[o]),Ge=r.useCallback((t,s)=>{if(s<=0){lt(t);return}const n=m.find(d=>d.partId===t);if(n&&s>n.stockSnapshot){b.error(`KhÃ´ng Ä‘á»§ hÃ ng! Tá»“n kho: ${n.stockSnapshot}`);return}o(d=>d.map(i=>i.partId===t?{...i,quantity:s}:i))},[m,o,lt]),ie=r.useMemo(()=>m.reduce((t,s)=>t+s.sellingPrice*s.quantity,0),[m]),Mt=r.useMemo(()=>Math.max(0,ie-ee),[ie,ee]),Qt=r.useMemo(()=>{const t=new Map;return m.forEach(s=>t.set(s.partId,s)),t},[m]),ft=r.useMemo(()=>Fe.reduce((t,s)=>t+s.sellingPrice*s.quantity,0),[Fe]),Xt=r.useMemo(()=>Math.max(0,ft-st),[ft,st]),Yt=r.useMemo(()=>Fe.reduce((t,s)=>t+s.quantity,0),[Fe]),ce=r.useMemo(()=>{if(he||Ce)return[];let t=U;return w&&(t=t.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())||s.sku.toLowerCase().includes(w.toLowerCase()))),t},[U,w,he,Ce]),kt=r.useMemo(()=>{if(!ce.length)return[];const t=ce.filter(n=>{var i;const d=Number(((i=n.stock)==null?void 0:i[p])??0);return g==="low"?d>0&&d<=ot:g==="out"?d<=0:!0}),s=n=>n<=0?2:n<=ot?1:0;return t.slice().sort((n,d)=>{var B,S;const i=Number(((B=n.stock)==null?void 0:B[p])??0),h=Number(((S=d.stock)==null?void 0:S[p])??0),v=s(i)-s(h);return v!==0?v:n.name.localeCompare(d.name)}).slice(0,36)},[ce,g,p]),He=t=>t.toLowerCase().replace(/[-\s./\\]/g,""),Zt=t=>{if(t.preventDefault(),!P.trim())return;const s=P.trim(),n=He(s),d=ce.find(i=>{var h,v,B;return He(i.barcode||"")===n||((h=i.barcode)==null?void 0:h.toLowerCase())===s.toLowerCase()||He(i.sku||"")===n||((v=i.sku)==null?void 0:v.toLowerCase())===s.toLowerCase()||((B=i.name)==null?void 0:B.toLowerCase().includes(s.toLowerCase()))});d?(Re(d),b.success(`ÄÃ£ thÃªm ${d.name} vÃ o giá» hÃ ng`),je(""),setTimeout(()=>{var i;return(i=ze.current)==null?void 0:i.focus()},100)):(b.error(`KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m cÃ³ mÃ£: ${s}`),je(""))},Jt=t=>{console.log("ðŸ“· Camera scanned:",t);const s=He(t),n=U.find(d=>{var i,h;return He(d.barcode||"")===s||((i=d.barcode)==null?void 0:i.toLowerCase())===t.toLowerCase()||He(d.sku||"")===s||((h=d.sku)==null?void 0:h.toLowerCase())===t.toLowerCase()});if(n){const d=m.find(i=>i.partId===n.id);d?Ge(n.id,d.quantity+1):(Re(n),b.success(`ÄÃ£ thÃªm ${n.name}`))}else b.error(`KhÃ´ng tÃ¬m tháº¥y: ${t}`)},{lowStockCount:Ue,outOfStockCount:Qe}=vs(U,p,ot),es=[{key:"all",label:"Táº¥t cáº£",count:ce.length,activeClass:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-transparent shadow-blue-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"},{key:"low",label:"Tá»“n tháº¥p",count:Ue,activeClass:"bg-gradient-to-r from-amber-500 to-orange-500 text-white border-transparent shadow-amber-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-amber-700 dark:text-amber-200 border border-amber-200/70 dark:border-amber-800/60"},{key:"out",label:"Háº¿t hÃ ng",count:Qe,activeClass:"bg-gradient-to-r from-rose-500 to-red-500 text-white border-transparent shadow-rose-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-rose-700 dark:text-rose-200 border border-rose-200/70 dark:border-rose-800/60"}],Lt=r.useRef(!1);r.useEffect(()=>{if(!Lt.current&&(Ue>0||Qe>0)){const t=[];Qe>0&&t.push(`Háº¿t hÃ ng: ${Qe}`),Ue>0&&t.push(`Tá»“n tháº¥p: ${Ue}`),b.info(t.join(" Â· ")),Lt.current=!0}},[Ue,Qe]);const Pt=r.useMemo(()=>se?q.filter(t=>{var s;return t.name.toLowerCase().includes(se.toLowerCase())||((s=t.phone)==null?void 0:s.includes(se))||!1}).slice(0,10):q.slice(0,10),[q,se]),ts=()=>{if(!E.name||!E.phone){alert("Vui lÃ²ng nháº­p tÃªn vÃ  sá»‘ Ä‘iá»‡n thoáº¡i");return}if(q.find(n=>n.phone===E.phone)){alert("Sá»‘ Ä‘iá»‡n thoáº¡i nÃ y Ä‘Ã£ tá»“n táº¡i!");return}const s={id:`CUST-${Date.now()}`,name:E.name,phone:E.phone,vehicleModel:E.vehicleModel,licensePlate:E.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()};we.mutate(s,{onSuccess:()=>{C(s),ae(s.name),Ne({name:"",phone:"",vehicleModel:"",licensePlate:""}),Oe(!1),b.success("ÄÃ£ thÃªm khÃ¡ch hÃ ng má»›i!")},onError:n=>{console.error("Error creating customer:",n),b.error("KhÃ´ng thá»ƒ thÃªm khÃ¡ch hÃ ng. Vui lÃ²ng thá»­ láº¡i.")}})},ss=t=>{pt(t),bt(!0)},as=()=>{if(!I)return;wt(I.sale_code||ct(I.id)||I.id),ht(I.customer.name),ut(I.customer.phone||"");const t=I.items.map(s=>({partId:s.partId||s.partid||"",partName:s.partName||s.partname||"",sku:s.sku||"",quantity:s.quantity||0,sellingPrice:s.sellingPrice||s.sellingprice||s.price||0,stockSnapshot:s.stockSnapshot||0,discount:s.discount||0}));Ct(t),St(I.discount||0),setTimeout(()=>{It("last-receipt"),bt(!1),pt(null)},100)},{profile:j}=qt(),rs=async t=>{var s;if(!hs(j==null?void 0:j.role,"sale.delete")){b.error("Báº¡n khÃ´ng cÃ³ quyá»n xÃ³a hÃ³a Ä‘Æ¡n");return}if(confirm("XÃ¡c nháº­n xÃ³a hÃ³a Ä‘Æ¡n nÃ y? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c."))try{const{deleteSaleById:n}=await jt(async()=>{const{deleteSaleById:i}=await import("./index-D9g1RJTX.js").then(h=>h.bo);return{deleteSaleById:i}},__vite__mapDeps([0,1])),d=await n(t);if(!d.ok){b.error(((s=d.error)==null?void 0:s.message)||"XÃ³a hÃ³a Ä‘Æ¡n tháº¥t báº¡i!");return}T.invalidateQueries({queryKey:["sales"]}),b.success("ÄÃ£ xÃ³a hÃ³a Ä‘Æ¡n thÃ nh cÃ´ng!"),Et((j==null?void 0:j.id)||null,{action:"sale.delete",tableName:"sales",recordId:t,oldData:null,newData:null})}catch(n){b.error("XÃ³a hÃ³a Ä‘Æ¡n tháº¥t báº¡i!"),console.error("Delete sale error:",n)}},ls=t=>{if(confirm("Má»Ÿ láº¡i hÃ³a Ä‘Æ¡n nÃ y Ä‘á»ƒ chá»‰nh sá»­a? Giá» hÃ ng hiá»‡n táº¡i sáº½ bá»‹ xÃ³a.")){if(K(),t.items.forEach(s=>{const n=U.find(d=>d.id===s.partId);if(n)for(let d=0;d<s.quantity;d++)Re(n)}),t.customer.id){const s=q.find(n=>n.id===t.customer.id);s&&(C(s),ae(s.name))}else ht(t.customer.name),ut(t.customer.phone||"");Ae(t.discount||0),tt(!1),alert("HÃ³a Ä‘Æ¡n Ä‘Ã£ Ä‘Æ°á»£c táº£i vÃ o giá» hÃ ng Ä‘á»ƒ chá»‰nh sá»­a")}},ns=async(t,s,n,d)=>{var i;if(!(s<=0)){console.log("[createCustomerDebtIfNeeded] CALLED with:",{saleId:t.id,totalAmount:n,paidAmount:d,remainingAmount:s,customerName:t.customer.name,timestamp:new Date().toISOString()});try{const h=t.customer.id||t.customer.phone||`CUST-ANON-${Date.now()}`,v=((i=t.customer.name)==null?void 0:i.trim())||t.customer.phone||"KhÃ¡ch láº»";let S=`BÃ¡n hÃ ng - HÃ³a Ä‘Æ¡n ${t.sale_code||t.id}`;t.items&&t.items.length>0&&(S+=`

Sáº£n pháº©m Ä‘Ã£ mua:`,t.items.forEach(N=>{const W=N.quantity*N.sellingPrice,$e=N.discount||0;S+=`
  â€¢ ${N.quantity} x ${N.partName} - ${x(W)}`,$e>0&&(S+=` (Giáº£m: ${x($e)})`)})),t.discount&&t.discount>0&&(S+=`

Giáº£m giÃ¡ Ä‘Æ¡n hÃ ng: -${x(t.discount)}`);const xe=t.paymentMethod==="cash"?"Tiá»n máº·t":"Chuyá»ƒn khoáº£n";S+=`

PhÆ°Æ¡ng thá»©c: ${xe}`,S+=`

NV: ${t.userName||"N/A"}`;const le={customerId:h,customerName:v,phone:t.customer.phone||null,licensePlate:null,description:S,totalAmount:n,paidAmount:d,remainingAmount:s,createdDate:new Date().toISOString().split("T")[0],branchId:p,saleId:t.id};console.log("[SalesManager] createCustomerDebt payload:",le);const me=await y.mutateAsync(le);console.log("[SalesManager] createCustomerDebt result:",me),b.success(`ÄÃ£ táº¡o cÃ´ng ná»£ ${x(s)} cho ${v}`)}catch(h){console.error("Error creating customer debt:",h),console.error("Error details:",{message:h==null?void 0:h.message,cause:h==null?void 0:h.cause,stack:h==null?void 0:h.stack}),b.error(`KhÃ´ng thá»ƒ táº¡o cÃ´ng ná»£ tá»± Ä‘á»™ng: ${(h==null?void 0:h.message)||"Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh"}`)}}},ds=async()=>{var t,s,n,d;if(m.length===0){alert("Vui lÃ²ng thÃªm sáº£n pháº©m vÃ o giá» hÃ ng");return}if(!D&&!_e&&!oe){alert("Vui lÃ²ng nháº­p thÃ´ng tin khÃ¡ch hÃ ng trÆ°á»›c khi bÃ¡n hÃ ng");return}if(!re){alert("Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n");return}if(!O){alert("Vui lÃ²ng chá»n hÃ¬nh thá»©c thanh toÃ¡n");return}if(O==="partial"&&qe<=0){alert("Vui lÃ²ng nháº­p sá»‘ tiá»n khÃ¡ch tráº£");return}try{for(const N of m){const W=U.find(nt=>nt.id===N.partId);if(!W){b.error(`KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m: ${N.partName}`);return}const $e=((t=W.stock)==null?void 0:t[p])??0;if(N.quantity>$e){b.error(`KhÃ´ng Ä‘á»§ hÃ ng cho ${W.name}. Tá»“n kho: ${$e}`);return}}const i=`SALE-${Date.now()}`,h=m.reduce((N,W)=>N+W.sellingPrice*W.quantity,0),v=m.reduce((N,W)=>N+(W.discount||0),0),B=Math.max(0,h-v-ee),S={id:D==null?void 0:D.id,name:(D==null?void 0:D.name)||_e||"KhÃ¡ch láº»",phone:(D==null?void 0:D.phone)||oe};wt(i),ht(S.name),ut(S.phone||""),Ct([...m]),St(ee+v),!D&&oe&&_e&&(q.find(W=>W.phone===oe)||G({id:`CUST-${Date.now()}`,name:_e,phone:oe,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()}));const xe=await u({id:i,items:m,discount:ee+v,customer:S,paymentMethod:re,userId:(j==null?void 0:j.id)||"local-user",userName:(j==null?void 0:j.email)||(j==null?void 0:j.full_name)||"Local User",branchId:p});if(xe!=null&&xe.error)throw xe.error;const le=O==="full"?B:O==="partial"?qe:0,me=B-le;if(console.log("[SalesManager] Payment details:",{paymentType:O,total:B,paidAmount:le,partialAmount:qe,remainingAmount:me,hasCustomer:!!(D||_e||oe)}),me>0){console.log("[SalesManager] Creating debt because remaining > 0");const{data:N,error:W}=await Dt.from("sales").select(`
            *,
            user:userid(
              full_name,
              display_name,
              email
            )
          `).eq("id",i).single();W&&console.error("[SalesManager] Error fetching sale:",W);const nt=(N?{...N,userName:((s=N.user)==null?void 0:s.full_name)||((n=N.user)==null?void 0:n.display_name)||((d=N.user)==null?void 0:d.email)||"N/A"}:null)||{id:i,sale_code:void 0,date:new Date().toISOString(),items:m,subtotal:ie,discount:ee+v,total:B,customer:S,paymentMethod:re,userName:(j==null?void 0:j.email)||(j==null?void 0:j.full_name)||"Local User",userId:(j==null?void 0:j.id)||"",branchId:p||""};console.log("[SalesManager] Sale data for debt:",nt),await ns(nt,me,B,le)}else console.log("[SalesManager] No debt needed, paid in full");C(null),ae(""),Ae(0),et(0),vt("amount"),gt(null),at(null),rt(0),K(),Tt&&setTimeout(()=>{It("last-receipt")},100)}catch(i){console.error("Error finalizing sale (atomic):",i),b.error((i==null?void 0:i.message)||"CÃ³ lá»—i khi táº¡o hÃ³a Ä‘Æ¡n (atomic)")}};return r.useEffect(()=>{const t=s=>{s.target.closest(".customer-dropdown-container")||Ve(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),e.jsxs("div",{className:"min-h-screen max-w-full overflow-x-hidden bg-gradient-to-br from-slate-50 via-blue-50/20 to-indigo-50/30 dark:from-slate-900 dark:via-slate-900 dark:to-slate-800 pb-16 md:pb-0",children:[e.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 safe-area-bottom",children:[e.jsx("div",{className:"absolute inset-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg -z-10"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 px-2 py-2",children:[e.jsxs("button",{onClick:()=>ye("products"),className:`flex flex-col items-center gap-1 px-1 py-1.5 rounded-lg transition-all duration-200 ${$==="products"?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30":"text-slate-600 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(Ee,{className:`w-6 h-6 transition-transform ${$==="products"?"scale-105":""}`}),e.jsx("span",{className:`text-[9px] font-medium ${$==="products"?"font-semibold":""}`,children:"Sáº£n pháº©m"})]}),e.jsxs("button",{onClick:()=>ye("cart"),className:`flex flex-col items-center gap-1 px-1 py-1.5 rounded-lg transition-all duration-200 relative ${$==="cart"?"text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30":"text-slate-600 dark:text-slate-400 active:scale-95"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:`w-6 h-6 transition-transform ${$==="cart"?"scale-105":""}`}),m.length>0&&e.jsx("span",{className:"absolute -top-1 -right-2 px-1 min-w-[14px] h-[14px] text-[8px] font-bold rounded-full bg-red-500 text-white flex items-center justify-center",children:m.length})]}),e.jsx("span",{className:`text-[9px] font-medium ${$==="cart"?"font-semibold":""}`,children:"Giá» hÃ ng"})]}),e.jsxs("button",{onClick:()=>{ye("history"),tt(!0)},className:`flex flex-col items-center gap-1 px-1 py-1.5 rounded-lg transition-all duration-200 ${$==="history"?"text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30":"text-slate-600 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(zt,{className:`w-6 h-6 transition-transform ${$==="history"?"scale-105":""}`}),e.jsx("span",{className:`text-[9px] font-medium ${$==="history"?"font-semibold":""}`,children:"Lá»‹ch sá»­"})]})]})]}),e.jsxs("div",{className:"flex h-[calc(100vh-64px)] md:h-screen",children:[e.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${$!=="products"?"hidden md:flex":"animate-fade-in"}`,children:[e.jsx("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-b border-slate-200/50 dark:border-slate-700/50 p-3 md:p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"TÃ¬m kiáº¿m sáº£n pháº©m...",value:w,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-2.5 border-2 border-slate-300/50 dark:border-slate-600/50 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm md:text-base transition-all placeholder:text-slate-400"})]}),e.jsxs("button",{type:"button",onClick:()=>xt(t=>!t),className:`px-4 py-2 rounded-xl border-2 font-semibold text-sm flex items-center gap-2 transition-all ${ve?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-200 bg-white dark:bg-slate-800"}`,children:[e.jsx(js,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:ve?"ÄÃ³ng quÃ©t":"QuÃ©t mÃ£"})]}),e.jsx("button",{type:"button",onClick:()=>Ke(!0),className:"md:hidden px-3 py-2 rounded-xl border-2 border-green-500 text-green-600 bg-green-50 dark:bg-green-900/20 font-semibold text-sm flex items-center gap-1.5 transition-all hover:bg-green-100",title:"QuÃ©t báº±ng camera",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),ve&&e.jsxs("form",{onSubmit:Zt,className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-blue-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),e.jsx("input",{ref:ze,type:"text",placeholder:"Nháº­p hoáº·c quÃ©t mÃ£ váº¡ch...",value:P,onChange:t=>je(t.target.value),className:"w-full pl-10 pr-10 py-2.5 border-2 border-blue-400 dark:border-blue-600 rounded-xl bg-blue-50/50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm md:text-base transition-all placeholder:text-blue-500/70 font-mono"}),P&&e.jsx("button",{type:"button",onClick:()=>je(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"hidden md:flex items-center gap-2",children:e.jsxs("button",{onClick:()=>tt(!0),className:"px-4 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl whitespace-nowrap transition-all inline-flex items-center gap-2 text-sm font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:"Lá»‹ch sá»­ bÃ¡n hÃ ng",children:[e.jsx(zt,{className:"w-5 h-5"}),e.jsx("span",{children:"Lá»‹ch sá»­"})]})})]})}),e.jsxs("div",{className:"bg-white/80 dark:bg-slate-800/80 border-b border-slate-200/60 dark:border-slate-700/60 px-3 md:px-6 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"text-xs md:text-sm text-slate-600 dark:text-slate-400 font-medium",children:["Hiá»ƒn thá»‹ ",kt.length," / ",ce.length||0," sáº£n pháº©m",w&&" theo tá»« khÃ³a"]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:es.map(t=>{const s=g===t.key;return e.jsxs("button",{type:"button","aria-pressed":s,onClick:()=>Y(t.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold transition-all whitespace-nowrap ${s?t.activeClass:t.inactiveClass}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] font-black ${s?"bg-white/30":"bg-slate-100 dark:bg-slate-800"}`,children:t.count})]},t.key)})})]}),e.jsx("div",{className:"flex-1 p-0 md:p-6 overflow-y-auto bg-slate-50 dark:bg-slate-900 pb-24 md:pb-6",children:kt.length===0?e.jsxs("div",{className:"text-center text-slate-400 mt-20",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",children:e.jsx(Ee,{className:"w-16 h-16 text-slate-300"})}),e.jsx("div",{className:"text-xl font-medium mb-2",children:ce.length===0?w?"KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m nÃ o":"ChÆ°a cÃ³ sáº£n pháº©m":g==="low"?"KhÃ´ng cÃ³ sáº£n pháº©m tá»“n tháº¥p":"KhÃ´ng cÃ³ sáº£n pháº©m háº¿t hÃ ng"}),e.jsx("div",{className:"text-sm",children:ce.length===0?w?"HÃ£y thá»­ má»™t tá»« khÃ³a tÃ¬m kiáº¿m khÃ¡c":"Vui lÃ²ng thÃªm sáº£n pháº©m vÃ o há»‡ thá»‘ng":"HÃ£y chá»n bá»™ lá»c khÃ¡c Ä‘á»ƒ xem thÃªm sáº£n pháº©m"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2.5 md:gap-3",children:kt.map(t=>{var le,me;const s=Number(((le=t.retailPrice)==null?void 0:le[p])??0),n=Number(((me=t.stock)==null?void 0:me[p])??0),d=n<=0,i=n>0&&n<=ot,h=Qt.get(t.id),v=!!h,B=d?"Háº¿t hÃ ng":i?"Tá»“n tháº¥p":"Sáºµn hÃ ng",S=d?"bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-200":i?"bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-200":"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-200",xe=d?"bg-gradient-to-r from-rose-500 to-red-500 text-white":i?"bg-gradient-to-r from-amber-500 to-orange-500 text-white":"bg-gradient-to-r from-emerald-500 to-green-500 text-white";return e.jsx("div",{className:`group relative text-left p-3 md:p-4 rounded-2xl border transition-all duration-200 h-full ${d?"bg-slate-50/70 dark:bg-slate-900/30 border-slate-200 dark:border-slate-800":"bg-white dark:bg-slate-800/70 border-slate-200/70 dark:border-slate-700 md:hover:border-blue-400 md:dark:hover:border-blue-500 md:hover:shadow-xl md:cursor-pointer"} ${v?"ring-2 ring-blue-200 dark:ring-blue-500/40":""}`,onClick:()=>{window.innerWidth>=768&&!d&&Re(t)},children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:N=>{N.stopPropagation(),d||Re(t)},disabled:d,className:`md:hidden w-12 h-12 rounded-xl flex items-center justify-center transition-all ${d?"bg-slate-100 dark:bg-slate-700 cursor-not-allowed":"bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg active:scale-95"}`,children:d?e.jsx(Ee,{className:"w-6 h-6 text-slate-400"}):e.jsx(dt,{className:"w-5 h-5"})}),e.jsx("div",{className:`hidden md:flex w-12 h-12 rounded-xl items-center justify-center ${d?"bg-slate-100 dark:bg-slate-700":"bg-slate-100 text-orange-500 dark:bg-slate-700/70"}`,children:e.jsx(Ee,{className:`w-6 h-6 ${d?"text-slate-400":"text-orange-500 dark:text-orange-300"}`})}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[11px] font-semibold ${S}`,children:B})]}),v&&e.jsxs("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-200",children:["ÄÃ£ chá»n Ã—",h==null?void 0:h.quantity]})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm text-slate-900 dark:text-slate-100 line-clamp-2",title:t.name,children:t.name}),e.jsx("div",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-mono truncate",children:t.sku})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-400 dark:text-slate-500 font-semibold",children:"GiÃ¡ bÃ¡n"}),e.jsx("p",{className:`text-sm md:text-base font-bold ${d?"text-slate-400 dark:text-slate-500":"text-blue-600 dark:text-blue-300"}`,children:x(s)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-400 dark:text-slate-500 font-semibold",children:"Tá»“n kho"}),e.jsx("span",{className:`inline-flex items-center justify-center min-w-[2.75rem] px-2.5 py-1 text-[11px] font-black rounded-lg ${xe}`,children:Math.max(0,Math.floor(n))})]})]})]})},t.id)})})})]}),e.jsxs("div",{className:`w-full md:w-[40%] bg-white dark:bg-slate-800 md:border-l border-slate-200 dark:border-slate-700 flex flex-col transition-all duration-300 overflow-y-auto ${$!=="cart"?"hidden md:flex":"animate-fade-in"}`,children:[e.jsx("div",{className:"p-3 md:p-4 border-b border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 bg-white dark:bg-slate-800 md:bg-gradient-to-r md:from-emerald-50/30 md:via-teal-50/20 md:to-cyan-50/30 dark:md:from-slate-800/50 dark:md:via-slate-800/30 dark:md:to-slate-800/50",children:e.jsxs("div",{className:"customer-dropdown-container",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:[e.jsx("div",{className:"w-7 h-7 md:w-8 md:h-8 bg-emerald-500 md:bg-gradient-to-br md:from-emerald-500 md:to-teal-500 rounded-lg flex items-center justify-center md:shadow-lg",children:e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("span",{children:"KhÃ¡ch hÃ ng"})]}),e.jsxs("div",{className:"relative flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"TÃ¬m tÃªn, sá»‘ Ä‘iá»‡n thoáº¡i...",value:se,onChange:t=>{ae(t.target.value),Ve(!0)},onFocus:()=>Ve(!0),onBlur:()=>{setTimeout(()=>Ve(!1),200)},className:"w-full pl-10 pr-4 py-2 md:py-2.5 border md:border-2 border-slate-300 md:border-slate-300/50 dark:border-slate-600/50 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all placeholder:text-slate-400"}),Z&&e.jsx("div",{className:"absolute top-full left-0 right-0 z-50 mt-1 max-h-48 overflow-y-auto bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg shadow-lg",children:Pt.length>0?Pt.map(t=>e.jsxs("button",{onClick:()=>{C(t),ae(t.name),Ve(!1)},className:"w-full text-left px-3 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-600 border-b border-slate-100 dark:border-slate-600 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:t.name}),t.phone&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["ðŸ“ž ",t.phone]})]},t.id)):e.jsx("div",{className:"px-3 py-3 text-center text-slate-500 dark:text-slate-400 text-sm",children:se?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"KhÃ´ng tÃ¬m tháº¥y khÃ¡ch hÃ ng"}),e.jsx("button",{onClick:()=>Oe(!0),className:"mt-2 text-emerald-500 hover:text-emerald-600 font-medium",children:"+ ThÃªm khÃ¡ch hÃ ng má»›i"})]}):q.length===0?e.jsx("div",{children:"ChÆ°a cÃ³ khÃ¡ch hÃ ng nÃ o"}):e.jsx("div",{children:"Nháº­p tÃªn hoáº·c SÄT Ä‘á»ƒ tÃ¬m..."})})})]}),e.jsxs("button",{onClick:()=>Oe(!0),className:"px-3 py-2 md:px-4 md:py-2.5 bg-emerald-500 md:bg-gradient-to-r md:from-emerald-500 md:to-teal-500 hover:bg-emerald-600 md:hover:from-emerald-600 md:hover:to-teal-600 text-white rounded-lg md:rounded-xl flex items-center justify-center gap-2 transition-all md:shadow-lg md:hover:shadow-xl md:hover:scale-105 md:active:scale-95 font-semibold md:font-bold",title:"ThÃªm khÃ¡ch hÃ ng má»›i",children:[e.jsx(Wt,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:"ThÃªm"})]})]}),D&&e.jsx("div",{className:"mt-2 md:mt-3 p-2 md:p-3.5 bg-emerald-50 dark:bg-emerald-900/20 md:bg-gradient-to-r md:from-emerald-50 md:to-teal-50 dark:md:from-emerald-900/20 dark:md:to-teal-900/20 rounded-lg md:rounded-xl border md:border-2 border-emerald-200 dark:border-emerald-800 md:shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"hidden md:flex w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-lg items-center justify-center shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium md:font-bold text-emerald-900 dark:text-emerald-100 truncate text-sm md:text-base",children:D.name}),D.phone&&e.jsxs("div",{className:"text-xs text-emerald-700 dark:text-emerald-300 flex items-center gap-1 mt-0.5",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0 hidden md:inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:D.phone})]})]})]}),e.jsx("button",{onClick:()=>{C(null),ae("")},className:"w-7 h-7 md:w-8 md:h-8 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 rounded-md md:rounded-lg flex items-center justify-center transition-all flex-shrink-0 md:shadow-sm md:hover:shadow-md text-lg",title:"XÃ³a",children:"Ã—"})]})})]})}),e.jsxs("div",{className:"p-3 md:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4 pb-2 md:pb-3 border-b md:border-b-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"hidden md:flex w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg items-center justify-center shadow-lg",children:e.jsx(dt,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-base md:text-lg font-semibold md:font-black text-slate-900 dark:text-slate-100",children:"Giá» hÃ ng"})]}),e.jsx("span",{className:"px-2 py-0.5 md:px-3 md:py-1 bg-blue-100 md:bg-gradient-to-r md:from-blue-100 md:to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-semibold md:font-bold md:shadow-sm",children:m.length})]}),m.length===0?e.jsxs("div",{className:"text-center py-12 md:py-16 mb-3",children:[e.jsx("div",{className:"mb-3 md:mb-4 flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-slate-100 md:bg-gradient-to-br md:from-slate-100 md:to-slate-200 dark:from-slate-800 dark:to-slate-700 rounded-2xl md:rounded-3xl flex items-center justify-center md:shadow-lg",children:e.jsx(dt,{className:"w-8 h-8 md:w-10 md:h-10 text-slate-400 dark:text-slate-500"})})}),e.jsx("div",{className:"text-sm md:text-base font-semibold md:font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Giá» hÃ ng trá»‘ng"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-500",children:"Chá»n sáº£n pháº©m Ä‘á»ƒ thÃªm vÃ o giá»"})]}):e.jsx("div",{className:"space-y-2 md:space-y-2.5",children:m.map(t=>e.jsxs("div",{className:"group p-2.5 md:p-3 border md:border-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 rounded-xl md:rounded-xl bg-white dark:bg-slate-800 md:hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 md:hover:shadow-lg md:hover:shadow-blue-500/10",children:[e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"flex items-start gap-2.5 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 dark:bg-orange-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ee,{className:"w-5 h-5 text-orange-500 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-900 dark:text-slate-100 leading-tight mb-1",title:t.partName,children:t.partName}),e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 rounded-md",children:e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-medium",children:t.sku})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:x(t.sellingPrice)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Ge(t.partId,Math.max(1,t.quantity-1)),className:"w-7 h-7 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded-md text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all font-bold text-base",children:"-"}),e.jsx("span",{className:"w-7 text-center font-bold text-xs text-slate-900 dark:text-slate-100 px-1 py-0.5 bg-slate-50 dark:bg-slate-700 rounded-md",children:t.quantity}),e.jsx("button",{onClick:()=>Ge(t.partId,t.quantity+1),className:"w-7 h-7 flex items-center justify-center bg-blue-500 dark:bg-blue-600 rounded-md text-white hover:bg-blue-600 dark:hover:bg-blue-700 transition-all font-bold text-base",children:"+"}),e.jsx("button",{onClick:()=>lt(t.partId),className:"w-7 h-7 flex items-center justify-center bg-red-500 hover:bg-red-600 rounded-md text-white transition-all ml-0.5 font-bold text-base",children:"Ã—"})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(Ee,{className:"w-6 h-6 text-orange-500 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-slate-900 dark:text-slate-100 line-clamp-1 mb-1",title:t.partName,children:t.partName}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-slate-100 dark:bg-slate-700 rounded-md mb-1",children:e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-semibold",children:t.sku})}),e.jsx("div",{className:"text-sm font-black bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent",children:x(t.sellingPrice)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>Ge(t.partId,Math.max(1,t.quantity-1)),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:from-slate-200 hover:to-slate-300 dark:hover:from-slate-600 dark:hover:to-slate-500 transition-all shadow-sm hover:shadow-md font-bold",children:"-"}),e.jsx("span",{className:"w-10 text-center font-black text-sm text-slate-900 dark:text-slate-100 px-2 py-1 bg-slate-50 dark:bg-slate-700 rounded-lg",children:t.quantity}),e.jsx("button",{onClick:()=>Ge(t.partId,t.quantity+1),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-blue-500 to-indigo-500 dark:from-blue-600 dark:to-indigo-600 rounded-lg text-white hover:from-blue-600 hover:to-indigo-600 dark:hover:from-blue-700 dark:hover:to-indigo-700 transition-all shadow-md hover:shadow-lg font-bold",children:"+"}),e.jsx("button",{onClick:()=>lt(t.partId),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 rounded-lg text-white transition-all ml-1 shadow-md hover:shadow-lg font-bold text-lg",children:"Ã—"})]})]})]},t.partId))})]}),m.length>0&&e.jsxs("div",{className:"border-t md:border-t-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 bg-slate-50 dark:bg-slate-800 md:bg-gradient-to-br md:from-slate-50 md:to-blue-50/30 dark:md:from-slate-800 dark:md:to-slate-800/50",children:[e.jsxs("div",{className:"p-3 md:p-4 space-y-2 md:space-y-3 pb-20 md:pb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs md:text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Tá»•ng tiá»n hÃ ng"}),e.jsx("span",{className:"font-semibold md:font-bold text-slate-900 dark:text-slate-100",children:x(ie)})]}),e.jsxs("div",{className:"space-y-2 md:space-y-2.5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between text-xs md:text-sm gap-1.5 md:gap-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Giáº£m giÃ¡:"}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"number",value:Be==="amount"?ee:yt,onChange:t=>{const s=Number(t.target.value)||0;if(Be==="amount")Ae(Math.min(s,ie));else{const n=Math.min(s,100);et(n),Ae(Math.round(ie*n/100))}},className:"flex-1 md:w-24 px-2 md:px-3 py-1.5 md:py-2 text-right text-xs md:text-sm border md:border-2 border-slate-300 md:border-slate-300 dark:border-slate-600 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all font-medium md:font-semibold",placeholder:"0",min:"0",max:Be==="amount"?ie:100}),e.jsxs("select",{value:Be,onChange:t=>{const s=t.target.value;vt(s),Ae(0),et(0)},className:"px-2 md:px-3 py-1.5 md:py-2 border md:border-2 border-slate-300 md:border-slate-300 dark:border-slate-600 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs md:text-sm font-semibold md:font-bold focus:ring-2 focus:ring-purple-500 transition-all",children:[e.jsx("option",{value:"amount",children:"â‚«"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),Be==="percent"&&e.jsx("div",{className:"flex gap-1.5 md:gap-2 justify-end flex-wrap",children:[5,10,15,20].map(t=>e.jsxs("button",{onClick:()=>{et(t),Ae(Math.round(ie*t/100))},className:"px-2 md:px-3 py-1 md:py-1.5 text-[10px] md:text-xs font-semibold md:font-bold bg-purple-100 md:bg-gradient-to-r md:from-purple-100 md:to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 hover:bg-purple-200 md:hover:from-purple-200 md:hover:to-pink-200 dark:hover:from-purple-900/50 dark:hover:to-pink-900/50 text-purple-700 dark:text-purple-300 rounded-md md:rounded-lg transition-all md:shadow-sm md:hover:shadow-md",children:[t,"%"]},t))}),Be==="percent"&&yt>0&&e.jsxs("div",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 text-right",children:["= ",x(ee)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 md:pt-3 mt-2 md:mt-3 border-t md:border-t-2 border-slate-200 dark:border-slate-700 p-2 md:p-3 -mx-3 md:-mx-4 bg-blue-600 md:bg-gradient-to-r md:from-blue-600 md:to-indigo-600 dark:from-blue-700 dark:to-indigo-700 rounded-b-lg md:rounded-b-xl md:shadow-lg",children:[e.jsx("span",{className:"font-semibold md:font-bold text-white text-xs md:text-sm",children:"KhÃ¡ch pháº£i tráº£"}),e.jsx("span",{className:"font-black text-lg md:text-2xl text-white",children:x(Math.max(0,Mt-ee))})]})]}),e.jsxs("div",{className:"px-3 md:px-4 pb-3 md:pb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs md:text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:[e.jsx("span",{children:"PhÆ°Æ¡ng thá»©c thanh toÃ¡n"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsxs("button",{onClick:()=>gt("cash"),className:`flex items-center justify-center gap-1.5 md:gap-2 px-3 md:px-4 py-2 md:py-3 rounded-lg md:rounded-xl border md:border-2 transition-all font-semibold md:font-bold md:shadow-sm md:hover:shadow-md ${re==="cash"?"border-emerald-500 bg-emerald-50 md:bg-gradient-to-r md:from-emerald-50 md:to-green-50 dark:from-emerald-900/30 dark:to-green-900/30 text-emerald-700 dark:text-emerald-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:border-emerald-400"}`,children:[e.jsx(Ht,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Tiá»n máº·t"})]}),e.jsxs("button",{onClick:()=>gt("bank"),className:`flex items-center justify-center gap-1.5 md:gap-2 px-3 md:px-4 py-2 md:py-3 rounded-lg md:rounded-xl border md:border-2 transition-all font-semibold md:font-bold md:shadow-sm md:hover:shadow-md ${re==="bank"?"border-blue-500 bg-blue-50 md:bg-gradient-to-r md:from-blue-50 md:to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 text-blue-700 dark:text-blue-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:border-blue-400"}`,children:[e.jsx(Vt,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Chuyá»ƒn khoáº£n"})]})]})]}),re&&e.jsxs("div",{className:"px-3 md:px-4 pb-3 md:pb-4",children:[e.jsx("label",{className:"block text-xs md:text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:"HÃ¬nh thá»©c"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 md:gap-2",children:[e.jsx("button",{onClick:()=>{at("full"),rt(0)},className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${O==="full"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"Äá»§"}),e.jsx("button",{onClick:()=>at("partial"),className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${O==="partial"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"1 pháº§n"}),e.jsx("button",{onClick:()=>{at("note"),rt(0)},className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${O==="note"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"Ghi ná»£"})]})]}),O==="partial"&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-900 dark:text-slate-100 mb-2",children:"Sá»‘ tiá»n khÃ¡ch tráº£"}),e.jsx("input",{type:"number",value:qe,onChange:t=>rt(Number(t.target.value)||0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"0"}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["CÃ²n láº¡i:"," ",x(Math.max(0,Mt-ee-qe))," ","Ä‘"]})]}),e.jsxs("div",{className:"px-3 md:px-4 pb-2 md:pb-3 space-y-1.5 md:space-y-2",children:[e.jsx("div",{className:"text-xs md:text-sm font-semibold md:font-medium text-slate-900 dark:text-slate-100 mb-1.5 md:mb-2",children:"Thá»i gian bÃ¡n hÃ ng"}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"salesTime",defaultChecked:!0,className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 text-pink-600 focus:ring-pink-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"Thá»i gian hiá»‡n táº¡i"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"salesTime",className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"TÃ¹y chá»‰nh"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm md:text-sm text-slate-700 dark:text-slate-300",children:"Ghi chÃº riÃªng cho Ä‘Æ¡n hÃ ng"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Tt,onChange:t=>Rt(t.target.checked),className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"ÄÃ³ng thá»i in hoÃ¡ Ä‘Æ¡n"})]})]}),e.jsxs("div",{className:"p-3 md:p-4 pt-0 flex flex-col md:flex-row gap-2 md:gap-3",children:[e.jsx("button",{onClick:K,className:"flex-1 px-3 md:px-4 py-2 md:py-3 bg-white dark:bg-slate-700 border md:border-2 border-slate-300 dark:border-slate-600 hover:border-slate-400 dark:hover:border-slate-500 hover:bg-slate-50 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 font-semibold md:font-bold rounded-lg md:rounded-xl transition-all md:shadow-sm md:hover:shadow-md text-sm md:text-base",children:"LÆ¯U NHÃP"}),e.jsx("button",{onClick:ds,disabled:!re||!O,className:`flex-1 px-3 md:px-4 py-2 md:py-3 font-bold md:font-black rounded-lg md:rounded-xl transition-all md:shadow-lg text-sm md:text-base ${re&&O?"bg-orange-500 md:bg-gradient-to-r md:from-orange-500 md:to-red-500 hover:bg-orange-600 md:hover:from-orange-600 md:hover:to-red-600 text-white md:shadow-orange-500/30 md:hover:shadow-xl md:hover:shadow-orange-500/40 md:hover:scale-105 md:active:scale-95":"bg-slate-300 dark:bg-slate-700 text-slate-500 dark:text-slate-500 cursor-not-allowed opacity-60"}`,children:"XUáº¤T BÃN"})]})]})]})]}),e.jsx(ws,{isOpen:Ot,onClose:()=>{tt(!1),$==="history"&&ye("products")},sales:te,currentBranchId:p,onPrintReceipt:ss,onEditSale:ls,onDeleteSale:rs,page:l.page,totalPages:l.totalPages,total:l.total,hasMore:l.hasMore,pageSize:ge,onPrevPage:a,onNextPage:()=>{var t,s;if(M){const n=(t=k==null?void 0:k.meta)==null?void 0:t.nextAfterDate,d=(s=k==null?void 0:k.meta)==null?void 0:s.nextAfterId;(n||d)&&_({afterDate:n,afterId:d})}else c()},onPageSizeChange:z,search:Te,onSearchChange:t=>{Me(t),t||V(1)},fromDate:De,toDate:J,onDateRangeChange:(t,s)=>{be(t),de(s),V(1),M&&_(null)},status:H,onStatusChange:t=>{pe(t),V(1),M&&_(null)},paymentMethodFilter:Q,onPaymentMethodFilterChange:t=>{fe(t),V(1),M&&_(null)},keysetMode:M,onToggleKeyset:t=>{Ie(t),V(1),_(null)},customerDebts:Ze}),Nt&&e.jsx("div",{id:"last-receipt",className:"hidden print:block",children:e.jsxs("div",{style:{width:"148mm",minHeight:"210mm",margin:"0 auto",padding:"15mm",fontFamily:"Arial, sans-serif",fontSize:"12px",backgroundColor:"white",color:"#000",boxSizing:"border-box"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px",borderBottom:"2px solid #333",paddingBottom:"15px"},children:[e.jsx("img",{src:"https://raw.githubusercontent.com/Nhan-Lam-SmartCare/Motocare/main/public/logo.png",alt:"Nháº­n-LÃ¢m SmartCare",style:{width:"120px",height:"120px",margin:"0 auto 10px",display:"block"},onError:t=>{t.currentTarget.style.display="none"}}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 8px 0",color:"#c92a2a"},children:"Nháº­n-LÃ¢m SmartCare"}),e.jsxs("div",{style:{fontSize:"11px",lineHeight:"1.6"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:"Äá»‹a chá»‰: 4p PhÃº Lá»£i B, PhÃº Thuáº­n B, Há»“ng Ngá»±, Äá»“ng ThÃ¡p"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15 .828 0 1.5-.672 1.5-1.5v-2.25a1.5 1.5 0 00-1.5-1.5h-1.158a1.5 1.5 0 00-1.092.468l-.936.996a1.5 1.5 0 01-1.392.444 12.035 12.035 0 01-7.29-7.29 1.5 1.5 0 01.444-1.392l.996-.936a1.5 1.5 0 00.468-1.092V6.75A1.5 1.5 0 006.75 5.25H4.5c-.828 0-1.5.672-1.5 1.5z"})}),e.jsx("span",{children:"Äiá»‡n thoáº¡i: 0947747907"})]})]})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"6px",padding:"10px 12px",marginBottom:"20px",fontSize:"11px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:"ðŸ’³ ThÃ´ng tin chuyá»ƒn khoáº£n:"}),e.jsxs("div",{style:{lineHeight:"1.6"},children:[e.jsxs("div",{children:["â€¢ NgÃ¢n hÃ ng: ",e.jsx("strong",{children:"NH LiÃªn Viá»‡t (LPBank)"})]}),e.jsxs("div",{children:["â€¢ Sá»‘ tÃ i khoáº£n: ",e.jsx("strong",{children:"LAMVOT"})]}),e.jsxs("div",{children:["â€¢ Chá»§ tÃ i khoáº£n: ",e.jsx("strong",{children:"VO THANH LAM"})]})]})]}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 8px 0",textTransform:"uppercase",letterSpacing:"1px"},children:"HÃ“A ÄÆ N BÃN HÃ€NG"}),e.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["Sá»‘: ",e.jsx("strong",{style:{color:"#000"},children:Nt})," - NgÃ y:"," ",e.jsx("strong",{style:{color:"#000"},children:it(new Date,!0)})]})]}),e.jsx("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px"},children:e.jsxs("div",{style:{fontSize:"12px",lineHeight:"1.8"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"KhÃ¡ch hÃ ng:"})," ",_e||"KhÃ¡ch láº»"]}),oe&&e.jsxs("div",{children:[e.jsx("strong",{children:"Äiá»‡n thoáº¡i:"})," ",oe]})]})}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"15px",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f3f5",borderTop:"2px solid #333",borderBottom:"2px solid #333"},children:[e.jsx("th",{style:{textAlign:"center",padding:"8px 4px",width:"8%",fontWeight:"bold"},children:"STT"}),e.jsx("th",{style:{textAlign:"left",padding:"8px 6px",width:"37%",fontWeight:"bold"},children:"TÃªn sáº£n pháº©m"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 4px",width:"10%",fontWeight:"bold"},children:"SL"}),e.jsx("th",{style:{textAlign:"right",padding:"8px 6px",width:"20%",fontWeight:"bold"},children:"ÄÆ¡n giÃ¡"}),e.jsx("th",{style:{textAlign:"right",padding:"8px 6px",width:"25%",fontWeight:"bold"},children:"ThÃ nh tiá»n"})]})}),e.jsx("tbody",{children:Fe.map((t,s)=>e.jsx($t.Fragment,{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("td",{style:{textAlign:"center",padding:"10px 4px",verticalAlign:"top"},children:s+1}),e.jsxs("td",{style:{padding:"10px 6px",verticalAlign:"top"},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"3px"},children:t.partName}),t.sku&&e.jsxs("div",{style:{fontSize:"9px",color:"#868e96"},children:["SKU: ",t.sku]})]}),e.jsx("td",{style:{textAlign:"center",padding:"10px 4px",verticalAlign:"top",fontWeight:"600"},children:t.quantity}),e.jsx("td",{style:{textAlign:"right",padding:"10px 6px",verticalAlign:"top"},children:x(t.sellingPrice)}),e.jsx("td",{style:{textAlign:"right",padding:"10px 6px",verticalAlign:"top",fontWeight:"600"},children:x(t.sellingPrice*t.quantity)})]})},t.partId))})]}),e.jsx("div",{style:{borderTop:"2px solid #333",paddingTop:"12px",marginBottom:"15px"},children:e.jsx("table",{style:{width:"100%",fontSize:"12px"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:"6px 0",textAlign:"right"},children:["Tá»•ng cá»™ng (",Yt," sáº£n pháº©m):"]}),e.jsx("td",{style:{padding:"6px 0 6px 20px",textAlign:"right",width:"30%",fontWeight:"600"},children:x(ft)})]}),st>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"6px 0",textAlign:"right",color:"#c92a2a"},children:"Giáº£m giÃ¡:"}),e.jsxs("td",{style:{padding:"6px 0 6px 20px",textAlign:"right",fontWeight:"600",color:"#c92a2a"},children:["-",x(st)]})]}),e.jsxs("tr",{style:{borderTop:"1px solid #dee2e6",fontSize:"14px"},children:[e.jsx("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:"bold"},children:"Tá»”NG THANH TOÃN:"}),e.jsx("td",{style:{padding:"10px 0 10px 20px",textAlign:"right",fontWeight:"bold",fontSize:"16px",color:"#2f9e44"},children:x(Xt)})]})]})})}),e.jsxs("div",{style:{marginBottom:"20px",padding:"10px 12px",backgroundColor:"#f8f9fa",borderRadius:"4px",fontSize:"11px"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"HÃ¬nh thá»©c thanh toÃ¡n:"})," ",re==="cash"?"Tiá»n máº·t":"Chuyá»ƒn khoáº£n"]}),e.jsx("div",{style:{fontStyle:"italic",color:"#495057"},children:O==="full"?"âœ“ ÄÃ£ thanh toÃ¡n Ä‘á»§":O==="partial"?`Thanh toÃ¡n má»™t pháº§n: ${x(qe)}`:"Ghi ná»£"})]}),e.jsx("div",{style:{marginTop:"30px",borderTop:"1px solid #dee2e6",paddingTop:"20px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px"},children:[e.jsxs("div",{style:{textAlign:"center",width:"40%"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"50px",fontSize:"12px"},children:"KhÃ¡ch hÃ ng"}),e.jsx("div",{style:{fontStyle:"italic",color:"#868e96"},children:"(KÃ½ vÃ  ghi rÃµ há» tÃªn)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"40%"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"50px",fontSize:"12px"},children:"NgÆ°á»i bÃ¡n hÃ ng"}),e.jsx("div",{style:{fontStyle:"italic",color:"#868e96"},children:"(KÃ½ vÃ  ghi rÃµ há» tÃªn)"})]})]})}),e.jsxs("div",{style:{textAlign:"center",marginTop:"25px",paddingTop:"15px",borderTop:"1px dashed #adb5bd",fontSize:"11px",fontStyle:"italic",color:"#495057"},children:[e.jsxs("div",{style:{marginBottom:"5px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{style:{display:"inline-flex"},children:"*"}),"Cáº£m Æ¡n quÃ½ khÃ¡ch Ä‘Ã£ sá»­ dá»¥ng dá»‹ch vá»¥",e.jsx("span",{style:{display:"inline-flex"},children:"*"})]}),e.jsx("div",{children:"Háº¹n gáº·p láº¡i quÃ½ khÃ¡ch!"})]})]})}),Ft&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"ThÃªm khÃ¡ch hÃ ng má»›i"}),e.jsx("button",{onClick:()=>{Oe(!1),Ne({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Kt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["TÃªn khÃ¡ch hÃ ng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:E.name,onChange:t=>Ne({...E,name:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"Nháº­p tÃªn khÃ¡ch hÃ ng"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Sá»‘ Ä‘iá»‡n thoáº¡i ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:E.phone,onChange:t=>Ne({...E,phone:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"DÃ²ng xe"}),e.jsx("input",{type:"text",value:E.vehicleModel,onChange:t=>Ne({...E,vehicleModel:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"VD: Honda SH 2023"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Biá»ƒn sá»‘ xe"}),e.jsx("input",{type:"text",value:E.licensePlate,onChange:t=>Ne({...E,licensePlate:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"VD: 30A-12345"})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>{Oe(!1),Ne({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"flex-1 px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600",children:"Há»§y"}),e.jsx("button",{onClick:ts,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"LÆ°u"})]})]})}),Gt&&I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Xem trÆ°á»›c hÃ³a Ä‘Æ¡n"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:as,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition",children:[e.jsx(bs,{className:"w-4 h-4"}),"In hÃ³a Ä‘Æ¡n"]}),e.jsx("button",{onClick:()=>{bt(!1),pt(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ÄÃ³ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{className:"bg-white shadow-lg mx-auto",style:{width:"80mm",minHeight:"100mm",color:"#000"},children:e.jsxs("div",{style:{padding:"5mm"},children:[e.jsx("div",{style:{borderBottom:"2px solid #3b82f6",paddingBottom:"2mm",marginBottom:"3mm"},children:e.jsxs("div",{style:{textAlign:"center"},children:[(f==null?void 0:f.logo_url)&&e.jsx("img",{src:f.logo_url,alt:"Logo",style:{height:"12mm",width:"auto",objectFit:"contain",margin:"0 auto 2mm"}}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",color:"#1e40af"},children:(f==null?void 0:f.store_name)||"Nháº¡n LÃ¢m SmartCare"}),e.jsx("div",{style:{fontSize:"8pt",color:"#000",marginTop:"1mm"},children:(f==null?void 0:f.address)&&`ðŸ“ ${f.address}`}),e.jsx("div",{style:{fontSize:"8pt",color:"#000"},children:(f==null?void 0:f.phone)&&`ðŸ“ž ${f.phone}`})]})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"3mm"},children:[e.jsx("h1",{style:{fontSize:"14pt",fontWeight:"bold",margin:"0",color:"#1e40af"},children:"HÃ“A ÄÆ N BÃN HÃ€NG"}),e.jsx("div",{style:{fontSize:"8pt",color:"#666",marginTop:"1mm"},children:new Date(I.date).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontSize:"8pt",fontWeight:"bold",marginTop:"0.5mm"},children:["MÃ£: ",ct(I.id)||I.id]})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"3mm",borderRadius:"2mm",backgroundColor:"#f8fafc",fontSize:"8.5pt"},children:[e.jsxs("div",{style:{marginBottom:"1mm"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"KH:"})," ",I.customer.name]}),I.customer.phone&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"SÄT:"})," ",I.customer.phone]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"3mm",fontSize:"8.5pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("th",{style:{textAlign:"left",padding:"1mm",fontSize:"8pt"},children:"Sáº£n pháº©m"}),e.jsx("th",{style:{textAlign:"center",padding:"1mm",width:"15%",fontSize:"8pt"},children:"SL"}),e.jsx("th",{style:{textAlign:"right",padding:"1mm",width:"28%",fontSize:"8pt"},children:"ThÃ nh tiá»n"})]})}),e.jsx("tbody",{children:I.items.map((t,s)=>{const n=t.sellingPrice||t.sellingprice||t.price||0,d=t.quantity||0;return e.jsxs("tr",{style:{borderBottom:"1px dashed #ddd"},children:[e.jsx("td",{style:{padding:"1.5mm 1mm",fontSize:"8.5pt"},children:t.partName||t.partname}),e.jsx("td",{style:{textAlign:"center",padding:"1.5mm 1mm",fontSize:"8.5pt"},children:d}),e.jsx("td",{style:{textAlign:"right",padding:"1.5mm 1mm",fontSize:"8.5pt",fontWeight:"bold"},children:x(n*d)})]},s)})})]}),e.jsxs("div",{style:{borderTop:"2px solid #333",paddingTop:"2mm",marginBottom:"3mm",fontSize:"9pt"},children:[I.discount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm",color:"#e74c3c"},children:[e.jsx("span",{children:"Giáº£m giÃ¡:"}),e.jsxs("span",{children:["-",x(I.discount)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",fontSize:"11pt"},children:[e.jsx("span",{children:"Tá»”NG Cá»˜NG:"}),e.jsxs("span",{style:{color:"#2563eb"},children:[x(I.total)," â‚«"]})]})]}),(f==null?void 0:f.bank_name)&&e.jsxs("div",{style:{borderTop:"1px dashed #999",paddingTop:"2mm",marginBottom:"3mm",fontSize:"7.5pt",textAlign:"center"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm"},children:["Chuyá»ƒn khoáº£n: ",f.bank_name]}),f.bank_account_number&&e.jsxs("div",{children:["STK: ",f.bank_account_number]}),f.bank_account_holder&&e.jsx("div",{style:{fontSize:"7pt"},children:f.bank_account_holder}),f.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm"},children:e.jsx("img",{src:f.bank_qr_url,alt:"QR Banking",style:{height:"20mm",width:"20mm",objectFit:"contain",margin:"0 auto"}})})]}),e.jsxs("div",{style:{textAlign:"center",fontSize:"7.5pt",color:"#666",borderTop:"1px dashed #999",paddingTop:"2mm"},children:[e.jsx("div",{children:"Cáº£m Æ¡n quÃ½ khÃ¡ch!"}),e.jsx("div",{children:"Háº¹n gáº·p láº¡i"})]})]})})})]})}),e.jsx(ms,{isOpen:mt,onClose:()=>Ke(!1),onScan:Jt,title:"QuÃ©t mÃ£ váº¡ch sáº£n pháº©m"})]})};export{Is as default};
