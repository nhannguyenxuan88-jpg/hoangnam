import{u as ve,r as i,j as e,i as p,l as F,s as D,n as Ne}from"./index-oC0AdDfJ.js";import{P as ke}from"./Icons-BUtVPADU.js";import{u as we,b as Ce,a as Me,c as Se,d as Ae,e as Le,f as De,g as Ie}from"./useDebtsRepository-CY6oY2vf.js";const Oe=()=>{const{customers:s,suppliers:g,currentBranchId:n,setCashTransactions:f,cashTransactions:m,setPaymentSources:v,paymentSources:a}=ve(),{data:l=[],isLoading:j}=we(),{data:d=[],isLoading:x}=Ce(),c=Me(),k=Se(),N=Ae(),S=Le(),r=De(),C=Ie(),[I,B]=i.useState(null);i.useEffect(()=>{(async()=>{const{data:o}=await Ne.from("store_settings").select("*").single();o&&B(o)})()},[]);const[b,te]=i.useState("customer"),[W,ie]=i.useState(""),[de,q]=i.useState(!1),[ce,R]=i.useState(!1),[T,K]=i.useState([]),[P,U]=i.useState([]),[se,X]=i.useState(!1),[_,z]=i.useState(null),[me,G]=i.useState(!1),[xe,E]=i.useState(!1),[he,V]=i.useState(!1),[ue,O]=i.useState(!1),[L,M]=i.useState(null),A=i.useMemo(()=>l.filter(t=>t.branchId===n),[l,n]),$=i.useMemo(()=>d.filter(t=>t.branchId===n),[d,n]),ae=i.useMemo(()=>{if(!W)return A;const t=W.toLowerCase();return A.filter(o=>{var u,h;return o.customerName.toLowerCase().includes(t)||((u=o.phone)==null?void 0:u.includes(t))||((h=o.licensePlate)==null?void 0:h.toLowerCase().includes(t))})},[A,W]);i.useEffect(()=>{console.log("[DebtManager] branchCustomerDebts count:",A.length,"branchId:",n)},[A,n]),i.useEffect(()=>{const t=o=>{o.target.closest(".debt-menu-dropdown")||z(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const ne=i.useMemo(()=>{if(!W)return $;const t=W.toLowerCase();return $.filter(o=>o.supplierName.toLowerCase().includes(t))},[$,W]),pe=i.useMemo(()=>A.reduce((t,o)=>t+o.remainingAmount,0),[A]),be=i.useMemo(()=>$.reduce((t,o)=>t+o.remainingAmount,0),[$]),Y=i.useMemo(()=>T.reduce((t,o)=>{const u=A.find(h=>h.customerId===o);return t+((u==null?void 0:u.remainingAmount)||0)},0),[T,A]),Q=i.useMemo(()=>P.reduce((t,o)=>{const u=$.find(h=>h.supplierId===o);return t+((u==null?void 0:u.remainingAmount)||0)},0),[P,$]),ge=(t,o)=>{K(o?[...T,t]:T.filter(u=>u!==t))},je=(t,o)=>{U(o?[...P,t]:P.filter(u=>u!==t))},fe=()=>{X(!0)};return e.jsxs("div",{className:"h-full flex flex-col bg-secondary-bg",children:[e.jsx("div",{className:"bg-primary-bg border-b border-primary-border",children:e.jsx("div",{className:"flex items-center justify-between px-6",children:e.jsxs("div",{className:"flex items-center w-full md:w-auto",children:[e.jsx("button",{onClick:()=>te("customer"),className:`flex-1 md:flex-none px-6 py-4 font-medium text-sm transition-all text-center ${b==="customer"?"text-cyan-600 dark:text-cyan-400 border-b-2 border-cyan-600 dark:border-cyan-400":"text-secondary-text hover:text-primary-text"}`,children:"Công nợ khách hàng"}),e.jsx("button",{onClick:()=>te("supplier"),className:`flex-1 md:flex-none px-6 py-4 font-medium text-sm transition-all text-center ${b==="supplier"?"text-cyan-600 dark:text-cyan-400 border-b-2 border-cyan-600 dark:border-cyan-400":"text-secondary-text hover:text-primary-text"}`,children:"Công nợ nhà cung cấp"})]})})}),e.jsx("div",{className:"bg-primary-bg px-6 py-4 border-b border-primary-border",children:j||x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-600"}),e.jsx("span",{className:"ml-3 text-secondary-text",children:"Đang tải dữ liệu..."})]}):e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsxs("div",{className:"w-full md:flex-1 relative",children:[e.jsx("svg",{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-tertiary-text",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:b==="customer"?"Tìm SĐT / Tên KH / Tên sản phẩm / IMEI":"Tìm tên / SĐT nhà cung cấp",value:W,onChange:t=>ie(t.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-primary-bg border border-secondary-border rounded-lg text-primary-text placeholder-tertiary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 w-full md:w-auto",children:[e.jsxs("div",{className:"text-secondary-text text-sm whitespace-nowrap",children:["Tổng công nợ:"," ",e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:p(b==="customer"?pe:be)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap",children:[e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{children:"Thêm công nợ"})]}),e.jsxs("button",{onClick:()=>b==="customer"?q(!0):R(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition-colors whitespace-nowrap",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:b==="customer"?"Thu nợ":"Chi trả nợ"})]})]}),e.jsx("button",{className:"hidden md:block p-2.5 text-secondary-text hover:text-primary-text transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:b==="customer"?e.jsx("div",{className:"p-6",children:ae.length===0?e.jsx("div",{className:"text-center py-12 text-tertiary-text",children:"Không có công nợ."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-semibold text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"col-span-4",children:"Khách hàng nợ"}),e.jsx("div",{className:"col-span-3",children:"Nội dung"}),e.jsx("div",{className:"col-span-1 text-right",children:"Số tiền"}),e.jsx("div",{className:"col-span-1 text-right",children:"Đã trả"}),e.jsx("div",{className:"col-span-2 text-right",children:"Còn nợ"}),e.jsx("div",{className:"col-span-1"})]}),ae.map(t=>{var o,u,h,H;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start bg-primary-bg border border-primary-border rounded-lg p-4 hover:border-cyan-500 hover:shadow-md transition-all cursor-pointer group",onClick:()=>{M(t),V(!0)},children:[e.jsxs("div",{className:"col-span-1 md:col-span-4 flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:T.includes(t.customerId),onChange:y=>{y.stopPropagation(),ge(t.customerId,y.target.checked)},onClick:y=>y.stopPropagation(),className:"mt-1 w-4 h-4 rounded border-secondary-border text-cyan-600 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-primary-text font-semibold text-base mb-1 truncate",children:t.customerName}),e.jsxs("div",{className:"space-y-0.5 text-xs text-secondary-text",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{children:t.phone||"--"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z M9 22V12h6v10"}),e.jsx("rect",{x:"7",y:"5",width:"10",height:"4",rx:"1",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),e.jsx("span",{className:"font-mono text-xs font-semibold",children:t.licensePlate||"--"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:F(new Date(t.createdDate))})]}),e.jsxs("div",{className:"flex items-center gap-1 text-cyan-600 dark:text-cyan-400",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsxs("span",{children:["NV:"," ",((u=(o=t.description.match(/NVKỹ thuật:([^\n]+)/))==null?void 0:o[1])==null?void 0:u.trim())||((H=(h=t.description.match(/NV:([^\n]+)/))==null?void 0:h[1])==null?void 0:H.trim())||"N/A"]})]})]})]})]}),e.jsx("div",{className:"col-span-1 md:col-span-3",children:e.jsx("div",{className:"text-sm text-primary-text space-y-1",children:(()=>{const y=t.description.split(`
`),ye=y[0],J=y.find(w=>w.includes("Phụ tùng đã thay:")),re=J?y.slice(y.indexOf(J)+1,y.findIndex((w,ee)=>ee>y.indexOf(J)&&(w.includes("Dịch vụ:")||w.includes("Công lao động:")))||y.length).filter(w=>w.trim().startsWith("•")):[],Z=y.find(w=>w.includes("Dịch vụ:")),le=Z?y.slice(y.indexOf(Z)+1,y.findIndex((w,ee)=>ee>y.indexOf(Z)&&w.includes("Công lao động:"))||y.length).filter(w=>w.trim().startsWith("•")):[],oe=y.find(w=>w.includes("Công lao động:"));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium",children:ye}),re.length>0&&e.jsxs("div",{className:"text-xs text-secondary-text",children:[e.jsx("span",{className:"font-semibold",children:"Phụ tùng:"})," ",re.length," món"]}),le.length>0&&e.jsxs("div",{className:"text-xs text-secondary-text",children:[e.jsx("span",{className:"font-semibold",children:"Dịch vụ:"})," ",le.length," món"]}),oe&&e.jsx("div",{className:"text-xs text-cyan-600 dark:text-cyan-400",children:oe})]})})()})}),e.jsxs("div",{className:"col-span-1 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm text-secondary-text",children:"Số tiền:"}),e.jsx("div",{className:"text-sm font-semibold text-primary-text",children:p(t.totalAmount)})]}),e.jsxs("div",{className:"col-span-1 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm text-secondary-text",children:"Đã trả:"}),e.jsx("div",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:p(t.paidAmount)})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm font-bold text-secondary-text",children:"Còn nợ:"}),e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:p(t.remainingAmount)})]}),e.jsx("div",{className:"col-span-1 flex justify-end hidden md:flex",children:e.jsxs("div",{className:"relative debt-menu-dropdown",children:[e.jsx("button",{onClick:()=>z(_===t.id?null:t.id),className:"p-2 text-secondary-text hover:text-primary-text transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),_===t.id&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 py-1 z-10",children:[e.jsxs("button",{onClick:()=>{M(t),V(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Xem chi tiết"]}),e.jsxs("button",{onClick:()=>{M(t),E(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Sửa"]}),e.jsxs("button",{onClick:()=>{M(t),O(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Xóa"]})]})]})})]},t.id)})]})}):e.jsx("div",{className:"p-6",children:ne.length===0?e.jsx("div",{className:"text-center py-12 text-tertiary-text",children:"Không có công nợ."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-semibold text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"col-span-4",children:"Nhà cung cấp"}),e.jsx("div",{className:"col-span-3",children:"Nội dung"}),e.jsx("div",{className:"col-span-1 text-right",children:"Số tiền"}),e.jsx("div",{className:"col-span-1 text-right",children:"Đã trả"}),e.jsx("div",{className:"col-span-2 text-right",children:"Còn nợ"}),e.jsx("div",{className:"col-span-1"})]}),ne.map(t=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start bg-primary-bg border border-primary-border rounded-lg p-4 hover:border-cyan-500 hover:shadow-md transition-all cursor-pointer group",onClick:()=>{M(t),V(!0)},children:[e.jsxs("div",{className:"col-span-1 md:col-span-4 flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:P.includes(t.supplierId),onChange:o=>{o.stopPropagation(),je(t.supplierId,o.target.checked)},onClick:o=>o.stopPropagation(),className:"mt-1 w-4 h-4 rounded border-secondary-border text-cyan-600 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-primary-text font-semibold text-base mb-1 truncate",children:t.supplierName}),e.jsx("div",{className:"space-y-0.5 text-xs text-secondary-text",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:F(new Date(t.createdDate))})]})})]})]}),e.jsx("div",{className:"col-span-1 md:col-span-3",children:e.jsx("div",{className:"text-sm text-primary-text",children:t.description})}),e.jsxs("div",{className:"col-span-1 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm text-secondary-text",children:"Số tiền:"}),e.jsx("div",{className:"text-sm text-primary-text font-semibold",children:p(t.totalAmount)})]}),e.jsxs("div",{className:"col-span-1 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm text-secondary-text",children:"Đã trả:"}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400 font-semibold",children:p(t.paidAmount)})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 text-right md:text-right flex justify-between md:block",children:[e.jsx("span",{className:"md:hidden text-sm font-bold text-secondary-text",children:"Còn nợ:"}),e.jsx("div",{className:"text-base text-red-600 dark:text-red-400 font-bold",children:p(t.remainingAmount)})]}),e.jsxs("div",{className:"col-span-1 flex justify-end relative debt-menu-dropdown hidden md:flex",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),z(_===t.id?null:t.id)},className:"p-1 text-secondary-text hover:text-primary-text transition-colors opacity-0 group-hover:opacity-100",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),_===t.id&&e.jsxs("div",{className:"absolute right-0 top-8 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 py-1 z-10",children:[e.jsxs("button",{onClick:o=>{o.stopPropagation(),M(t),V(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Xem chi tiết"]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),M(t),E(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Sửa"]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),M(t),O(!0),z(null)},className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Xóa"]})]})]})]},t.id))]})})}),(b==="customer"&&T.length>0||b==="supplier"&&P.length>0)&&e.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50",children:e.jsxs("button",{onClick:fe,className:"flex items-center gap-3 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold shadow-2xl transition-all hover:scale-105",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:["Đã chọn"," ",b==="customer"?T.length:P.length," ","đơn"]}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsxs("span",{className:"text-xl font-bold",children:["Trả hết nợ (",p(b==="customer"?Y:Q),")"]})]})}),de&&e.jsx(Te,{customers:s,customerDebts:l,onClose:()=>q(!1),onCollect:t=>{const u={id:`CT-${Date.now()}`,type:"income",date:t.timestamp,amount:t.amount,recipient:t.customerName,notes:`Thu nợ khách hàng - ${t.customerName}`,paymentSourceId:t.paymentMethod,branchId:n,category:"debt_collection"};f([u,...m]),v(a.map(h=>h.id===t.paymentMethod?{...h,balance:{...h.balance,[n]:(h.balance[n]||0)+t.amount}}:h)),q(!1)}}),se&&e.jsx(ze,{isOpen:se,onClose:()=>{X(!1)},selectedDebts:b==="customer"?A.filter(t=>T.includes(t.customerId)):$.filter(t=>P.includes(t.supplierId)),totalAmount:b==="customer"?Y:Q,debtType:b,onConfirm:async(t,o)=>{try{if(b==="customer"){for(const u of T){const h=A.find(H=>H.customerId===u);h&&await k.mutateAsync({id:h.id,updates:{paidAmount:h.totalAmount,remainingAmount:0}})}K([])}else{for(const u of P){const h=$.find(H=>H.supplierId===u);h&&await r.mutateAsync({id:h.id,updates:{paidAmount:h.totalAmount,remainingAmount:0}})}U([])}X(!1),D.success(`Đã thanh toán thành công ${p(b==="customer"?Y:Q)} qua ${t==="cash"?"Tiền mặt":"Chuyển khoản"}`)}catch(u){D.error(u.message||"Không thể thanh toán")}}}),ce&&e.jsx(Pe,{suppliers:g,supplierDebts:d,onClose:()=>R(!1),onPay:t=>{const u={id:`CT-${Date.now()}`,type:"expense",date:t.timestamp,amount:t.amount,recipient:t.supplierName,notes:`Trả nợ nhà cung cấp - ${t.supplierName}`,paymentSourceId:t.paymentMethod,branchId:n,category:"debt_payment"};f([u,...m]),v(a.map(h=>h.id===t.paymentMethod?{...h,balance:{...h.balance,[n]:(h.balance[n]||0)-t.amount}}:h)),R(!1)}}),me&&e.jsx($e,{activeTab:b,customers:s,suppliers:g,currentBranchId:n,onClose:()=>G(!1),onSave:async t=>{b==="customer"?await c.mutateAsync(t):await S.mutateAsync(t),G(!1)}}),xe&&L&&e.jsx(Be,{debt:L,activeTab:b,customers:s,suppliers:g,onClose:()=>{E(!1),M(null)},onSave:async t=>{b==="customer"?await k.mutateAsync({id:L.id,updates:t}):await r.mutateAsync({id:L.id,updates:t}),E(!1),M(null)}}),he&&L&&e.jsx(We,{debt:L,activeTab:b,storeSettings:I,onClose:()=>{V(!1),M(null)}}),ue&&L&&e.jsx(He,{debt:L,activeTab:b,onClose:()=>{O(!1),M(null)},onConfirm:async()=>{b==="customer"?await N.mutateAsync(L.id):await C.mutateAsync(L.id),O(!1),M(null)}})]})},Te=({customers:s,customerDebts:g,onClose:n,onCollect:f})=>{const[m,v]=i.useState(""),[a,l]=i.useState("0"),[j,d]=i.useState("cash"),[x,c]=i.useState(new Date().toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(" "," ")),k=i.useMemo(()=>g.find(r=>r.customerId===m),[m,g]),N=(k==null?void 0:k.remainingAmount)||0,S=r=>{r.preventDefault();const C=parseFloat(a);if(C<=0){D.error("Số tiền thanh toán phải lớn hơn 0");return}if(C>N){D.error(`Số tiền thanh toán không được vượt quá số nợ còn lại (${p(N)})`);return}const I=s.find(B=>B.id===m);I&&f&&f({customerName:I.name,amount:C,paymentMethod:j,timestamp:x}),n()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-secondary-bg rounded-xl shadow-2xl max-w-lg w-full border border-primary-border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-primary-border",children:e.jsx("h2",{className:"text-xl font-semibold text-primary-text",children:"Thu nợ khách hàng"})}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-2",children:"Tìm kiếm và chọn một khách hàng đang nợ"}),e.jsxs("select",{value:m,onChange:r=>v(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Chọn khách hàng..."}),g.map(r=>e.jsxs("option",{value:r.customerId,children:[r.customerName," - ",p(r.remainingAmount)]},r.customerId))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text",children:"Nhập số tiền thanh toán"}),e.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 text-sm",children:p(parseFloat(a)||0)})]}),e.jsx("input",{type:"number",value:a,onChange:r=>l(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-tertiary-text",children:"Còn nợ:"}),e.jsx("span",{className:"text-red-600 dark:text-red-400 font-bold text-base",children:p(N)})]}),e.jsx("button",{type:"button",onClick:()=>l(N.toString()),className:"text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 text-sm mt-1",children:"Điền số còn nợ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-3",children:"Hình thức thanh toán:"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:j==="cash",onChange:r=>d(r.target.value),className:"w-4 h-4 text-cyan-600 bg-primary-bg border-secondary-border focus:ring-cyan-500"}),e.jsx("span",{className:"text-primary-text",children:"Tiền mặt"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:j==="bank",onChange:r=>d(r.target.value),className:"w-4 h-4 text-cyan-600 bg-primary-bg border-secondary-border focus:ring-cyan-500"}),e.jsx("span",{className:"text-primary-text",children:"Chuyển khoản"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-2",children:"Thời gian tạo phiếu thu"}),e.jsx("input",{type:"text",value:x,onChange:r=>c(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsx("button",{type:"submit",disabled:!m||parseFloat(a)<=0,className:"w-full py-3 bg-primary-bg hover:bg-tertiary-bg text-primary-text rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Tạo phiếu thu"})]}),e.jsx("div",{className:"px-6 py-4 border-t border-primary-border flex justify-end",children:e.jsx("button",{onClick:n,className:"px-6 py-2 text-secondary-text hover:text-primary-text transition-colors",children:"Đóng"})})]})})},Pe=({suppliers:s,supplierDebts:g,onClose:n,onPay:f})=>{const[m,v]=i.useState(""),[a,l]=i.useState("0"),[j,d]=i.useState("cash"),[x,c]=i.useState(new Date().toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(" "," ")),k=i.useMemo(()=>g.find(r=>r.supplierId===m),[m,g]),N=(k==null?void 0:k.remainingAmount)||0,S=r=>{r.preventDefault();const C=parseFloat(a);if(C<=0){D.error("Số tiền thanh toán phải lớn hơn 0");return}if(C>N){D.error(`Số tiền thanh toán không được vượt quá số nợ còn lại (${p(N)})`);return}const I=s.find(B=>B.id===m);I&&f&&f({supplierName:I.name,amount:C,paymentMethod:j,timestamp:x}),n()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-secondary-bg rounded-xl shadow-2xl max-w-lg w-full border border-primary-border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-primary-border",children:e.jsx("h2",{className:"text-xl font-semibold text-primary-text",children:"Chi trả nợ nhà cung cấp"})}),e.jsxs("form",{onSubmit:S,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-2",children:"Tìm kiếm và chọn một nhà cung cấp đang nợ"}),e.jsxs("select",{value:m,onChange:r=>v(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Chọn nhà cung cấp..."}),g.map(r=>e.jsxs("option",{value:r.supplierId,children:[r.supplierName," - ",p(r.remainingAmount)]},r.supplierId))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text",children:"Nhập số tiền thanh toán"}),e.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 text-sm",children:p(parseFloat(a)||0)})]}),e.jsx("input",{type:"number",value:a,onChange:r=>l(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-tertiary-text",children:"Còn nợ:"}),e.jsx("span",{className:"text-red-600 dark:text-red-400 font-bold text-base",children:p(N)})]}),e.jsx("button",{type:"button",onClick:()=>l(N.toString()),className:"text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 text-sm mt-1",children:"Điền số còn nợ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-3",children:"Hình thức thanh toán:"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:j==="cash",onChange:r=>d(r.target.value),className:"w-4 h-4 text-cyan-600 bg-primary-bg border-secondary-border focus:ring-cyan-500"}),e.jsx("span",{className:"text-primary-text",children:"Tiền mặt"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:j==="bank",onChange:r=>d(r.target.value),className:"w-4 h-4 text-cyan-600 bg-primary-bg border-secondary-border focus:ring-cyan-500"}),e.jsx("span",{className:"text-primary-text",children:"Chuyển khoản"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-2",children:"Thời gian tạo phiếu chi"}),e.jsx("input",{type:"text",value:x,onChange:r=>c(r.target.value),className:"w-full px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg text-primary-text focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]}),e.jsx("button",{type:"submit",disabled:!m||parseFloat(a)<=0,className:"w-full py-3 bg-primary-bg hover:bg-tertiary-bg text-primary-text rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Tạo phiếu chi"})]}),e.jsx("div",{className:"px-6 py-4 border-t border-primary-border flex justify-end",children:e.jsx("button",{onClick:n,className:"px-6 py-2 text-secondary-text hover:text-primary-text transition-colors",children:"Đóng"})})]})})},ze=({isOpen:s,onClose:g,selectedDebts:n,totalAmount:f,debtType:m,onConfirm:v})=>{const[a,l]=i.useState(null),[j,d]=i.useState(()=>{const c=new Date,k=String(c.getDate()).padStart(2,"0"),N=String(c.getMonth()+1).padStart(2,"0"),S=c.getFullYear(),r=String(c.getHours()).padStart(2,"0"),C=String(c.getMinutes()).padStart(2,"0");return`${k}-${N}-${S} ${r}:${C}`});if(!s)return null;const x=c=>{if(c.preventDefault(),!a){D.warning("Vui lòng chọn hình thức thanh toán");return}const[k,N]=j.split(" "),[S,r,C]=k.split("-"),[I,B]=N.split(":"),b=new Date(parseInt(C),parseInt(r)-1,parseInt(S),parseInt(I),parseInt(B)).toISOString();v(a,b)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-secondary-bg rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-primary-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("h2",{className:"text-xl font-semibold text-primary-text",children:["Trả hết nợ (",m==="customer"?"nhiều đơn hàng":"nhiều nhà cung cấp",")"]})]}),e.jsx("button",{onClick:g,className:"text-secondary-text hover:text-primary-text transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:x,className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-secondary-text",children:"-"}),e.jsx("span",{className:"text-sm font-medium text-secondary-text",children:"Chi tiết"}),e.jsx("span",{className:"text-sm font-medium text-secondary-text",children:"Số tiền"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:n.map((c,k)=>{const N="customerName"in c,S=N?c.customerName:c.supplierName,r=c.description;return e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-tertiary-bg rounded",children:[e.jsx("span",{className:"text-sm text-tertiary-text",children:k+1}),e.jsxs("div",{className:"flex-1 mx-3",children:[e.jsx("div",{className:"text-sm font-medium text-primary-text",children:r}),e.jsx("div",{className:"text-xs text-tertiary-text",children:S})]}),e.jsx("span",{className:"text-sm font-semibold text-primary-text",children:p(c.remainingAmount)})]},k)})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-primary-border",children:[e.jsx("span",{className:"font-semibold text-primary-text",children:"TỔNG"}),e.jsx("span",{className:"text-lg font-bold text-red-500",children:p(f)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-3",children:"Hình thức thanh toán:"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:a==="cash",onChange:c=>l(c.target.value),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-primary-text",children:"Tiền mặt"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:a==="bank",onChange:c=>l(c.target.value),className:"w-4 h-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-primary-text",children:"Chuyển khoản"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-text mb-2",children:"Thời gian tạo phiếu thu"}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-primary-bg border border-secondary-border rounded-lg",children:[e.jsx("input",{type:"text",value:j,onChange:c=>d(c.target.value),className:"flex-1 bg-transparent text-primary-text outline-none"}),e.jsx("svg",{className:"w-5 h-5 text-tertiary-text",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("svg",{className:"w-5 h-5 text-tertiary-text",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 px-4 py-3 border border-secondary-border text-secondary-text rounded-lg hover:bg-primary-bg transition-colors font-medium",children:"ĐÓNG"}),e.jsx("button",{type:"submit",disabled:!a,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-blue-600",children:"TẠO PHIẾU THU"})]})]})]})})},$e=({activeTab:s,customers:g,suppliers:n,currentBranchId:f,onClose:m,onSave:v})=>{const[a,l]=i.useState({customerId:"",supplierId:"",description:"",totalAmount:0,phone:"",licensePlate:""}),j=d=>{if(d.preventDefault(),s==="customer"){const x=g.find(c=>c.id===a.customerId);if(!x){D.error("Vui lòng chọn khách hàng");return}v({customerId:a.customerId,customerName:x.name,phone:a.phone||x.phone,licensePlate:a.licensePlate||x.licensePlate,description:a.description,totalAmount:a.totalAmount,paidAmount:0,remainingAmount:a.totalAmount,createdDate:new Date().toISOString(),branchId:f})}else{const x=n.find(c=>c.id===a.supplierId);if(!x){D.error("Vui lòng chọn nhà cung cấp");return}v({supplierId:a.supplierId,supplierName:x.name,description:a.description,totalAmount:a.totalAmount,paidAmount:0,remainingAmount:a.totalAmount,createdDate:new Date().toISOString(),branchId:f})}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:["Thêm công nợ"," ",s==="customer"?"khách hàng":"nhà cung cấp"]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[s==="customer"?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Khách hàng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.customerId,onChange:d=>l({...a,customerId:d.target.value}),required:!0,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Chọn khách hàng..."}),g.map(d=>e.jsxs("option",{value:d.id,children:[d.name," - ",d.phone]},d.id))]})]}):e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Nhà cung cấp ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.supplierId,onChange:d=>l({...a,supplierId:d.target.value}),required:!0,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Chọn nhà cung cấp..."}),n.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),s==="customer"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Số điện thoại"}),e.jsx("input",{type:"text",value:a.phone,onChange:d=>l({...a,phone:d.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Biển số xe"}),e.jsx("input",{type:"text",value:a.licensePlate,onChange:d=>l({...a,licensePlate:d.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Nội dung công nợ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:a.description,onChange:d=>l({...a,description:d.target.value}),required:!0,rows:3,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",placeholder:"Mô tả chi tiết công nợ..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Số tiền ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:a.totalAmount||"",onChange:d=>l({...a,totalAmount:Number(d.target.value)}),required:!0,min:"0",className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",placeholder:"0"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:p(a.totalAmount||0)})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors font-medium",children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium",children:"Thêm công nợ"})]})]})]})})},Be=({debt:s,activeTab:g,customers:n,suppliers:f,onClose:m,onSave:v})=>{const a="customerName"in s,[l,j]=i.useState({description:s.description,totalAmount:s.totalAmount,paidAmount:s.paidAmount,phone:a?s.phone:"",licensePlate:a?s.licensePlate:""}),d=x=>{x.preventDefault();const c=l.totalAmount-l.paidAmount;if(l.paidAmount>l.totalAmount){D.error("Số tiền đã trả không được lớn hơn tổng tiền!");return}v({description:l.description,totalAmount:l.totalAmount,paidAmount:l.paidAmount,remainingAmount:c,...a&&{phone:l.phone,licensePlate:l.licensePlate}})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Sửa công nợ"})}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-3",children:e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white",children:a?s.customerName:s.supplierName})}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Số điện thoại"}),e.jsx("input",{type:"text",value:l.phone,onChange:x=>j({...l,phone:x.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Biển số xe"}),e.jsx("input",{type:"text",value:l.licensePlate,onChange:x=>j({...l,licensePlate:x.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nội dung công nợ"}),e.jsx("textarea",{value:l.description,onChange:x=>j({...l,description:x.target.value}),rows:3,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Tổng tiền"}),e.jsx("input",{type:"number",value:l.totalAmount,onChange:x=>j({...l,totalAmount:Number(x.target.value)}),min:"0",className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Đã trả"}),e.jsx("input",{type:"number",value:l.paidAmount,onChange:x=>j({...l,paidAmount:Number(x.target.value)}),min:"0",max:l.totalAmount,className:"w-full px-4 py-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:["Còn nợ:"," ",e.jsx("span",{className:"font-bold",children:p(l.totalAmount-l.paidAmount)})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors font-medium",children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"Lưu thay đổi"})]})]})]})})},We=({debt:s,activeTab:g,storeSettings:n,onClose:f})=>{const m="customerName"in s;return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Chi tiết công nợ"}),e.jsx("button",{onClick:f,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:m?"Khách hàng":"Nhà cung cấp"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:m?s.customerName:s.supplierName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Ngày tạo"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:F(new Date(s.createdDate))})]})]}),m&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Số điện thoại"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:s.phone||"--"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Biển số xe"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:s.licensePlate||"--"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-2",children:"Nội dung"}),e.jsx("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-4",children:e.jsx("p",{className:"text-slate-900 dark:text-white",children:s.description})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Tổng tiền"}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:p(s.totalAmount)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Đã trả"}),e.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:p(s.paidAmount)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Còn nợ"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:p(s.remainingAmount)})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-600 dark:text-slate-400 mb-2",children:[e.jsx("span",{children:"Tiến độ thanh toán"}),e.jsxs("span",{children:[Math.round(s.paidAmount/s.totalAmount*100),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3",children:e.jsx("div",{className:"bg-green-600 h-3 rounded-full transition-all",style:{width:`${s.paidAmount/s.totalAmount*100}%`}})})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[e.jsxs("button",{onClick:()=>{const v=document.getElementById("debt-print-area");if(v){const a=window.open("","_blank");a&&(a.document.write(`
                    <html>
                      <head>
                        <title>Phiếu Công Nợ - ${m?s.customerName:s.supplierName}</title>
                        <style>
                          body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
                          .store-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #ddd; }
                          .store-header h2 { margin: 0 0 10px 0; font-size: 24px; color: #0ea5e9; }
                          .store-header p { margin: 5px 0; color: #666; }
                          h1 { text-align: center; margin-bottom: 20px; }
                          .info { margin-bottom: 15px; }
                          .info label { font-weight: bold; }
                          .description { white-space: pre-line; margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px; }
                          .amounts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
                          .amount-box { padding: 15px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
                          .amount-box label { display: block; font-size: 12px; color: #666; margin-bottom: 5px; }
                          .amount-box .value { font-size: 20px; font-weight: bold; }
                          .total { color: #1e40af; }
                          .paid { color: #16a34a; }
                          .remaining { color: #dc2626; }
                          .bank-info { margin-top: 30px; padding: 20px; background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; }
                          .bank-info h3 { margin: 0 0 15px 0; color: #0369a1; text-align: center; }
                          .bank-info p { margin: 8px 0; }
                          .bank-info strong { display: inline-block; min-width: 150px; }
                          .bank-qr { text-align: center; margin-top: 15px; }
                          .bank-qr img { max-width: 200px; border: 1px solid #ddd; padding: 10px; background: white; }
                          @media print { button { display: none; } }
                        </style>
                      </head>
                      <body>
                        ${n?`
                        <div class="store-header">
                          <h2>${n.store_name||"MOTOCARE"}</h2>
                          ${n.address?`<p>📍 ${n.address}</p>`:""}
                          ${n.phone?`<p>📞 ${n.phone}</p>`:""}
                        </div>
                        `:""}
                        ${v.innerHTML}
                        ${n&&(n.bank_name||n.bank_account_number)?`
                        <div class="bank-info">
                          <h3>💳 THÔNG TIN CHUYỂN KHOẢN</h3>
                          ${n.bank_name?`<p><strong>Ngân hàng:</strong> ${n.bank_name}</p>`:""}
                          ${n.bank_account_number?`<p><strong>Số tài khoản:</strong> ${n.bank_account_number}</p>`:""}
                          ${n.bank_account_holder?`<p><strong>Chủ tài khoản:</strong> ${n.bank_account_holder}</p>`:""}
                          ${n.bank_branch?`<p><strong>Chi nhánh:</strong> ${n.bank_branch}</p>`:""}
                          ${n.bank_qr_url?`<div class="bank-qr"><img src="${n.bank_qr_url}" alt="QR Code" /></div>`:""}
                        </div>
                        `:""}
                        <div style="margin-top: 30px; text-align: center;">
                          <button onclick="window.print()" style="padding: 10px 20px; background: #0ea5e9; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">In Phiếu</button>
                        </div>
                      </body>
                    </html>
                  `),a.document.close())}},className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"In phiếu"]}),e.jsx("button",{onClick:f,className:"px-6 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors font-medium",children:"Đóng"})]}),e.jsxs("div",{id:"debt-print-area",style:{display:"none"},children:[e.jsx("h1",{children:"PHIẾU CÔNG NỢ"}),e.jsxs("div",{className:"info",children:[e.jsx("label",{children:m?"Khách hàng:":"Nhà cung cấp:"})," ",m?s.customerName:s.supplierName]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"info",children:[e.jsx("label",{children:"Số điện thoại:"})," ",s.phone||"Chưa có"]}),e.jsxs("div",{className:"info",children:[e.jsx("label",{children:"Biển số xe:"})," ",s.licensePlate||"Chưa có"]})]}),e.jsxs("div",{className:"info",children:[e.jsx("label",{children:"Ngày tạo:"})," ",F(new Date(s.createdDate))]}),e.jsxs("div",{className:"description",children:[e.jsx("strong",{children:"Nội dung:"}),e.jsx("br",{}),s.description]}),e.jsxs("div",{className:"amounts",children:[e.jsxs("div",{className:"amount-box",children:[e.jsx("label",{children:"Tổng tiền"}),e.jsx("div",{className:"value total",children:p(s.totalAmount)})]}),e.jsxs("div",{className:"amount-box",children:[e.jsx("label",{children:"Đã trả"}),e.jsx("div",{className:"value paid",children:p(s.paidAmount)})]}),e.jsxs("div",{className:"amount-box",children:[e.jsx("label",{children:"Còn nợ"}),e.jsx("div",{className:"value remaining",children:p(s.remainingAmount)})]})]})]})]})})},He=({debt:s,activeTab:g,onClose:n,onConfirm:f})=>{const v="customerName"in s?s.customerName:s.supplierName;return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-md w-full border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 dark:bg-red-900/20 rounded-full mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-center text-slate-900 dark:text-white mb-2",children:"Xác nhận xóa công nợ"}),e.jsxs("p",{className:"text-center text-slate-600 dark:text-slate-400 mb-6",children:["Bạn có chắc chắn muốn xóa công nợ của"," ",e.jsx("span",{className:"font-semibold",children:v}),"?",e.jsx("br",{}),e.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium",children:["Số tiền: ",p(s.remainingAmount)]}),e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:"Hành động này không thể hoàn tác!"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,className:"flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors font-medium",children:"Hủy"}),e.jsx("button",{onClick:f,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors font-medium",children:"Xóa"})]})]})})})};export{Oe as default};
