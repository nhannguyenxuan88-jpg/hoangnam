import{c as Ie,p as ts,q as rs,u as Zt,t as Ma,r as j,j as e,i as U,l as Qe,v as it,n as ce,o as cr,w as Ta,x as dt,a as mr,y as as,s as I,R as ot,z as ss,X as ur,E as Nr,A as nt,C as ns,P as lt,D as ls,F as is,G as fr,H as os,h as La,B as sr,I as nr,T as _r}from"./index-oC0AdDfJ.js";import{B as Aa,c as ds}from"./BarcodeScannerModal-Updr7Vfy.js";import{r as cs,u as ze,w as Ra}from"./xlsx-BBWTpfDg.js";import{u as us,a as br,C as hs,b as xs,c as $a}from"./CategoriesManager-CkvlTC2V.js";import ms from"./LookupManager-C0R_sS9X.js";import{u as fs,a as bs,b as gs}from"./useInventoryTransactionsRepository-t7XMkBDO.js";import{b as Ia}from"./useDebtsRepository-CY6oY2vf.js";import{v as hr}from"./validation-CmPBxZwi.js";import{P as Jt}from"./printer-B3Z-fK6G.js";import{M as ps}from"./minus-h9_rk-zz.js";import{P as Yt}from"./plus-GlAjTyJ4.js";import"./Icons-BUtVPADU.js";import"./palette-DZW8LA8Z.js";import"./bike-D8nrj_Cs.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=Ie("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=Ie("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=Ie("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=Ie("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=Ie("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=Ie("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=Ie("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=Ie("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),ws=(d,f,b="inventory-export.xlsx")=>{const o=d.map((x,h)=>{var l;return{STT:h+1,"T√™n s·∫£n ph·∫©m":x.name,SKU:x.sku,"Danh m·ª•c":x.category||"","T·ªìn kho":x.stock[f]||0,"Gi√° b√°n l·∫ª":x.retailPrice[f]||0,"Gi√° b√°n s·ªâ":((l=x.wholesalePrice)==null?void 0:l[f])||0,"Gi√° tr·ªã t·ªìn":(x.stock[f]||0)*(x.retailPrice[f]||0),"M√¥ t·∫£":x.description||""}}),c=ze.json_to_sheet(o);c["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20},{wch:10},{wch:15},{wch:15},{wch:15},{wch:40}];const m=ze.book_new();ze.book_append_sheet(m,c,"T·ªìn kho"),Ra(m,b)},Ns=(d="inventory-template.xlsx")=>{const f=[{"T√™n s·∫£n ph·∫©m":"VD: Nh·ªõt Motul 7100 10W40",SKU:"A3B7K9M2 (ho·∫∑c ƒë·ªÉ tr·ªëng - h·ªá th·ªëng t·ª± t·∫°o)","Danh m·ª•c":"Nh·ªõt ƒë·ªông c∆°","S·ªë l∆∞·ª£ng nh·∫≠p":50,"Gi√° b√°n l·∫ª":18e4,"Gi√° b√°n s·ªâ":15e4,"M√¥ t·∫£":"Nh·ªõt cao c·∫•p cho xe c√¥n tay"}],b=ze.json_to_sheet(f);b["!cols"]=[{wch:30},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:40}];const o=ze.book_new();ze.book_append_sheet(o,b,"Template"),Ra(o,d)},_s=(d,f)=>new Promise((b,o)=>{const c=new FileReader;c.onload=m=>{var x;try{const h=(x=m.target)==null?void 0:x.result,l=/\.csv$/i.test(d.name),t=cs(h,{type:l?"string":"binary"}),r=t.SheetNames[0],s=t.Sheets[r],a=ze.sheet_to_json(s,{defval:"",blankrows:!1}),n=v=>v.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/ƒë/gi,_=>_==="ƒë"?"d":"D"),i=v=>n(String(v).toLowerCase().trim()).replace(/[^a-z0-9]+/g,""),u=v=>{if(v==null||v==="")return 0;if(typeof v=="number")return v;let _=String(v).trim();_=_.replace(/\s+/g,""),_.includes(".")&&_.includes(",")?_=_.replace(/\./g,"").replace(/,/g,"."):_.includes(",")&&!_.includes(".")?_=_.replace(/,/g,"."):_=_.replace(/,/g,"");const M=parseFloat(_);return isNaN(M)?0:M},g={name:["tensanpham","ten","productname","name","tenhang","tenmh"],sku:["sku","mahang","mah","code","ma","masp","mavt"],category:["danhmuc","nhom","loai","category"],quantity:["soluongnhap","soluong","ton","tonkho","sl","qty"],costPrice:["dongianhap","gianhap","costprice","giavon"],retailPrice:["giabanle","giale","giaban","gia","retailprice","giabanra","dongiabanle"],wholesalePrice:["giabansi","giasi","wholesaleprice","giabuon","dongiabansi"],description:["mota","ghichu","note","description"]},p=[],k=a.map((v,_)=>{const M=v||{},D={};Object.keys(M).forEach(Q=>{D[i(Q)]=M[Q]});const P=(Q,H)=>{for(const K of g[Q]){const ee=D[K];if(ee!=null&&ee!=="")return ee}return H},C=String(P("name","")).trim();let N=String(P("sku","")).trim().toUpperCase();(!N||!ts(N))&&(N=rs(),console.log(`üîÑ Generated SKU for "${C}": ${N}`));const O=P("category"),q=u(P("quantity",0)),E=u(P("costPrice",0)),T=u(P("retailPrice",0)),B=u(P("wholesalePrice",0)),Z=P("description");if(!C&&Object.values(M).some(Q=>Q!=="")){const Q=Object.values(M).map(H=>String(H).trim()).filter(H=>H!=="");if(Q.length>0&&Q[0].length>0)return p.push(`H√†ng ${_+2}: Thi·∫øu t√™n s·∫£n ph·∫©m, t·∫°o SKU: ${N}`),null}return C?{name:C,sku:N,category:O,quantity:q,costPrice:E,retailPrice:T,wholesalePrice:B,description:Z}:null}).filter(Boolean);b({items:k,errors:p})}catch(h){const l=h instanceof Error?h.message:"Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu";o(new Error(l))}},c.onerror=()=>{o(new Error("L·ªói ƒë·ªçc file"))},/\.csv$/i.test(d.name)?c.readAsText(d,"utf-8"):c.readAsBinaryString(d)}),Ss=()=>{const{sales:d,workOrders:f,currentBranchId:b}=Zt(),{data:o,isLoading:c}=Ma({page:1,pageSize:20}),m=(o==null?void 0:o.data)||[],[x,h]=j.useState(""),[l,t]=j.useState("all"),[r,s]=j.useState(null),[a,n]=j.useState("all"),[i,u]=j.useState(null),[g,p]=j.useState(!1),[k,v]=j.useState(!1),_=j.useMemo(()=>{const C=new Set;return m.forEach(N=>{N.category&&C.add(N.category)}),Array.from(C).sort()},[m]),M=j.useMemo(()=>m.filter(C=>{var O,q;if(x){const E=x.toLowerCase(),T=C.name.toLowerCase().includes(E),B=(O=C.sku)==null?void 0:O.toLowerCase().includes(E),Z=(q=C.description)==null?void 0:q.toLowerCase().includes(E);if(!T&&!B&&!Z)return!1}if(l!=="all"&&C.category!==l)return!1;if(r){const E=C.retailPrice[b]||0;if(E<r.min||E>r.max)return!1}const N=C.stock[b]||0;return!(a==="in-stock"&&N<=0||a==="low-stock"&&N>10||a==="out-of-stock"&&N>0)}),[m,x,l,r,a,b]),P=i?(C=>{const N=m.find(B=>B.id===C);if(!N)return null;const O=d.filter(B=>B.items.some(Z=>Z.partId===C)),q=f.filter(B=>{var Z;return(Z=B.partsUsed)==null?void 0:Z.some(Q=>Q.partId===C)}),E=O.reduce((B,Z)=>{const Q=Z.items.find(H=>H.partId===C);return B+((Q==null?void 0:Q.quantity)||0)},0),T=O.reduce((B,Z)=>{const Q=Z.items.find(H=>H.partId===C);return B+((Q==null?void 0:Q.sellingPrice)||0)*((Q==null?void 0:Q.quantity)||0)},0);return{part:N,salesCount:O.length,totalSold:E,revenue:T,lastSold:O.length>0?O.sort((B,Z)=>new Date(Z.date).getTime()-new Date(B.date).getTime())[0].date:null,workOrdersCount:q.length}})(i):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[e.jsx("input",{type:"text",value:x,onChange:C=>h(C.target.value),placeholder:"T√¨m s·∫£n ph·∫©m...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),e.jsxs("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:[M.length," sp"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:M.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsxs("svg",{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:M.map(C=>{const N=C.stock[b]||0,O=C.retailPrice[b]||0;return e.jsxs("button",{onClick:()=>{u(C.id),v(!0)},className:"w-full p-4 flex items-center gap-3 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 truncate",children:C.name}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["SKU: ",C.sku]}),C.category&&e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-0.5",children:C.category})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-base font-bold text-blue-600 dark:text-blue-400",children:U(O)}),e.jsx("div",{className:"flex items-center gap-1 justify-end mt-1",children:N<=0?e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs rounded",children:"H·∫øt"}):N<=10?e.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs rounded",children:N}):e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 text-xs rounded",children:N})})]})]},C.id)})})})]}),g&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>p(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc t√¨m ki·∫øm"}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh m·ª•c"}),e.jsxs("select",{value:l,onChange:C=>t(C.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),_.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"T·ªìn kho"}),e.jsx("div",{className:"space-y-2",children:[{value:"all",label:"T·∫•t c·∫£"},{value:"in-stock",label:"C√≤n h√†ng"},{value:"low-stock",label:"S·∫Øp h·∫øt (‚â§10)"},{value:"out-of-stock",label:"H·∫øt h√†ng"}].map(C=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"stock",value:C.value,checked:a===C.value,onChange:N=>n(N.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:C.label})]},C.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Kho·∫£ng gi√°"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"T·ª´",onChange:C=>s(N=>({min:Number(C.target.value)||0,max:(N==null?void 0:N.max)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"}),e.jsx("input",{type:"number",placeholder:"ƒê·∫øn",onChange:C=>s(N=>({min:(N==null?void 0:N.min)||0,max:Number(C.target.value)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"})]}),r&&e.jsx("button",{onClick:()=>s(null),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"X√≥a b·ªô l·ªçc gi√°"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex gap-2",children:[e.jsx("button",{onClick:()=>{t("all"),n("all"),s(null)},className:"flex-1 px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê·∫∑t l·∫°i"}),e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})]})]})]}),k&&P&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>v(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt s·∫£n ph·∫©m"}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-1",children:P.part.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["SKU: ",P.part.sku]}),P.part.category&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["Danh m·ª•c: ",P.part.category]})]}),P.part.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"M√¥ t·∫£"}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:P.part.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"T·ªìn kho"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:P.part.stock[b]||0})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Gi√° b√°n l·∫ª"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:U(P.part.retailPrice[b]||0)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"Th·ªëng k√™ b√°n h√†ng"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ƒë√£ b√°n"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:P.totalSold})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400 mb-1",children:"Doanh thu"}),e.jsx("div",{className:"text-xl font-bold text-emerald-900 dark:text-emerald-100",children:U(P.revenue)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-600 dark:text-amber-400 mb-1",children:"S·ªë ƒë∆°n h√†ng"}),e.jsx("div",{className:"text-2xl font-bold text-amber-900 dark:text-amber-100",children:P.salesCount})]}),P.lastSold&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"B√°n g·∫ßn nh·∫•t"}),e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:Qe(P.lastSold)})]})]})]})]})]})]})]})},xr="suppliers";async function Cs(){try{const{data:d,error:f}=await ce.from(xr).select("*").order("name");return f?it({code:"supabase",message:"Kh√¥ng th·ªÉ t·∫£i nh√† cung c·∫•p",cause:f}):Ta(d||[])}catch(d){return it({code:"network",message:"L·ªói k·∫øt n·ªëi",cause:d})}}async function Es(d){var f;try{if(!d.name)return it({code:"validation",message:"Thi·∫øu t√™n nh√† cung c·∫•p"});const b={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Math.random().toString(36).slice(2)}-${Date.now()}`,name:d.name,phone:d.phone,address:d.address,created_at:new Date().toISOString()},{data:o,error:c}=await ce.from(xr).insert([b]).select().single();if(c||!o){const x=(c==null?void 0:c.message)||(c==null?void 0:c.details)||"T·∫°o nh√† cung c·∫•p th·∫•t b·∫°i";return it({code:"supabase",message:x,cause:c})}let m=null;try{const{data:x}=await ce.auth.getUser();m=((f=x==null?void 0:x.user)==null?void 0:f.id)||null}catch{}return await cr(m,{action:"supplier.create",tableName:xr,recordId:o.id,oldData:null,newData:o}),Ta(o)}catch(b){return it({code:"network",message:"L·ªói k·∫øt n·ªëi khi t·∫°o nh√† cung c·∫•p",cause:b})}}const gr=()=>dt({queryKey:["suppliers"],queryFn:async()=>{const d=await Cs();if(!d.ok)throw d.error;return d.data}}),Da=()=>{const d=mr();return as({mutationFn:async f=>{const b=await Es(f);if(!b.ok)throw b.error;return b.data},onSuccess:()=>{d.invalidateQueries({queryKey:["suppliers"]}),I.success("ƒê√£ th√™m nh√† cung c·∫•p")},onError:f=>I.error((f==null?void 0:f.message)||"L·ªói th√™m nh√† cung c·∫•p")})},lr=new Intl.NumberFormat("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:2});function Ps(d){let f=d.replace(/[^0-9.,-]/g,"");const b=f.includes("."),o=f.includes(",");b&&o?f=f.replace(/\./g,"").replace(",","."):o&&!b&&(f=f.replace(",","."));const c=Number(f);return Number.isFinite(c)?c:0}const Re=({value:d,onValue:f,placeholder:b,className:o,min:c,max:m,disabled:x,ariaLabel:h})=>{const[l,t]=ot.useState(d?lr.format(d):""),[r,s]=ot.useState(!1);ot.useEffect(()=>{r||t(d?lr.format(d):"")},[d,r]);const a=i=>{const u=i.target.value;t(u);const g=Ps(u);if(c!==void 0&&g<c){f(c);return}if(m!==void 0&&g>m){f(m);return}f(g)},n=()=>{s(!1),t(d?lr.format(d):"")};return e.jsx("input",{type:"text",inputMode:"decimal",value:l,onChange:a,onFocus:()=>s(!0),onBlur:n,placeholder:b,className:o,disabled:x,"aria-label":h})},Os=({isOpen:d,onClose:f,selectedSupplierId:b,onSelectSupplier:o})=>{const[c,m]=j.useState(""),[x,h]=j.useState(!1),{data:l=[]}=gr(),t=Da(),[r,s]=j.useState({name:"",phone:"",address:"",note:""}),a=l.filter(i=>{var g,p;const u=c.toLowerCase();return((g=i.name)==null?void 0:g.toLowerCase().includes(u))||((p=i.phone)==null?void 0:p.toLowerCase().includes(u))}),n=async()=>{if(!r.name.trim()){I.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const i=await t.mutateAsync(r);I.success("ƒê√£ th√™m nh√† cung c·∫•p"),o(i.id),s({name:"",phone:"",address:"",note:""}),h(!1),f()}catch(i){I.error((i==null?void 0:i.message)||"L·ªói th√™m nh√† cung c·∫•p")}};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[110] flex items-end sm:items-center justify-center",onClick:f,children:e.jsxs("div",{onClick:i=>i.stopPropagation(),className:"bg-white dark:bg-slate-800 w-full sm:max-w-md h-[85vh] sm:h-auto sm:max-h-[80vh] rounded-t-3xl sm:rounded-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:x?"Th√™m NCC m·ªõi":"Ch·ªçn nh√† cung c·∫•p"}),e.jsx("button",{onClick:f,className:"text-white text-2xl leading-none",children:"√ó"})]}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["T√™n nh√† cung c·∫•p ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:i=>s({...r,name:i.target.value}),placeholder:"Nh·∫≠p t√™n NCC",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",inputMode:"numeric",value:r.phone,onChange:i=>s({...r,phone:i.target.value}),placeholder:"Nh·∫≠p SƒêT",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{value:r.address,onChange:i=>s({...r,address:i.target.value}),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ghi ch√∫"}),e.jsx("textarea",{value:r.note,onChange:i=>s({...r,note:i.target.value}),placeholder:"Ghi ch√∫ th√™m",rows:2,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]}),e.jsxs("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{h(!1),s({name:"",phone:"",address:"",note:""})},className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"H·ªßy"}),e.jsx("button",{onClick:n,disabled:!r.name.trim()||t.isPending,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:t.isPending?"ƒêang th√™m...":"Th√™m NCC"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"T√¨m theo t√™n, SƒêT...",value:c,onChange:i=>m(i.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"üë§"}),e.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y nh√† cung c·∫•p"})]}):a.map(i=>e.jsxs("div",{onClick:()=>{o(i.id),f()},className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${b===i.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 active:scale-98"}`,children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:i.name}),i.phone&&e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["üìû ",i.phone]}),i.address&&e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["üìç ",i.address]})]},i.id))}),e.jsx("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsxs("button",{onClick:()=>h(!0),className:"w-full py-4 bg-green-600 hover:bg-green-700 active:scale-98 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-transform",children:[e.jsx("span",{className:"text-xl",children:"+"}),e.jsx("span",{children:"Th√™m nh√† cung c·∫•p m·ªõi"})]})})]})]})}):null},Ms=({isOpen:d,onClose:f,parts:b,receiptItems:o,setReceiptItems:c,selectedSupplier:m,setSelectedSupplier:x,searchTerm:h,setSearchTerm:l,onSave:t,discount:r,setDiscount:s,discountType:a,setDiscountType:n,paymentMethod:i,setPaymentMethod:u,paymentType:g,setPaymentType:p,partialAmount:k,setPartialAmount:v,showAddProductModal:_,setShowAddProductModal:M,onAddNewProduct:D,currentBranchId:P})=>{var oe,ne,Ne;const[C,N]=j.useState(1),[O,q]=j.useState(!1),[E,T]=j.useState(""),B=j.useRef(null),[Z,Q]=j.useState(!1),{data:H=[]}=gr();console.log("üîç GoodsReceiptMobileModal - parts:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üîç searchTerm:",h);const K=(b==null?void 0:b.filter(A=>{var Y,S;if(!h||h.trim()==="")return!0;const te=h.toLowerCase().trim();return((Y=A.name)==null?void 0:Y.toLowerCase().includes(te))||((S=A.sku)==null?void 0:S.toLowerCase().includes(te))}))||[];console.log("üîç filteredParts:",(K==null?void 0:K.length)||0);const ee=A=>{o.find(Y=>Y.partId===A.id)?(c(Y=>Y.map(S=>S.partId===A.id?{...S,quantity:S.quantity+1}:S)),I.success(`ƒê√£ tƒÉng s·ªë l∆∞·ª£ng ${A.name}`)):(c(Y=>{var S,z,X;return[...Y,{partId:A.id,partName:A.name,sku:A.sku,quantity:1,importPrice:((S=A.costPrice)==null?void 0:S[P])||0,sellingPrice:((z=A.retailPrice)==null?void 0:z[P])||0,wholesalePrice:((X=A.wholesalePrice)==null?void 0:X[P])||0}]}),I.success(`ƒê√£ th√™m ${A.name} v√†o phi·∫øu nh·∫≠p`)),l(""),setTimeout(()=>{var Y;return(Y=B.current)==null?void 0:Y.focus()},100)},de=A=>{if(A.preventDefault(),!E.trim())return;const te=E.trim(),Y=b.find(S=>{var z,X;return((z=S.sku)==null?void 0:z.toLowerCase())===te.toLowerCase()||((X=S.name)==null?void 0:X.toLowerCase().includes(te.toLowerCase()))});Y?(ee(Y),T("")):(I.info(`S·∫£n ph·∫©m m√£ ${te} ch∆∞a c√≥. Vui l√≤ng th√™m th√¥ng tin s·∫£n ph·∫©m m·ªõi.`,{autoClose:3e3}),setTimeout(()=>{M(!0)},500))},xe=A=>{console.log("üì∑ Camera scanned:",A);const te=z=>z.toLowerCase().replace(/[-\s./\\]/g,""),Y=te(A),S=b.find(z=>{var X,J;return te(z.barcode||"")===Y||((X=z.barcode)==null?void 0:X.toLowerCase())===A.toLowerCase()||te(z.sku||"")===Y||((J=z.sku)==null?void 0:J.toLowerCase())===A.toLowerCase()});S?(o.find(X=>X.partId===S.id)?c(X=>X.map(J=>J.partId===S.id?{...J,quantity:J.quantity+1}:J)):(c(X=>{var J,re,le;return[...X,{partId:S.id,partName:S.name,sku:S.sku,quantity:1,importPrice:((J=S.costPrice)==null?void 0:J[P])||0,sellingPrice:((re=S.retailPrice)==null?void 0:re[P])||0,wholesalePrice:((le=S.wholesalePrice)==null?void 0:le[P])||0}]}),I.success(`ƒê√£ th√™m ${S.name}`)),l("")):(I.info(`S·∫£n ph·∫©m m√£ ${A} ch∆∞a c√≥.`),T(A),setTimeout(()=>{M(!0)},500))};j.useEffect(()=>{d&&C===1&&setTimeout(()=>{var A;return(A=B.current)==null?void 0:A.focus()},300)},[d,C]);const se=A=>{c(te=>te.filter((Y,S)=>S!==A))},ie=o.reduce((A,te)=>A+te.quantity*te.importPrice,0),L=a==="percent"?Math.round(ie*r/100):r,w=Math.max(0,ie-L),R=()=>{if(!m){alert("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}N(2)},W=()=>{alert("Ch·ª©c nƒÉng l∆∞u nh√°p ƒëang ph√°t tri·ªÉn")};return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end justify-center sm:hidden",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 w-full h-[95vh] rounded-t-3xl overflow-hidden flex flex-col",children:C===1?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:f,className:"text-white text-2xl leading-none",children:"√ó"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"T·∫°o phi·∫øu nh·∫≠p kho"})]})}),e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsx("div",{onClick:()=>q(!0),className:`p-4 rounded-xl border-2 cursor-pointer active:scale-98 transition-transform ${m?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-dashed border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"NH√Ä CUNG C·∫§P"}),e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:((oe=H.find(A=>A.id===m))==null?void 0:oe.name)||""}),((ne=H.find(A=>A.id===m))==null?void 0:ne.phone)&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:(Ne=H.find(A=>A.id===m))==null?void 0:Ne.phone})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üë§"}),e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Ch·ªçn nh√† cung c·∫•p"})]})}),e.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),e.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10 flex-shrink-0 space-y-2",children:[e.jsxs("form",{onSubmit:de,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),e.jsx("input",{ref:B,type:"text",placeholder:"Nh·∫≠p SKU ho·∫∑c qu√©t...",value:E,onChange:A=>T(A.target.value),className:"w-full px-4 py-3 pl-11 border-2 border-blue-400 dark:border-blue-600 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-base font-mono placeholder:text-blue-500/70"}),E&&e.jsx("button",{type:"button",onClick:()=>T(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{type:"button",onClick:()=>Q(!0),className:"w-14 h-[50px] flex items-center justify-center bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-lg transition-all active:scale-95",children:e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:h,onChange:A=>l(A.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-50 dark:bg-slate-900",children:[!b||b.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"‚è≥"}),e.jsx("div",{children:"ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m..."})]}):K.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"üì¶"}),e.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),h&&e.jsxs("div",{className:"text-sm mt-2",children:['T√¨m ki·∫øm: "',h,'"']})]}):e.jsx("div",{className:"space-y-2",children:K.map(A=>{var Y,S;const te=o.find(z=>z.partId===A.id);return e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 text-base leading-tight mb-1",children:A.name}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["SKU: ",A.sku]}),e.jsxs("div",{className:"mt-2 flex gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["Nh·∫≠p:"," "]}),e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:U(((Y=A.costPrice)==null?void 0:Y[P])||0)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["B√°n:"," "]}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:U(((S=A.retailPrice)==null?void 0:S[P])||0)})]})]}),te&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["ƒê√£ th√™m: ",te.quantity," √ó"," ",U(te.importPrice)]})})]}),e.jsx("button",{onClick:()=>ee(A),className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl leading-none active:scale-95 transition-transform",children:"+"})]})},A.id)})}),e.jsxs("button",{onClick:()=>M(!0),className:"w-full mt-3 py-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-500 dark:text-slate-400 hover:border-blue-400 hover:text-blue-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"+"}),e.jsx("span",{className:"font-medium",children:"T·∫°o s·∫£n ph·∫©m m·ªõi"})]})]}),o.length>0&&e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-t from-white via-white dark:from-slate-800 dark:via-slate-800 to-transparent pt-6 pb-safe pb-4 px-3",children:e.jsxs("button",{onClick:R,className:"w-full bg-blue-600 hover:bg-blue-700 active:scale-98 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-between px-6 shadow-lg transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-white/20 rounded-full w-8 h-8 flex items-center justify-center font-bold",children:o.reduce((A,te)=>A+te.quantity,0)}),e.jsx("span",{children:"Ti·∫øp t·ª•c"})]}),e.jsx("span",{className:"font-bold",children:U(ie)})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>N(1),className:"text-white text-xl leading-none",children:"‚Üê"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"X√°c nh·∫≠n nh·∫≠p kho"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900",children:[e.jsx("div",{className:"p-3 space-y-2",children:o.map((A,te)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 leading-tight",children:A.partName}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["SKU: ",A.sku]})]}),e.jsx("button",{onClick:()=>se(te),className:"text-red-500 hover:text-red-600 text-xl",children:"√ó"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{if(A.quantity>1){const Y=[...o];Y[te].quantity-=1,c(Y)}},className:"w-8 h-8 rounded-lg border-2 border-slate-300 dark:border-slate-600 flex items-center justify-center text-slate-600 dark:text-slate-400 font-bold active:scale-95 transition-transform",children:"‚àí"}),e.jsx("div",{className:"w-12 text-center font-bold text-lg text-slate-900 dark:text-slate-100",children:A.quantity}),e.jsx("button",{onClick:()=>{const Y=[...o];Y[te].quantity+=1,c(Y)},className:"w-8 h-8 rounded-lg border-2 border-blue-500 flex items-center justify-center text-blue-600 font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[U(A.importPrice)," / c√°i"]}),e.jsx("div",{className:"font-bold text-orange-600 dark:text-orange-400",children:U(A.quantity*A.importPrice)})]})]})]},te))}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-slate-700 dark:text-slate-300",children:[e.jsx("span",{children:"T·ªïng ti·ªÅn h√†ng"}),e.jsx("span",{className:"font-medium",children:U(ie)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Gi·∫£m gi√°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",inputMode:"numeric",value:r,onChange:A=>s(Number(A.target.value)),placeholder:"0",className:"w-24 px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsxs("select",{value:a,onChange:A=>n(A.target.value),className:"px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t-2 border-slate-200 dark:border-slate-700",children:[e.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"C·∫¶N THANH TO√ÅN"}),e.jsx("span",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:U(w)})]})]})}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("cash"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${i==="cash"?"bg-green-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),e.jsx("button",{onClick:()=>u("bank"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${i==="bank"?"bg-blue-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-slate-200 dark:bg-slate-700 rounded-xl p-1 flex gap-1",children:[e.jsx("button",{onClick:()=>{p("full"),v(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="full"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"ƒê·ªß"}),e.jsx("button",{onClick:()=>p("partial"),className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="partial"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"1 Ph·∫ßn"}),e.jsx("button",{onClick:()=>{p("note"),v(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="note"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"N·ª£"})]})}),g==="partial"&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-300 dark:border-slate-600",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ti·ªÅn tr·∫£ NCC"}),e.jsx("input",{type:"number",inputMode:"numeric",value:k,onChange:A=>{const te=Number(A.target.value);te<=w?v(te):alert("S·ªë ti·ªÅn tr·∫£ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° t·ªïng ti·ªÅn")},placeholder:"Nh·∫≠p s·ªë ti·ªÅn",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg text-right text-lg font-bold bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsxs("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",U(w-k)]})]})}),g==="note"&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-red-700 dark:text-red-400 mb-1",children:"S·ªë ti·ªÅn n·ª£"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:U(w)})]})})]}),e.jsx("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 space-y-2 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:W,className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"üíæ L∆∞u Nh√°p"}),e.jsx("button",{onClick:t,disabled:!m||o.length===0,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:"‚úÖ NH·∫¨P KHO"})]})})]})})}),e.jsx(Os,{isOpen:O,onClose:()=>q(!1),selectedSupplierId:m,onSelectSupplier:x}),e.jsx(Aa,{isOpen:Z,onClose:()=>Q(!1),onScan:xe,title:"Qu√©t m√£ v·∫°ch s·∫£n ph·∫©m"})]}):null},Ts=({transactions:d})=>{const{currentBranchId:f}=Zt(),{data:b=[]}=Ia(),[o,c]=j.useState("7days"),[m,x]=j.useState(Qe(new Date,!0)),[h,l]=j.useState(Qe(new Date,!0)),[t,r]=j.useState(""),[s,a]=j.useState(!1),[n,i]=j.useState(null),u=j.useMemo(()=>{let k=d.filter(_=>_.type==="Nh·∫≠p kho");const v=new Date;switch(o){case"7days":const _=new Date(v.getTime()-6048e5);k=k.filter(P=>new Date(P.date)>=_);break;case"30days":const M=new Date(v.getTime()-720*60*60*1e3);k=k.filter(P=>new Date(P.date)>=M);break;case"thisMonth":const D=new Date(v.getFullYear(),v.getMonth(),1);k=k.filter(P=>new Date(P.date)>=D);break;case"custom":k=k.filter(P=>{const C=new Date(P.date);return C>=new Date(m)&&C<=new Date(h)});break}if(t){const _=t.toLowerCase();k=k.filter(M=>M.partName.toLowerCase().includes(_)||M.notes&&M.notes.toLowerCase().includes(_))}return k.sort((_,M)=>new Date(M.date).getTime()-new Date(_.date).getTime())},[d,o,m,h,t]),g=j.useMemo(()=>u.reduce((k,v)=>k+v.totalPrice,0),[u]),p=j.useMemo(()=>{const k=new Map;return u.forEach(v=>{var C,N;const _=new Date(v.date),M=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,D=(C=v.notes)!=null&&C.includes("NCC:")?(N=v.notes.split("NCC:")[1])==null?void 0:N.trim():"Kh√¥ng x√°c ƒë·ªãnh",P=`${M}_${D}_${_.getHours()}_${_.getMinutes()}`;k.has(P)||k.set(P,[]),k.get(P).push(v)}),Array.from(k.entries()).map(([v,_],M)=>{var N,O,q;const D=_[0],P=new Date(D.date);let C="";if(D.notes){const E=D.notes.match(/NH-\d{8}-\d{3}/);E&&(C=E[0])}return C||(C=`NH-${`${P.getFullYear()}${String(P.getMonth()+1).padStart(2,"0")}${String(P.getDate()).padStart(2,"0")}`}-${String(k.size-M).padStart(3,"0")}`),{receiptCode:C,date:D.date,supplier:(N=D.notes)!=null&&N.includes("NCC:")?(q=(O=D.notes.split("NCC:")[1])==null?void 0:O.split("|")[0])==null?void 0:q.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:_,total:_.reduce((E,T)=>E+T.totalPrice,0)}}).sort((v,_)=>new Date(_.date).getTime()-new Date(v.date).getTime())},[u]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[e.jsx("input",{type:"text",value:t,onChange:k=>r(k.target.value),placeholder:"T√¨m NCC, ph·ª• t√πng...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),e.jsx("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:p.length})]})]}),e.jsx("div",{className:"px-3 py-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"T·ªïng gi√° tr·ªã nh·∫≠p"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:U(g)})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì¶"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th·ªùi gian"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:p.map(k=>{const v=new Date(k.date),_=v.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),M=v.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),D=b.find(N=>{var O;return(O=N.description)==null?void 0:O.includes(k.receiptCode)}),P=(D==null?void 0:D.remainingAmount)||0,C=P>0;return e.jsxs("button",{onClick:()=>i({...k,date:new Date(k.date)}),className:"w-full p-4 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:k.receiptCode}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[_," ¬∑ ",M]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:U(k.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-lg",children:"üè¢"}),e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:k.supplier})]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:[k.items.length," s·∫£n ph·∫©m"]}),C&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",U(P)]})})]},k.receiptCode)})})})]}),s&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc th·ªùi gian"}),e.jsx("button",{onClick:()=>a(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Th·ªùi gian"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(k=>e.jsx("button",{onClick:()=>c(k.key),className:`px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${o===k.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:k.label},k.key))})]}),o==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),e.jsx("input",{type:"date",value:m,onChange:k=>x(k.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),e.jsx("input",{type:"date",value:h,onChange:k=>l(k.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:()=>a(!1),className:"w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})})]})]}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>i(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt phi·∫øu nh·∫≠p"}),e.jsx("button",{onClick:()=>i(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-cyan-600 dark:text-cyan-400 mb-1",children:"M√£ phi·∫øu"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600 dark:text-cyan-400",children:n.receiptCode})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Ng√†y nh·∫≠p"}),e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:Qe(new Date(n.date))})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:U(n.total)})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400 mb-1",children:"Nh√† cung c·∫•p"}),e.jsx("div",{className:"text-base font-semibold text-orange-900 dark:text-orange-100",children:n.supplier})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-2",children:["Danh s√°ch s·∫£n ph·∫©m (",n.items.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.items.map(k=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:[k.quantity," x ",k.partName]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[U(k.unitPrice||0)," / SP"]})]}),e.jsx("div",{className:"text-sm font-bold text-slate-900 dark:text-white",children:U(k.quantity*(k.unitPrice||0))})]},k.id))})]})]})]})]})]})};var ft={},Ze={},bt={},Or;function we(){if(Or)return bt;Or=1,Object.defineProperty(bt,"__esModule",{value:!0});function d(b,o){if(!(b instanceof o))throw new TypeError("Cannot call a class as a function")}var f=function b(o,c){d(this,b),this.data=o,this.text=c.text||o,this.options=c};return bt.default=f,bt}var Mr;function Ls(){if(Mr)return Ze;Mr=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.CODE39=void 0;var d=(function(){function u(g,p){for(var k=0;k<p.length;k++){var v=p[k];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(g,v.key,v)}}return function(g,p,k){return p&&u(g.prototype,p),k&&u(g,k),g}})(),f=we(),b=o(f);function o(u){return u&&u.__esModule?u:{default:u}}function c(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")}function m(u,g){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:u}function x(u,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);u.prototype=Object.create(g&&g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(u,g):u.__proto__=g)}var h=(function(u){x(g,u);function g(p,k){return c(this,g),p=p.toUpperCase(),k.mod43&&(p+=a(i(p))),m(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,p,k))}return d(g,[{key:"encode",value:function(){for(var k=r("*"),v=0;v<this.data.length;v++)k+=r(this.data[v])+"0";return k+=r("*"),{data:k,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),g})(b.default),l=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],t=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function r(u){return s(n(u))}function s(u){return t[u].toString(2)}function a(u){return l[u]}function n(u){return l.indexOf(u)}function i(u){for(var g=0,p=0;p<u.length;p++)g+=n(u[p]);return g=g%43,g}return Ze.CODE39=h,Ze}var Ce={},gt={},pt={},he={},Tr;function ct(){if(Tr)return he;Tr=1,Object.defineProperty(he,"__esModule",{value:!0});var d;function f(l,t,r){return t in l?Object.defineProperty(l,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):l[t]=r,l}var b=he.SET_A=0,o=he.SET_B=1,c=he.SET_C=2;he.SHIFT=98;var m=he.START_A=103,x=he.START_B=104,h=he.START_C=105;return he.MODULO=103,he.STOP=106,he.FNC1=207,he.SET_BY_CODE=(d={},f(d,m,b),f(d,x,o),f(d,h,c),d),he.SWAP={101:b,100:o,99:c},he.A_START_CHAR="√ê",he.B_START_CHAR="√ë",he.C_START_CHAR="√í",he.A_CHARS="[\0-_√à-√è]",he.B_CHARS="[ -√à-√è]",he.C_CHARS="(√è*[0-9]{2}√è*)",he.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011],he}var Lr;function er(){if(Lr)return pt;Lr=1,Object.defineProperty(pt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=we(),b=c(f),o=ct();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){m(this,r);var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s.substring(1),a));return n.bytes=s.split("").map(function(i){return i.charCodeAt(0)}),n}return d(r,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var a=this.bytes,n=a.shift()-105,i=o.SET_BY_CODE[n];if(i===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&a.unshift(o.FNC1);var u=r.next(a,1,i);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:r.getBar(n)+u.result+r.getBar((u.checksum+n)%o.MODULO)+r.getBar(o.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var a=this.options.ean128||!1;return typeof a=="string"&&(a=a.toLowerCase()==="true"),a}}],[{key:"getBar",value:function(a){return o.BARS[a]?o.BARS[a].toString():""}},{key:"correctIndex",value:function(a,n){if(n===o.SET_A){var i=a.shift();return i<32?i+64:i-32}else return n===o.SET_B?a.shift()-32:(a.shift()-48)*10+a.shift()-48}},{key:"next",value:function(a,n,i){if(!a.length)return{result:"",checksum:0};var u=void 0,g=void 0;if(a[0]>=200){g=a.shift()-105;var p=o.SWAP[g];p!==void 0?u=r.next(a,n+1,p):((i===o.SET_A||i===o.SET_B)&&g===o.SHIFT&&(a[0]=i===o.SET_A?a[0]>95?a[0]-96:a[0]:a[0]<32?a[0]+96:a[0]),u=r.next(a,n+1,i))}else g=r.correctIndex(a,i),u=r.next(a,n+1,i);var k=r.getBar(g),v=g*n;return{result:k+u.result,checksum:v+u.checksum}}}]),r})(b.default);return pt.default=l,pt}var vt={},Ar;function As(){if(Ar)return vt;Ar=1,Object.defineProperty(vt,"__esModule",{value:!0});var d=ct(),f=function(h){return h.match(new RegExp("^"+d.A_CHARS+"*"))[0].length},b=function(h){return h.match(new RegExp("^"+d.B_CHARS+"*"))[0].length},o=function(h){return h.match(new RegExp("^"+d.C_CHARS+"*"))[0]};function c(x,h){var l=h?d.A_CHARS:d.B_CHARS,t=x.match(new RegExp("^("+l+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(t)return t[1]+"√å"+m(x.substring(t[1].length));var r=x.match(new RegExp("^"+l+"+"))[0];return r.length===x.length?x:r+String.fromCharCode(h?205:206)+c(x.substring(r.length),!h)}function m(x){var h=o(x),l=h.length;if(l===x.length)return x;x=x.substring(l);var t=f(x)>=b(x);return h+String.fromCharCode(t?206:205)+c(x,t)}return vt.default=function(x){var h=void 0,l=o(x).length;if(l>=2)h=d.C_START_CHAR+m(x);else{var t=f(x)>b(x);h=(t?d.A_START_CHAR:d.B_START_CHAR)+c(x,t)}return h.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(r,s){return"√ã"+s})},vt}var Rr;function Rs(){if(Rr)return gt;Rr=1,Object.defineProperty(gt,"__esModule",{value:!0});var d=er(),f=c(d),b=As(),o=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){if(m(this,r),/^[\x00-\x7F\xC8-\xD3]+$/.test(s))var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,(0,o.default)(s),a));else var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a));return x(n)}return r})(f.default);return gt.default=l,gt}var kt={},$r;function $s(){if($r)return kt;$r=1,Object.defineProperty(kt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=er(),b=c(f),o=ct();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,o.A_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+o.A_CHARS+"+$").test(this.data)}}]),r})(b.default);return kt.default=l,kt}var yt={},Ir;function Is(){if(Ir)return yt;Ir=1,Object.defineProperty(yt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=er(),b=c(f),o=ct();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,o.B_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+o.B_CHARS+"+$").test(this.data)}}]),r})(b.default);return yt.default=l,yt}var jt={},Dr;function Ds(){if(Dr)return jt;Dr=1,Object.defineProperty(jt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=er(),b=c(f),o=ct();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,o.C_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+o.C_CHARS+"+$").test(this.data)}}]),r})(b.default);return jt.default=l,jt}var qr;function qs(){if(qr)return Ce;qr=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.CODE128C=Ce.CODE128B=Ce.CODE128A=Ce.CODE128=void 0;var d=Rs(),f=l(d),b=$s(),o=l(b),c=Is(),m=l(c),x=Ds(),h=l(x);function l(t){return t&&t.__esModule?t:{default:t}}return Ce.CODE128=f.default,Ce.CODE128A=o.default,Ce.CODE128B=m.default,Ce.CODE128C=h.default,Ce}var pe={},wt={},Ae={},Br;function ut(){return Br||(Br=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.SIDE_BIN="101",Ae.MIDDLE_BIN="01010",Ae.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},Ae.EAN2_STRUCTURE=["LL","LG","GL","GG"],Ae.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],Ae.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]),Ae}var Nt={},_t={},zr;function ht(){if(zr)return _t;zr=1,Object.defineProperty(_t,"__esModule",{value:!0});var d=ut(),f=function(o,c,m){var x=o.split("").map(function(l,t){return d.BINARIES[c[t]]}).map(function(l,t){return l?l[o[t]]:""});if(m){var h=o.length-1;x=x.map(function(l,t){return t<h?l+m:l})}return x.join("")};return _t.default=f,_t}var Fr;function qa(){if(Fr)return Nt;Fr=1,Object.defineProperty(Nt,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var i=0;i<n.length;i++){var u=n[i];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,i){return n&&s(a.prototype,n),i&&s(a,i),a}})(),f=ut(),b=ht(),o=x(b),c=we(),m=x(c);function x(s){return s&&s.__esModule?s:{default:s}}function h(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function l(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function t(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var r=(function(s){t(a,s);function a(n,i){h(this,a);var u=l(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,i));return u.fontSize=!i.flat&&i.fontSize>i.width*10?i.width*10:i.fontSize,u.guardHeight=i.height+u.fontSize/2+i.textMargin,u}return d(a,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(i,u){return this.text.substr(i,u)}},{key:"leftEncode",value:function(i,u){return(0,o.default)(i,u)}},{key:"rightText",value:function(i,u){return this.text.substr(i,u)}},{key:"rightEncode",value:function(i,u){return(0,o.default)(i,u)}},{key:"encodeGuarded",value:function(){var i={fontSize:this.fontSize},u={height:this.guardHeight};return[{data:f.SIDE_BIN,options:u},{data:this.leftEncode(),text:this.leftText(),options:i},{data:f.MIDDLE_BIN,options:u},{data:this.rightEncode(),text:this.rightText(),options:i},{data:f.SIDE_BIN,options:u}]}},{key:"encodeFlat",value:function(){var i=[f.SIDE_BIN,this.leftEncode(),f.MIDDLE_BIN,this.rightEncode(),f.SIDE_BIN];return{data:i.join(""),text:this.text}}}]),a})(m.default);return Nt.default=r,Nt}var Hr;function Bs(){if(Hr)return wt;Hr=1,Object.defineProperty(wt,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var i=0;i<n.length;i++){var u=n[i];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,i){return n&&s(a.prototype,n),i&&s(a,i),a}})(),f=function s(a,n,i){a===null&&(a=Function.prototype);var u=Object.getOwnPropertyDescriptor(a,n);if(u===void 0){var g=Object.getPrototypeOf(a);return g===null?void 0:s(g,n,i)}else{if("value"in u)return u.value;var p=u.get;return p===void 0?void 0:p.call(i)}},b=ut(),o=qa(),c=m(o);function m(s){return s&&s.__esModule?s:{default:s}}function x(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function h(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function l(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var t=function(a){var n=a.substr(0,12).split("").map(function(i){return+i}).reduce(function(i,u,g){return g%2?i+u*3:i+u},0);return(10-n%10)%10},r=(function(s){l(a,s);function a(n,i){x(this,a),n.search(/^[0-9]{12}$/)!==-1&&(n+=t(n));var u=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,i));return u.lastChar=i.lastChar,u}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===t(this.data)}},{key:"leftText",value:function(){return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var i=this.data.substr(1,6),u=b.EAN13_STRUCTURE[this.data[0]];return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"leftEncode",this).call(this,i,u)}},{key:"rightText",value:function(){return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var i=this.data.substr(7,6);return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"rightEncode",this).call(this,i,"RRRRRR")}},{key:"encodeGuarded",value:function(){var i=f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(i.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(i.push({data:"00"}),i.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),i}}]),a})(c.default);return wt.default=r,wt}var St={},Gr;function zs(){if(Gr)return St;Gr=1,Object.defineProperty(St,"__esModule",{value:!0});var d=(function(){function r(s,a){for(var n=0;n<a.length;n++){var i=a[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}return function(s,a,n){return a&&r(s.prototype,a),n&&r(s,n),s}})(),f=function r(s,a,n){s===null&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,a);if(i===void 0){var u=Object.getPrototypeOf(s);return u===null?void 0:r(u,a,n)}else{if("value"in i)return i.value;var g=i.get;return g===void 0?void 0:g.call(n)}},b=qa(),o=c(b);function c(r){return r&&r.__esModule?r:{default:r}}function m(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")}function x(r,s){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:r}function h(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(r,s):r.__proto__=s)}var l=function(s){var a=s.substr(0,7).split("").map(function(n){return+n}).reduce(function(n,i,u){return u%2?n+i:n+i*3},0);return(10-a%10)%10},t=(function(r){h(s,r);function s(a,n){return m(this,s),a.search(/^[0-9]{7}$/)!==-1&&(a+=l(a)),x(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a,n))}return d(s,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===l(this.data)}},{key:"leftText",value:function(){return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var n=this.data.substr(0,4);return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"leftEncode",this).call(this,n,"LLLL")}},{key:"rightText",value:function(){return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var n=this.data.substr(4,4);return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"rightEncode",this).call(this,n,"RRRR")}}]),s})(o.default);return St.default=t,St}var Ct={},Vr;function Fs(){if(Vr)return Ct;Vr=1,Object.defineProperty(Ct,"__esModule",{value:!0});var d=(function(){function a(n,i){for(var u=0;u<i.length;u++){var g=i[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(n,i,u){return i&&a(n.prototype,i),u&&a(n,u),n}})(),f=ut(),b=ht(),o=x(b),c=we(),m=x(c);function x(a){return a&&a.__esModule?a:{default:a}}function h(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function l(a,n){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:a}function t(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);a.prototype=Object.create(n&&n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(a,n):a.__proto__=n)}var r=function(n){var i=n.split("").map(function(u){return+u}).reduce(function(u,g,p){return p%2?u+g*9:u+g*3},0);return i%10},s=(function(a){t(n,a);function n(i,u){return h(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i,u))}return d(n,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var u=f.EAN5_STRUCTURE[r(this.data)];return{data:"1011"+(0,o.default)(this.data,u,"01"),text:this.text}}}]),n})(m.default);return Ct.default=s,Ct}var Et={},Ur;function Hs(){if(Ur)return Et;Ur=1,Object.defineProperty(Et,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var i=0;i<n.length;i++){var u=n[i];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,i){return n&&s(a.prototype,n),i&&s(a,i),a}})(),f=ut(),b=ht(),o=x(b),c=we(),m=x(c);function x(s){return s&&s.__esModule?s:{default:s}}function h(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function l(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function t(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var r=(function(s){t(a,s);function a(n,i){return h(this,a),l(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,i))}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var i=f.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,o.default)(this.data,i,"01"),text:this.text}}}]),a})(m.default);return Et.default=r,Et}var et={},Kr;function Ba(){if(Kr)return et;Kr=1,Object.defineProperty(et,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var i=0;i<n.length;i++){var u=n[i];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,i){return n&&s(a.prototype,n),i&&s(a,i),a}})();et.checksum=r;var f=ht(),b=m(f),o=we(),c=m(o);function m(s){return s&&s.__esModule?s:{default:s}}function x(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function h(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function l(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var t=(function(s){l(a,s);function a(n,i){x(this,a),n.search(/^[0-9]{11}$/)!==-1&&(n+=r(n));var u=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,i));return u.displayValue=i.displayValue,i.fontSize>i.width*10?u.fontSize=i.width*10:u.fontSize=i.fontSize,u.guardHeight=i.height+u.fontSize/2+i.textMargin,u}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==r(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var i="";return i+="101",i+=(0,b.default)(this.data.substr(0,6),"LLLLLL"),i+="01010",i+=(0,b.default)(this.data.substr(6,6),"RRRRRR"),i+="101",{data:i,text:this.text}}},{key:"guardedEncoding",value:function(){var i=[];return this.displayValue&&i.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),i.push({data:"101"+(0,b.default)(this.data[0],"L"),options:{height:this.guardHeight}}),i.push({data:(0,b.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),i.push({data:"01010",options:{height:this.guardHeight}}),i.push({data:(0,b.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),i.push({data:(0,b.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&i.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),i}}]),a})(c.default);function r(s){var a=0,n;for(n=1;n<11;n+=2)a+=parseInt(s[n]);for(n=0;n<11;n+=2)a+=parseInt(s[n])*3;return(10-a%10)%10}return et.default=t,et}var Pt={},Xr;function Gs(){if(Xr)return Pt;Xr=1,Object.defineProperty(Pt,"__esModule",{value:!0});var d=(function(){function i(u,g){for(var p=0;p<g.length;p++){var k=g[p];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(u,k.key,k)}}return function(u,g,p){return g&&i(u.prototype,g),p&&i(u,p),u}})(),f=ht(),b=x(f),o=we(),c=x(o),m=Ba();function x(i){return i&&i.__esModule?i:{default:i}}function h(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")}function l(i,u){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:i}function t(i,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);i.prototype=Object.create(u&&u.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(i,u):i.__proto__=u)}var r=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],s=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],a=(function(i){t(u,i);function u(g,p){h(this,u);var k=l(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,g,p));if(k.isValid=!1,g.search(/^[0-9]{6}$/)!==-1)k.middleDigits=g,k.upcA=n(g,"0"),k.text=p.text||""+k.upcA[0]+g+k.upcA[k.upcA.length-1],k.isValid=!0;else if(g.search(/^[01][0-9]{7}$/)!==-1)if(k.middleDigits=g.substring(1,g.length-1),k.upcA=n(k.middleDigits,g[0]),k.upcA[k.upcA.length-1]===g[g.length-1])k.isValid=!0;else return l(k);else return l(k);return k.displayValue=p.displayValue,p.fontSize>p.width*10?k.fontSize=p.width*10:k.fontSize=p.fontSize,k.guardHeight=p.height+k.fontSize/2+p.textMargin,k}return d(u,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var p="";return p+="101",p+=this.encodeMiddleDigits(),p+="010101",{data:p,text:this.text}}},{key:"guardedEncoding",value:function(){var p=[];return this.displayValue&&p.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),p.push({data:"101",options:{height:this.guardHeight}}),p.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),p.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&p.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),p}},{key:"encodeMiddleDigits",value:function(){var p=this.upcA[0],k=this.upcA[this.upcA.length-1],v=s[parseInt(k)][parseInt(p)];return(0,b.default)(this.middleDigits,v)}}]),u})(c.default);function n(i,u){for(var g=parseInt(i[i.length-1]),p=r[g],k="",v=0,_=0;_<p.length;_++){var M=p[_];M==="X"?k+=i[v++]:k+=M}return k=""+u+k,""+k+(0,m.checksum)(k)}return Pt.default=a,Pt}var Wr;function Vs(){if(Wr)return pe;Wr=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.UPCE=pe.UPC=pe.EAN2=pe.EAN5=pe.EAN8=pe.EAN13=void 0;var d=Bs(),f=a(d),b=zs(),o=a(b),c=Fs(),m=a(c),x=Hs(),h=a(x),l=Ba(),t=a(l),r=Gs(),s=a(r);function a(n){return n&&n.__esModule?n:{default:n}}return pe.EAN13=f.default,pe.EAN8=o.default,pe.EAN5=m.default,pe.EAN2=h.default,pe.UPC=t.default,pe.UPCE=s.default,pe}var qe={},Ot={},Ke={},Qr;function Us(){return Qr||(Qr=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.START_BIN="1010",Ke.END_BIN="11101",Ke.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]),Ke}var Yr;function za(){if(Yr)return Ot;Yr=1,Object.defineProperty(Ot,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=Us(),b=we(),o=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return d(r,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var a=this,n=this.data.match(/.{2}/g).map(function(i){return a.encodePair(i)}).join("");return{data:f.START_BIN+n+f.END_BIN,text:this.text}}},{key:"encodePair",value:function(a){var n=f.BINARIES[a[1]];return f.BINARIES[a[0]].split("").map(function(i,u){return(i==="1"?"111":"1")+(n[u]==="1"?"000":"0")}).join("")}}]),r})(o.default);return Ot.default=l,Ot}var Mt={},Jr;function Ks(){if(Jr)return Mt;Jr=1,Object.defineProperty(Mt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=za(),b=o(f);function o(t){return t&&t.__esModule?t:{default:t}}function c(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function m(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function x(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var h=function(r){var s=r.substr(0,13).split("").map(function(a){return parseInt(a,10)}).reduce(function(a,n,i){return a+n*(3-i%2*2)},0);return Math.ceil(s/10)*10-s},l=(function(t){x(r,t);function r(s,a){return c(this,r),s.search(/^[0-9]{13}$/)!==-1&&(s+=h(s)),m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===h(this.data)}}]),r})(b.default);return Mt.default=l,Mt}var Zr;function Xs(){if(Zr)return qe;Zr=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.ITF14=qe.ITF=void 0;var d=za(),f=c(d),b=Ks(),o=c(b);function c(m){return m&&m.__esModule?m:{default:m}}return qe.ITF=f.default,qe.ITF14=o.default,qe}var ye={},Tt={},ea;function xt(){if(ea)return Tt;ea=1,Object.defineProperty(Tt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=we(),b=o(f);function o(t){return t&&t.__esModule?t:{default:t}}function c(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function m(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function x(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var h=(function(t){x(r,t);function r(s,a){return c(this,r),m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"encode",value:function(){for(var a="110",n=0;n<this.data.length;n++){var i=parseInt(this.data[n]),u=i.toString(2);u=l(u,4-u.length);for(var g=0;g<u.length;g++)a+=u[g]=="0"?"100":"110"}return a+="1001",{data:a,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),r})(b.default);function l(t,r){for(var s=0;s<r;s++)t="0"+t;return t}return Tt.default=h,Tt}var Lt={},tt={},ta;function tr(){if(ta)return tt;ta=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.mod10=d,tt.mod11=f;function d(b){for(var o=0,c=0;c<b.length;c++){var m=parseInt(b[c]);(c+b.length)%2===0?o+=m:o+=m*2%10+Math.floor(m*2/10)}return(10-o%10)%10}function f(b){for(var o=0,c=[2,3,4,5,6,7],m=0;m<b.length;m++){var x=parseInt(b[b.length-1-m]);o+=c[m%c.length]*x}return(11-o%11)%11}return tt}var ra;function Ws(){if(ra)return Lt;ra=1,Object.defineProperty(Lt,"__esModule",{value:!0});var d=xt(),f=o(d),b=tr();function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r+(0,b.mod10)(r),s))}return t})(f.default);return Lt.default=h,Lt}var At={},aa;function Qs(){if(aa)return At;aa=1,Object.defineProperty(At,"__esModule",{value:!0});var d=xt(),f=o(d),b=tr();function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r+(0,b.mod11)(r),s))}return t})(f.default);return At.default=h,At}var Rt={},sa;function Ys(){if(sa)return Rt;sa=1,Object.defineProperty(Rt,"__esModule",{value:!0});var d=xt(),f=o(d),b=tr();function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),r+=(0,b.mod10)(r),r+=(0,b.mod10)(r),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return t})(f.default);return Rt.default=h,Rt}var $t={},na;function Js(){if(na)return $t;na=1,Object.defineProperty($t,"__esModule",{value:!0});var d=xt(),f=o(d),b=tr();function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),r+=(0,b.mod11)(r),r+=(0,b.mod10)(r),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return t})(f.default);return $t.default=h,$t}var la;function Zs(){if(la)return ye;la=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.MSI1110=ye.MSI1010=ye.MSI11=ye.MSI10=ye.MSI=void 0;var d=xt(),f=r(d),b=Ws(),o=r(b),c=Qs(),m=r(c),x=Ys(),h=r(x),l=Js(),t=r(l);function r(s){return s&&s.__esModule?s:{default:s}}return ye.MSI=f.default,ye.MSI10=o.default,ye.MSI11=m.default,ye.MSI1010=h.default,ye.MSI1110=t.default,ye}var rt={},ia;function en(){if(ia)return rt;ia=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.pharmacode=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=we(),b=o(f);function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){c(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s));return a.number=parseInt(r,10),a}return d(t,[{key:"encode",value:function(){for(var s=this.number,a="";!isNaN(s)&&s!=0;)s%2===0?(a="11100"+a,s=(s-2)/2):(a="100"+a,s=(s-1)/2);return a=a.slice(0,-2),{data:a,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t})(b.default);return rt.pharmacode=h,rt}var at={},oa;function tn(){if(oa)return at;oa=1,Object.defineProperty(at,"__esModule",{value:!0}),at.codabar=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=we(),b=o(f);function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){c(this,t),r.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(r="A"+r+"A");var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.toUpperCase(),s));return a.text=a.options.text||a.text.replace(/[A-D]/g,""),a}return d(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var s=[],a=this.getEncodings(),n=0;n<this.data.length;n++)s.push(a[this.data.charAt(n)]),n!==this.data.length-1&&s.push("0");return{text:this.text,data:s.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t})(b.default);return at.codabar=h,at}var Be={},It={},Xe={},da;function rn(){return da||(da=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","√ø"],Xe.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],Xe.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"":["(%)","T"]}),Xe}var ca;function Fa(){if(ca)return It;ca=1,Object.defineProperty(It,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=rn(),b=we(),o=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var a=this.data.split("").flatMap(function(g){return f.MULTI_SYMBOLS[g]||g}),n=a.map(function(g){return r.getEncoding(g)}).join(""),i=r.checksum(a,20),u=r.checksum(a.concat(i),15);return{text:this.text,data:r.getEncoding("√ø")+n+r.getEncoding(i)+r.getEncoding(u)+r.getEncoding("√ø")+"1"}}}],[{key:"getEncoding",value:function(a){return f.BINARIES[r.symbolValue(a)]}},{key:"getSymbol",value:function(a){return f.SYMBOLS[a]}},{key:"symbolValue",value:function(a){return f.SYMBOLS.indexOf(a)}},{key:"checksum",value:function(a,n){var i=a.slice().reverse().reduce(function(u,g,p){var k=p%n+1;return u+r.symbolValue(g)*k},0);return r.getSymbol(i%47)}}]),r})(o.default);return It.default=l,It}var Dt={},ua;function an(){if(ua)return Dt;ua=1,Object.defineProperty(Dt,"__esModule",{value:!0});var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=Fa(),b=o(f);function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return d(t,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),t})(b.default);return Dt.default=h,Dt}var ha;function sn(){if(ha)return Be;ha=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.CODE93FullASCII=Be.CODE93=void 0;var d=Fa(),f=c(d),b=an(),o=c(b);function c(m){return m&&m.__esModule?m:{default:m}}return Be.CODE93=f.default,Be.CODE93FullASCII=o.default,Be}var st={},xa;function nn(){if(xa)return st;xa=1,Object.defineProperty(st,"__esModule",{value:!0}),st.GenericBarcode=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=we(),b=o(f);function o(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return d(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t})(b.default);return st.GenericBarcode=h,st}var ma;function ln(){if(ma)return ft;ma=1,Object.defineProperty(ft,"__esModule",{value:!0});var d=Ls(),f=qs(),b=Vs(),o=Xs(),c=Zs(),m=en(),x=tn(),h=sn(),l=nn();return ft.default={CODE39:d.CODE39,CODE128:f.CODE128,CODE128A:f.CODE128A,CODE128B:f.CODE128B,CODE128C:f.CODE128C,EAN13:b.EAN13,EAN8:b.EAN8,EAN5:b.EAN5,EAN2:b.EAN2,UPC:b.UPC,UPCE:b.UPCE,ITF14:o.ITF14,ITF:o.ITF,MSI:c.MSI,MSI10:c.MSI10,MSI11:c.MSI11,MSI1010:c.MSI1010,MSI1110:c.MSI1110,pharmacode:m.pharmacode,codabar:x.codabar,CODE93:h.CODE93,CODE93FullASCII:h.CODE93FullASCII,GenericBarcode:l.GenericBarcode},ft}var qt={},fa;function rr(){if(fa)return qt;fa=1,Object.defineProperty(qt,"__esModule",{value:!0});var d=Object.assign||function(f){for(var b=1;b<arguments.length;b++){var o=arguments[b];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(f[c]=o[c])}return f};return qt.default=function(f,b){return d({},f,b)},qt}var Bt={},ba;function on(){if(ba)return Bt;ba=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=d;function d(f){var b=[];function o(c){if(Array.isArray(c))for(var m=0;m<c.length;m++)o(c[m]);else c.text=c.text||"",c.data=c.data||"",b.push(c)}return o(f),b}return Bt}var zt={},ga;function dn(){if(ga)return zt;ga=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=d;function d(f){return f.marginTop=f.marginTop||f.margin,f.marginBottom=f.marginBottom||f.margin,f.marginRight=f.marginRight||f.margin,f.marginLeft=f.marginLeft||f.margin,f}return zt}var Ft={},Ht={},Gt={},pa;function Ha(){if(pa)return Gt;pa=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.default=d;function d(f){var b=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var o in b)b.hasOwnProperty(o)&&(o=b[o],typeof f[o]=="string"&&(f[o]=parseInt(f[o],10)));return typeof f.displayValue=="string"&&(f.displayValue=f.displayValue!="false"),f}return Gt}var Vt={},va;function Ga(){if(va)return Vt;va=1,Object.defineProperty(Vt,"__esModule",{value:!0});var d={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};return Vt.default=d,Vt}var ka;function cn(){if(ka)return Ht;ka=1,Object.defineProperty(Ht,"__esModule",{value:!0});var d=Ha(),f=c(d),b=Ga(),o=c(b);function c(x){return x&&x.__esModule?x:{default:x}}function m(x){var h={};for(var l in o.default)o.default.hasOwnProperty(l)&&(x.hasAttribute("jsbarcode-"+l.toLowerCase())&&(h[l]=x.getAttribute("jsbarcode-"+l.toLowerCase())),x.hasAttribute("data-"+l.toLowerCase())&&(h[l]=x.getAttribute("data-"+l.toLowerCase())));return h.value=x.getAttribute("jsbarcode-value")||x.getAttribute("data-value"),h=(0,f.default)(h),h}return Ht.default=m,Ht}var Ut={},Kt={},je={},ya;function Va(){if(ya)return je;ya=1,Object.defineProperty(je,"__esModule",{value:!0}),je.getTotalWidthOfEncodings=je.calculateEncodingAttributes=je.getBarcodePadding=je.getEncodingHeight=je.getMaximumHeightOfEncodings=void 0;var d=rr(),f=b(d);function b(t){return t&&t.__esModule?t:{default:t}}function o(t,r){return r.height+(r.displayValue&&t.text.length>0?r.fontSize+r.textMargin:0)+r.marginTop+r.marginBottom}function c(t,r,s){if(s.displayValue&&r<t){if(s.textAlign=="center")return Math.floor((t-r)/2);if(s.textAlign=="left")return 0;if(s.textAlign=="right")return Math.floor(t-r)}return 0}function m(t,r,s){for(var a=0;a<t.length;a++){var n=t[a],i=(0,f.default)(r,n.options),u;i.displayValue?u=l(n.text,i,s):u=0;var g=n.data.length*i.width;n.width=Math.ceil(Math.max(u,g)),n.height=o(n,i),n.barcodePadding=c(u,g,i)}}function x(t){for(var r=0,s=0;s<t.length;s++)r+=t[s].width;return r}function h(t){for(var r=0,s=0;s<t.length;s++)t[s].height>r&&(r=t[s].height);return r}function l(t,r,s){var a;if(s)a=s;else if(typeof document<"u")a=document.createElement("canvas").getContext("2d");else return 0;a.font=r.fontOptions+" "+r.fontSize+"px "+r.font;var n=a.measureText(t);if(!n)return 0;var i=n.width;return i}return je.getMaximumHeightOfEncodings=h,je.getEncodingHeight=o,je.getBarcodePadding=c,je.calculateEncodingAttributes=m,je.getTotalWidthOfEncodings=x,je}var ja;function un(){if(ja)return Kt;ja=1,Object.defineProperty(Kt,"__esModule",{value:!0});var d=(function(){function h(l,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,s.key,s)}}return function(l,t,r){return t&&h(l.prototype,t),r&&h(l,r),l}})(),f=rr(),b=c(f),o=Va();function c(h){return h&&h.__esModule?h:{default:h}}function m(h,l){if(!(h instanceof l))throw new TypeError("Cannot call a class as a function")}var x=(function(){function h(l,t,r){m(this,h),this.canvas=l,this.encodings=t,this.options=r}return d(h,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var t=0;t<this.encodings.length;t++){var r=(0,b.default)(this.options,this.encodings[t].options);this.drawCanvasBarcode(r,this.encodings[t]),this.drawCanvasText(r,this.encodings[t]),this.moveCanvasDrawing(this.encodings[t])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var t=this.canvas.getContext("2d");t.save(),(0,o.calculateEncodingAttributes)(this.encodings,this.options,t);var r=(0,o.getTotalWidthOfEncodings)(this.encodings),s=(0,o.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=r+this.options.marginLeft+this.options.marginRight,this.canvas.height=s,t.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(t.fillStyle=this.options.background,t.fillRect(0,0,this.canvas.width,this.canvas.height)),t.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(t,r){var s=this.canvas.getContext("2d"),a=r.data,n;t.textPosition=="top"?n=t.marginTop+t.fontSize+t.textMargin:n=t.marginTop,s.fillStyle=t.lineColor;for(var i=0;i<a.length;i++){var u=i*t.width+r.barcodePadding;a[i]==="1"?s.fillRect(u,n,t.width,t.height):a[i]&&s.fillRect(u,n,t.width,t.height*a[i])}}},{key:"drawCanvasText",value:function(t,r){var s=this.canvas.getContext("2d"),a=t.fontOptions+" "+t.fontSize+"px "+t.font;if(t.displayValue){var n,i;t.textPosition=="top"?i=t.marginTop+t.fontSize-t.textMargin:i=t.height+t.textMargin+t.marginTop+t.fontSize,s.font=a,t.textAlign=="left"||r.barcodePadding>0?(n=0,s.textAlign="left"):t.textAlign=="right"?(n=r.width-1,s.textAlign="right"):(n=r.width/2,s.textAlign="center"),s.fillText(r.text,n,i)}}},{key:"moveCanvasDrawing",value:function(t){var r=this.canvas.getContext("2d");r.translate(t.width,0)}},{key:"restoreCanvas",value:function(){var t=this.canvas.getContext("2d");t.restore()}}]),h})();return Kt.default=x,Kt}var Xt={},wa;function hn(){if(wa)return Xt;wa=1,Object.defineProperty(Xt,"__esModule",{value:!0});var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=rr(),b=c(f),o=Va();function c(l){return l&&l.__esModule?l:{default:l}}function m(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}var x="http://www.w3.org/2000/svg",h=(function(){function l(t,r,s){m(this,l),this.svg=t,this.encodings=r,this.options=s,this.document=s.xmlDocument||document}return d(l,[{key:"render",value:function(){var r=this.options.marginLeft;this.prepareSVG();for(var s=0;s<this.encodings.length;s++){var a=this.encodings[s],n=(0,b.default)(this.options,a.options),i=this.createGroup(r,n.marginTop,this.svg);this.setGroupOptions(i,n),this.drawSvgBarcode(i,n,a),this.drawSVGText(i,n,a),r+=a.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,o.calculateEncodingAttributes)(this.encodings,this.options);var r=(0,o.getTotalWidthOfEncodings)(this.encodings),s=(0,o.getMaximumHeightOfEncodings)(this.encodings),a=r+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(a,s),this.options.background&&this.drawRect(0,0,a,s,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(r,s,a){var n=a.data,i;s.textPosition=="top"?i=s.fontSize+s.textMargin:i=0;for(var u=0,g=0,p=0;p<n.length;p++)g=p*s.width+a.barcodePadding,n[p]==="1"?u++:u>0&&(this.drawRect(g-s.width*u,i,s.width*u,s.height,r),u=0);u>0&&this.drawRect(g-s.width*(u-1),i,s.width*u,s.height,r)}},{key:"drawSVGText",value:function(r,s,a){var n=this.document.createElementNS(x,"text");if(s.displayValue){var i,u;n.setAttribute("style","font:"+s.fontOptions+" "+s.fontSize+"px "+s.font),s.textPosition=="top"?u=s.fontSize-s.textMargin:u=s.height+s.textMargin+s.fontSize,s.textAlign=="left"||a.barcodePadding>0?(i=0,n.setAttribute("text-anchor","start")):s.textAlign=="right"?(i=a.width-1,n.setAttribute("text-anchor","end")):(i=a.width/2,n.setAttribute("text-anchor","middle")),n.setAttribute("x",i),n.setAttribute("y",u),n.appendChild(this.document.createTextNode(a.text)),r.appendChild(n)}}},{key:"setSvgAttributes",value:function(r,s){var a=this.svg;a.setAttribute("width",r+"px"),a.setAttribute("height",s+"px"),a.setAttribute("x","0px"),a.setAttribute("y","0px"),a.setAttribute("viewBox","0 0 "+r+" "+s),a.setAttribute("xmlns",x),a.setAttribute("version","1.1"),a.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(r,s,a){var n=this.document.createElementNS(x,"g");return n.setAttribute("transform","translate("+r+", "+s+")"),a.appendChild(n),n}},{key:"setGroupOptions",value:function(r,s){r.setAttribute("style","fill:"+s.lineColor+";")}},{key:"drawRect",value:function(r,s,a,n,i){var u=this.document.createElementNS(x,"rect");return u.setAttribute("x",r),u.setAttribute("y",s),u.setAttribute("width",a),u.setAttribute("height",n),i.appendChild(u),u}}]),l})();return Xt.default=h,Xt}var Wt={},Na;function xn(){if(Na)return Wt;Na=1,Object.defineProperty(Wt,"__esModule",{value:!0});var d=(function(){function o(c,m){for(var x=0;x<m.length;x++){var h=m[x];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,m,x){return m&&o(c.prototype,m),x&&o(c,x),c}})();function f(o,c){if(!(o instanceof c))throw new TypeError("Cannot call a class as a function")}var b=(function(){function o(c,m,x){f(this,o),this.object=c,this.encodings=m,this.options=x}return d(o,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),o})();return Wt.default=b,Wt}var _a;function mn(){if(_a)return Ut;_a=1,Object.defineProperty(Ut,"__esModule",{value:!0});var d=un(),f=x(d),b=hn(),o=x(b),c=xn(),m=x(c);function x(h){return h&&h.__esModule?h:{default:h}}return Ut.default={CanvasRenderer:f.default,SVGRenderer:o.default,ObjectRenderer:m.default},Ut}var We={},Sa;function Ua(){if(Sa)return We;Sa=1,Object.defineProperty(We,"__esModule",{value:!0});function d(x,h){if(!(x instanceof h))throw new TypeError("Cannot call a class as a function")}function f(x,h){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:x}function b(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);x.prototype=Object.create(h&&h.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(x,h):x.__proto__=h)}var o=(function(x){b(h,x);function h(l,t){d(this,h);var r=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return r.name="InvalidInputException",r.symbology=l,r.input=t,r.message='"'+r.input+'" is not a valid input for '+r.symbology,r}return h})(Error),c=(function(x){b(h,x);function h(){d(this,h);var l=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return l.name="InvalidElementException",l.message="Not supported type to render on",l}return h})(Error),m=(function(x){b(h,x);function h(){d(this,h);var l=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return l.name="NoElementException",l.message="No element to render on.",l}return h})(Error);return We.InvalidInputException=o,We.InvalidElementException=c,We.NoElementException=m,We}var Ca;function fn(){if(Ca)return Ft;Ca=1,Object.defineProperty(Ft,"__esModule",{value:!0});var d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},f=cn(),b=x(f),o=mn(),c=x(o),m=Ua();function x(r){return r&&r.__esModule?r:{default:r}}function h(r){if(typeof r=="string")return l(r);if(Array.isArray(r)){for(var s=[],a=0;a<r.length;a++)s.push(h(r[a]));return s}else{if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLImageElement)return t(r);if(r&&r.nodeName&&r.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&r instanceof SVGElement)return{element:r,options:(0,b.default)(r),renderer:c.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement)return{element:r,options:(0,b.default)(r),renderer:c.default.CanvasRenderer};if(r&&r.getContext)return{element:r,renderer:c.default.CanvasRenderer};if(r&&(typeof r>"u"?"undefined":d(r))==="object"&&!r.nodeName)return{element:r,renderer:c.default.ObjectRenderer};throw new m.InvalidElementException}}function l(r){var s=document.querySelectorAll(r);if(s.length!==0){for(var a=[],n=0;n<s.length;n++)a.push(h(s[n]));return a}}function t(r){var s=document.createElement("canvas");return{element:s,options:(0,b.default)(r),renderer:c.default.CanvasRenderer,afterRender:function(){r.setAttribute("src",s.toDataURL())}}}return Ft.default=h,Ft}var Qt={},Ea;function bn(){if(Ea)return Qt;Ea=1,Object.defineProperty(Qt,"__esModule",{value:!0});var d=(function(){function o(c,m){for(var x=0;x<m.length;x++){var h=m[x];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,m,x){return m&&o(c.prototype,m),x&&o(c,x),c}})();function f(o,c){if(!(o instanceof c))throw new TypeError("Cannot call a class as a function")}var b=(function(){function o(c){f(this,o),this.api=c}return d(o,[{key:"handleCatch",value:function(m){if(m.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw m.message;else throw m;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(m){try{var x=m.apply(void 0,arguments);return this.api._options.valid(!0),x}catch(h){return this.handleCatch(h),this.api}}}]),o})();return Qt.default=b,Qt}var ir,Pa;function gn(){if(Pa)return ir;Pa=1;var d=ln(),f=p(d),b=rr(),o=p(b),c=on(),m=p(c),x=dn(),h=p(x),l=fn(),t=p(l),r=Ha(),s=p(r),a=bn(),n=p(a),i=Ua(),u=Ga(),g=p(u);function p(N){return N&&N.__esModule?N:{default:N}}var k=function(){},v=function(O,q,E){var T=new k;if(typeof O>"u")throw Error("No element to render on was provided.");return T._renderProperties=(0,t.default)(O),T._encodings=[],T._options=g.default,T._errorHandler=new n.default(T),typeof q<"u"&&(E=E||{},E.format||(E.format=P()),T.options(E)[E.format](q,E).render()),T};v.getModule=function(N){return f.default[N]};for(var _ in f.default)f.default.hasOwnProperty(_)&&M(f.default,_);function M(N,O){k.prototype[O]=k.prototype[O.toUpperCase()]=k.prototype[O.toLowerCase()]=function(q,E){var T=this;return T._errorHandler.wrapBarcodeCall(function(){E.text=typeof E.text>"u"?void 0:""+E.text;var B=(0,o.default)(T._options,E);B=(0,s.default)(B);var Z=N[O],Q=D(q,Z,B);return T._encodings.push(Q),T})}}function D(N,O,q){N=""+N;var E=new O(N,q);if(!E.valid())throw new i.InvalidInputException(E.constructor.name,N);var T=E.encode();T=(0,m.default)(T);for(var B=0;B<T.length;B++)T[B].options=(0,o.default)(q,T[B].options);return T}function P(){return f.default.CODE128?"CODE128":Object.keys(f.default)[0]}k.prototype.options=function(N){return this._options=(0,o.default)(this._options,N),this},k.prototype.blank=function(N){var O=new Array(N+1).join("0");return this._encodings.push({data:O}),this},k.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var N;for(var O in this._renderProperties){N=this._renderProperties[O];var q=(0,o.default)(this._options,N.options);q.format=="auto"&&(q.format=P()),this._errorHandler.wrapBarcodeCall(function(){var E=q.value,T=f.default[q.format.toUpperCase()],B=D(E,T,q);C(N,B,q)})}}},k.prototype.render=function(){if(!this._renderProperties)throw new i.NoElementException;if(Array.isArray(this._renderProperties))for(var N=0;N<this._renderProperties.length;N++)C(this._renderProperties[N],this._encodings,this._options);else C(this._renderProperties,this._encodings,this._options);return this},k.prototype._defaults=g.default;function C(N,O,q){O=(0,m.default)(O);for(var E=0;E<O.length;E++)O[E].options=(0,o.default)(q,O[E].options),(0,h.default)(O[E].options);(0,h.default)(q);var T=N.renderer,B=new T(N.element,O,q);B.render(),N.afterRender&&N.afterRender()}return typeof window<"u"&&(window.JsBarcode=v),typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(N,O){var q=[];return jQuery(this).each(function(){q.push(this)}),v(q,N,O)}),ir=v,ir}var pn=gn();const Ye=ss(pn),or={"30x20":{width:30,height:20,name:"30√ó20mm (nh·ªè)",barcodeHeight:25,fontSize:7},"40x30":{width:40,height:30,name:"40√ó30mm (ph·ªï bi·∫øn)",barcodeHeight:35,fontSize:8},"50x30":{width:50,height:30,name:"50√ó30mm (v·ª´a)",barcodeHeight:40,fontSize:9},"60x40":{width:60,height:40,name:"60√ó40mm (l·ªõn)",barcodeHeight:45,fontSize:10},"80x50":{width:80,height:50,name:"80√ó50mm (max)",barcodeHeight:55,fontSize:12}},vn=({part:d,currentBranchId:f,onClose:b})=>{const o=j.useRef(null),c=j.useRef(null),[m,x]=j.useState(1),[h,l]=j.useState(!0),[t,r]=j.useState(!0),[s,a]=j.useState("40x30"),[n,i]=j.useState("CODE128"),[u,g]=j.useState(1),p=d.barcode||d.sku||d.id.slice(0,12),k=or[s];j.useEffect(()=>{if(o.current)try{const _=Math.max(1,(k.width-10)/50);Ye(o.current,p,{format:n,width:_,height:k.barcodeHeight,displayValue:!0,fontSize:k.fontSize,margin:2,textMargin:1,font:"monospace"})}catch(_){console.error("Barcode generation error:",_),Ye(o.current,p,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}},[p,n,s,k]);const v=()=>{if(!c.current)return;const M=window.open("","_blank");if(!M){alert("Vui l√≤ng cho ph√©p popup ƒë·ªÉ in");return}const D=Math.floor(k.width/3),P=d.name.length>D?d.name.slice(0,D)+"...":d.name,C=Array(m).fill(null).map(()=>{var N;return`
        <div class="label" style="
          width: ${k.width}mm;
          height: ${k.height}mm;
          padding: 1mm;
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          page-break-inside: avoid;
          box-sizing: border-box;
          overflow: hidden;
        ">
          ${t?`<div style="font-size: ${k.fontSize-1}px; font-weight: bold; text-align: center; line-height: 1.1; max-width: 100%; overflow: hidden; white-space: nowrap;">${P}</div>`:""}
          ${((N=o.current)==null?void 0:N.outerHTML)||""}
          ${h?`<div style="font-size: ${k.fontSize}px; font-weight: bold; line-height: 1;">${U(d.retailPrice[f]||0)}</div>`:""}
        </div>
      `}).join("");M.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>In m√£ v·∫°ch - ${d.name}</title>
          <style>
            @page {
              size: ${k.width}mm ${k.height}mm;
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            body {
              font-family: Arial, sans-serif;
              margin: 0;
              padding: 0;
              width: ${k.width*u}mm;
            }
            .labels-container {
              display: flex;
              flex-wrap: wrap;
              width: 100%;
            }
            .label {
              border: none;
            }
            svg {
              max-width: ${k.width-4}mm !important;
              height: auto !important;
            }
            @media print {
              body { 
                margin: 0; 
                padding: 0;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
              }
              .label { 
                page-break-after: always;
              }
              .label:last-child {
                page-break-after: avoid;
              }
            }
          </style>
        </head>
        <body>
          <div class="labels-container">
            ${C}
          </div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                window.onafterprint = function() { window.close(); };
              }, 200);
            };
          <\/script>
        </body>
      </html>
    `),M.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(Jt,{className:"w-5 h-5 text-blue-600"}),"In m√£ v·∫°ch n·ªôi b·ªô"]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:"Xprinter XP-360B (20-82mm)"})]}),e.jsx("button",{onClick:b,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ur,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:d.name}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono mt-1",children:["M√£: ",p]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 font-semibold mt-1",children:U(d.retailPrice[f]||0)})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 flex flex-col items-center bg-white",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Xem tr∆∞·ªõc nh√£n (",k.name,")"]}),e.jsxs("div",{ref:c,className:"border-2 border-dashed border-slate-300 rounded flex flex-col items-center justify-center bg-white",style:{width:`${k.width}mm`,height:`${k.height}mm`,padding:"1mm"},children:[t&&e.jsx("p",{className:"font-bold text-center text-slate-900 truncate max-w-full leading-tight",style:{fontSize:`${k.fontSize-1}px`},children:d.name.length>Math.floor(k.width/3)?d.name.slice(0,Math.floor(k.width/3))+"...":d.name}),e.jsx("svg",{ref:o,className:"max-w-full"}),h&&e.jsx("p",{className:"font-bold text-slate-900 leading-tight",style:{fontSize:`${k.fontSize}px`},children:U(d.retailPrice[f]||0)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"K√≠ch th∆∞·ªõc nh√£n (ph√π h·ª£p XP-360B)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(or).map(_=>e.jsx("button",{onClick:()=>a(_),className:`px-3 py-2 text-xs rounded-lg transition-colors text-left ${s===_?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:or[_].name},_))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"S·ªë l∆∞·ª£ng nh√£n"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(Math.max(1,m-1)),className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(ps,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:m,onChange:_=>x(Math.max(1,parseInt(_.target.value)||1)),className:"w-16 text-center px-2 py-1 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"1",max:"100"}),e.jsx("button",{onClick:()=>x(Math.min(100,m+1)),className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(Yt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Lo·∫°i m√£ v·∫°ch"}),e.jsxs("select",{value:n,onChange:_=>i(_.target.value),className:"px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"CODE128",children:"CODE128 (ph·ªï bi·∫øn)"}),e.jsx("option",{value:"CODE39",children:"CODE39"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:_=>r(_.target.checked),className:"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Hi·ªán t√™n"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:_=>l(_.target.checked),className:"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Hi·ªán gi√°"})]})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-300",children:[e.jsx("strong",{children:"üí° M·∫πo:"})," C√†i ƒë·∫∑t kh·ªï gi·∫•y trong driver m√°y in tr√πng v·ªõi k√≠ch th∆∞·ªõc nh√£n ƒë√£ ch·ªçn ƒë·ªÉ in ch√≠nh x√°c."]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors",children:"ƒê√≥ng"}),e.jsxs("button",{onClick:v,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),"In ",m," nh√£n"]})]})]})})},dr={"30x20":{width:30,height:20,name:"30√ó20mm",barcodeHeight:25,fontSize:7},"40x30":{width:40,height:30,name:"40√ó30mm",barcodeHeight:35,fontSize:8},"50x30":{width:50,height:30,name:"50√ó30mm",barcodeHeight:40,fontSize:9},"60x40":{width:60,height:40,name:"60√ó40mm",barcodeHeight:45,fontSize:10},"80x50":{width:80,height:50,name:"80√ó50mm",barcodeHeight:55,fontSize:12}},kn=({value:d,format:f,size:b})=>{const o=j.useRef(null);return j.useEffect(()=>{if(o.current)try{Ye(o.current,d,{format:f,width:1.5,height:b.barcodeHeight,displayValue:!0,fontSize:b.fontSize,margin:2,textMargin:1,font:"monospace"})}catch{Ye(o.current,d,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}},[d,f,b]),e.jsx("svg",{ref:o,className:"max-w-full h-auto"})},yn=({parts:d,currentBranchId:f,onClose:b})=>{const[o,c]=j.useState("select"),[m,x]=j.useState(new Map),[h,l]=j.useState(""),[t,r]=j.useState("all"),[s,a]=j.useState("40x30"),[n,i]=j.useState("CODE128"),[u,g]=j.useState(!0),[p,k]=j.useState(!0),[v,_]=j.useState("stock"),[M,D]=j.useState(1),[P,C]=j.useState(0),N=6,O=j.useMemo(()=>{const w=new Set;return d.forEach(R=>{R.category&&w.add(R.category)}),Array.from(w).sort()},[d]),q=j.useMemo(()=>d.filter(w=>{var oe,ne;const R=!h||w.name.toLowerCase().includes(h.toLowerCase())||((oe=w.sku)==null?void 0:oe.toLowerCase().includes(h.toLowerCase()))||((ne=w.barcode)==null?void 0:ne.toLowerCase().includes(h.toLowerCase())),W=t==="all"||w.category===t;return R&&W}),[d,h,t]),E=w=>w.stock[f]||0,T=w=>{const R=new Map(m);if(R.has(w.id))R.delete(w.id);else{const W=v==="stock"?Math.max(1,E(w)):v==="fixed"?M:1;R.set(w.id,{part:w,quantity:W})}x(R)},B=()=>{const w=new Map(m);q.forEach(R=>{if(!w.has(R.id)){const W=v==="stock"?Math.max(1,E(R)):v==="fixed"?M:1;w.set(R.id,{part:R,quantity:W})}}),x(w)},Z=()=>{x(new Map)},Q=(w,R)=>{const W=new Map(m),oe=W.get(w);oe&&(W.set(w,{...oe,quantity:Math.max(1,R)}),x(W))},H=()=>{const w=new Map;m.forEach((R,W)=>{const oe=v==="stock"?Math.max(1,E(R.part)):v==="fixed"?M:R.quantity;w.set(W,{...R,quantity:oe})}),x(w)},K=j.useMemo(()=>{let w=0;return m.forEach(R=>{w+=R.quantity}),w},[m]),ee=j.useMemo(()=>{const w=[];return m.forEach(({part:R,quantity:W})=>{for(let oe=0;oe<W;oe++)w.push({part:R,index:oe})}),w},[m]),de=j.useMemo(()=>{const w=P*N;return ee.slice(w,w+N)},[ee,P,N]),xe=Math.ceil(ee.length/N),se=dr[s],ie=w=>{const R=document.createElementNS("http://www.w3.org/2000/svg","svg");try{Ye(R,w,{format:n,width:Math.max(1,(se.width-10)/50),height:se.barcodeHeight,displayValue:!0,fontSize:se.fontSize,margin:2,textMargin:1,font:"monospace"})}catch{Ye(R,w,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}return R.outerHTML},L=()=>{if(m.size===0){alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 s·∫£n ph·∫©m");return}const w=window.open("","_blank");if(!w){alert("Vui l√≤ng cho ph√©p popup ƒë·ªÉ in");return}let R="";m.forEach(({part:W,quantity:oe})=>{const ne=W.barcode||W.sku||W.id.slice(0,12),Ne=ie(ne);for(let A=0;A<oe;A++)R+=`
          <div class="label" style="
            width: ${se.width}mm;
            height: ${se.height}mm;
            padding: 1mm;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            page-break-inside: avoid;
            box-sizing: border-box;
            overflow: hidden;
          ">
            ${p?`<div style="font-size: ${Math.max(7,se.fontSize-1)}px; font-weight: bold; text-align: center; line-height: 1.2; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; word-break: break-word;">${W.name}</div>`:""}
            ${Ne}
            ${u?`<div style="font-size: ${se.fontSize}px; font-weight: bold; line-height: 1;">${U(W.retailPrice[f]||0)}</div>`:""}
          </div>
        `}),w.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>In m√£ v·∫°ch h√†ng lo·∫°t - ${m.size} s·∫£n ph·∫©m</title>
          <style>
            @page {
              size: ${se.width}mm ${se.height}mm;
              margin: 0;
            }
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
              font-family: Arial, sans-serif;
              margin: 0;
              padding: 0;
            }
            .labels-container {
              display: flex;
              flex-wrap: wrap;
              width: 100%;
            }
            .label { border: none; }
            svg { max-width: ${se.width-4}mm !important; height: auto !important; }
            @media print {
              body { margin: 0; padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
              .label { page-break-after: always; }
              .label:last-child { page-break-after: avoid; }
            }
          </style>
        </head>
        <body>
          <div class="labels-container">${R}</div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                window.onafterprint = function() { window.close(); };
              }, 300);
            };
          <\/script>
        </body>
      </html>
    `),w.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-2 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(Jt,{className:"w-5 h-5 text-blue-600"}),"In m√£ v·∫°ch h√†ng lo·∫°t"]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:o==="select"?"B∆∞·ªõc 1: Ch·ªçn s·∫£n ph·∫©m v√† c√†i ƒë·∫∑t":"B∆∞·ªõc 2: Xem tr∆∞·ªõc v√† ch·ªânh s·ª≠a"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-700 rounded-lg p-0.5",children:[e.jsxs("button",{onClick:()=>c("select"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors flex items-center gap-1.5 ${o==="select"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:[e.jsx(js,{className:"w-3.5 h-3.5"}),"Ch·ªçn SP"]}),e.jsxs("button",{onClick:()=>{c("preview"),C(0)},disabled:m.size===0,className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors flex items-center gap-1.5 ${o==="preview"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:[e.jsx(Nr,{className:"w-3.5 h-3.5"}),"Xem tr∆∞·ªõc"]})]}),e.jsx("button",{onClick:b,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ur,{className:"w-5 h-5"})})]})]}),o==="select"?e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col border-r border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 space-y-2 shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:h,onChange:w=>l(w.target.value),placeholder:"T√¨m s·∫£n ph·∫©m, SKU, m√£ v·∫°ch...",className:"w-full pl-9 pr-3 py-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:w=>r(w.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),O.map(w=>e.jsx("option",{value:w,children:w},w))]}),e.jsx("button",{onClick:B,className:"px-3 py-1.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50",children:"Ch·ªçn t·∫•t c·∫£"}),e.jsx("button",{onClick:Z,className:"px-3 py-1.5 text-xs bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600",children:"B·ªè ch·ªçn"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:q.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}):e.jsx("div",{className:"space-y-1",children:q.map(w=>{const R=m.has(w.id),W=E(w);return e.jsxs("div",{onClick:()=>T(w),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${R?"bg-blue-50 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700":"bg-slate-50 dark:bg-slate-900/50 border border-transparent hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center shrink-0 ${R?"bg-blue-600 text-white":"border-2 border-slate-300 dark:border-slate-600"}`,children:R&&e.jsx(ns,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100 truncate",children:w.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono",children:w.barcode||w.sku})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªìn kho"}),e.jsx("p",{className:`text-sm font-bold ${W>0?"text-green-600":"text-red-500"}`,children:W})]})]},w.id)})})})]}),e.jsxs("div",{className:"w-full md:w-80 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 space-y-3 shrink-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"C√†i ƒë·∫∑t in"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"S·ªë l∆∞·ª£ng nh√£n"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{_("stock")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${v==="stock"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"= T·ªìn kho"}),e.jsx("button",{onClick:()=>{_("fixed")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${v==="fixed"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"C·ªë ƒë·ªãnh"}),e.jsx("button",{onClick:()=>{_("custom")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${v==="custom"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"T√πy ch·ªânh"})]}),v==="fixed"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"M·ªói SP in:"}),e.jsx("input",{type:"number",value:M,onChange:w=>D(Math.max(1,parseInt(w.target.value)||1)),className:"w-16 px-2 py-1 text-sm text-center border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",min:"1"}),e.jsx("span",{className:"text-xs text-slate-500",children:"nh√£n"})]}),m.size>0&&v!=="custom"&&e.jsxs("button",{onClick:H,className:"mt-2 w-full px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded hover:bg-amber-200",children:["√Åp d·ª•ng cho ",m.size," SP ƒë√£ ch·ªçn"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"K√≠ch th∆∞·ªõc nh√£n"}),e.jsx("select",{value:s,onChange:w=>a(w.target.value),className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700",children:Object.entries(dr).map(([w,R])=>e.jsx("option",{value:w,children:R.name},w))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:w=>k(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"T√™n"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:w=>g(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Gi√°"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 px-1",children:["ƒê√£ ch·ªçn: ",m.size," SP ‚Ä¢ ",K," nh√£n"]}),m.size===0?e.jsxs("div",{className:"text-center py-4 text-slate-400 text-xs",children:[e.jsx(lt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"Ch∆∞a ch·ªçn s·∫£n ph·∫©m n√†o"]}):e.jsx("div",{className:"space-y-1",children:Array.from(m.values()).map(({part:w,quantity:R})=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-xs font-medium text-slate-900 dark:text-slate-100 truncate",children:w.name})}),v==="custom"?e.jsx("input",{type:"number",value:R,onChange:W=>Q(w.id,parseInt(W.target.value)||1),onClick:W=>W.stopPropagation(),className:"w-14 px-1 py-0.5 text-xs text-center border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",min:"1"}):e.jsxs("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:["√ó",R]}),e.jsx("button",{onClick:W=>{W.stopPropagation(),T(w)},className:"text-red-500 hover:text-red-700",children:e.jsx(ur,{className:"w-4 h-4"})})]},w.id))})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 flex flex-wrap items-center gap-3 shrink-0 bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"K√≠ch th∆∞·ªõc:"}),e.jsx("select",{value:s,onChange:w=>a(w.target.value),className:"px-2 py-1 text-sm border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",children:Object.entries(dr).map(([w,R])=>e.jsx("option",{value:w,children:R.name},w))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:w=>k(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"T√™n SP"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:w=>g(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Gi√°"})]})]}),e.jsxs("div",{className:"ml-auto text-xs text-slate-500 dark:text-slate-400",children:["T·ªïng:"," ",e.jsx("span",{className:"font-bold text-blue-600",children:K})," ","nh√£n"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 max-w-3xl mx-auto",children:de.map(({part:w,index:R})=>{const W=w.barcode||w.sku||w.id.slice(0,12);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-md p-2 flex flex-col items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600",style:{minHeight:`${se.height*2.5}px`,aspectRatio:`${se.width}/${se.height}`},children:[p&&e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-slate-100 text-center w-full mb-1 line-clamp-2 leading-tight",style:{fontSize:`${Math.max(9,se.fontSize-1)}px`},children:w.name}),e.jsx(kn,{value:W,format:n,size:se}),u&&e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-slate-100 mt-1",children:U(w.retailPrice[f]||0)})]},`${w.id}-${R}`)})})}),xe>1&&e.jsxs("div",{className:"flex items-center justify-center gap-3 p-3 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("button",{onClick:()=>C(w=>Math.max(0,w-1)),disabled:P===0,className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(Sr,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Trang ",e.jsx("span",{className:"font-bold",children:P+1})," /"," ",xe]}),e.jsx("button",{onClick:()=>C(w=>Math.min(xe-1,w+1)),disabled:P>=xe-1,className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(ls,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:m.size})," ","s·∫£n ph·∫©m ‚Ä¢",e.jsx("span",{className:"font-semibold text-green-600 ml-1",children:K})," ","nh√£n"]}),e.jsx("div",{className:"flex gap-3",children:o==="select"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg",children:"ƒê√≥ng"}),e.jsxs("button",{onClick:()=>{c("preview"),C(0)},disabled:m.size===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed rounded-lg flex items-center gap-2",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Xem tr∆∞·ªõc (",K,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("select"),className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg flex items-center gap-2",children:[e.jsx(Sr,{className:"w-4 h-4"}),"Quay l·∫°i ch·ªânh s·ª≠a"]}),e.jsxs("button",{onClick:L,disabled:m.size===0,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-slate-400 disabled:cursor-not-allowed rounded-lg flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),"In ",K," nh√£n"]})]})})]})]})})},$e=5,Oa={neutral:{buttonActive:"border-blue-500 bg-blue-500/10 shadow-[0_5px_25px_rgba(59,130,246,0.15)] text-primary-text",buttonInactive:"border-primary-border bg-primary-bg hover:border-blue-300/70",badgeActive:"border-blue-500 text-blue-600 bg-white/60 dark:bg-slate-900/40 dark:text-blue-400",badgeInactive:"border-secondary-border text-secondary-text"},success:{buttonActive:"border-emerald-500 bg-emerald-50 shadow-[0_5px_25px_rgba(16,185,129,0.2)] text-emerald-900 dark:bg-emerald-950/50 dark:text-emerald-200",buttonInactive:"border-emerald-200 bg-emerald-50/40 hover:border-emerald-400/70 dark:border-emerald-800 dark:bg-emerald-950/20",badgeActive:"border-emerald-500 text-emerald-700 bg-emerald-50 dark:bg-emerald-950/50 dark:text-emerald-300 dark:border-emerald-600",badgeInactive:"border-emerald-200 text-emerald-600 dark:border-emerald-700 dark:text-emerald-400"},warning:{buttonActive:"border-amber-500 bg-amber-50 shadow-[0_5px_25px_rgba(245,158,11,0.25)] text-amber-900 dark:bg-amber-950/50 dark:text-amber-200",buttonInactive:"border-amber-200 bg-amber-50/40 hover:border-amber-400/70 dark:border-amber-800 dark:bg-amber-950/20",badgeActive:"border-amber-500 text-amber-700 bg-amber-50 dark:bg-amber-950/50 dark:text-amber-300 dark:border-amber-600",badgeInactive:"border-amber-200 text-amber-600 dark:border-amber-700 dark:text-amber-400"},danger:{buttonActive:"border-red-500 bg-red-50 shadow-[0_5px_25px_rgba(239,68,68,0.25)] text-red-900 dark:bg-red-950/50 dark:text-red-200",buttonInactive:"border-red-200 bg-red-50/40 hover:border-red-400/70 dark:border-red-800 dark:bg-red-950/20",badgeActive:"border-red-500 text-red-700 bg-red-50 dark:bg-red-950/50 dark:text-red-300 dark:border-red-700",badgeInactive:"border-red-200 text-red-600 dark:border-red-700 dark:text-red-400"}},Ka=({isOpen:d,onClose:f,onSave:b})=>{const[o,c]=j.useState(""),[m,x]=j.useState(""),[h,l]=j.useState(""),[t,r]=j.useState(1),[s,a]=j.useState(0),[n,i]=j.useState(0),[u,g]=j.useState(1),[p,k]=j.useState("th√°ng"),[v,_]=j.useState(!1),{data:M=[]}=br(),D=$a(),[P,C]=j.useState(!1),[N,O]=j.useState(""),q=()=>{if(!o.trim()){I.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}b({name:o.trim(),description:m.trim(),category:h||"Ch∆∞a ph√¢n lo·∫°i",quantity:Number(t)||1,importPrice:Number(s)||0,retailPrice:Number(n)||0,warranty:Number(u)||0,warrantyUnit:p}),c(""),x(""),l(""),r(1),a(0),i(0),g(1),_(!1),k("th√°ng")};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m m·ªõi"}),e.jsx("button",{onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o,onChange:E=>c(E.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"Nh·∫≠p t√™n s·∫£n ph·∫©m"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{value:m,onChange:E=>x(E.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"M√¥ t·∫£ s·∫£n ph·∫©m"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c s·∫£n ph·∫©m"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:h,onChange:E=>l(E.target.value),className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),M.map(E=>e.jsx("option",{value:E.name,children:E.name},E.id))]}),e.jsx("button",{type:"button",onClick:()=>C(!0),className:"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600","aria-label":"Th√™m danh m·ª•c m·ªõi",children:e.jsx("span",{className:"text-xl text-slate-600 dark:text-slate-300",children:"+"})})]}),P&&e.jsxs("form",{onSubmit:async E=>{E.preventDefault();const T=N.trim();if(!T){I.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");return}if(T.length<2){I.warning("T√™n qu√° ng·∫Øn");return}try{const B=await D.mutateAsync({name:T});l(B.name),O(""),C(!1)}catch(B){I.error((B==null?void 0:B.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:N,onChange:E=>O(E.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-sm text-slate-900 dark:text-slate-100"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"L∆∞u"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),O("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]})]})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Th√¥ng tin nh·∫≠p kho:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"S·ªë l∆∞·ª£ng:"}),e.jsx(Re,{value:t,onValue:E=>{const T=hr(s,E);T.warnings.length&&T.warnings.forEach(B=>I.warning(B)),r(Math.max(1,T.clean.quantity))},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gi√° nh·∫≠p:"}),e.jsx(Re,{value:s,onValue:E=>{const T=hr(E,t);T.warnings.length&&T.warnings.forEach(B=>I.warning(B)),a(T.clean.importPrice),v||i(Math.round(T.clean.importPrice*1.5))},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gi√° b√°n l·∫ª:"}),e.jsx(Re,{value:n,onValue:E=>{i(Math.max(0,Math.round(E))),_(!0)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"B·∫£o h√†nh"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{value:u,onValue:E=>g(Math.max(0,Math.floor(E))),className:"w-24 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"}),e.jsxs("select",{value:p,onChange:E=>k(E.target.value),className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"th√°ng",children:"th√°ng"}),e.jsx("option",{value:"nƒÉm",children:"nƒÉm"}),e.jsx("option",{value:"ng√†y",children:"ng√†y"})]})]})]})]})}),e.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:q,className:"w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-medium",children:"L∆∞u v√† Th√™m v√†o gi·ªè h√†ng"})})]})}):null},jn=({isOpen:d,onClose:f,parts:b,currentBranchId:o,onSave:c})=>{const[m,x]=j.useState([]),[h,l]=j.useState(""),[t,r]=j.useState(""),[s,a]=j.useState(0),[n,i]=j.useState("amount"),[u,g]=j.useState("cash"),[p,k]=j.useState("full"),[v,_]=j.useState(0),[M,D]=j.useState(!1),P=fr();console.log("üì¶ GoodsReceiptMobileWrapper - parts received:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üì¶ currentBranchId:",o),j.useEffect(()=>{d||(x([]),l(""),r(""),a(0),i("amount"),g("cash"),k("full"),_(0))},[d]);const C=O=>{(async()=>{var q;try{const E=await P.mutateAsync({name:O.name,sku:O.sku||`SKU-${Date.now()}`,category:O.category,stock:{[o]:O.quantity},costPrice:{[o]:O.importPrice},retailPrice:{[o]:O.retailPrice},wholesalePrice:{[o]:O.wholesalePrice||0}});if(!E.ok)throw new Error(((q=E.error)==null?void 0:q.message)||"Failed to create part");x(T=>[...T,{partId:E.data.id,partName:O.name,sku:O.sku||`SKU-${Date.now()}`,quantity:O.quantity,importPrice:O.importPrice,sellingPrice:O.retailPrice,wholesalePrice:O.wholesalePrice||0}]),I.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(E){I.error((E==null?void 0:E.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{D(!1)}})()},N=()=>{if(!h){I.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(m.length===0){I.error("Vui l√≤ng th√™m s·∫£n ph·∫©m");return}const O=m.reduce((B,Z)=>B+Z.quantity*Z.importPrice,0),q=n==="percent"?Math.round(O*s/100):s,E=Math.max(0,O-q);let T=0;p==="full"?T=E:p==="partial"&&(T=v),c(m,h,E,"",{paymentMethod:u,paymentType:p,paidAmount:T,discount:q}),f()};return e.jsxs(e.Fragment,{children:[e.jsx(Ms,{isOpen:d,onClose:f,parts:b,receiptItems:m,setReceiptItems:x,selectedSupplier:h,setSelectedSupplier:l,searchTerm:t,setSearchTerm:r,onSave:N,discount:s,setDiscount:a,discountType:n,setDiscountType:i,paymentMethod:u,setPaymentMethod:g,paymentType:p,setPaymentType:k,partialAmount:v,setPartialAmount:_,showAddProductModal:M,setShowAddProductModal:D,onAddNewProduct:C,currentBranchId:o}),e.jsx(Ka,{isOpen:M,onClose:()=>D(!1),onSave:C})]})},wn=({isOpen:d,onClose:f,parts:b,currentBranchId:o,onSave:c})=>{const[m,x]=j.useState(""),[h,l]=j.useState(""),t=j.useRef(null),[r,s]=j.useState(!1),[a,n]=j.useState(""),[i,u]=j.useState(1),{data:g=[]}=gr(),p=Da(),[k,v]=j.useState(!1),[_,M]=j.useState({name:"",phone:"",address:"",note:""}),D=fr(),[P,C]=j.useState(!1),[N,O]=j.useState([]),[q,E]=j.useState(null),[T,B]=j.useState(null),[Z,Q]=j.useState(0),[H,K]=j.useState(0),[ee,de]=j.useState("amount"),[xe,se]=j.useState(0),ie=j.useMemo(()=>{if(console.log("üîç Desktop Modal - parts:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üîç Desktop Modal - searchTerm:",m),!b||b.length===0)return console.log("‚ö†Ô∏è parts is empty or undefined"),[];if(!m||m.trim()==="")return console.log("‚úÖ Showing all parts:",b.length),b;const S=m.toLowerCase().trim(),z=b.filter(X=>{var J,re;return((J=X.name)==null?void 0:J.toLowerCase().includes(S))||((re=X.sku)==null?void 0:re.toLowerCase().includes(S))});return console.log("‚úÖ Filtered results:",z.length),z},[b,m]),L=S=>{var X,J;N.find(re=>re.partId===S.id)?O(re=>re.map(le=>le.partId===S.id?{...le,quantity:le.quantity+1}:le)):(O([...N,{partId:S.id,partName:S.name,sku:S.sku,quantity:1,importPrice:((X=S.costPrice)==null?void 0:X[o])||0,sellingPrice:S.retailPrice[o]||0,wholesalePrice:((J=S.wholesalePrice)==null?void 0:J[o])||0}]),I.success(`ƒê√£ th√™m ${S.name} v√†o phi·∫øu nh·∫≠p`)),x(""),setTimeout(()=>{var re;return(re=t.current)==null?void 0:re.focus()},100)},w=S=>{if(S.preventDefault(),!h.trim())return;const z=h.trim(),X=le=>le.toLowerCase().replace(/[-\s./\\]/g,""),J=X(z),re=b.find(le=>{var fe,be,mt;return X(le.barcode||"")===J||((fe=le.barcode)==null?void 0:fe.toLowerCase())===z.toLowerCase()||X(le.sku||"")===J||((be=le.sku)==null?void 0:be.toLowerCase())===z.toLowerCase()||((mt=le.name)==null?void 0:mt.toLowerCase().includes(z.toLowerCase()))});re?(L(re),l("")):(I.error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m c√≥ m√£: ${z}`),l(""))},R=S=>{console.log("üì∑ Camera scanned:",S);const z=re=>re.toLowerCase().replace(/[-\s./\\]/g,""),X=z(S),J=b.find(re=>{var le,fe;return z(re.barcode||"")===X||((le=re.barcode)==null?void 0:le.toLowerCase())===S.toLowerCase()||z(re.sku||"")===X||((fe=re.sku)==null?void 0:fe.toLowerCase())===S.toLowerCase()});J?(N.find(le=>le.partId===J.id)?O(le=>le.map(fe=>fe.partId===J.id?{...fe,quantity:fe.quantity+1}:fe)):(O(le=>{var fe,be;return[...le,{partId:J.id,partName:J.name,sku:J.sku,quantity:1,importPrice:((fe=J.costPrice)==null?void 0:fe[o])||0,sellingPrice:J.retailPrice[o]||0,wholesalePrice:((be=J.wholesalePrice)==null?void 0:be[o])||0}]}),I.success(`ƒê√£ th√™m ${J.name}`)),x("")):I.error(`Kh√¥ng t√¨m th·∫•y: ${S}`)};j.useEffect(()=>{d&&setTimeout(()=>{var S;return(S=t.current)==null?void 0:S.focus()},300)},[d]);const W=(S,z,X)=>{O(J=>J.map(re=>re.partId===S?{...re,[z]:X}:re))},oe=S=>{O(z=>z.filter(X=>X.partId!==S))},ne=j.useMemo(()=>N.reduce((S,z)=>S+z.importPrice*z.quantity,0),[N]),Ne=j.useMemo(()=>Math.max(0,ne-H),[ne,H]),{profile:A}=La(),te=()=>{var z;if(!ds(A==null?void 0:A.role,"part.update_price")){I.error("B·∫°n kh√¥ng c√≥ quy·ªÅn c·∫≠p nh·∫≠t gi√°");return}if(N.length===0){I.warning("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m nh·∫≠p kho");return}(z=g.find(X=>X.id===a))!=null&&z.name,c(N,a,Ne,"",{paymentMethod:q||"cash",paymentType:T||"full",paidAmount:T==="full"?Ne:T==="partial"?Z:0,discount:H}),O([]),n(""),x(""),K(0),se(0),de("amount")},Y=S=>{(async()=>{try{const z=await D.mutateAsync({name:S.name,sku:`SKU-${Date.now()}`,category:S.category,description:S.description,stock:{[o]:S.quantity},retailPrice:{[o]:S.retailPrice},wholesalePrice:{[o]:Math.round(S.retailPrice*.9)}});O(X=>[...X,{partId:z.id,partName:S.name,sku:z.sku,quantity:S.quantity,importPrice:S.importPrice,sellingPrice:S.retailPrice,wholesalePrice:S.wholesalePrice||0}]),I.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(z){I.error((z==null?void 0:z.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{C(!1)}})()};return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 w-full max-w-7xl h-[92vh] rounded-2xl shadow-2xl overflow-hidden flex",children:[e.jsxs("div",{className:"w-1/2 flex flex-col bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-r border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200/50 dark:border-slate-700/50 bg-gradient-to-r from-blue-50/50 to-indigo-50/50 dark:from-slate-800/50 dark:to-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:f,className:"w-9 h-9 flex items-center justify-center hover:bg-white/80 dark:hover:bg-slate-700/80 rounded-lg text-slate-600 dark:text-slate-400 transition-all hover:scale-105",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Danh m·ª•c s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"Ch·ªçn ƒë·ªÉ th√™m v√†o gi·ªè"})]})]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-lg shadow-blue-500/30 transition-all hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Th√™m m·ªõi"})]})]}),e.jsxs("div",{className:"p-3 bg-white/50 dark:bg-slate-800/50 space-y-2",children:[e.jsx("form",{onSubmit:w,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),e.jsx("input",{ref:t,type:"text",placeholder:"Qu√©t m√£ v·∫°ch ho·∫∑c nh·∫≠p SKU...",value:h,onChange:S=>l(S.target.value),className:"w-full pl-10 pr-8 py-2.5 border-2 border-blue-300 dark:border-blue-600 rounded-xl bg-blue-50/50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-sm placeholder:text-blue-500/60 dark:placeholder:text-blue-400/60 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all font-mono"}),h&&e.jsx("button",{type:"button",onClick:()=>l(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-3 py-2.5 rounded-xl border-2 border-green-500 text-green-600 bg-green-50 dark:bg-green-900/20 font-semibold text-sm flex items-center gap-1.5 transition-all hover:bg-green-100",title:"Qu√©t b·∫±ng camera",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:m,onChange:S=>x(S.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm placeholder:text-slate-400 focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:ie.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-3 opacity-30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-sm font-medium",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-xs mt-1",children:"Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c"})]}):e.jsx("div",{className:"space-y-2",children:ie.map(S=>e.jsx("div",{onClick:()=>L(S),className:"group p-3 bg-white dark:bg-slate-800 rounded-xl hover:shadow-lg hover:shadow-blue-500/10 cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-900 dark:text-slate-100 line-clamp-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:S.name}),e.jsxs("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-0.5",children:["SKU: ",e.jsx("span",{className:"font-mono",children:S.sku})]})]}),e.jsx("svg",{className:"w-5 h-5 text-slate-300 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},S.id))})})]}),e.jsxs("div",{className:"w-1/2 bg-white dark:bg-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-emerald-50/30 to-teal-50/30 dark:from-slate-800/50 dark:to-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),e.jsxs("button",{onClick:()=>{M({name:"",phone:"",address:"",note:""}),v(!0)},className:"ml-auto flex items-center gap-1 text-xs px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:hover:bg-emerald-900/50 font-medium transition-all",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Th√™m NCC"]})]}),e.jsxs("select",{value:a,onChange:S=>n(S.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm font-medium focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all",children:[e.jsx("option",{value:"",children:"Ch·ªçn nh√† cung c·∫•p..."}),g.map(S=>e.jsxs("option",{value:S.id,children:[S.name," ",S.phone?`‚Ä¢ ${S.phone}`:""]},S.id))]})]}),k&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Th√™m nh√† cung c·∫•p"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"T√™n *"}),e.jsx("input",{autoFocus:!0,value:_.name,onChange:S=>M(z=>({...z,name:S.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"T√™n nh√† cung c·∫•p"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒêi·ªán tho·∫°i"}),e.jsx("input",{value:_.phone,onChange:S=>M(z=>({...z,phone:S.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"SƒêT"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{rows:2,value:_.address,onChange:S=>M(z=>({...z,address:S.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"ƒê·ªãa ch·ªâ nh√† cung c·∫•p"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"Ghi ch√∫"}),e.jsx("textarea",{rows:2,value:_.note,onChange:S=>M(z=>({...z,note:S.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"Th√¥ng tin th√™m (t√πy ch·ªçn)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 text-sm rounded border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{onClick:async()=>{var S,z;if(!_.name.trim()){I.warning("Nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const X=await p.mutateAsync({name:_.name.trim(),phone:((S=_.phone)==null?void 0:S.trim())||void 0,address:((z=_.address)==null?void 0:z.trim())||void 0});n(X.id),v(!1)}catch{}},className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",disabled:p.isPending,children:p.isPending?"ƒêang l∆∞u...":"L∆∞u"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Gi·ªè h√†ng nh·∫≠p"})]}),e.jsxs("span",{className:"text-xs text-white bg-gradient-to-r from-blue-600 to-indigo-600 px-3 py-1 rounded-full font-semibold shadow-lg",children:[N.length," s·∫£n ph·∫©m"]})]}),N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-12 h-12 text-slate-300 dark:text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Gi·ªè h√†ng tr·ªëng"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ch·ªçn s·∫£n ph·∫©m b√™n tr√°i ƒë·ªÉ th√™m v√†o"})]}):e.jsx("div",{className:"space-y-3",children:N.map((S,z)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-2.5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-xs font-bold text-white",children:["#",z+1]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-xs text-slate-900 dark:text-slate-100 truncate",children:S.partName}),e.jsxs("div",{className:"text-[9px] text-slate-500 dark:text-slate-400",children:["SKU: ",S.sku]})]}),e.jsx("button",{onClick:()=>oe(S.partId),className:"w-6 h-6 flex items-center justify-center bg-red-100 dark:bg-red-900/30 rounded text-red-600 dark:text-red-400 hover:bg-red-200 flex-shrink-0",title:"X√≥a",children:"√ó"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>W(S.partId,"quantity",Math.max(1,S.quantity-1)),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"-"}),e.jsx("input",{type:"number",value:S.quantity,onChange:X=>{const J=parseInt(X.target.value)||1;W(S.partId,"quantity",Math.max(1,J))},className:"w-10 px-1 py-1 text-center border border-blue-300 dark:border-blue-700 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold",min:"1"}),e.jsx("button",{onClick:()=>W(S.partId,"quantity",S.quantity+1),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"+"})]}),e.jsx(Re,{value:S.importPrice,onValue:X=>{const{clean:J}=hr(X,S.quantity),re=J.importPrice,le=Math.round(re*1.5);O(fe=>fe.map(be=>be.partId===S.partId?{...be,importPrice:re,sellingPrice:be.sellingPrice===0||be.sellingPrice===Math.round((be.importPrice||0)*1.5)?le:be.sellingPrice}:be))},className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-blue-500",placeholder:"Gi√° nh·∫≠p"}),e.jsx(Re,{value:S.sellingPrice,onValue:X=>W(S.partId,"sellingPrice",Math.max(0,Math.round(X))),className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-emerald-500",placeholder:"Gi√° b√°n"}),e.jsx("div",{className:"w-20 text-right",children:e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:U(S.importPrice*S.quantity)})})]})]},S.partId))})]}),e.jsxs("div",{className:"p-3 border-t-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[e.jsx("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-white uppercase",children:"T·ªïng thanh to√°n"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-black text-white",children:U(Ne)}),e.jsxs("div",{className:"text-[10px] text-white/70",children:[N.length," SP"]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:["Ph∆∞∆°ng th·ª©c thanh to√°n ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>E("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${q==="cash"?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),e.jsx("button",{onClick:()=>E("bank"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${q==="bank"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"H√¨nh th·ª©c thanh to√°n"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[e.jsx("button",{onClick:()=>{B("full"),Q(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${T==="full"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"ƒê·ªß"}),e.jsx("button",{onClick:()=>B("partial"),className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${T==="partial"?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"1 ph·∫ßn"}),e.jsx("button",{onClick:()=>{B("note"),Q(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${T==="note"?"border-purple-500 bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"C√¥ng n·ª£"})]})]}),T==="partial"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"S·ªë ti·ªÅn kh√°ch tr·∫£"}),e.jsx(Re,{value:Z,onValue:S=>Q(Math.max(0,Math.round(S))),className:"w-full px-3 py-2 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-sm font-bold focus:border-orange-500",placeholder:"Nh·∫≠p s·ªë ti·ªÅn..."}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-slate-500",children:"C√≤n l·∫°i:"}),e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:U(Math.max(0,Ne-Z))})]})]}),T&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"Lo·∫°i h·∫°ch to√°n"}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold focus:border-blue-500",children:[e.jsx("option",{children:"Mua h√†ng/nh·∫≠p kho"}),e.jsx("option",{children:"Nh·∫≠p tr·∫£ h√†ng"}),e.jsx("option",{children:"Kh√°c"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"flex-1 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 px-3 py-2.5 rounded-lg font-bold text-xs transition-all",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"L∆ØU NH√ÅP"]})}),e.jsx("button",{onClick:()=>{if(!q){I.warning("Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n");return}if(!T){I.warning("Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n");return}if(T==="partial"&&Z<=0){I.warning("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kh√°ch tr·∫£");return}te()},disabled:!q||!T||T==="partial"&&Z<=0,className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white px-3 py-2.5 rounded-lg font-bold text-xs transition-all disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed dark:disabled:bg-slate-600 dark:disabled:text-slate-400",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),"NH·∫¨P KHO"]})})]})]})]})]})}),e.jsx(Aa,{isOpen:r,onClose:()=>s(!1),onScan:R}),e.jsx(Ka,{isOpen:P,onClose:()=>C(!1),onSave:Y})]}):null},Nn=({isOpen:d,onClose:f,onSave:b,initialData:o,mode:c})=>{const[m,x]=j.useState((o==null?void 0:o.name)||""),[h,l]=j.useState((o==null?void 0:o.phone)||""),[t,r]=j.useState((o==null?void 0:o.address)||""),[s,a]=j.useState((o==null?void 0:o.email)||"");j.useEffect(()=>{o&&(x(o.name),l(o.phone),r(o.address),a(o.email))},[o]);const n=i=>{if(i.preventDefault(),!m.trim()){I.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}b({name:m.trim(),phone:h.trim(),address:t.trim(),email:s.trim()})};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-md",children:e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:c==="add"?"Th√™m nh√† cung c·∫•p m·ªõi":"Ch·ªânh s·ª≠a nh√† cung c·∫•p"}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√™n nh√† cung c·∫•p *"}),e.jsx("input",{type:"text",value:m,onChange:i=>x(i.target.value),placeholder:"Nh·∫≠p t√™n nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",value:h,onChange:i=>l(i.target.value),placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:s,onChange:i=>a(i.target.value),placeholder:"Nh·∫≠p email",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{value:t,onChange:i=>r(i.target.value),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:c==="add"?"Th√™m":"L∆∞u"})]})]})})}):null},_n=({isOpen:d,onClose:f,onAdd:b,currentBranchId:o})=>{const[c,m]=j.useState(""),[x,h]=j.useState(null),[l,t]=j.useState(1),[r,s]=j.useState(0),{data:a=[]}=dt({queryKey:["allPartsForReceipt"],queryFn:async()=>{const{data:g,error:p}=await ce.from("parts").select("*").order("name");if(p)throw p;return g||[]}}),n=j.useMemo(()=>{if(!c)return[];const g=c.toLowerCase();return a.filter(p=>{var k,v;return p.name.toLowerCase().includes(g)||((k=p.sku)==null?void 0:k.toLowerCase().includes(g))||((v=p.description)==null?void 0:v.toLowerCase().includes(g))})},[a,c]),i=g=>{var p;h(g),s(((p=g.costPrice)==null?void 0:p[o])||0),m(g.name)},u=g=>{if(g.preventDefault(),!x){I.error("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m");return}if(l<=0){I.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}if(r<0){I.error("ƒê∆°n gi√° kh√¥ng ƒë∆∞·ª£c √¢m");return}b({partId:x.id,partName:x.name,sku:x.sku||"",quantity:l,unitPrice:r}),m(""),h(null),t(1),s(0)};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-lg",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m v√†o phi·∫øu"}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√¨m ki·∫øm s·∫£n ph·∫©m *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:g=>{m(g.target.value),h(null)},placeholder:"Nh·∫≠p t√™n ho·∫∑c SKU s·∫£n ph·∫©m...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0}),c&&!x&&n.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:n.map(g=>{var p;return e.jsxs("button",{type:"button",onClick:()=>i(g),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:g.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",g.sku||"N/A"," | Gi√° nh·∫≠p:"," ",U(((p=g.costPrice)==null?void 0:p[o])||0)]})]},g.id)})})]}),x&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded text-sm text-green-800 dark:text-green-200",children:["‚úì ƒê√£ ch·ªçn: ",x.name," (",x.sku,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë l∆∞·ª£ng *"}),e.jsx("input",{type:"number",value:l,onChange:g=>t(Number(g.target.value)),min:"1",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê∆°n gi√° nh·∫≠p *"}),e.jsx(Re,{value:r,onValue:s,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Th√†nh ti·ªÅn"}),e.jsx("input",{type:"text",value:U(l*r),readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-bold"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"Th√™m s·∫£n ph·∫©m"})]})]})})}):null},Sn=({receipt:d,onClose:f,onSave:b,currentBranchId:o})=>{const[c,m]=j.useState(d.supplier),[x,h]=j.useState(""),[l,t]=j.useState(d.supplier),[r,s]=j.useState(!1),[a,n]=j.useState(!1),[i,u]=j.useState("add"),[g,p]=j.useState(!1),[k,v]=j.useState(null),{data:_=[]}=dt({queryKey:["suppliers"],queryFn:async()=>{const{data:L,error:w}=await ce.from("suppliers").select("*").order("name");if(w)throw w;return L||[]}}),M=j.useMemo(()=>{if(!l)return _;const L=l.toLowerCase();return _.filter(w=>w.name.toLowerCase().includes(L))},[_,l]),[D,P]=j.useState(d.items.map(L=>({id:L.id,partName:L.partName,quantity:L.quantity,unitPrice:L.unitPrice||0,totalPrice:L.quantity*(L.unitPrice||0),notes:L.notes||""}))),[C,N]=j.useState([{time:"15:31",date:d.date,payer:"Xu√¢n Nhan",cashier:"(Ti·ªÅn m·∫∑t)",amount:d.total}]),[O,q]=j.useState(!0);ot.useEffect(()=>{var w,R,W;const L=d.items[0];if((w=L==null?void 0:L.notes)!=null&&w.includes("Phone:")){const oe=(W=(R=L.notes.split("Phone:")[1])==null?void 0:R.split("NV:")[0])==null?void 0:W.trim();oe&&h(oe)}},[d.items]),ot.useEffect(()=>{const L=w=>{w.target.closest(".supplier-dropdown-container")||s(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const E=D.reduce((L,w)=>L+w.totalPrice,0),T=C.reduce((L,w)=>L+w.amount,0),B=(L,w)=>{const R=[...D];R[L].quantity=w,R[L].totalPrice=w*R[L].unitPrice,P(R)},Z=(L,w)=>{const R=[...D];R[L].unitPrice=w,R[L].totalPrice=R[L].quantity*w,P(R)},Q=L=>{if(D.length===1){I.error("Ph·∫£i c√≥ √≠t nh·∫•t 1 s·∫£n ph·∫©m");return}const w=D.filter((R,W)=>W!==L);P(w),I.success("ƒê√£ x√≥a s·∫£n ph·∫©m")},H=L=>{const w={id:`new-${Date.now()}`,partId:L.partId,partName:L.partName,quantity:L.quantity,unitPrice:L.unitPrice,totalPrice:L.quantity*L.unitPrice,notes:"",sku:L.sku};P([...D,w]),p(!1),I.success(`ƒê√£ th√™m ${L.partName} (s·∫Ω l∆∞u khi b·∫•m L∆ØU)`)},K=L=>{m(L.name),h(L.phone),n(!1),I.success(i==="add"?"ƒê√£ th√™m nh√† cung c·∫•p":"ƒê√£ c·∫≠p nh·∫≠t nh√† cung c·∫•p")},ee=()=>{u("edit"),n(!0)},de=()=>{u("add"),n(!0)},xe=L=>{v(L),I.info("Click v√†o √¥ s·ªë l∆∞·ª£ng ho·∫∑c ƒë∆°n gi√° ƒë·ªÉ ch·ªânh s·ª≠a")},se=L=>{confirm("B·∫°n c√≥ mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")&&Q(L)},ie=L=>{if(L.preventDefault(),!c){I.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(D.some(w=>w.quantity<=0)){I.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}b({supplier:c,supplierPhone:x,items:D,payments:C,isPaid:O})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:["[Ch·ªânh s·ª≠a] Phi·∫øu Nh·∫≠p Kho ",d.receiptCode]})]}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:[new Date(d.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})," ",new Date(d.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 dark:hover:bg-slate-700",children:"√ó"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-2",children:"Nh√† cung c·∫•p:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative supplier-dropdown-container",children:[e.jsx("input",{type:"text",value:l,onChange:L=>{t(L.target.value),s(!0)},onFocus:()=>s(!0),placeholder:"T√¨m ki·∫øm v√† ch·ªçn m·ªôt nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),l&&e.jsx("button",{type:"button",onClick:()=>{t(""),m(""),h("")},className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:"√ó"}),r&&M.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:M.map(L=>e.jsxs("button",{type:"button",onClick:()=>{m(L.name),t(L.name),h(L.phone||""),s(!1)},className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:L.name}),L.phone&&e.jsxs("div",{className:"text-xs text-slate-500",children:["Phone: ",L.phone]})]},L.id))})]}),e.jsxs("button",{type:"button",onClick:ee,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Ch·ªânh s·ª≠a"]}),e.jsxs("button",{type:"button",onClick:de,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"+"}),"Th√™m m·ªõi"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400",children:"Chi ti·∫øt s·∫£n ph·∫©m nh·∫≠p kho:"}),e.jsxs("button",{type:"button",onClick:()=>p(!0),className:"text-sm text-teal-600 hover:text-teal-700 dark:text-teal-400 flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Th√™m s·∫£n ph·∫©m"]})]}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"-"}),e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"T√™n"}),e.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê∆°n gi√° nh·∫≠p"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"Th√†nh ti·ªÅn"}),e.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300 w-20"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:D.map((L,w)=>e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors ${k===w?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("td",{className:"px-3 py-3 text-sm text-slate-900 dark:text-slate-100",children:w+1}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("div",{className:"text-sm text-slate-900 dark:text-slate-100",children:L.partName}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"[Kh√°c]"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n l·∫ª: ",U(7e4)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n s·ªâ: ",U(0)]}),e.jsx("div",{className:"text-xs text-red-500",children:"(ƒê√£ xu·∫•t kho)"})]}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("input",{type:"number",value:L.quantity,onChange:R=>B(w,Number(R.target.value)),onFocus:()=>v(w),onBlur:()=>v(null),min:"1",className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(Re,{value:L.unitPrice,onValue:R=>Z(w,R),className:"w-28 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),e.jsx("td",{className:"px-3 py-3 text-right text-sm font-medium text-slate-900 dark:text-slate-100",children:U(L.totalPrice)}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>xe(w),className:"p-1 text-blue-400 hover:bg-blue-500/20 rounded",title:"Ch·ªânh s·ª≠a",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>se(w),className:"p-1 text-slate-400 hover:bg-slate-500/20 rounded",title:"X√≥a s·∫£n ph·∫©m",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})})]},L.id))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªîNG:"}),e.jsx("td",{className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:U(E)}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg p-4",children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-3",children:"C√¥ng n·ª£:"}),e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsxs("span",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:["T·ªîNG PH·∫¢I CHI: ",U(E)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"ƒê√£ thanh to√°n ƒë·ªß"]}),e.jsxs("button",{type:"button",className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"+"}),"T·∫°o phi·∫øu chi"]})]})]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-3 flex items-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"T·ªïng ph·∫£i chi l√† ph√≠ ch∆∞a ph·∫£i tr·∫£ cho ƒë·ªëi t√°c s·ª≠a ch·ªØa"]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"-"}),e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Th·ªùi gian"}),e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Ng∆∞·ªùi chi - Ghi ch√∫"}),e.jsx("th",{className:"px-2 py-2 text-right text-slate-700 dark:text-slate-300",children:"S·ªë ti·ªÅn"})]})}),e.jsx("tbody",{children:C.map((L,w)=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:w+1}),e.jsxs("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:[L.time," ",new Date(L.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})]}),e.jsxs("td",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-slate-900 dark:text-slate-100",children:L.payer}),e.jsx("div",{className:"text-xs text-slate-500",children:L.cashier})]}),e.jsx("td",{className:"px-2 py-2 text-right text-slate-900 dark:text-slate-100",children:U(L.amount)})]},w))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªïng ƒë√£ chi"}),e.jsx("td",{className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:U(T)})]})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 p-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"ƒê√ìNG"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"L∆ØU"})]})]}),e.jsx(Nn,{isOpen:a,onClose:()=>n(!1),onSave:K,initialData:i==="edit"?{name:c,phone:x,address:"",email:""}:void 0,mode:i}),e.jsx(_n,{isOpen:g,onClose:()=>p(!1),onAdd:H,currentBranchId:o})]})})},Cn=({transactions:d})=>{const f=mr(),{data:b=[]}=Ia(),[o,c]=j.useState("7days"),[m,x]=j.useState(Qe(new Date,!0)),[h,l]=j.useState(Qe(new Date,!0)),[t,r]=j.useState(""),[s,a]=j.useState(null),{currentBranchId:n}=Zt(),i=j.useMemo(()=>{console.log("üì¶ [InventoryHistorySection] T·ªïng s·ªë giao d·ªãch:",d.length);let v=d.filter(M=>M.type==="Nh·∫≠p kho");console.log("üì¶ [InventoryHistorySection] Giao d·ªãch 'Nh·∫≠p kho':",v.length);const _=new Date;switch(o){case"7days":const M=new Date(_.getTime()-6048e5);v=v.filter(C=>new Date(C.date)>=M);break;case"30days":const D=new Date(_.getTime()-720*60*60*1e3);v=v.filter(C=>new Date(C.date)>=D);break;case"thisMonth":const P=new Date(_.getFullYear(),_.getMonth(),1);v=v.filter(C=>new Date(C.date)>=P);break;case"custom":v=v.filter(C=>{const N=new Date(C.date);return N>=new Date(m)&&N<=new Date(h)});break}if(t){const M=t.toLowerCase();v=v.filter(D=>D.partName.toLowerCase().includes(M)||D.notes&&D.notes.toLowerCase().includes(M))}return v.sort((M,D)=>new Date(D.date).getTime()-new Date(M.date).getTime())},[d,o,m,h,t]),u=j.useMemo(()=>i.reduce((v,_)=>v+_.totalPrice,0),[i]),g=j.useMemo(()=>{const v=new Map;return i.forEach(_=>{var N,O;const M=new Date(_.date),D=`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`,P=(N=_.notes)!=null&&N.includes("NCC:")?(O=_.notes.split("NCC:")[1])==null?void 0:O.trim():"Kh√¥ng x√°c ƒë·ªãnh",C=`${D}_${P}_${M.getHours()}_${M.getMinutes()}`;v.has(C)||v.set(C,[]),v.get(C).push(_)}),Array.from(v.entries()).map(([_,M],D)=>{var O,q,E;const P=M[0],C=new Date(P.date);let N="";if(P.notes){const T=P.notes.match(/NH-\d{8}-\d{3}/);T&&(N=T[0])}return N||(N=`NH-${`${C.getFullYear()}${String(C.getMonth()+1).padStart(2,"0")}${String(C.getDate()).padStart(2,"0")}`}-${String(v.size-D).padStart(3,"0")}`),{receiptCode:N,date:P.date,supplier:(O=P.notes)!=null&&O.includes("NCC:")?(E=(q=P.notes.split("NCC:")[1])==null?void 0:q.split("|")[0])==null?void 0:E.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:M,total:M.reduce((T,B)=>T+B.totalPrice,0)}}).sort((_,M)=>new Date(M.date).getTime()-new Date(_.date).getTime())},[i]),[p,k]=j.useState(new Set);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-3 sm:p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-slate-100 mb-3 sm:mb-4",children:"L·ªãch s·ª≠ nh·∫≠p kho"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 sm:mb-4",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(v=>e.jsx("button",{onClick:()=>c(v.key),className:`px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-sm sm:text-base font-medium transition-colors ${o===v.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:v.label},v.key))}),o==="custom"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),e.jsx("input",{type:"date",value:m,onChange:v=>x(v.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),e.jsx("input",{type:"date",value:h,onChange:v=>l(v.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]})]}),e.jsx("input",{type:"text",placeholder:"Nh√† cung c·∫•p, SKU, t√™n ph·ª• t√πng...",value:t,onChange:v=>r(v.target.value),className:"w-full px-3 py-2 sm:px-4 sm:py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),e.jsx("div",{className:"px-3 py-3 sm:px-6 sm:py-4 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:["T·ªïng s·ªë ti·ªÅn:"," ",e.jsx("span",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-slate-100",children:g.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"T·ªïng gi√° tr·ªã"}),e.jsx("div",{className:"text-base sm:text-lg font-bold text-blue-600",children:U(u)})]})]})}),e.jsxs("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:[g.length>0&&e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-3 bg-slate-100 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600 sticky top-0 z-10",children:[e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),e.jsx("div",{className:"col-span-4 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thanh to√°n"}),e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]}),g.length===0?e.jsxs("div",{className:"px-3 py-8 sm:px-6 sm:py-12 text-center text-slate-500",children:[e.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:"üì¶"}),e.jsx("div",{className:"text-sm sm:text-base",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"})]}):g.map(v=>{var q,E,T,B,Z,Q,H;const _=new Date(v.date),M=_.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),D=_.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),P=b.find(K=>{var ee;return(ee=K.description)==null?void 0:ee.includes(v.receiptCode)}),C=P?P.totalAmount-P.remainingAmount:v.total,N=(P==null?void 0:P.remainingAmount)||0,O=N>0;return e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"md:hidden flex flex-col gap-3 bg-white dark:bg-slate-800/60 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-cyan-600 dark:text-cyan-300",children:["üì¶ ",v.receiptCode]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:["üìÖ"," ",e.jsxs("span",{children:[M," ¬∑ ",D]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:U(v.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-900/30 rounded-2xl p-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-200 font-semibold text-lg",children:"üè¢"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-white",children:v.supplier}),((q=v.items[0].notes)==null?void 0:q.includes("Phone:"))&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(E=v.items[0].notes.split("Phone:")[1])==null?void 0:E.trim()]})]})]}),e.jsx("div",{className:"space-y-2",children:v.items.map((K,ee)=>e.jsxs("div",{className:"flex items-start justify-between text-sm text-slate-700 dark:text-slate-200",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[K.quantity," x ",K.partName]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[U(K.unitPrice||0)," / s·∫£n ph·∫©m"]})]}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:U(K.quantity*(K.unitPrice||0))})]},K.id))}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",U(N)]}):e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200",children:"‚úì ƒê√£ thanh to√°n"})}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-dashed border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:()=>a({...v,date:new Date(v.date)}),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Ch·ªânh s·ª≠a"})})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-start",children:[e.jsx("div",{className:"col-span-1 flex items-start pt-1",children:e.jsx("input",{type:"checkbox",checked:p.has(v.receiptCode),onChange:K=>{const ee=new Set(p);K.target.checked?ee.add(v.receiptCode):ee.delete(v.receiptCode),k(ee)},className:"w-4 h-4 rounded border-slate-300"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:v.receiptCode}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[M," ",D]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"NV:"})," ",((Z=(B=(T=v.items[0].notes)==null?void 0:T.split("NV:")[1])==null?void 0:B.split("NCC:")[0])==null?void 0:Z.trim())||"Xu√¢n Nhan"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:v.supplier}),((Q=v.items[0].notes)==null?void 0:Q.includes("Phone:"))&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(H=v.items[0].notes.split("Phone:")[1])==null?void 0:H.trim()]})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"space-y-1",children:v.items.map((K,ee)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:[e.jsxs("span",{className:"font-medium",children:[K.quantity," x"]})," ",K.partName,e.jsxs("span",{className:"text-slate-400 ml-1",children:["(",U(K.unitPrice||0),")"]})]},K.id))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"T·ªïng ti·ªÅn:"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:U(v.total)}),O?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["ƒê√£ tr·∫£: ",U(C)]}),e.jsxs("div",{className:"text-xs font-semibold text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",U(N)]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"‚ö†Ô∏è C√≤n n·ª£"})]}):e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:"‚úì ƒê√£ thanh to√°n"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>a({...v,date:new Date(v.date)}),className:"p-1.5 text-blue-400 hover:bg-blue-500/20 rounded transition-colors",title:"Ch·ªânh s·ª≠a",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})})]})]},v.receiptCode)})]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Hi·ªÉn th·ªã ",g.length," phi·∫øu nh·∫≠p"]})}),s&&e.jsx(Sn,{receipt:s,onClose:()=>a(null),onSave:async v=>{var _,M,D,P,C,N,O,q,E;try{const T=new Set(s.items.map(H=>H.id)),B=new Set(v.items.filter(H=>!H.id.startsWith("new-")).map(H=>H.id)),Z=Array.from(T).filter(H=>!B.has(H));for(const H of Z){const K=s.items.find(se=>se.id===H);if(!K)continue;const{data:ee,error:de}=await ce.from("parts").select("stock").eq("id",K.partId).single();if(de)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${de.message}`);if(ee){const ie=(((_=ee.stock)==null?void 0:_[n])||0)-K.quantity;if(ie<0)throw new Error(`Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m "${K.partName}" v√¨ s·∫Ω l√†m t·ªìn kho √¢m`);const{error:L}=await ce.from("parts").update({stock:{...ee.stock,[n]:ie}}).eq("id",K.partId);if(L)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${L.message}`)}const{error:xe}=await ce.from("inventory_transactions").delete().eq("id",H);if(xe)throw new Error(`Kh√¥ng th·ªÉ x√≥a giao d·ªãch: ${xe.message}`)}for(const H of v.items){if(H.id.startsWith("new-"))continue;const K=s.items.find(de=>de.id===H.id),{error:ee}=await ce.from("inventory_transactions").update({quantity:H.quantity,unitPrice:H.unitPrice,totalPrice:H.totalPrice,notes:`NV:${((P=(D=(M=v.items[0].notes)==null?void 0:M.split("NV:")[1])==null?void 0:D.split("NCC:")[0])==null?void 0:P.trim())||"Xu√¢n Nhan"} NCC:${v.supplier}${v.supplierPhone?` Phone:${v.supplierPhone}`:""}`}).eq("id",H.id);if(ee)throw ee;if(K&&K.quantity!==H.quantity){const de=H.quantity-K.quantity,{data:xe,error:se}=await ce.from("parts").select("stock, id").eq("id",K.partId).single();if(se)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${se.message}`);if(xe){const ie=((C=xe.stock)==null?void 0:C[n])||0,L=ie+de;if(L<0)throw new Error(`Kh√¥ng th·ªÉ gi·∫£m s·ªë l∆∞·ª£ng v√¨ s·∫Ω l√†m t·ªìn kho √¢m (hi·ªán c√≥: ${ie})`);const{error:w}=await ce.from("parts").update({stock:{...xe.stock,[n]:L}}).eq("id",xe.id);if(w)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${w.message}`)}}}const Q=v.items.filter(H=>H.id.startsWith("new-"));for(const H of Q){const{data:K,error:ee}=await ce.from("parts").select("stock, id").eq("id",H.partId).single();if(ee)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${ee.message}`);if(K){const se=(((N=K.stock)==null?void 0:N[n])||0)+H.quantity,{error:ie}=await ce.from("parts").update({stock:{...K.stock,[n]:se}}).eq("id",K.id);if(ie)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${ie.message}`)}const{error:de}=await ce.from("inventory_transactions").insert({type:"Nh·∫≠p kho",partId:H.partId,partName:H.partName,quantity:H.quantity,date:s.date.toISOString(),unitPrice:H.unitPrice,totalPrice:H.totalPrice,branchId:n,notes:`NV:${((E=(q=(O=v.items[0].notes)==null?void 0:O.split("NV:")[1])==null?void 0:q.split("NCC:")[0])==null?void 0:E.trim())||"Xu√¢n Nhan"} NCC:${v.supplier}${v.supplierPhone?` Phone:${v.supplierPhone}`:""}`});if(de)throw new Error(`Kh√¥ng th·ªÉ t·∫°o giao d·ªãch m·ªõi: ${de.message}`)}I.success(`ƒê√£ c·∫≠p nh·∫≠t phi·∫øu nh·∫≠p kho (${v.items.length} s·∫£n ph·∫©m)`),f.invalidateQueries({queryKey:["inventoryTransactions"]}),f.invalidateQueries({queryKey:["partsRepo"]}),f.invalidateQueries({queryKey:["partsRepoPaged"]}),a(null)}catch(T){I.error(`L·ªói c·∫≠p nh·∫≠t: ${T.message||"Kh√¥ng r√µ"}`)}},currentBranchId:n})]})},Gn=()=>{var wr;const{currentBranchId:d}=Zt(),{mutateAsync:f}=fs(),b=bs(),{data:o=[]}=gs({branchId:d}),[c,m]=j.useState("stock"),[x,h]=j.useState(!1),[l,t]=j.useState(""),[r,s]=j.useState("all"),[a,n]=j.useState("all"),[i,u]=j.useState(!1),[g,p]=j.useState(1),[k,v]=j.useState(20),[_,M]=j.useState([]),[D,P]=j.useState(null),[C,N]=j.useState(!1),[O,q]=j.useState(!1),[E,T]=j.useState(null),[B,Z]=j.useState(!1),[Q,H]=j.useState(null),K=y=>{if(!y)return"#94a3b8";let $=0;for(let V=0;V<y.length;V++)$=y.charCodeAt(V)+(($<<5)-$);const G=($&16777215).toString(16).toUpperCase();return`#${"00000".substring(0,6-G.length)+G}`},{confirm:ee,confirmState:de,handleConfirm:xe,handleCancel:se}=us(),{data:ie,isLoading:L,isError:w}=Ma({page:g,pageSize:k,search:l,category:r==="all"?void 0:r}),R=(ie==null?void 0:ie.data)||[],W=((wr=ie==null?void 0:ie.meta)==null?void 0:wr.total)||0,oe=Math.max(1,Math.ceil(W/k)),{data:ne,refetch:Ne}=dt({queryKey:["allPartsForTotals",d,l,r],queryFn:async()=>{console.log("üîÑ Fetching allPartsForTotals...");let y=ce.from("parts").select("id, name, sku, stock, costPrice, retailPrice").order("name");if(r&&r!=="all"&&(y=y.eq("category",r)),l&&l.trim()){const V=l.trim();y=y.or(`name.ilike.%${V}%,sku.ilike.%${V}%`)}const{data:$,error:G}=await y;if(G)throw G;return console.log(`‚úÖ Fetched ${($==null?void 0:$.length)||0} parts`),$||[]},staleTime:5e3}),A=j.useMemo(()=>{if(!ne)return{totalProducts:0,inStock:0,lowStock:0,outOfStock:0};const y={totalProducts:ne.length,inStock:0,lowStock:0,outOfStock:0},$=d||"";return ne.forEach(G=>{var ae;const V=((ae=G.stock)==null?void 0:ae[$])||0;V>0&&(y.inStock+=1),V===0&&(y.outOfStock+=1),V>0&&V<=$e&&(y.lowStock+=1)}),y},[ne,d]),te=j.useMemo(()=>[{id:"all",label:"T·∫•t c·∫£",description:"To√†n b·ªô kho",count:A.totalProducts,variant:"neutral"},{id:"in-stock",label:"C√≤n h√†ng",description:"> 0",count:A.inStock,variant:"success"},{id:"low-stock",label:"S·∫Øp h·∫øt",description:`<= ${$e}`,count:A.lowStock,variant:"warning"},{id:"out-of-stock",label:"H·∫øt h√†ng",description:"= 0",count:A.outOfStock,variant:"danger"}],[A]),Y=j.useMemo(()=>{if(!ne)return new Set;const y=new Map;ne.forEach(G=>{const V=y.get(G.name)||0;y.set(G.name,V+1)});const $=new Set(Array.from(y.entries()).filter(([G,V])=>V>1).map(([G,V])=>G));return console.log(`üîç Detected ${$.size} duplicate product names from ${ne.length} parts`),$.size>0&&console.log("Duplicate names:",Array.from($).slice(0,5)),$},[ne]),S=j.useCallback(y=>Y.has(y),[Y]),{data:z}=dt({queryKey:["duplicateParts",d,Array.from(Y)],queryFn:async()=>{if(Y.size===0)return[];console.log(`üîç Fetching all duplicate parts for ${Y.size} names...`);const{data:y,error:$}=await ce.from("parts").select("*").in("name",Array.from(Y)).order("name");if($)throw $;return console.log(`‚úÖ Found ${(y==null?void 0:y.length)||0} parts with duplicate names`),y||[]},enabled:i&&Y.size>0,staleTime:5e3}),X=j.useMemo(()=>{const y=i&&Y.size>0?z||[]:R;if(a==="all")return y;const $=d||"";return y.filter(G=>{var ae;const V=((ae=G.stock)==null?void 0:ae[$])||0;return a==="in-stock"?V>0:a==="low-stock"?V>0&&V<=$e:a==="out-of-stock"?V===0:!0})},[R,i,Y,z,a,d]);j.useEffect(()=>{i&&Y.size===0&&u(!1)},[i,Y.size]);const J=j.useMemo(()=>ne?ne.reduce((y,$)=>{var G;return y+(((G=$.stock)==null?void 0:G[d])||0)},0):0,[ne,d]),re=j.useMemo(()=>ne?ne.reduce((y,$)=>{var ae,ge;const G=((ae=$.stock)==null?void 0:ae[d])||0,V=((ge=$.costPrice)==null?void 0:ge[d])||0;return y+G*V},0):0,[ne,d]),le=mr(),fe=is();fr();const be=os(),{data:mt=[]}=br(),{profile:Pe}=La(),pr=j.useCallback(async(y,$,G,V,ae)=>{const ge=new Date,_e=ge.toISOString().split("T")[0].replace(/-/g,""),ve=`NH-${_e}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;console.log("üì¶ Saving goods receipt:",{receiptCode:ve,supplierId:$,totalAmount:G,paymentInfo:ae,itemCount:y.length});const{data:Oe}=await ce.from("suppliers").select("name").eq("id",$).single(),Me=(Oe==null?void 0:Oe.name)||"Kh√¥ng x√°c ƒë·ªãnh",Te=(ae==null?void 0:ae.paidAmount)||0,Le=G-Te;try{if(await b.mutateAsync({items:y.map(ue=>({partId:ue.partId,partName:ue.partName,quantity:ue.quantity,importPrice:ue.importPrice,sellingPrice:ue.sellingPrice,wholesalePrice:ue.wholesalePrice||0})),supplierId:$,branchId:d,userId:(Pe==null?void 0:Pe.id)||"unknown",notes:`${ve} | NCC: ${Me}${V?" | "+V:""}`}),Le>0&&ae){const ue=`DEBT-${_e}-${Math.random().toString(36).substring(2,5).toUpperCase()}`,{error:Ee}=await ce.from("supplier_debts").insert({id:ue,supplier_id:$,supplier_name:Me,branch_id:d,total_amount:Le,paid_amount:0,remaining_amount:Le,description:`Nh·∫≠p kho ${ve} - Thanh to√°n ${Te.toLocaleString()}/${G.toLocaleString()} ƒë`,created_date:ge.toISOString().split("T")[0],created_at:ge.toISOString()});Ee?(console.error("‚ùå Error creating debt:",Ee),I.error("L·ªói t·∫°o c√¥ng n·ª£: "+Ee.message)):console.log(`‚úÖ Created supplier debt: ${Le.toLocaleString()} ƒë`)}h(!1),I.success(`Nh·∫≠p kho th√†nh c√¥ng! M√£ phi·∫øu: ${ve}`),cr((Pe==null?void 0:Pe.id)||null,{action:"inventory.receipt",tableName:"inventory_transactions",oldData:null,newData:{receiptCode:ve,supplierId:$,supplierName:Me,items:y.map(ue=>({partId:ue.partId,quantity:ue.quantity,importPrice:ue.importPrice,sellingPrice:ue.sellingPrice})),totalAmount:G,paidAmount:Te,debtAmount:Le,paymentInfo:ae}})}catch(ue){console.error("üõë L·ªói l∆∞u phi·∫øu nh·∫≠p kho:",ue),I.error(`L·ªói: ${ue.message||"Kh√¥ng r√µ"}`)}},[ne,d,fe,f,Pe==null?void 0:Pe.id]),Xa=y=>{M(y?X.map($=>$.id):[])},Wa=(y,$)=>{M($?[..._,y]:_.filter(G=>G!==y))},vr=async y=>{const $=R.find(V=>V.id===y);!$||!await ee({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m "${$.name}"?`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"})||be.mutate({id:y},{onSuccess:async()=>{M(V=>V.filter(ae=>ae!==y)),await Ne(),console.log("üîÑ Refetched allPartsForTotals after delete"),I.success(`ƒê√£ x√≥a ph·ª• t√πng "${$.name}"`)},onError:V=>{console.error("Delete error:",V),I.error(`Kh√¥ng th·ªÉ x√≥a: ${V.message}`)}})},Qa=async()=>{if(_.length===0){I.warning("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m");return}if(!await ee({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ${_.length} s·∫£n ph·∫©m ƒë√£ ch·ªçn? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"}))return;let $=0,G=0;const V=_.length;_.forEach((ae,ge)=>{be.mutate({id:ae},{onSuccess:async()=>{$++,$+G===V&&(await Ne(),console.log("üîÑ Refetched allPartsForTotals after bulk delete"),G===0?I.success(`ƒê√£ x√≥a ${$} ph·ª• t√πng`):I.warning(`ƒê√£ x√≥a ${$}/${V} ph·ª• t√πng (${G} l·ªói)`))},onError:_e=>{console.error(`Delete error for item ${ae}:`,_e),G++,$+G===V&&($===0?I.error(`Kh√¥ng th·ªÉ x√≥a ${V} ph·ª• t√πng`):I.warning(`ƒê√£ x√≥a ${$}/${V} ph·ª• t√πng (${G} l·ªói)`))}})}),M([])},ar=y=>{p(1),n(y)},Ya=y=>{p(1),s(y)},Ja=()=>{n("all"),s("all"),u(!1),p(1),Z(!1)},kr=a!=="all"||r!=="all"||i,Za=A.lowStock>0&&a!=="low-stock",es=A.totalProducts>0?Math.round(A.lowStock/A.totalProducts*100):0,yr=()=>{try{const y=new Date,$=`ton-kho-${y.getDate()}-${y.getMonth()+1}-${y.getFullYear()}.xlsx`;ws(R,d,$),I.success("Xu·∫•t file Excel th√†nh c√¥ng!")}catch(y){console.error("Export error:",y),I.error("C√≥ l·ªói khi xu·∫•t file Excel")}},jr=()=>{try{Ns(),I.success("T·∫£i template th√†nh c√¥ng! Vui l√≤ng ƒëi·ªÅn th√¥ng tin v√† import l·∫°i.")}catch(y){console.error("Template download error:",y),I.error("C√≥ l·ªói khi t·∫£i template")}};return j.useEffect(()=>{if(typeof document>"u")return;const y=()=>H(null);return document.addEventListener("click",y),()=>document.removeEventListener("click",y)},[]),e.jsxs("div",{className:"h-full flex flex-col bg-slate-50 dark:bg-slate-900 sm:bg-[#1e293b]",children:[e.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex gap-2",children:[{key:"stock",label:"T·ªìn kho",icon:e.jsx(sr,{className:"w-4 h-4"})},{key:"categories",label:"Danh m·ª•c",icon:e.jsx(lt,{className:"w-4 h-4"})},{key:"lookup",label:"Tra c·ª©u",icon:e.jsx(nt,{className:"w-4 h-4"})},{key:"history",label:"L·ªãch s·ª≠",icon:e.jsx(nr,{className:"w-4 h-4"})}].map(y=>e.jsx("button",{onClick:()=>m(y.key),className:`px-4 py-2 rounded-lg font-medium transition-colors ${c===y.key?"bg-blue-600 text-white":"text-secondary-text hover:bg-tertiary-bg"}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[y.icon,y.label]})},y.key))}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>q(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-semibold shadow-lg shadow-emerald-500/30 hover:brightness-110 transition",title:"In m√£ v·∫°ch h√†ng lo·∫°t",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"In m√£ v·∫°ch"]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold shadow-lg shadow-blue-500/30 hover:brightness-110 transition",children:[e.jsx(Yt,{className:"w-4 h-4"}),"T·∫°o phi·∫øu nh·∫≠p"]}),e.jsxs("div",{className:"flex items-center gap-1 rounded-2xl border border-primary-border bg-tertiary-bg px-1.5 py-1",children:[e.jsxs("button",{onClick:()=>{I.info("T√≠nh nƒÉng chuy·ªÉn kho ƒëang ph√°t tri·ªÉn")},className:"p-2 rounded-xl text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Chuy·ªÉn kho",children:[e.jsx(Er,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Chuy·ªÉn kho"})]}),e.jsxs("button",{onClick:yr,className:"p-2 rounded-xl text-secondary-text hover:text-emerald-600 hover:bg-primary-bg transition",title:"Xu·∫•t Excel",children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Xu·∫•t Excel"})]}),e.jsxs("button",{onClick:()=>N(!0),className:"p-2 rounded-xl text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Nh·∫≠p CSV",children:[e.jsx(vs,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Nh·∫≠p CSV"})]}),e.jsxs("button",{onClick:jr,className:"p-2 rounded-xl text-secondary-text hover:text-amber-600 hover:bg-primary-bg transition",title:"T·∫£i m·∫´u import",children:[e.jsx(nr,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"T·∫£i template"})]})]})]})]})}),e.jsxs("div",{className:"sm:hidden bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:l,onChange:y=>{p(1),t(y.target.value)},className:"w-full pl-10 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1.5 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition whitespace-nowrap",children:[e.jsx(Yt,{className:"w-4 h-4"}),"T·∫°o phi·∫øu"]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"T·ªïng:"}),e.jsxs("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:[J.toLocaleString()," sp"]})]}),e.jsx("div",{className:"h-3 w-px bg-slate-300 dark:bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gi√° tr·ªã:"}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:U(re)})]})]})})]}),c==="stock"&&e.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-5 py-5",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr)_320px]",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx("div",{className:"rounded-2xl border border-blue-500/20 bg-gradient-to-r from-blue-500/15 via-blue-500/5 to-transparent p-4 shadow-inner",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-blue-600 dark:text-blue-300",children:"T·ªïng s·ªë l∆∞·ª£ng t·ªìn"}),e.jsxs("p",{className:"mt-2 text-3xl font-bold text-primary-text",children:[J.toLocaleString()," sp"]}),e.jsxs("p",{className:"text-xs text-secondary-text mt-1",children:[A.inStock," s·∫£n ph·∫©m c√≤n h√†ng ‚Ä¢"," ",A.outOfStock," h·∫øt h√†ng"]})]}),e.jsx("div",{className:"p-3 rounded-2xl bg-white/70 dark:bg-slate-900/40 text-blue-600",children:e.jsx(sr,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"rounded-2xl border border-emerald-500/20 bg-gradient-to-r from-emerald-500/15 via-emerald-500/5 to-transparent p-4 shadow-inner",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-emerald-600 dark:text-emerald-300",children:"T·ªïng gi√° tr·ªã t·ªìn"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-primary-text",children:U(re)}),e.jsxs("p",{className:"text-xs text-secondary-text mt-1",children:["Trung b√¨nh"," ",U(J>0?re/J:0)," ","/ s·∫£n ph·∫©m"]})]}),e.jsx("div",{className:"p-3 rounded-2xl bg-white/70 dark:bg-slate-900/40 text-emerald-600",children:e.jsx(lt,{className:"w-6 h-6"})})]})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:l,onChange:y=>{p(1),t(y.target.value)},className:"w-full pl-10 pr-12 py-2.5 border border-primary-border rounded-xl bg-primary-bg text-primary-text focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-secondary-text",children:[X.length,"/",W]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("button",{onClick:()=>Z(y=>!y),className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-xl border transition ${B?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-primary-border text-secondary-text hover:text-primary-text"}`,children:[e.jsx(ys,{className:"w-4 h-4"}),"B·ªô l·ªçc n√¢ng cao",kr&&e.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500 animate-pulse"})]}),kr&&e.jsx("button",{onClick:Ja,className:"px-3 py-2 text-sm font-medium text-red-500 hover:text-red-600",children:"X√≥a b·ªô l·ªçc"})]})]})]}),Za&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-amber-900 dark:border-amber-800 dark:bg-amber-950/50 dark:text-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[A.lowStock," s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng"]}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:["Chi·∫øm ",es,"% danh m·ª•c hi·ªán t·∫°i"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ar("low-stock"),className:"px-3 py-1.5 rounded-lg bg-amber-600 text-white text-sm font-semibold hover:bg-amber-700 transition dark:bg-amber-700 dark:hover:bg-amber-600",children:"L·ªçc nhanh"}),e.jsx("button",{onClick:()=>h(!0),className:"px-3 py-1.5 rounded-lg border border-amber-400 text-sm font-medium text-amber-800 hover:bg-amber-100 transition dark:border-amber-600 dark:text-amber-300 dark:hover:bg-amber-950/30",children:"T·∫°o phi·∫øu nh·∫≠p"})]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:te.map(y=>{const $=a===y.id,G=Oa[y.variant??"neutral"]||Oa.neutral,V=`text-left rounded-2xl border px-4 py-3 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 ${$?G.buttonActive:G.buttonInactive}`,ae=`inline-flex items-center justify-center rounded-xl border px-3 py-1 text-xs font-semibold ${$?G.badgeActive:G.badgeInactive}`;return e.jsxs("button",{onClick:()=>ar(y.id),className:V,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-secondary-text",children:y.label}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-primary-text",children:(y.count||0).toLocaleString()})]}),e.jsx("span",{className:ae,children:y.description})]}),e.jsx("p",{className:"mt-2 text-xs text-tertiary-text",children:"Tr·∫°ng th√°i kho t∆∞∆°ng ·ª©ng"})]},y.id)})}),B&&e.jsxs("div",{className:"rounded-2xl border border-primary-border bg-white/70 dark:bg-slate-900/40 p-4 grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Tr·∫°ng th√°i t·ªìn kho"}),e.jsxs("select",{value:a,onChange:y=>ar(y.target.value),className:"mt-2 w-full rounded-xl border border-secondary-border bg-primary-bg px-4 py-2.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ t·ªìn kho"}),e.jsx("option",{value:"in-stock",children:"C√≤n h√†ng"}),e.jsx("option",{value:"low-stock",children:"S·∫Øp h·∫øt"}),e.jsx("option",{value:"out-of-stock",children:"H·∫øt h√†ng"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Danh m·ª•c"}),e.jsxs("select",{value:r,onChange:y=>Ya(y.target.value),className:"mt-2 w-full rounded-xl border border-secondary-border bg-primary-bg px-4 py-2.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),mt.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{className:"flex flex-col justify-end",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Ph√°t hi·ªán tr√πng t√™n"}),e.jsx("button",{onClick:()=>u(y=>!y),className:`mt-2 rounded-xl border px-4 py-2.5 text-sm font-medium transition ${i?"border-orange-500 text-orange-600 bg-orange-50 dark:bg-orange-900/20":"border-secondary-border text-secondary-text hover:text-primary-text"}`,children:i?"ƒêang hi·ªÉn th·ªã s·∫£n ph·∫©m tr√πng t√™n":"L·ªçc s·∫£n ph·∫©m tr√πng t√™n"})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4",children:[c==="stock"&&e.jsxs("div",{className:"space-y-3",children:[Y.size>0&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xs font-semibold text-orange-800 dark:text-orange-300 mb-1",children:["Ph√°t hi·ªán ",Y.size," s·∫£n ph·∫©m tr√πng t√™n"]}),e.jsx("button",{onClick:()=>u(!i),className:`mt-1 px-2 py-1 rounded text-xs font-medium transition ${i?"bg-orange-600 text-white":"bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300"}`,children:i?"‚úì ƒêang l·ªçc":"üîç L·ªçc"})]})]})}),e.jsxs("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[_.length>0&&e.jsxs("div",{className:"px-6 py-3 bg-blue-100 dark:bg-blue-900/30 border-b border-primary-border flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:["ƒê√£ ch·ªçn ",_.length," s·∫£n ph·∫©m"]}),e.jsxs("button",{onClick:Qa,className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"X√≥a ƒë√£ ch·ªçn"]})]}),e.jsx("div",{className:"block sm:hidden",children:e.jsx("div",{className:"space-y-3 p-3",children:X.map((y,$)=>{const G=y.stock[d]||0,V=y.retailPrice[d]||0,ae=G*V,ge=S(y.name),_e=y.name.split(/[-\s]/).slice(0,2).map(ve=>ve.charAt(0).toUpperCase()).join("");return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl bg-[#2d3748] border border-slate-600 transition ${ge?"border-l-4 border-l-orange-500":""}`,role:"listitem",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-600 rounded-lg overflow-hidden flex items-center justify-center flex-shrink-0",children:y.imageUrl?e.jsx("img",{src:y.imageUrl,alt:y.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:K(y.category)},children:e.jsx("span",{className:"text-lg font-bold text-white/90",children:_e||e.jsx(lt,{className:"w-6 h-6 text-white opacity-90"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[15px] font-medium text-white line-clamp-2 leading-tight",children:y.name}),e.jsxs("div",{className:"text-[12px] text-slate-400 mt-1 truncate",children:["SKU: ",y.sku," ‚Ä¢ ",y.category]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("div",{className:"text-[13px] text-slate-300 font-medium",children:U(ae)})})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 text-sm font-bold rounded-lg ${G===0?"text-red-300 bg-red-900/40 border border-red-700/50":G<$e?"text-yellow-300 bg-yellow-900/40 border border-yellow-700/50":"text-emerald-300 bg-emerald-900/40 border border-emerald-700/50"}`,children:[e.jsx("span",{className:"text-xs opacity-80",children:"SL:"}),G]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>T(E===$?null:$),"aria-haspopup":"true","aria-expanded":E===$,"aria-label":"Th√™m h√†nh ƒë·ªông",className:"p-2.5 -m-1 text-slate-400 hover:bg-slate-600 rounded-lg transition active:bg-slate-500",children:e.jsx(Cr,{className:"w-5 h-5"})}),E===$&&e.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-50",children:[e.jsxs("button",{onClick:()=>{P(y),T(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-white","aria-label":`Ch·ªânh s·ª≠a ${y.name}`,children:[e.jsx(Pr,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{children:"Ch·ªânh s·ª≠a"})]}),e.jsxs("button",{onClick:()=>{vr(y.id),T(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-red-400","aria-label":`X√≥a ${y.name}`,children:[e.jsx(_r,{className:"w-4 h-4"}),e.jsx("span",{children:"X√≥a"})]})]})]})]})]})]},y.id)})})}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-tertiary-bg",children:e.jsxs("tr",{className:"border-b border-primary-border text-xs font-semibold uppercase tracking-wider text-secondary-text",children:[e.jsx("th",{className:"px-6 py-4 text-center w-12",children:e.jsx("input",{type:"checkbox",checked:_.length===X.length&&X.length>0,onChange:y=>Xa(y.target.checked),className:"w-4 h-4 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),e.jsx("th",{className:"px-6 py-4 text-left",children:"S·∫£n ph·∫©m"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"T·ªìn kho"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° nh·∫≠p"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° b√°n l·∫ª"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° b√°n s·ªâ"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° tr·ªã t·ªìn"}),e.jsx("th",{className:"px-6 py-4 text-center w-16",children:"H√†nh ƒë·ªông"})]})}),e.jsx("tbody",{className:"bg-primary-bg divide-y divide-primary-border",children:X.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-6 py-8 text-center text-tertiary-text",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üóÇÔ∏è"}),e.jsx("div",{className:"text-lg",children:"Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o"}),e.jsx("div",{className:"text-sm",children:"H√£y th·ª≠ m·ªôt b·ªô l·ªçc kh√°c ho·∫∑c th√™m s·∫£n ph·∫©m m·ªõi"})]})}):X.map(y=>{var De,Je,Fe,He,Ge,Ve;const $=d||"",G=((De=y.stock)==null?void 0:De[$])||0,V=((Je=y.retailPrice)==null?void 0:Je[$])||0,ae=((Fe=y.wholesalePrice)==null?void 0:Fe[$])||0,ge=((He=y.costPrice)==null?void 0:He[$])||0,_e=G*V,ve=_.includes(y.id),Oe=S(y.name),Me=G===0?"border-red-300 bg-red-50 text-red-700 dark:border-red-700 dark:bg-red-950/50 dark:text-red-300":G<=$e?"border-amber-300 bg-amber-50 text-amber-700 dark:border-amber-600 dark:bg-amber-950/50 dark:text-amber-300":"border-emerald-300 bg-emerald-50 text-emerald-700 dark:border-emerald-600 dark:bg-emerald-950/50 dark:text-emerald-300",Te=G===0?"H·∫øt h√†ng":G<=$e?"S·∫Øp h·∫øt":"·ªîn ƒë·ªãnh",Le=G===0?"text-red-600 dark:text-red-400":G<=$e?"text-amber-600 dark:text-amber-400":"text-emerald-700 dark:text-emerald-400",ue=((Ve=(Ge=y.name)==null?void 0:Ge.charAt(0))==null?void 0:Ve.toUpperCase())||"?",Ee=ve?"bg-blue-900/20 dark:bg-blue-900/20":Oe?"bg-orange-500/10 border-l-4 border-l-orange-500":"";return e.jsxs("tr",{className:`border-b border-primary-border hover:bg-tertiary-bg transition-colors ${Ee}`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",checked:ve,onChange:ke=>Wa(y.id,ke.target.checked),className:"w-4 h-4 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 min-w-[220px]",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl overflow-hidden flex items-center justify-center text-base font-semibold text-white",style:y.imageUrl?void 0:{backgroundColor:K(y.category)},children:y.imageUrl?e.jsx("img",{src:y.imageUrl,alt:y.name,className:"h-full w-full object-cover"}):e.jsx("span",{children:ue})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-primary-text",children:[y.name,Oe&&e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-orange-300 bg-orange-50 px-2 py-0.5 text-[11px] font-semibold text-orange-700 dark:bg-orange-900/30",title:"S·∫£n ph·∫©m c√≥ t√™n tr√πng l·∫∑p",children:"‚ö†Ô∏è Tr√πng"})]}),e.jsxs("div",{className:"text-xs text-tertiary-text",children:["SKU: ",y.sku||"N/A"]}),e.jsx("div",{className:"text-xs text-tertiary-text",children:y.category||"Ch∆∞a ph√¢n lo·∫°i"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:`text-lg font-semibold ${Le}`,children:G.toLocaleString()}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-semibold ${Me}`,children:[e.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${G===0?"bg-red-500":G<=$e?"bg-amber-500":"bg-emerald-500"}`}),Te]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-secondary-text",children:U(ge)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-primary-text",children:U(V)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-secondary-text",children:U(ae)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-primary-text",children:U(_e)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"relative flex justify-end",children:[e.jsx("button",{onClick:ke=>{ke.stopPropagation(),H(F=>F===y.id?null:y.id)},className:"rounded-full border border-transparent p-2 text-secondary-text hover:border-secondary-border hover:text-primary-text transition","aria-haspopup":"menu","aria-expanded":Q===y.id,title:"Thao t√°c nhanh",children:e.jsx(Cr,{className:"w-5 h-5"})}),Q===y.id&&e.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-44 overflow-hidden rounded-xl border border-primary-border bg-white shadow-xl dark:bg-slate-800",onClick:ke=>ke.stopPropagation(),children:[e.jsxs("button",{onClick:ke=>{ke.stopPropagation(),P(y),H(null)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm hover:bg-blue-50 dark:hover:bg-slate-700",children:[e.jsx(Pr,{className:"h-4 w-4 text-blue-500"}),"Ch·ªânh s·ª≠a"]}),e.jsxs("button",{onClick:ke=>{ke.stopPropagation(),H(null),vr(y.id)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-red-500 hover:bg-red-50 dark:hover:bg-slate-700/70",children:[e.jsx(_r,{className:"h-4 w-4"}),"X√≥a"]})]})]})})]},y.id)})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 px-3 sm:px-6 py-3 sm:py-4 border-t border-primary-border bg-primary-bg",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-secondary-text text-center sm:text-left",children:[e.jsxs("span",{className:"font-medium",children:["Trang ",g,"/",oe]}),e.jsx("span",{className:"mx-1",children:"‚Ä¢"}),e.jsxs("span",{children:[W," ph·ª• t√πng"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("button",{disabled:g===1||L,onClick:()=>p(y=>Math.max(1,y-1)),className:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm border border-secondary-border rounded disabled:opacity-40 hover:bg-slate-700/50 transition-colors",children:"‚Üê"}),e.jsx("span",{className:"px-2 py-1 text-xs sm:text-sm font-medium text-slate-300 min-w-[2rem] text-center",children:g}),e.jsx("button",{disabled:g>=oe||L,onClick:()=>p(y=>Math.min(oe,y+1)),className:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm border border-secondary-border rounded disabled:opacity-40 hover:bg-slate-700/50 transition-colors",children:"‚Üí"}),e.jsx("select",{value:k,onChange:y=>{const $=Number(y.target.value)||20;v($),p(1)},className:"px-1.5 sm:px-2 py-1.5 text-xs sm:text-sm border border-secondary-border rounded bg-slate-800 text-slate-200",children:[10,20,50,100].map(y=>e.jsx("option",{value:y,children:y},y))})]})]})]})]}),c==="history"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(Cn,{transactions:o})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ts,{transactions:o})})]}),c==="categories"&&e.jsx("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:e.jsx(hs,{})}),c==="lookup"&&e.jsxs("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(ms,{})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ss,{})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(wn,{isOpen:x,onClose:()=>h(!1),parts:ne||[],currentBranchId:d,onSave:pr})}),e.jsx(jn,{isOpen:x,onClose:()=>h(!1),parts:ne||[],currentBranchId:d,onSave:pr}),O&&e.jsx(yn,{parts:ne||[],currentBranchId:d,onClose:()=>q(!1)}),D&&e.jsx(Pn,{part:D,onClose:()=>P(null),onSave:y=>{console.log("üíæ Saving part updates:",y);const $={name:y.name,barcode:y.barcode,category:y.category,stock:y.stock,retailPrice:y.retailPrice,wholesalePrice:y.wholesalePrice};y.costPrice&&($.costPrice=y.costPrice),console.log("üì§ Sending updates:",$),fe.mutate({id:y.id,updates:$}),P(null)},currentBranchId:d}),C&&e.jsx(En,{onClose:()=>N(!1),onDownloadTemplate:jr,onImport:async y=>{var $,G;try{const{items:V,errors:ae}=await _s(y,d);if(V.length===0){const F=ae.length?`Kh√¥ng import ƒë∆∞·ª£c: ${ae.slice(0,3).join("; ")}`:"File kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá";throw new Error(F)}const ge=V.map(F=>F.sku);console.log(`üîç Checking ${ge.length} SKUs...`);const _e=new Map;ge.forEach(F=>{_e.set(F,(_e.get(F)||0)+1)});const ve=Array.from(_e.entries()).filter(([F,me])=>me>1).map(([F,me])=>`${F}(${me}x)`);ve.length>0&&console.warn(`‚ö†Ô∏è Duplicate SKUs in file: ${ve.slice(0,5).join(", ")}`);const Oe=Array.from(new Set(ge)),Me=100,Te=[];for(let F=0;F<Oe.length;F+=Me){const me=Oe.slice(F,F+Me),{data:Se,error:Ue}=await ce.from("parts").select("*").in("sku",me);if(Ue)throw console.error(`‚ùå Fetch chunk ${F/Me+1} error:`,Ue),new Error(`L·ªói ki·ªÉm tra ph·ª• t√πng: ${Ue.message}`);Se&&Te.push(...Se)}console.log(`‚úÖ Found ${Te.length} existing parts`);const Le=new Map(Te.map(F=>[F.sku,F])),ue=[],Ee=[],De=[],Je=new Set;let Fe=0,He=0,Ge=0;const Ve=new Date().toISOString();for(const F of V){if(Je.has(F.sku)){console.warn(`‚ö†Ô∏è Skipping duplicate SKU in file: ${F.sku}`),Ge++;continue}Je.add(F.sku);const me=Le.get(F.sku);if(me)He+=1,Ee.push({id:me.id,stock:{...me.stock,[d]:(me.stock[d]||0)+F.quantity},costPrice:{...me.costPrice,[d]:F.costPrice},retailPrice:{...me.retailPrice,[d]:F.retailPrice},wholesalePrice:{...me.wholesalePrice,[d]:F.wholesalePrice}}),De.push({type:"Nh·∫≠p kho",date:Ve,branchId:d,partId:me.id,partName:F.name,quantity:F.quantity,unitPrice:F.retailPrice,totalPrice:F.quantity*F.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"});else{Fe+=1;const Se=(($=crypto==null?void 0:crypto.randomUUID)==null?void 0:$.call(crypto))||`${Math.random().toString(36).slice(2)}-${Date.now()}`;ue.push({id:Se,name:F.name,sku:F.sku,category:F.category,description:F.description,stock:{[d]:F.quantity},costPrice:{[d]:F.costPrice},retailPrice:{[d]:F.retailPrice},wholesalePrice:{[d]:F.wholesalePrice}}),De.push({type:"Nh·∫≠p kho",date:Ve,branchId:d,partId:Se,partName:F.name,quantity:F.quantity,unitPrice:F.retailPrice,totalPrice:F.quantity*F.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"})}}if(ue.length>0){const{data:F,error:me}=await ce.from("parts").insert(ue).select();if(me)throw console.error("‚ùå Batch create error:",me),new Error(`L·ªói t·∫°o ph·ª• t√πng: ${me.message}`);console.log(`‚úÖ Created ${(F==null?void 0:F.length)||0} parts`)}if(Ee.length>0){let F=0,me=0;for(const Se of Ee){const{error:Ue}=await ce.from("parts").update({stock:Se.stock,costPrice:Se.costPrice,retailPrice:Se.retailPrice,wholesalePrice:Se.wholesalePrice}).eq("id",Se.id);Ue?(console.error(`‚ùå Update error for part ${Se.id}:`,Ue),me++):F++}console.log(`‚úÖ Updated ${F}/${Ee.length} parts`)}if(De.length>0){const{error:F}=await ce.from("inventory_transactions").insert(De);F&&console.warn("‚ö†Ô∏è Inventory transactions error:",F)}le.invalidateQueries({queryKey:["partsRepo"]}),le.invalidateQueries({queryKey:["partsRepoPaged"]});try{const{data:F}=await ce.auth.getUser();await cr(((G=F==null?void 0:F.user)==null?void 0:G.id)||null,{action:"inventory.import",tableName:"inventory_transactions",oldData:null,newData:{totalRows:V.length+ae.length,created:Fe,updated:He,skipped:ae.length,sampleErrors:ae.slice(0,10),branchId:d,at:Ve}})}catch{}N(!1);let ke=`Import: t·∫°o m·ªõi ${Fe}, c·∫≠p nh·∫≠t ${He}`;Ge>0&&(ke+=`, b·ªè qua ${Ge} SKU tr√πng`),ae.length>0&&(ke+=`, ${ae.length} d√≤ng l·ªói`),I.success(ke)}catch(V){console.error("‚ùå Import error:",V),I.error(`L·ªói import: ${V}`)}}}),e.jsx(xs,{isOpen:de.isOpen,title:de.title,message:de.message,confirmText:de.confirmText,cancelText:de.cancelText,confirmColor:de.confirmColor,onConfirm:xe,onCancel:se}),e.jsxs("div",{className:"sm:hidden fixed bottom-20 right-4 z-40 flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>h(!0),className:"w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-full shadow-lg shadow-green-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"T·∫°o phi·∫øu nh·∫≠p",children:e.jsx(Yt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:yr,className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-full shadow-lg shadow-orange-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"Xu·∫•t Excel",children:e.jsx(Er,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 z-50 safe-area-bottom",children:[e.jsx("div",{className:"absolute inset-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg -z-10"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 px-2 py-2",children:[e.jsxs("button",{onClick:()=>m("stock"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="stock"?"bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(sr,{className:`w-5 h-5 ${c==="stock"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="stock"?"font-semibold":""}`,children:"T·ªìn kho"})]}),e.jsxs("button",{onClick:()=>m("categories"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="categories"?"bg-purple-100 dark:bg-purple-900/40 text-purple-600 dark:text-purple-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(lt,{className:`w-5 h-5 ${c==="categories"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="categories"?"font-semibold":""}`,children:"Danh m·ª•c"})]}),e.jsxs("button",{onClick:()=>m("lookup"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="lookup"?"bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(nt,{className:`w-5 h-5 ${c==="lookup"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="lookup"?"font-semibold":""}`,children:"Tra c·ª©u"})]}),e.jsxs("button",{onClick:()=>m("history"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="history"?"bg-green-100 dark:bg-green-900/40 text-green-600 dark:text-green-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(nr,{className:`w-5 h-5 ${c==="history"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="history"?"font-semibold":""}`,children:"L·ªãch s·ª≠"})]})]})]})]})},En=({onClose:d,onDownloadTemplate:f,onImport:b})=>{const[o,c]=j.useState(null),[m,x]=j.useState(!1),h=t=>{var s,a;const r=(s=t.target.files)==null?void 0:s[0];if(r){const n=(a=r.name.split(".").pop())==null?void 0:a.toLowerCase();n==="xlsx"||n==="xls"||n==="csv"?c(r):I.warning("Vui l√≤ng ch·ªçn file Excel (.xlsx, .xls) ho·∫∑c CSV (.csv)")}},l=async()=>{if(!o){I.warning("Vui l√≤ng ch·ªçn file ƒë·ªÉ import");return}x(!0);try{await b(o)}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Nh·∫≠p t·ªìn kho t·ª´ Excel/CSV"}),e.jsx("button",{onClick:d,disabled:m,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng"}),e.jsxs("ol",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"T·∫£i file template m·∫´u"}),e.jsx("li",{children:"ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m v√†o file"}),e.jsx("li",{children:"L∆∞u file v√† ch·ªçn ƒë·ªÉ import"})]}),e.jsx("button",{onClick:f,className:"mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"üì• T·∫£i Template Excel"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ch·ªçn file ƒë·ªÉ import"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:h,disabled:m,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-slate-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Click ƒë·ªÉ ch·ªçn file Excel ho·∫∑c CSV"}),o&&e.jsxs("span",{className:"mt-2 text-sm font-medium text-blue-600 dark:text-blue-400",children:["‚úì ",o.name]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:d,disabled:m,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"H·ªßy"}),e.jsx("button",{onClick:l,disabled:!o||m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"ƒêang x·ª≠ l√Ω...":"Import"})]})]})]})})},Pn=({part:d,onClose:f,onSave:b,currentBranchId:o})=>{var u,g;const[c,m]=j.useState({name:d.name,barcode:d.barcode||"",category:d.category||"",retailPrice:d.retailPrice[o]||0,wholesalePrice:((u=d.wholesalePrice)==null?void 0:u[o])||0,costPrice:((g=d.costPrice)==null?void 0:g[o])||0,stock:d.stock[o]||0}),[x,h]=j.useState(!1),{data:l=[]}=br(),t=$a(),[r,s]=j.useState(!1),[a,n]=j.useState(""),i=p=>{if(p.preventDefault(),!c.name.trim()){I.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}b({id:d.id,name:c.name.trim(),barcode:c.barcode.trim()||void 0,category:c.category.trim()||void 0,stock:{...d.stock,[o]:c.stock},costPrice:{...d.costPrice,[o]:c.costPrice},retailPrice:{...d.retailPrice,[o]:c.retailPrice},wholesalePrice:{...d.wholesalePrice,[o]:c.wholesalePrice}})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Ch·ªânh s·ª≠a s·∫£n ph·∫©m"}),e.jsx("button",{onClick:f,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:i,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.name,onChange:p=>m({...c,name:p.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√£ v·∫°ch (Barcode)"}),e.jsx("input",{type:"text",value:c.barcode,onChange:p=>m({...c,barcode:p.target.value}),placeholder:"V√≠ d·ª•: 06455-KYJ-841 (Honda), 5S9-F2101-00 (Yamaha)",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-mono"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Nh·∫≠p m√£ v·∫°ch t·ª´ bao b√¨ g·ªëc c·ªßa h√£ng ƒë·ªÉ qu√©t nhanh khi b√°n h√†ng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c.category,onChange:p=>m({...c,category:p.target.value}),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),l.map(p=>e.jsx("option",{value:p.name,children:p.name},p.id))]}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600",title:"Th√™m danh m·ª•c m·ªõi",children:"+"})]}),r&&e.jsxs("form",{onSubmit:async p=>{p.preventDefault();const k=a.trim();if(!k)return I.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");try{const v=await t.mutateAsync({name:k});m({...c,category:v.name}),n(""),s(!1)}catch(v){I.error((v==null?void 0:v.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:a,onChange:p=>n(p.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-sm text-slate-900 dark:text-slate-100"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"L∆∞u"}),e.jsx("button",{type:"button",onClick:()=>{s(!1),n("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° nh·∫≠p"}),e.jsx("input",{type:"number",value:c.costPrice||0,onChange:p=>m({...c,costPrice:Number(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n l·∫ª"}),e.jsx("input",{type:"number",value:c.retailPrice,onChange:p=>m({...c,retailPrice:Number(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n s·ªâ"}),e.jsx("input",{type:"number",value:c.wholesalePrice,onChange:p=>m({...c,wholesalePrice:Number(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ªìn kho hi·ªán t·∫°i"}),e.jsx("input",{type:"number",value:c.stock,onChange:p=>m({...c,stock:Number(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"S·ªë l∆∞·ª£ng t·ªìn kho t·∫°i chi nh√°nh hi·ªán t·∫°i"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("div",{className:"font-medium mb-1",children:"L∆∞u √Ω:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a tr·ª±c ti·∫øp gi√° nh·∫≠p, gi√° b√°n v√† t·ªìn kho"}),e.jsx("li",{children:'Ho·∫∑c s·ª≠ d·ª•ng "T·∫°o phi·∫øu nh·∫≠p" ƒë·ªÉ ghi nh·∫≠n l·ªãch s·ª≠ nh·∫≠p kho chi ti·∫øt'})]})]})}),e.jsxs("div",{className:"flex justify-between gap-3 pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"px-4 py-2 border border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"In m√£ v·∫°ch"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"L∆∞u thay ƒë·ªïi"})]})]})]}),x&&e.jsx(vn,{part:d,currentBranchId:o,onClose:()=>h(!1)})]})})};export{yn as BatchPrintBarcodeModal,Gn as default};
