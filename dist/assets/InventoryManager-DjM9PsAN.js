import{c as qe,p as Ya,q as Ja,u as rr,t as Ma,r as y,j as e,i as X,l as et,v as ct,n as he,o as xr,w as Ta,x as ht,a as gr,y as Za,s as B,R as ut,z as es,X as mr,E as _r,A as dt,C as ts,P as Zt,D as rs,F as as,G as pr,H as ss,h as La,B as or,I as ir,T as Sr}from"./index-omObMK_Y.js";import{B as Aa,c as ns}from"./BarcodeScannerModal-B43vdyB6.js";import{r as ls,u as He,w as Ra}from"./xlsx-BBWTpfDg.js";import{u as os,a as vr,C as is,b as ds,c as $a}from"./CategoriesManager-DbOoIgde.js";import cs from"./LookupManager-DiScA6xj.js";import{u as us,a as hs,b as xs}from"./useInventoryTransactionsRepository-CbC_wQmb.js";import{b as Da}from"./useDebtsRepository-seOctDoy.js";import{v as fr}from"./validation-CmPBxZwi.js";import{P as tr}from"./printer-ZAAXeFsS.js";import{M as ms}from"./minus-QLRBDB4k.js";import{P as er}from"./plus-CTNJ_OT8.js";import"./Icons-Bn15JKOR.js";import"./palette-DcSCc2Q_.js";import"./cog-inInbshi.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=qe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=qe("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=qe("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=qe("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=qe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=qe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=qe("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=qe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),vs=(d,f,b="inventory-export.xlsx")=>{const i=d.map((x,h)=>{var l;return{STT:h+1,"T√™n s·∫£n ph·∫©m":x.name,SKU:x.sku,"Danh m·ª•c":x.category||"","T·ªìn kho":x.stock[f]||0,"Gi√° b√°n l·∫ª":x.retailPrice[f]||0,"Gi√° b√°n s·ªâ":((l=x.wholesalePrice)==null?void 0:l[f])||0,"Gi√° tr·ªã t·ªìn":(x.stock[f]||0)*(x.retailPrice[f]||0),"M√¥ t·∫£":x.description||""}}),c=He.json_to_sheet(i);c["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20},{wch:10},{wch:15},{wch:15},{wch:15},{wch:40}];const m=He.book_new();He.book_append_sheet(m,c,"T·ªìn kho"),Ra(m,b)},ks=(d="inventory-template.xlsx")=>{const f=[{"T√™n s·∫£n ph·∫©m":"VD: Nh·ªõt Motul 7100 10W40",SKU:"A3B7K9M2 (ho·∫∑c ƒë·ªÉ tr·ªëng - h·ªá th·ªëng t·ª± t·∫°o)","Danh m·ª•c":"Nh·ªõt ƒë·ªông c∆°","S·ªë l∆∞·ª£ng nh·∫≠p":50,"Gi√° b√°n l·∫ª":18e4,"Gi√° b√°n s·ªâ":15e4,"M√¥ t·∫£":"Nh·ªõt cao c·∫•p cho xe c√¥n tay"}],b=He.json_to_sheet(f);b["!cols"]=[{wch:30},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:40}];const i=He.book_new();He.book_append_sheet(i,b,"Template"),Ra(i,d)},ys=(d,f)=>new Promise((b,i)=>{const c=new FileReader;c.onload=m=>{var x;try{const h=(x=m.target)==null?void 0:x.result,l=/\.csv$/i.test(d.name),t=ls(h,{type:l?"string":"binary"}),r=t.SheetNames[0],s=t.Sheets[r],a=He.sheet_to_json(s,{defval:"",blankrows:!1}),n=p=>p.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/ƒë/gi,_=>_==="ƒë"?"d":"D"),o=p=>n(String(p).toLowerCase().trim()).replace(/[^a-z0-9]+/g,""),u=p=>{if(p==null||p==="")return 0;if(typeof p=="number")return p;let _=String(p).trim();_=_.replace(/\s+/g,""),_.includes(".")&&_.includes(",")?_=_.replace(/\./g,"").replace(/,/g,"."):_.includes(",")&&!_.includes(".")?_=_.replace(/,/g,"."):_=_.replace(/,/g,"");const O=parseFloat(_);return isNaN(O)?0:O},g={name:["tensanpham","ten","productname","name","tenhang","tenmh"],sku:["sku","mahang","mah","code","ma","masp","mavt"],category:["danhmuc","nhom","loai","category"],quantity:["soluongnhap","soluong","ton","tonkho","sl","qty"],costPrice:["dongianhap","gianhap","costprice","giavon"],retailPrice:["giabanle","giale","giaban","gia","retailprice","giabanra","dongiabanle"],wholesalePrice:["giabansi","giasi","wholesaleprice","giabuon","dongiabansi"],description:["mota","ghichu","note","description"]},k=[],v=a.map((p,_)=>{const O=p||{},D={};Object.keys(O).forEach(U=>{D[o(U)]=O[U]});const E=(U,z)=>{for(const W of g[U]){const J=D[W];if(J!=null&&J!=="")return J}return z},C=String(E("name","")).trim();let S=String(E("sku","")).trim().toUpperCase();(!S||!Ya(S))&&(S=Ja(),console.log(`üîÑ Generated SKU for "${C}": ${S}`));const T=E("category"),R=u(E("quantity",0)),P=u(E("costPrice",0)),I=u(E("retailPrice",0)),A=u(E("wholesalePrice",0)),H=E("description");if(!C&&Object.values(O).some(U=>U!=="")){const U=Object.values(O).map(z=>String(z).trim()).filter(z=>z!=="");if(U.length>0&&U[0].length>0)return k.push(`H√†ng ${_+2}: Thi·∫øu t√™n s·∫£n ph·∫©m, t·∫°o SKU: ${S}`),null}return C?{name:C,sku:S,category:T,quantity:R,costPrice:P,retailPrice:I,wholesalePrice:A,description:H}:null}).filter(Boolean);b({items:v,errors:k})}catch(h){const l=h instanceof Error?h.message:"Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu";i(new Error(l))}},c.onerror=()=>{i(new Error("L·ªói ƒë·ªçc file"))},/\.csv$/i.test(d.name)?c.readAsText(d,"utf-8"):c.readAsBinaryString(d)}),js=()=>{const{sales:d,workOrders:f,currentBranchId:b}=rr(),{data:i,isLoading:c}=Ma({page:1,pageSize:20}),m=(i==null?void 0:i.data)||[],[x,h]=y.useState(""),[l,t]=y.useState("all"),[r,s]=y.useState(null),[a,n]=y.useState("all"),[o,u]=y.useState(null),[g,k]=y.useState(!1),[v,p]=y.useState(!1),_=y.useMemo(()=>{const C=new Set;return m.forEach(S=>{S.category&&C.add(S.category)}),Array.from(C).sort()},[m]),O=y.useMemo(()=>m.filter(C=>{var T,R;if(x){const P=x.toLowerCase(),I=C.name.toLowerCase().includes(P),A=(T=C.sku)==null?void 0:T.toLowerCase().includes(P),H=(R=C.description)==null?void 0:R.toLowerCase().includes(P);if(!I&&!A&&!H)return!1}if(l!=="all"&&C.category!==l)return!1;if(r){const P=C.retailPrice[b]||0;if(P<r.min||P>r.max)return!1}const S=C.stock[b]||0;return!(a==="in-stock"&&S<=0||a==="low-stock"&&S>10||a==="out-of-stock"&&S>0)}),[m,x,l,r,a,b]),E=o?(C=>{const S=m.find(A=>A.id===C);if(!S)return null;const T=d.filter(A=>A.items.some(H=>H.partId===C)),R=f.filter(A=>{var H;return(H=A.partsUsed)==null?void 0:H.some(U=>U.partId===C)}),P=T.reduce((A,H)=>{const U=H.items.find(z=>z.partId===C);return A+((U==null?void 0:U.quantity)||0)},0),I=T.reduce((A,H)=>{const U=H.items.find(z=>z.partId===C);return A+((U==null?void 0:U.sellingPrice)||0)*((U==null?void 0:U.quantity)||0)},0);return{part:S,salesCount:T.length,totalSold:P,revenue:I,lastSold:T.length>0?T.sort((A,H)=>new Date(H.date).getTime()-new Date(A.date).getTime())[0].date:null,workOrdersCount:R.length}})(o):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[e.jsx("input",{type:"text",value:x,onChange:C=>h(C.target.value),placeholder:"T√¨m s·∫£n ph·∫©m...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),e.jsxs("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:[O.length," sp"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsxs("svg",{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:O.map(C=>{const S=C.stock[b]||0,T=C.retailPrice[b]||0;return e.jsxs("button",{onClick:()=>{u(C.id),p(!0)},className:"w-full p-4 flex items-center gap-3 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 truncate",children:C.name}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["SKU: ",C.sku]}),C.category&&e.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-0.5",children:C.category})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-base font-bold text-blue-600 dark:text-blue-400",children:X(T)}),e.jsx("div",{className:"flex items-center gap-1 justify-end mt-1",children:S<=0?e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs rounded",children:"H·∫øt"}):S<=10?e.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs rounded",children:S}):e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 text-xs rounded",children:S})})]})]},C.id)})})})]}),g&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>k(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc t√¨m ki·∫øm"}),e.jsx("button",{onClick:()=>k(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh m·ª•c"}),e.jsxs("select",{value:l,onChange:C=>t(C.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),_.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"T·ªìn kho"}),e.jsx("div",{className:"space-y-2",children:[{value:"all",label:"T·∫•t c·∫£"},{value:"in-stock",label:"C√≤n h√†ng"},{value:"low-stock",label:"S·∫Øp h·∫øt (‚â§10)"},{value:"out-of-stock",label:"H·∫øt h√†ng"}].map(C=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"stock",value:C.value,checked:a===C.value,onChange:S=>n(S.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:C.label})]},C.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Kho·∫£ng gi√°"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"T·ª´",onChange:C=>s(S=>({min:Number(C.target.value)||0,max:(S==null?void 0:S.max)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"}),e.jsx("input",{type:"number",placeholder:"ƒê·∫øn",onChange:C=>s(S=>({min:(S==null?void 0:S.min)||0,max:Number(C.target.value)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"})]}),r&&e.jsx("button",{onClick:()=>s(null),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"X√≥a b·ªô l·ªçc gi√°"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex gap-2",children:[e.jsx("button",{onClick:()=>{t("all"),n("all"),s(null)},className:"flex-1 px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê·∫∑t l·∫°i"}),e.jsx("button",{onClick:()=>k(!1),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})]})]})]}),v&&E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>p(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt s·∫£n ph·∫©m"}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-1",children:E.part.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["SKU: ",E.part.sku]}),E.part.category&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["Danh m·ª•c: ",E.part.category]})]}),E.part.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"M√¥ t·∫£"}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:E.part.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"T·ªìn kho"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:E.part.stock[b]||0})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Gi√° b√°n l·∫ª"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:X(E.part.retailPrice[b]||0)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"Th·ªëng k√™ b√°n h√†ng"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ƒë√£ b√°n"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:E.totalSold})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400 mb-1",children:"Doanh thu"}),e.jsx("div",{className:"text-xl font-bold text-emerald-900 dark:text-emerald-100",children:X(E.revenue)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-600 dark:text-amber-400 mb-1",children:"S·ªë ƒë∆°n h√†ng"}),e.jsx("div",{className:"text-2xl font-bold text-amber-900 dark:text-amber-100",children:E.salesCount})]}),E.lastSold&&e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"B√°n g·∫ßn nh·∫•t"}),e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:et(E.lastSold)})]})]})]})]})]})]})]})},br="suppliers";async function ws(){try{const{data:d,error:f}=await he.from(br).select("*").order("name");return f?ct({code:"supabase",message:"Kh√¥ng th·ªÉ t·∫£i nh√† cung c·∫•p",cause:f}):Ta(d||[])}catch(d){return ct({code:"network",message:"L·ªói k·∫øt n·ªëi",cause:d})}}async function Ns(d){var f;try{if(!d.name)return ct({code:"validation",message:"Thi·∫øu t√™n nh√† cung c·∫•p"});const b={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Math.random().toString(36).slice(2)}-${Date.now()}`,name:d.name,phone:d.phone,address:d.address,created_at:new Date().toISOString()},{data:i,error:c}=await he.from(br).insert([b]).select().single();if(c||!i){const x=(c==null?void 0:c.message)||(c==null?void 0:c.details)||"T·∫°o nh√† cung c·∫•p th·∫•t b·∫°i";return ct({code:"supabase",message:x,cause:c})}let m=null;try{const{data:x}=await he.auth.getUser();m=((f=x==null?void 0:x.user)==null?void 0:f.id)||null}catch{}return await xr(m,{action:"supplier.create",tableName:br,recordId:i.id,oldData:null,newData:i}),Ta(i)}catch(b){return ct({code:"network",message:"L·ªói k·∫øt n·ªëi khi t·∫°o nh√† cung c·∫•p",cause:b})}}const kr=()=>ht({queryKey:["suppliers"],queryFn:async()=>{const d=await ws();if(!d.ok)throw d.error;return d.data}}),Ia=()=>{const d=gr();return Za({mutationFn:async f=>{const b=await Ns(f);if(!b.ok)throw b.error;return b.data},onSuccess:()=>{d.invalidateQueries({queryKey:["suppliers"]}),B.success("ƒê√£ th√™m nh√† cung c·∫•p")},onError:f=>B.error((f==null?void 0:f.message)||"L·ªói th√™m nh√† cung c·∫•p")})},dr=new Intl.NumberFormat("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:2});function _s(d){let f=d.replace(/[^0-9.,-]/g,"");const b=f.includes("."),i=f.includes(",");b&&i?f=f.replace(/\./g,"").replace(",","."):i&&!b&&(f=f.replace(",","."));const c=Number(f);return Number.isFinite(c)?c:0}const De=({value:d,onValue:f,placeholder:b,className:i,min:c,max:m,disabled:x,ariaLabel:h})=>{const[l,t]=ut.useState(d?dr.format(d):""),[r,s]=ut.useState(!1);ut.useEffect(()=>{r||t(d?dr.format(d):"")},[d,r]);const a=o=>{const u=o.target.value;t(u);const g=_s(u);if(c!==void 0&&g<c){f(c);return}if(m!==void 0&&g>m){f(m);return}f(g)},n=()=>{s(!1),t(d?dr.format(d):"")};return e.jsx("input",{type:"text",inputMode:"decimal",value:l,onChange:a,onFocus:()=>s(!0),onBlur:n,placeholder:b,className:i,disabled:x,"aria-label":h})},Ss=({isOpen:d,onClose:f,selectedSupplierId:b,onSelectSupplier:i})=>{const[c,m]=y.useState(""),[x,h]=y.useState(!1),{data:l=[]}=kr(),t=Ia(),[r,s]=y.useState({name:"",phone:"",address:"",note:""}),a=l.filter(o=>{var g,k;const u=c.toLowerCase();return((g=o.name)==null?void 0:g.toLowerCase().includes(u))||((k=o.phone)==null?void 0:k.toLowerCase().includes(u))}),n=async()=>{if(!r.name.trim()){B.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const o=await t.mutateAsync(r);B.success("ƒê√£ th√™m nh√† cung c·∫•p"),i(o.id),s({name:"",phone:"",address:"",note:""}),h(!1),f()}catch(o){B.error((o==null?void 0:o.message)||"L·ªói th√™m nh√† cung c·∫•p")}};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[110] flex items-end sm:items-center justify-center",onClick:f,children:e.jsxs("div",{onClick:o=>o.stopPropagation(),className:"bg-white dark:bg-slate-800 w-full sm:max-w-md h-[85vh] sm:h-auto sm:max-h-[80vh] rounded-t-3xl sm:rounded-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:x?"Th√™m NCC m·ªõi":"Ch·ªçn nh√† cung c·∫•p"}),e.jsx("button",{onClick:f,className:"text-white text-2xl leading-none",children:"√ó"})]}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["T√™n nh√† cung c·∫•p ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.name,onChange:o=>s({...r,name:o.target.value}),placeholder:"Nh·∫≠p t√™n NCC",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",inputMode:"numeric",value:r.phone,onChange:o=>s({...r,phone:o.target.value}),placeholder:"Nh·∫≠p SƒêT",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{value:r.address,onChange:o=>s({...r,address:o.target.value}),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ghi ch√∫"}),e.jsx("textarea",{value:r.note,onChange:o=>s({...r,note:o.target.value}),placeholder:"Ghi ch√∫ th√™m",rows:2,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]}),e.jsxs("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{h(!1),s({name:"",phone:"",address:"",note:""})},className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"H·ªßy"}),e.jsx("button",{onClick:n,disabled:!r.name.trim()||t.isPending,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:t.isPending?"ƒêang th√™m...":"Th√™m NCC"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"T√¨m theo t√™n, SƒêT...",value:c,onChange:o=>m(o.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"üë§"}),e.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y nh√† cung c·∫•p"})]}):a.map(o=>e.jsxs("div",{onClick:()=>{i(o.id),f()},className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${b===o.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 active:scale-98"}`,children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:o.name}),o.phone&&e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["üìû ",o.phone]}),o.address&&e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["üìç ",o.address]})]},o.id))}),e.jsx("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsxs("button",{onClick:()=>h(!0),className:"w-full py-4 bg-green-600 hover:bg-green-700 active:scale-98 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-transform",children:[e.jsx("span",{className:"text-xl",children:"+"}),e.jsx("span",{children:"Th√™m nh√† cung c·∫•p m·ªõi"})]})})]})]})}):null},Cs=({isOpen:d,onClose:f,parts:b,receiptItems:i,setReceiptItems:c,selectedSupplier:m,setSelectedSupplier:x,searchTerm:h,setSearchTerm:l,onSave:t,discount:r,setDiscount:s,discountType:a,setDiscountType:n,paymentMethod:o,setPaymentMethod:u,paymentType:g,setPaymentType:k,partialAmount:v,setPartialAmount:p,showAddProductModal:_,setShowAddProductModal:O,onAddNewProduct:D,currentBranchId:E})=>{var Me,fe,Ge;const[C,S]=y.useState(1),[T,R]=y.useState(!1),[P,I]=y.useState(""),A=y.useRef(null),[H,U]=y.useState(!1),[z,W]=y.useState(!1),{data:J=[]}=kr();console.log("üîç GoodsReceiptMobileModal - parts:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üîç searchTerm:",h);const oe=(b==null?void 0:b.filter(L=>{var se,te;if(!h||h.trim()==="")return!0;const re=h.toLowerCase().trim();return((se=L.name)==null?void 0:se.toLowerCase().includes(re))||((te=L.sku)==null?void 0:te.toLowerCase().includes(re))}))||[];console.log("üîç filteredParts:",(oe==null?void 0:oe.length)||0);const ue=L=>{i.find(se=>se.partId===L.id)?(c(se=>se.map(te=>te.partId===L.id?{...te,quantity:te.quantity+1}:te)),B.success(`ƒê√£ tƒÉng s·ªë l∆∞·ª£ng ${L.name}`)):(c(se=>{var te,be,N;return[...se,{partId:L.id,partName:L.name,sku:L.sku,quantity:1,importPrice:((te=L.costPrice)==null?void 0:te[E])||0,sellingPrice:((be=L.retailPrice)==null?void 0:be[E])||0,wholesalePrice:((N=L.wholesalePrice)==null?void 0:N[E])||0}]}),B.success(`ƒê√£ th√™m ${L.name} v√†o phi·∫øu nh·∫≠p`)),l(""),setTimeout(()=>{var se;return(se=A.current)==null?void 0:se.focus()},100)},ne=L=>{if(L.preventDefault(),!P.trim())return;const re=P.trim(),se=b.find(te=>{var be,N;return((be=te.sku)==null?void 0:be.toLowerCase())===re.toLowerCase()||((N=te.name)==null?void 0:N.toLowerCase().includes(re.toLowerCase()))});se?(ue(se),I("")):(B.info(`S·∫£n ph·∫©m m√£ ${re} ch∆∞a c√≥. Vui l√≤ng th√™m th√¥ng tin s·∫£n ph·∫©m m·ªõi.`,{autoClose:3e3}),setTimeout(()=>{O(!0)},500))},ce=L=>{console.log("üì∑ Camera scanned:",L);const re=be=>be.toLowerCase().replace(/[-\s./\\]/g,""),se=re(L),te=b.find(be=>{var N,G;return re(be.barcode||"")===se||((N=be.barcode)==null?void 0:N.toLowerCase())===L.toLowerCase()||re(be.sku||"")===se||((G=be.sku)==null?void 0:G.toLowerCase())===L.toLowerCase()});te?(i.find(N=>N.partId===te.id)?c(N=>N.map(G=>G.partId===te.id?{...G,quantity:G.quantity+1}:G)):(c(N=>{var G,Z,Q;return[...N,{partId:te.id,partName:te.name,sku:te.sku,quantity:1,importPrice:((G=te.costPrice)==null?void 0:G[E])||0,sellingPrice:((Z=te.retailPrice)==null?void 0:Z[E])||0,wholesalePrice:((Q=te.wholesalePrice)==null?void 0:Q[E])||0}]}),B.success(`ƒê√£ th√™m ${te.name}`)),l("")):(B.info(`S·∫£n ph·∫©m m√£ ${L} ch∆∞a c√≥.`),I(L),setTimeout(()=>{O(!0)},500))};y.useEffect(()=>{z&&setTimeout(()=>{var L;return(L=A.current)==null?void 0:L.focus()},100)},[z]);const M=L=>{c(re=>re.filter((se,te)=>te!==L))},w=i.reduce((L,re)=>L+re.quantity*re.importPrice,0),q=a==="percent"?Math.round(w*r/100):r,Y=Math.max(0,w-q),de=()=>{if(!m){alert("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}S(2)},ie=()=>{alert("Ch·ª©c nƒÉng l∆∞u nh√°p ƒëang ph√°t tri·ªÉn")};return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end justify-center sm:hidden",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 w-full h-[95vh] rounded-t-3xl overflow-hidden flex flex-col",children:C===1?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:f,className:"text-white text-2xl leading-none",children:"√ó"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"T·∫°o phi·∫øu nh·∫≠p kho"})]})}),e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsx("div",{onClick:()=>R(!0),className:`p-4 rounded-xl border-2 cursor-pointer active:scale-98 transition-transform ${m?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-dashed border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"NH√Ä CUNG C·∫§P"}),e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:((Me=J.find(L=>L.id===m))==null?void 0:Me.name)||""}),((fe=J.find(L=>L.id===m))==null?void 0:fe.phone)&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:(Ge=J.find(L=>L.id===m))==null?void 0:Ge.phone})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üë§"}),e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Ch·ªçn nh√† cung c·∫•p"})]})}),e.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),e.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10 flex-shrink-0 space-y-2",children:[z&&e.jsxs("form",{onSubmit:ne,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),e.jsx("input",{ref:A,type:"text",placeholder:"Nh·∫≠p SKU ho·∫∑c qu√©t...",value:P,onChange:L=>I(L.target.value),className:"w-full px-4 py-3 pl-11 border-2 border-blue-400 dark:border-blue-600 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-base font-mono placeholder:text-blue-500/70"}),P&&e.jsx("button",{type:"button",onClick:()=>I(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{type:"button",onClick:()=>{W(!1),I("")},className:"w-12 h-[50px] flex items-center justify-center border-2 border-slate-300 dark:border-slate-600 rounded-xl text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:h,onChange:L=>l(L.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),!z&&e.jsx("button",{type:"button",onClick:()=>{W(!0)},className:"w-12 h-[50px] flex items-center justify-center border-2 border-blue-400 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-xl transition-all active:scale-95",title:"Qu√©t m√£ v·∫°ch",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),e.jsx("button",{type:"button",onClick:()=>U(!0),className:"w-12 h-[50px] flex items-center justify-center bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-lg transition-all active:scale-95",children:e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-50 dark:bg-slate-900",children:[!b||b.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"‚è≥"}),e.jsx("div",{children:"ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m..."})]}):oe.length===0?e.jsxs("div",{className:"text-center text-slate-500 py-12",children:[e.jsx("div",{className:"text-5xl mb-3",children:"üì¶"}),e.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),h&&e.jsxs("div",{className:"text-sm mt-2",children:['T√¨m ki·∫øm: "',h,'"']})]}):e.jsx("div",{className:"space-y-2",children:oe.map(L=>{var se,te;const re=i.find(be=>be.partId===L.id);return e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 text-base leading-tight mb-1",children:L.name}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["SKU: ",L.sku]}),e.jsxs("div",{className:"mt-2 flex gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["Nh·∫≠p:"," "]}),e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:X(((se=L.costPrice)==null?void 0:se[E])||0)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["B√°n:"," "]}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:X(((te=L.retailPrice)==null?void 0:te[E])||0)})]})]}),re&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["ƒê√£ th√™m: ",re.quantity," √ó"," ",X(re.importPrice)]})})]}),e.jsx("button",{onClick:()=>ue(L),className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl leading-none active:scale-95 transition-transform",children:"+"})]})},L.id)})}),e.jsxs("button",{onClick:()=>O(!0),className:"w-full mt-3 py-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-500 dark:text-slate-400 hover:border-blue-400 hover:text-blue-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"+"}),e.jsx("span",{className:"font-medium",children:"T·∫°o s·∫£n ph·∫©m m·ªõi"})]})]}),i.length>0&&e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-t from-white via-white dark:from-slate-800 dark:via-slate-800 to-transparent pt-6 pb-safe pb-4 px-3",children:e.jsxs("button",{onClick:de,className:"w-full bg-blue-600 hover:bg-blue-700 active:scale-98 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-between px-6 shadow-lg transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-white/20 rounded-full w-8 h-8 flex items-center justify-center font-bold",children:i.reduce((L,re)=>L+re.quantity,0)}),e.jsx("span",{children:"Ti·∫øp t·ª•c"})]}),e.jsx("span",{className:"font-bold",children:X(w)})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(1),className:"text-white text-xl leading-none",children:"‚Üê"}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"X√°c nh·∫≠n nh·∫≠p kho"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900",children:[e.jsx("div",{className:"p-3 space-y-2",children:i.map((L,re)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 leading-tight",children:L.partName}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["SKU: ",L.sku]})]}),e.jsx("button",{onClick:()=>M(re),className:"text-red-500 hover:text-red-600 text-xl",children:"√ó"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{if(L.quantity>1){const se=[...i];se[re].quantity-=1,c(se)}},className:"w-8 h-8 rounded-lg border-2 border-slate-300 dark:border-slate-600 flex items-center justify-center text-slate-600 dark:text-slate-400 font-bold active:scale-95 transition-transform",children:"‚àí"}),e.jsx("div",{className:"w-12 text-center font-bold text-lg text-slate-900 dark:text-slate-100",children:L.quantity}),e.jsx("button",{onClick:()=>{const se=[...i];se[re].quantity+=1,c(se)},className:"w-8 h-8 rounded-lg border-2 border-blue-500 flex items-center justify-center text-blue-600 font-bold active:scale-95 transition-transform",children:"+"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[X(L.importPrice)," / c√°i"]}),e.jsx("div",{className:"font-bold text-orange-600 dark:text-orange-400",children:X(L.quantity*L.importPrice)})]})]})]},re))}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-slate-700 dark:text-slate-300",children:[e.jsx("span",{children:"T·ªïng ti·ªÅn h√†ng"}),e.jsx("span",{className:"font-medium",children:X(w)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Gi·∫£m gi√°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",inputMode:"numeric",value:r,onChange:L=>s(Number(L.target.value)),placeholder:"0",className:"w-24 px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsxs("select",{value:a,onChange:L=>n(L.target.value),className:"px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t-2 border-slate-200 dark:border-slate-700",children:[e.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"C·∫¶N THANH TO√ÅN"}),e.jsx("span",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:X(Y)})]})]})}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("cash"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${o==="cash"?"bg-green-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),e.jsx("button",{onClick:()=>u("bank"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${o==="bank"?"bg-blue-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-slate-200 dark:bg-slate-700 rounded-xl p-1 flex gap-1",children:[e.jsx("button",{onClick:()=>{k("full"),p(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="full"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"ƒê·ªß"}),e.jsx("button",{onClick:()=>k("partial"),className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="partial"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"1 Ph·∫ßn"}),e.jsx("button",{onClick:()=>{k("note"),p(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${g==="note"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"N·ª£"})]})}),g==="partial"&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-300 dark:border-slate-600",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ti·ªÅn tr·∫£ NCC"}),e.jsx("input",{type:"number",inputMode:"numeric",value:v,onChange:L=>{const re=Number(L.target.value);re<=Y?p(re):alert("S·ªë ti·ªÅn tr·∫£ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° t·ªïng ti·ªÅn")},placeholder:"Nh·∫≠p s·ªë ti·ªÅn",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg text-right text-lg font-bold bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),e.jsxs("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",X(Y-v)]})]})}),g==="note"&&e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-red-700 dark:text-red-400 mb-1",children:"S·ªë ti·ªÅn n·ª£"}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:X(Y)})]})})]}),e.jsx("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 space-y-2 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ie,className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"üíæ L∆∞u Nh√°p"}),e.jsx("button",{onClick:t,disabled:!m||i.length===0,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:"‚úÖ NH·∫¨P KHO"})]})})]})})}),e.jsx(Ss,{isOpen:T,onClose:()=>R(!1),selectedSupplierId:m,onSelectSupplier:x}),e.jsx(Aa,{isOpen:H,onClose:()=>U(!1),onScan:ce,title:"Qu√©t m√£ v·∫°ch s·∫£n ph·∫©m"})]}):null},Es=({transactions:d})=>{const{currentBranchId:f}=rr(),{data:b=[]}=Da(),[i,c]=y.useState("7days"),[m,x]=y.useState(et(new Date,!0)),[h,l]=y.useState(et(new Date,!0)),[t,r]=y.useState(""),[s,a]=y.useState(!1),[n,o]=y.useState(null),u=y.useMemo(()=>{let v=d.filter(_=>_.type==="Nh·∫≠p kho");const p=new Date;switch(i){case"7days":const _=new Date(p.getTime()-6048e5);v=v.filter(E=>new Date(E.date)>=_);break;case"30days":const O=new Date(p.getTime()-720*60*60*1e3);v=v.filter(E=>new Date(E.date)>=O);break;case"thisMonth":const D=new Date(p.getFullYear(),p.getMonth(),1);v=v.filter(E=>new Date(E.date)>=D);break;case"custom":v=v.filter(E=>{const C=new Date(E.date);return C>=new Date(m)&&C<=new Date(h)});break}if(t){const _=t.toLowerCase();v=v.filter(O=>O.partName.toLowerCase().includes(_)||O.notes&&O.notes.toLowerCase().includes(_))}return v.sort((_,O)=>new Date(O.date).getTime()-new Date(_.date).getTime())},[d,i,m,h,t]),g=y.useMemo(()=>u.reduce((v,p)=>v+p.totalPrice,0),[u]),k=y.useMemo(()=>{const v=new Map;return u.forEach(p=>{var C,S;const _=new Date(p.date),O=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,D=(C=p.notes)!=null&&C.includes("NCC:")?(S=p.notes.split("NCC:")[1])==null?void 0:S.trim():"Kh√¥ng x√°c ƒë·ªãnh",E=`${O}_${D}_${_.getHours()}_${_.getMinutes()}`;v.has(E)||v.set(E,[]),v.get(E).push(p)}),Array.from(v.entries()).map(([p,_],O)=>{var S,T,R;const D=_[0],E=new Date(D.date);let C="";if(D.notes){const P=D.notes.match(/NH-\d{8}-\d{3}/);P&&(C=P[0])}return C||(C=`NH-${`${E.getFullYear()}${String(E.getMonth()+1).padStart(2,"0")}${String(E.getDate()).padStart(2,"0")}`}-${String(v.size-O).padStart(3,"0")}`),{receiptCode:C,date:D.date,supplier:(S=D.notes)!=null&&S.includes("NCC:")?(R=(T=D.notes.split("NCC:")[1])==null?void 0:T.split("|")[0])==null?void 0:R.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:_,total:_.reduce((P,I)=>P+I.totalPrice,0)}}).sort((p,_)=>new Date(_.date).getTime()-new Date(p.date).getTime())},[u]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[e.jsx("input",{type:"text",value:t,onChange:v=>r(v.target.value),placeholder:"T√¨m NCC, ph·ª• t√πng...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>a(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),e.jsx("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:k.length})]})]}),e.jsx("div",{className:"px-3 py-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"T·ªïng gi√° tr·ªã nh·∫≠p"}),e.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:X(g)})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:k.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì¶"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th·ªùi gian"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:k.map(v=>{const p=new Date(v.date),_=p.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),O=p.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),D=b.find(S=>{var T;return(T=S.description)==null?void 0:T.includes(v.receiptCode)}),E=(D==null?void 0:D.remainingAmount)||0,C=E>0;return e.jsxs("button",{onClick:()=>o({...v,date:new Date(v.date)}),className:"w-full p-4 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:v.receiptCode}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[_," ¬∑ ",O]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:X(v.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-lg",children:"üè¢"}),e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:v.supplier})]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:[v.items.length," s·∫£n ph·∫©m"]}),C&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",X(E)]})})]},v.receiptCode)})})})]}),s&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>a(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc th·ªùi gian"}),e.jsx("button",{onClick:()=>a(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Th·ªùi gian"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(v=>e.jsx("button",{onClick:()=>c(v.key),className:`px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${i===v.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:v.label},v.key))})]}),i==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),e.jsx("input",{type:"date",value:m,onChange:v=>x(v.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),e.jsx("input",{type:"date",value:h,onChange:v=>l(v.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:()=>a(!1),className:"w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})})]})]}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>o(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt phi·∫øu nh·∫≠p"}),e.jsx("button",{onClick:()=>o(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-cyan-600 dark:text-cyan-400 mb-1",children:"M√£ phi·∫øu"}),e.jsx("div",{className:"text-lg font-bold text-cyan-600 dark:text-cyan-400",children:n.receiptCode})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Ng√†y nh·∫≠p"}),e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:et(new Date(n.date))})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:X(n.total)})]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400 mb-1",children:"Nh√† cung c·∫•p"}),e.jsx("div",{className:"text-base font-semibold text-orange-900 dark:text-orange-100",children:n.supplier})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-2",children:["Danh s√°ch s·∫£n ph·∫©m (",n.items.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.items.map(v=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:[v.quantity," x ",v.partName]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[X(v.unitPrice||0)," / SP"]})]}),e.jsx("div",{className:"text-sm font-bold text-slate-900 dark:text-white",children:X(v.quantity*(v.unitPrice||0))})]},v.id))})]})]})]})]})]})};var gt={},at={},pt={},Mr;function _e(){if(Mr)return pt;Mr=1,Object.defineProperty(pt,"__esModule",{value:!0});function d(b,i){if(!(b instanceof i))throw new TypeError("Cannot call a class as a function")}var f=function b(i,c){d(this,b),this.data=i,this.text=c.text||i,this.options=c};return pt.default=f,pt}var Tr;function Ps(){if(Tr)return at;Tr=1,Object.defineProperty(at,"__esModule",{value:!0}),at.CODE39=void 0;var d=(function(){function u(g,k){for(var v=0;v<k.length;v++){var p=k[v];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(g,p.key,p)}}return function(g,k,v){return k&&u(g.prototype,k),v&&u(g,v),g}})(),f=_e(),b=i(f);function i(u){return u&&u.__esModule?u:{default:u}}function c(u,g){if(!(u instanceof g))throw new TypeError("Cannot call a class as a function")}function m(u,g){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:u}function x(u,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);u.prototype=Object.create(g&&g.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(u,g):u.__proto__=g)}var h=(function(u){x(g,u);function g(k,v){return c(this,g),k=k.toUpperCase(),v.mod43&&(k+=a(o(k))),m(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,k,v))}return d(g,[{key:"encode",value:function(){for(var v=r("*"),p=0;p<this.data.length;p++)v+=r(this.data[p])+"0";return v+=r("*"),{data:v,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),g})(b.default),l=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],t=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function r(u){return s(n(u))}function s(u){return t[u].toString(2)}function a(u){return l[u]}function n(u){return l.indexOf(u)}function o(u){for(var g=0,k=0;k<u.length;k++)g+=n(u[k]);return g=g%43,g}return at.CODE39=h,at}var Ee={},vt={},kt={},me={},Lr;function xt(){if(Lr)return me;Lr=1,Object.defineProperty(me,"__esModule",{value:!0});var d;function f(l,t,r){return t in l?Object.defineProperty(l,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):l[t]=r,l}var b=me.SET_A=0,i=me.SET_B=1,c=me.SET_C=2;me.SHIFT=98;var m=me.START_A=103,x=me.START_B=104,h=me.START_C=105;return me.MODULO=103,me.STOP=106,me.FNC1=207,me.SET_BY_CODE=(d={},f(d,m,b),f(d,x,i),f(d,h,c),d),me.SWAP={101:b,100:i,99:c},me.A_START_CHAR="√ê",me.B_START_CHAR="√ë",me.C_START_CHAR="√í",me.A_CHARS="[\0-_√à-√è]",me.B_CHARS="[ -√à-√è]",me.C_CHARS="(√è*[0-9]{2}√è*)",me.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011],me}var Ar;function ar(){if(Ar)return kt;Ar=1,Object.defineProperty(kt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=_e(),b=c(f),i=xt();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){m(this,r);var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s.substring(1),a));return n.bytes=s.split("").map(function(o){return o.charCodeAt(0)}),n}return d(r,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var a=this.bytes,n=a.shift()-105,o=i.SET_BY_CODE[n];if(o===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&a.unshift(i.FNC1);var u=r.next(a,1,o);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:r.getBar(n)+u.result+r.getBar((u.checksum+n)%i.MODULO)+r.getBar(i.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var a=this.options.ean128||!1;return typeof a=="string"&&(a=a.toLowerCase()==="true"),a}}],[{key:"getBar",value:function(a){return i.BARS[a]?i.BARS[a].toString():""}},{key:"correctIndex",value:function(a,n){if(n===i.SET_A){var o=a.shift();return o<32?o+64:o-32}else return n===i.SET_B?a.shift()-32:(a.shift()-48)*10+a.shift()-48}},{key:"next",value:function(a,n,o){if(!a.length)return{result:"",checksum:0};var u=void 0,g=void 0;if(a[0]>=200){g=a.shift()-105;var k=i.SWAP[g];k!==void 0?u=r.next(a,n+1,k):((o===i.SET_A||o===i.SET_B)&&g===i.SHIFT&&(a[0]=o===i.SET_A?a[0]>95?a[0]-96:a[0]:a[0]<32?a[0]+96:a[0]),u=r.next(a,n+1,o))}else g=r.correctIndex(a,o),u=r.next(a,n+1,o);var v=r.getBar(g),p=g*n;return{result:v+u.result,checksum:p+u.checksum}}}]),r})(b.default);return kt.default=l,kt}var yt={},Rr;function Os(){if(Rr)return yt;Rr=1,Object.defineProperty(yt,"__esModule",{value:!0});var d=xt(),f=function(h){return h.match(new RegExp("^"+d.A_CHARS+"*"))[0].length},b=function(h){return h.match(new RegExp("^"+d.B_CHARS+"*"))[0].length},i=function(h){return h.match(new RegExp("^"+d.C_CHARS+"*"))[0]};function c(x,h){var l=h?d.A_CHARS:d.B_CHARS,t=x.match(new RegExp("^("+l+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(t)return t[1]+"√å"+m(x.substring(t[1].length));var r=x.match(new RegExp("^"+l+"+"))[0];return r.length===x.length?x:r+String.fromCharCode(h?205:206)+c(x.substring(r.length),!h)}function m(x){var h=i(x),l=h.length;if(l===x.length)return x;x=x.substring(l);var t=f(x)>=b(x);return h+String.fromCharCode(t?206:205)+c(x,t)}return yt.default=function(x){var h=void 0,l=i(x).length;if(l>=2)h=d.C_START_CHAR+m(x);else{var t=f(x)>b(x);h=(t?d.A_START_CHAR:d.B_START_CHAR)+c(x,t)}return h.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(r,s){return"√ã"+s})},yt}var $r;function Ms(){if($r)return vt;$r=1,Object.defineProperty(vt,"__esModule",{value:!0});var d=ar(),f=c(d),b=Os(),i=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){if(m(this,r),/^[\x00-\x7F\xC8-\xD3]+$/.test(s))var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,(0,i.default)(s),a));else var n=x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a));return x(n)}return r})(f.default);return vt.default=l,vt}var jt={},Dr;function Ts(){if(Dr)return jt;Dr=1,Object.defineProperty(jt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=ar(),b=c(f),i=xt();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i.A_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+i.A_CHARS+"+$").test(this.data)}}]),r})(b.default);return jt.default=l,jt}var wt={},Ir;function Ls(){if(Ir)return wt;Ir=1,Object.defineProperty(wt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=ar(),b=c(f),i=xt();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i.B_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+i.B_CHARS+"+$").test(this.data)}}]),r})(b.default);return wt.default=l,wt}var Nt={},qr;function As(){if(qr)return Nt;qr=1,Object.defineProperty(Nt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=ar(),b=c(f),i=xt();function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i.C_START_CHAR+s,a))}return d(r,[{key:"valid",value:function(){return new RegExp("^"+i.C_CHARS+"+$").test(this.data)}}]),r})(b.default);return Nt.default=l,Nt}var Br;function Rs(){if(Br)return Ee;Br=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.CODE128C=Ee.CODE128B=Ee.CODE128A=Ee.CODE128=void 0;var d=Ms(),f=l(d),b=Ts(),i=l(b),c=Ls(),m=l(c),x=As(),h=l(x);function l(t){return t&&t.__esModule?t:{default:t}}return Ee.CODE128=f.default,Ee.CODE128A=i.default,Ee.CODE128B=m.default,Ee.CODE128C=h.default,Ee}var ke={},_t={},$e={},zr;function mt(){return zr||(zr=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.SIDE_BIN="101",$e.MIDDLE_BIN="01010",$e.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},$e.EAN2_STRUCTURE=["LL","LG","GL","GG"],$e.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],$e.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]),$e}var St={},Ct={},Fr;function ft(){if(Fr)return Ct;Fr=1,Object.defineProperty(Ct,"__esModule",{value:!0});var d=mt(),f=function(i,c,m){var x=i.split("").map(function(l,t){return d.BINARIES[c[t]]}).map(function(l,t){return l?l[i[t]]:""});if(m){var h=i.length-1;x=x.map(function(l,t){return t<h?l+m:l})}return x.join("")};return Ct.default=f,Ct}var Hr;function qa(){if(Hr)return St;Hr=1,Object.defineProperty(St,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var o=0;o<n.length;o++){var u=n[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,o){return n&&s(a.prototype,n),o&&s(a,o),a}})(),f=mt(),b=ft(),i=x(b),c=_e(),m=x(c);function x(s){return s&&s.__esModule?s:{default:s}}function h(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function l(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function t(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var r=(function(s){t(a,s);function a(n,o){h(this,a);var u=l(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,o));return u.fontSize=!o.flat&&o.fontSize>o.width*10?o.width*10:o.fontSize,u.guardHeight=o.height+u.fontSize/2+o.textMargin,u}return d(a,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(o,u){return this.text.substr(o,u)}},{key:"leftEncode",value:function(o,u){return(0,i.default)(o,u)}},{key:"rightText",value:function(o,u){return this.text.substr(o,u)}},{key:"rightEncode",value:function(o,u){return(0,i.default)(o,u)}},{key:"encodeGuarded",value:function(){var o={fontSize:this.fontSize},u={height:this.guardHeight};return[{data:f.SIDE_BIN,options:u},{data:this.leftEncode(),text:this.leftText(),options:o},{data:f.MIDDLE_BIN,options:u},{data:this.rightEncode(),text:this.rightText(),options:o},{data:f.SIDE_BIN,options:u}]}},{key:"encodeFlat",value:function(){var o=[f.SIDE_BIN,this.leftEncode(),f.MIDDLE_BIN,this.rightEncode(),f.SIDE_BIN];return{data:o.join(""),text:this.text}}}]),a})(m.default);return St.default=r,St}var Gr;function $s(){if(Gr)return _t;Gr=1,Object.defineProperty(_t,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var o=0;o<n.length;o++){var u=n[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,o){return n&&s(a.prototype,n),o&&s(a,o),a}})(),f=function s(a,n,o){a===null&&(a=Function.prototype);var u=Object.getOwnPropertyDescriptor(a,n);if(u===void 0){var g=Object.getPrototypeOf(a);return g===null?void 0:s(g,n,o)}else{if("value"in u)return u.value;var k=u.get;return k===void 0?void 0:k.call(o)}},b=mt(),i=qa(),c=m(i);function m(s){return s&&s.__esModule?s:{default:s}}function x(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function h(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function l(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var t=function(a){var n=a.substr(0,12).split("").map(function(o){return+o}).reduce(function(o,u,g){return g%2?o+u*3:o+u},0);return(10-n%10)%10},r=(function(s){l(a,s);function a(n,o){x(this,a),n.search(/^[0-9]{12}$/)!==-1&&(n+=t(n));var u=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,o));return u.lastChar=o.lastChar,u}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===t(this.data)}},{key:"leftText",value:function(){return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var o=this.data.substr(1,6),u=b.EAN13_STRUCTURE[this.data[0]];return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"leftEncode",this).call(this,o,u)}},{key:"rightText",value:function(){return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var o=this.data.substr(7,6);return f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"rightEncode",this).call(this,o,"RRRRRR")}},{key:"encodeGuarded",value:function(){var o=f(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(o.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(o.push({data:"00"}),o.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),o}}]),a})(c.default);return _t.default=r,_t}var Et={},Vr;function Ds(){if(Vr)return Et;Vr=1,Object.defineProperty(Et,"__esModule",{value:!0});var d=(function(){function r(s,a){for(var n=0;n<a.length;n++){var o=a[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,o.key,o)}}return function(s,a,n){return a&&r(s.prototype,a),n&&r(s,n),s}})(),f=function r(s,a,n){s===null&&(s=Function.prototype);var o=Object.getOwnPropertyDescriptor(s,a);if(o===void 0){var u=Object.getPrototypeOf(s);return u===null?void 0:r(u,a,n)}else{if("value"in o)return o.value;var g=o.get;return g===void 0?void 0:g.call(n)}},b=qa(),i=c(b);function c(r){return r&&r.__esModule?r:{default:r}}function m(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")}function x(r,s){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:r}function h(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(r,s):r.__proto__=s)}var l=function(s){var a=s.substr(0,7).split("").map(function(n){return+n}).reduce(function(n,o,u){return u%2?n+o:n+o*3},0);return(10-a%10)%10},t=(function(r){h(s,r);function s(a,n){return m(this,s),a.search(/^[0-9]{7}$/)!==-1&&(a+=l(a)),x(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a,n))}return d(s,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===l(this.data)}},{key:"leftText",value:function(){return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var n=this.data.substr(0,4);return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"leftEncode",this).call(this,n,"LLLL")}},{key:"rightText",value:function(){return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var n=this.data.substr(4,4);return f(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"rightEncode",this).call(this,n,"RRRR")}}]),s})(i.default);return Et.default=t,Et}var Pt={},Ur;function Is(){if(Ur)return Pt;Ur=1,Object.defineProperty(Pt,"__esModule",{value:!0});var d=(function(){function a(n,o){for(var u=0;u<o.length;u++){var g=o[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(n,o,u){return o&&a(n.prototype,o),u&&a(n,u),n}})(),f=mt(),b=ft(),i=x(b),c=_e(),m=x(c);function x(a){return a&&a.__esModule?a:{default:a}}function h(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function l(a,n){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n&&(typeof n=="object"||typeof n=="function")?n:a}function t(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof n);a.prototype=Object.create(n&&n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(a,n):a.__proto__=n)}var r=function(n){var o=n.split("").map(function(u){return+u}).reduce(function(u,g,k){return k%2?u+g*9:u+g*3},0);return o%10},s=(function(a){t(n,a);function n(o,u){return h(this,n),l(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,o,u))}return d(n,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var u=f.EAN5_STRUCTURE[r(this.data)];return{data:"1011"+(0,i.default)(this.data,u,"01"),text:this.text}}}]),n})(m.default);return Pt.default=s,Pt}var Ot={},Kr;function qs(){if(Kr)return Ot;Kr=1,Object.defineProperty(Ot,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var o=0;o<n.length;o++){var u=n[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,o){return n&&s(a.prototype,n),o&&s(a,o),a}})(),f=mt(),b=ft(),i=x(b),c=_e(),m=x(c);function x(s){return s&&s.__esModule?s:{default:s}}function h(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function l(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function t(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var r=(function(s){t(a,s);function a(n,o){return h(this,a),l(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,o))}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var o=f.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,i.default)(this.data,o,"01"),text:this.text}}}]),a})(m.default);return Ot.default=r,Ot}var st={},Xr;function Ba(){if(Xr)return st;Xr=1,Object.defineProperty(st,"__esModule",{value:!0});var d=(function(){function s(a,n){for(var o=0;o<n.length;o++){var u=n[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}return function(a,n,o){return n&&s(a.prototype,n),o&&s(a,o),a}})();st.checksum=r;var f=ft(),b=m(f),i=_e(),c=m(i);function m(s){return s&&s.__esModule?s:{default:s}}function x(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function h(s,a){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:s}function l(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(s,a):s.__proto__=a)}var t=(function(s){l(a,s);function a(n,o){x(this,a),n.search(/^[0-9]{11}$/)!==-1&&(n+=r(n));var u=h(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n,o));return u.displayValue=o.displayValue,o.fontSize>o.width*10?u.fontSize=o.width*10:u.fontSize=o.fontSize,u.guardHeight=o.height+u.fontSize/2+o.textMargin,u}return d(a,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==r(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var o="";return o+="101",o+=(0,b.default)(this.data.substr(0,6),"LLLLLL"),o+="01010",o+=(0,b.default)(this.data.substr(6,6),"RRRRRR"),o+="101",{data:o,text:this.text}}},{key:"guardedEncoding",value:function(){var o=[];return this.displayValue&&o.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),o.push({data:"101"+(0,b.default)(this.data[0],"L"),options:{height:this.guardHeight}}),o.push({data:(0,b.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),o.push({data:"01010",options:{height:this.guardHeight}}),o.push({data:(0,b.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),o.push({data:(0,b.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&o.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),o}}]),a})(c.default);function r(s){var a=0,n;for(n=1;n<11;n+=2)a+=parseInt(s[n]);for(n=0;n<11;n+=2)a+=parseInt(s[n])*3;return(10-a%10)%10}return st.default=t,st}var Mt={},Wr;function Bs(){if(Wr)return Mt;Wr=1,Object.defineProperty(Mt,"__esModule",{value:!0});var d=(function(){function o(u,g){for(var k=0;k<g.length;k++){var v=g[k];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(u,v.key,v)}}return function(u,g,k){return g&&o(u.prototype,g),k&&o(u,k),u}})(),f=ft(),b=x(f),i=_e(),c=x(i),m=Ba();function x(o){return o&&o.__esModule?o:{default:o}}function h(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")}function l(o,u){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:o}function t(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(o,u):o.__proto__=u)}var r=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],s=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],a=(function(o){t(u,o);function u(g,k){h(this,u);var v=l(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,g,k));if(v.isValid=!1,g.search(/^[0-9]{6}$/)!==-1)v.middleDigits=g,v.upcA=n(g,"0"),v.text=k.text||""+v.upcA[0]+g+v.upcA[v.upcA.length-1],v.isValid=!0;else if(g.search(/^[01][0-9]{7}$/)!==-1)if(v.middleDigits=g.substring(1,g.length-1),v.upcA=n(v.middleDigits,g[0]),v.upcA[v.upcA.length-1]===g[g.length-1])v.isValid=!0;else return l(v);else return l(v);return v.displayValue=k.displayValue,k.fontSize>k.width*10?v.fontSize=k.width*10:v.fontSize=k.fontSize,v.guardHeight=k.height+v.fontSize/2+k.textMargin,v}return d(u,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var k="";return k+="101",k+=this.encodeMiddleDigits(),k+="010101",{data:k,text:this.text}}},{key:"guardedEncoding",value:function(){var k=[];return this.displayValue&&k.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),k.push({data:"101",options:{height:this.guardHeight}}),k.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),k.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&k.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),k}},{key:"encodeMiddleDigits",value:function(){var k=this.upcA[0],v=this.upcA[this.upcA.length-1],p=s[parseInt(v)][parseInt(k)];return(0,b.default)(this.middleDigits,p)}}]),u})(c.default);function n(o,u){for(var g=parseInt(o[o.length-1]),k=r[g],v="",p=0,_=0;_<k.length;_++){var O=k[_];O==="X"?v+=o[p++]:v+=O}return v=""+u+v,""+v+(0,m.checksum)(v)}return Mt.default=a,Mt}var Qr;function zs(){if(Qr)return ke;Qr=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.UPCE=ke.UPC=ke.EAN2=ke.EAN5=ke.EAN8=ke.EAN13=void 0;var d=$s(),f=a(d),b=Ds(),i=a(b),c=Is(),m=a(c),x=qs(),h=a(x),l=Ba(),t=a(l),r=Bs(),s=a(r);function a(n){return n&&n.__esModule?n:{default:n}}return ke.EAN13=f.default,ke.EAN8=i.default,ke.EAN5=m.default,ke.EAN2=h.default,ke.UPC=t.default,ke.UPCE=s.default,ke}var ze={},Tt={},Ye={},Yr;function Fs(){return Yr||(Yr=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.START_BIN="1010",Ye.END_BIN="11101",Ye.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]),Ye}var Jr;function za(){if(Jr)return Tt;Jr=1,Object.defineProperty(Tt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=Fs(),b=_e(),i=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return d(r,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var a=this,n=this.data.match(/.{2}/g).map(function(o){return a.encodePair(o)}).join("");return{data:f.START_BIN+n+f.END_BIN,text:this.text}}},{key:"encodePair",value:function(a){var n=f.BINARIES[a[1]];return f.BINARIES[a[0]].split("").map(function(o,u){return(o==="1"?"111":"1")+(n[u]==="1"?"000":"0")}).join("")}}]),r})(i.default);return Tt.default=l,Tt}var Lt={},Zr;function Hs(){if(Zr)return Lt;Zr=1,Object.defineProperty(Lt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=za(),b=i(f);function i(t){return t&&t.__esModule?t:{default:t}}function c(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function m(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function x(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var h=function(r){var s=r.substr(0,13).split("").map(function(a){return parseInt(a,10)}).reduce(function(a,n,o){return a+n*(3-o%2*2)},0);return Math.ceil(s/10)*10-s},l=(function(t){x(r,t);function r(s,a){return c(this,r),s.search(/^[0-9]{13}$/)!==-1&&(s+=h(s)),m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===h(this.data)}}]),r})(b.default);return Lt.default=l,Lt}var ea;function Gs(){if(ea)return ze;ea=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.ITF14=ze.ITF=void 0;var d=za(),f=c(d),b=Hs(),i=c(b);function c(m){return m&&m.__esModule?m:{default:m}}return ze.ITF=f.default,ze.ITF14=i.default,ze}var we={},At={},ta;function bt(){if(ta)return At;ta=1,Object.defineProperty(At,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=_e(),b=i(f);function i(t){return t&&t.__esModule?t:{default:t}}function c(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function m(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function x(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var h=(function(t){x(r,t);function r(s,a){return c(this,r),m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"encode",value:function(){for(var a="110",n=0;n<this.data.length;n++){var o=parseInt(this.data[n]),u=o.toString(2);u=l(u,4-u.length);for(var g=0;g<u.length;g++)a+=u[g]=="0"?"100":"110"}return a+="1001",{data:a,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),r})(b.default);function l(t,r){for(var s=0;s<r;s++)t="0"+t;return t}return At.default=h,At}var Rt={},nt={},ra;function sr(){if(ra)return nt;ra=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.mod10=d,nt.mod11=f;function d(b){for(var i=0,c=0;c<b.length;c++){var m=parseInt(b[c]);(c+b.length)%2===0?i+=m:i+=m*2%10+Math.floor(m*2/10)}return(10-i%10)%10}function f(b){for(var i=0,c=[2,3,4,5,6,7],m=0;m<b.length;m++){var x=parseInt(b[b.length-1-m]);i+=c[m%c.length]*x}return(11-i%11)%11}return nt}var aa;function Vs(){if(aa)return Rt;aa=1,Object.defineProperty(Rt,"__esModule",{value:!0});var d=bt(),f=i(d),b=sr();function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r+(0,b.mod10)(r),s))}return t})(f.default);return Rt.default=h,Rt}var $t={},sa;function Us(){if(sa)return $t;sa=1,Object.defineProperty($t,"__esModule",{value:!0});var d=bt(),f=i(d),b=sr();function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r+(0,b.mod11)(r),s))}return t})(f.default);return $t.default=h,$t}var Dt={},na;function Ks(){if(na)return Dt;na=1,Object.defineProperty(Dt,"__esModule",{value:!0});var d=bt(),f=i(d),b=sr();function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),r+=(0,b.mod10)(r),r+=(0,b.mod10)(r),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return t})(f.default);return Dt.default=h,Dt}var It={},la;function Xs(){if(la)return It;la=1,Object.defineProperty(It,"__esModule",{value:!0});var d=bt(),f=i(d),b=sr();function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),r+=(0,b.mod11)(r),r+=(0,b.mod10)(r),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return t})(f.default);return It.default=h,It}var oa;function Ws(){if(oa)return we;oa=1,Object.defineProperty(we,"__esModule",{value:!0}),we.MSI1110=we.MSI1010=we.MSI11=we.MSI10=we.MSI=void 0;var d=bt(),f=r(d),b=Vs(),i=r(b),c=Us(),m=r(c),x=Ks(),h=r(x),l=Xs(),t=r(l);function r(s){return s&&s.__esModule?s:{default:s}}return we.MSI=f.default,we.MSI10=i.default,we.MSI11=m.default,we.MSI1010=h.default,we.MSI1110=t.default,we}var lt={},ia;function Qs(){if(ia)return lt;ia=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.pharmacode=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=_e(),b=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){c(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s));return a.number=parseInt(r,10),a}return d(t,[{key:"encode",value:function(){for(var s=this.number,a="";!isNaN(s)&&s!=0;)s%2===0?(a="11100"+a,s=(s-2)/2):(a="100"+a,s=(s-1)/2);return a=a.slice(0,-2),{data:a,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t})(b.default);return lt.pharmacode=h,lt}var ot={},da;function Ys(){if(da)return ot;da=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.codabar=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=_e(),b=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){c(this,t),r.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(r="A"+r+"A");var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.toUpperCase(),s));return a.text=a.options.text||a.text.replace(/[A-D]/g,""),a}return d(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var s=[],a=this.getEncodings(),n=0;n<this.data.length;n++)s.push(a[this.data.charAt(n)]),n!==this.data.length-1&&s.push("0");return{text:this.text,data:s.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t})(b.default);return ot.codabar=h,ot}var Fe={},qt={},Je={},ca;function Js(){return ca||(ca=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","√ø"],Je.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],Je.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"":["(%)","T"]}),Je}var ua;function Fa(){if(ua)return qt;ua=1,Object.defineProperty(qt,"__esModule",{value:!0});var d=(function(){function t(r,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(r,s,a){return s&&t(r.prototype,s),a&&t(r,a),r}})(),f=Js(),b=_e(),i=c(b);function c(t){return t&&t.__esModule?t:{default:t}}function m(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function x(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&(typeof r=="object"||typeof r=="function")?r:t}function h(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=(function(t){h(r,t);function r(s,a){return m(this,r),x(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,s,a))}return d(r,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var a=this.data.split("").flatMap(function(g){return f.MULTI_SYMBOLS[g]||g}),n=a.map(function(g){return r.getEncoding(g)}).join(""),o=r.checksum(a,20),u=r.checksum(a.concat(o),15);return{text:this.text,data:r.getEncoding("√ø")+n+r.getEncoding(o)+r.getEncoding(u)+r.getEncoding("√ø")+"1"}}}],[{key:"getEncoding",value:function(a){return f.BINARIES[r.symbolValue(a)]}},{key:"getSymbol",value:function(a){return f.SYMBOLS[a]}},{key:"symbolValue",value:function(a){return f.SYMBOLS.indexOf(a)}},{key:"checksum",value:function(a,n){var o=a.slice().reverse().reduce(function(u,g,k){var v=k%n+1;return u+r.symbolValue(g)*v},0);return r.getSymbol(o%47)}}]),r})(i.default);return qt.default=l,qt}var Bt={},ha;function Zs(){if(ha)return Bt;ha=1,Object.defineProperty(Bt,"__esModule",{value:!0});var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=Fa(),b=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return d(t,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),t})(b.default);return Bt.default=h,Bt}var xa;function en(){if(xa)return Fe;xa=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.CODE93FullASCII=Fe.CODE93=void 0;var d=Fa(),f=c(d),b=Zs(),i=c(b);function c(m){return m&&m.__esModule?m:{default:m}}return Fe.CODE93=f.default,Fe.CODE93FullASCII=i.default,Fe}var it={},ma;function tn(){if(ma)return it;ma=1,Object.defineProperty(it,"__esModule",{value:!0}),it.GenericBarcode=void 0;var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=_e(),b=i(f);function i(l){return l&&l.__esModule?l:{default:l}}function c(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}function m(l,t){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:l}function x(l,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);l.prototype=Object.create(t&&t.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(l,t):l.__proto__=t)}var h=(function(l){x(t,l);function t(r,s){return c(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,s))}return d(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t})(b.default);return it.GenericBarcode=h,it}var fa;function rn(){if(fa)return gt;fa=1,Object.defineProperty(gt,"__esModule",{value:!0});var d=Ps(),f=Rs(),b=zs(),i=Gs(),c=Ws(),m=Qs(),x=Ys(),h=en(),l=tn();return gt.default={CODE39:d.CODE39,CODE128:f.CODE128,CODE128A:f.CODE128A,CODE128B:f.CODE128B,CODE128C:f.CODE128C,EAN13:b.EAN13,EAN8:b.EAN8,EAN5:b.EAN5,EAN2:b.EAN2,UPC:b.UPC,UPCE:b.UPCE,ITF14:i.ITF14,ITF:i.ITF,MSI:c.MSI,MSI10:c.MSI10,MSI11:c.MSI11,MSI1010:c.MSI1010,MSI1110:c.MSI1110,pharmacode:m.pharmacode,codabar:x.codabar,CODE93:h.CODE93,CODE93FullASCII:h.CODE93FullASCII,GenericBarcode:l.GenericBarcode},gt}var zt={},ba;function nr(){if(ba)return zt;ba=1,Object.defineProperty(zt,"__esModule",{value:!0});var d=Object.assign||function(f){for(var b=1;b<arguments.length;b++){var i=arguments[b];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(f[c]=i[c])}return f};return zt.default=function(f,b){return d({},f,b)},zt}var Ft={},ga;function an(){if(ga)return Ft;ga=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.default=d;function d(f){var b=[];function i(c){if(Array.isArray(c))for(var m=0;m<c.length;m++)i(c[m]);else c.text=c.text||"",c.data=c.data||"",b.push(c)}return i(f),b}return Ft}var Ht={},pa;function sn(){if(pa)return Ht;pa=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.default=d;function d(f){return f.marginTop=f.marginTop||f.margin,f.marginBottom=f.marginBottom||f.margin,f.marginRight=f.marginRight||f.margin,f.marginLeft=f.marginLeft||f.margin,f}return Ht}var Gt={},Vt={},Ut={},va;function Ha(){if(va)return Ut;va=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=d;function d(f){var b=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var i in b)b.hasOwnProperty(i)&&(i=b[i],typeof f[i]=="string"&&(f[i]=parseInt(f[i],10)));return typeof f.displayValue=="string"&&(f.displayValue=f.displayValue!="false"),f}return Ut}var Kt={},ka;function Ga(){if(ka)return Kt;ka=1,Object.defineProperty(Kt,"__esModule",{value:!0});var d={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};return Kt.default=d,Kt}var ya;function nn(){if(ya)return Vt;ya=1,Object.defineProperty(Vt,"__esModule",{value:!0});var d=Ha(),f=c(d),b=Ga(),i=c(b);function c(x){return x&&x.__esModule?x:{default:x}}function m(x){var h={};for(var l in i.default)i.default.hasOwnProperty(l)&&(x.hasAttribute("jsbarcode-"+l.toLowerCase())&&(h[l]=x.getAttribute("jsbarcode-"+l.toLowerCase())),x.hasAttribute("data-"+l.toLowerCase())&&(h[l]=x.getAttribute("data-"+l.toLowerCase())));return h.value=x.getAttribute("jsbarcode-value")||x.getAttribute("data-value"),h=(0,f.default)(h),h}return Vt.default=m,Vt}var Xt={},Wt={},Ne={},ja;function Va(){if(ja)return Ne;ja=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.getTotalWidthOfEncodings=Ne.calculateEncodingAttributes=Ne.getBarcodePadding=Ne.getEncodingHeight=Ne.getMaximumHeightOfEncodings=void 0;var d=nr(),f=b(d);function b(t){return t&&t.__esModule?t:{default:t}}function i(t,r){return r.height+(r.displayValue&&t.text.length>0?r.fontSize+r.textMargin:0)+r.marginTop+r.marginBottom}function c(t,r,s){if(s.displayValue&&r<t){if(s.textAlign=="center")return Math.floor((t-r)/2);if(s.textAlign=="left")return 0;if(s.textAlign=="right")return Math.floor(t-r)}return 0}function m(t,r,s){for(var a=0;a<t.length;a++){var n=t[a],o=(0,f.default)(r,n.options),u;o.displayValue?u=l(n.text,o,s):u=0;var g=n.data.length*o.width;n.width=Math.ceil(Math.max(u,g)),n.height=i(n,o),n.barcodePadding=c(u,g,o)}}function x(t){for(var r=0,s=0;s<t.length;s++)r+=t[s].width;return r}function h(t){for(var r=0,s=0;s<t.length;s++)t[s].height>r&&(r=t[s].height);return r}function l(t,r,s){var a;if(s)a=s;else if(typeof document<"u")a=document.createElement("canvas").getContext("2d");else return 0;a.font=r.fontOptions+" "+r.fontSize+"px "+r.font;var n=a.measureText(t);if(!n)return 0;var o=n.width;return o}return Ne.getMaximumHeightOfEncodings=h,Ne.getEncodingHeight=i,Ne.getBarcodePadding=c,Ne.calculateEncodingAttributes=m,Ne.getTotalWidthOfEncodings=x,Ne}var wa;function ln(){if(wa)return Wt;wa=1,Object.defineProperty(Wt,"__esModule",{value:!0});var d=(function(){function h(l,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,s.key,s)}}return function(l,t,r){return t&&h(l.prototype,t),r&&h(l,r),l}})(),f=nr(),b=c(f),i=Va();function c(h){return h&&h.__esModule?h:{default:h}}function m(h,l){if(!(h instanceof l))throw new TypeError("Cannot call a class as a function")}var x=(function(){function h(l,t,r){m(this,h),this.canvas=l,this.encodings=t,this.options=r}return d(h,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var t=0;t<this.encodings.length;t++){var r=(0,b.default)(this.options,this.encodings[t].options);this.drawCanvasBarcode(r,this.encodings[t]),this.drawCanvasText(r,this.encodings[t]),this.moveCanvasDrawing(this.encodings[t])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var t=this.canvas.getContext("2d");t.save(),(0,i.calculateEncodingAttributes)(this.encodings,this.options,t);var r=(0,i.getTotalWidthOfEncodings)(this.encodings),s=(0,i.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=r+this.options.marginLeft+this.options.marginRight,this.canvas.height=s,t.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(t.fillStyle=this.options.background,t.fillRect(0,0,this.canvas.width,this.canvas.height)),t.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(t,r){var s=this.canvas.getContext("2d"),a=r.data,n;t.textPosition=="top"?n=t.marginTop+t.fontSize+t.textMargin:n=t.marginTop,s.fillStyle=t.lineColor;for(var o=0;o<a.length;o++){var u=o*t.width+r.barcodePadding;a[o]==="1"?s.fillRect(u,n,t.width,t.height):a[o]&&s.fillRect(u,n,t.width,t.height*a[o])}}},{key:"drawCanvasText",value:function(t,r){var s=this.canvas.getContext("2d"),a=t.fontOptions+" "+t.fontSize+"px "+t.font;if(t.displayValue){var n,o;t.textPosition=="top"?o=t.marginTop+t.fontSize-t.textMargin:o=t.height+t.textMargin+t.marginTop+t.fontSize,s.font=a,t.textAlign=="left"||r.barcodePadding>0?(n=0,s.textAlign="left"):t.textAlign=="right"?(n=r.width-1,s.textAlign="right"):(n=r.width/2,s.textAlign="center"),s.fillText(r.text,n,o)}}},{key:"moveCanvasDrawing",value:function(t){var r=this.canvas.getContext("2d");r.translate(t.width,0)}},{key:"restoreCanvas",value:function(){var t=this.canvas.getContext("2d");t.restore()}}]),h})();return Wt.default=x,Wt}var Qt={},Na;function on(){if(Na)return Qt;Na=1,Object.defineProperty(Qt,"__esModule",{value:!0});var d=(function(){function l(t,r){for(var s=0;s<r.length;s++){var a=r[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,s){return r&&l(t.prototype,r),s&&l(t,s),t}})(),f=nr(),b=c(f),i=Va();function c(l){return l&&l.__esModule?l:{default:l}}function m(l,t){if(!(l instanceof t))throw new TypeError("Cannot call a class as a function")}var x="http://www.w3.org/2000/svg",h=(function(){function l(t,r,s){m(this,l),this.svg=t,this.encodings=r,this.options=s,this.document=s.xmlDocument||document}return d(l,[{key:"render",value:function(){var r=this.options.marginLeft;this.prepareSVG();for(var s=0;s<this.encodings.length;s++){var a=this.encodings[s],n=(0,b.default)(this.options,a.options),o=this.createGroup(r,n.marginTop,this.svg);this.setGroupOptions(o,n),this.drawSvgBarcode(o,n,a),this.drawSVGText(o,n,a),r+=a.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,i.calculateEncodingAttributes)(this.encodings,this.options);var r=(0,i.getTotalWidthOfEncodings)(this.encodings),s=(0,i.getMaximumHeightOfEncodings)(this.encodings),a=r+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(a,s),this.options.background&&this.drawRect(0,0,a,s,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(r,s,a){var n=a.data,o;s.textPosition=="top"?o=s.fontSize+s.textMargin:o=0;for(var u=0,g=0,k=0;k<n.length;k++)g=k*s.width+a.barcodePadding,n[k]==="1"?u++:u>0&&(this.drawRect(g-s.width*u,o,s.width*u,s.height,r),u=0);u>0&&this.drawRect(g-s.width*(u-1),o,s.width*u,s.height,r)}},{key:"drawSVGText",value:function(r,s,a){var n=this.document.createElementNS(x,"text");if(s.displayValue){var o,u;n.setAttribute("style","font:"+s.fontOptions+" "+s.fontSize+"px "+s.font),s.textPosition=="top"?u=s.fontSize-s.textMargin:u=s.height+s.textMargin+s.fontSize,s.textAlign=="left"||a.barcodePadding>0?(o=0,n.setAttribute("text-anchor","start")):s.textAlign=="right"?(o=a.width-1,n.setAttribute("text-anchor","end")):(o=a.width/2,n.setAttribute("text-anchor","middle")),n.setAttribute("x",o),n.setAttribute("y",u),n.appendChild(this.document.createTextNode(a.text)),r.appendChild(n)}}},{key:"setSvgAttributes",value:function(r,s){var a=this.svg;a.setAttribute("width",r+"px"),a.setAttribute("height",s+"px"),a.setAttribute("x","0px"),a.setAttribute("y","0px"),a.setAttribute("viewBox","0 0 "+r+" "+s),a.setAttribute("xmlns",x),a.setAttribute("version","1.1"),a.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(r,s,a){var n=this.document.createElementNS(x,"g");return n.setAttribute("transform","translate("+r+", "+s+")"),a.appendChild(n),n}},{key:"setGroupOptions",value:function(r,s){r.setAttribute("style","fill:"+s.lineColor+";")}},{key:"drawRect",value:function(r,s,a,n,o){var u=this.document.createElementNS(x,"rect");return u.setAttribute("x",r),u.setAttribute("y",s),u.setAttribute("width",a),u.setAttribute("height",n),o.appendChild(u),u}}]),l})();return Qt.default=h,Qt}var Yt={},_a;function dn(){if(_a)return Yt;_a=1,Object.defineProperty(Yt,"__esModule",{value:!0});var d=(function(){function i(c,m){for(var x=0;x<m.length;x++){var h=m[x];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,m,x){return m&&i(c.prototype,m),x&&i(c,x),c}})();function f(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}var b=(function(){function i(c,m,x){f(this,i),this.object=c,this.encodings=m,this.options=x}return d(i,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),i})();return Yt.default=b,Yt}var Sa;function cn(){if(Sa)return Xt;Sa=1,Object.defineProperty(Xt,"__esModule",{value:!0});var d=ln(),f=x(d),b=on(),i=x(b),c=dn(),m=x(c);function x(h){return h&&h.__esModule?h:{default:h}}return Xt.default={CanvasRenderer:f.default,SVGRenderer:i.default,ObjectRenderer:m.default},Xt}var Ze={},Ca;function Ua(){if(Ca)return Ze;Ca=1,Object.defineProperty(Ze,"__esModule",{value:!0});function d(x,h){if(!(x instanceof h))throw new TypeError("Cannot call a class as a function")}function f(x,h){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:x}function b(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);x.prototype=Object.create(h&&h.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(x,h):x.__proto__=h)}var i=(function(x){b(h,x);function h(l,t){d(this,h);var r=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return r.name="InvalidInputException",r.symbology=l,r.input=t,r.message='"'+r.input+'" is not a valid input for '+r.symbology,r}return h})(Error),c=(function(x){b(h,x);function h(){d(this,h);var l=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return l.name="InvalidElementException",l.message="Not supported type to render on",l}return h})(Error),m=(function(x){b(h,x);function h(){d(this,h);var l=f(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));return l.name="NoElementException",l.message="No element to render on.",l}return h})(Error);return Ze.InvalidInputException=i,Ze.InvalidElementException=c,Ze.NoElementException=m,Ze}var Ea;function un(){if(Ea)return Gt;Ea=1,Object.defineProperty(Gt,"__esModule",{value:!0});var d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},f=nn(),b=x(f),i=cn(),c=x(i),m=Ua();function x(r){return r&&r.__esModule?r:{default:r}}function h(r){if(typeof r=="string")return l(r);if(Array.isArray(r)){for(var s=[],a=0;a<r.length;a++)s.push(h(r[a]));return s}else{if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLImageElement)return t(r);if(r&&r.nodeName&&r.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&r instanceof SVGElement)return{element:r,options:(0,b.default)(r),renderer:c.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement)return{element:r,options:(0,b.default)(r),renderer:c.default.CanvasRenderer};if(r&&r.getContext)return{element:r,renderer:c.default.CanvasRenderer};if(r&&(typeof r>"u"?"undefined":d(r))==="object"&&!r.nodeName)return{element:r,renderer:c.default.ObjectRenderer};throw new m.InvalidElementException}}function l(r){var s=document.querySelectorAll(r);if(s.length!==0){for(var a=[],n=0;n<s.length;n++)a.push(h(s[n]));return a}}function t(r){var s=document.createElement("canvas");return{element:s,options:(0,b.default)(r),renderer:c.default.CanvasRenderer,afterRender:function(){r.setAttribute("src",s.toDataURL())}}}return Gt.default=h,Gt}var Jt={},Pa;function hn(){if(Pa)return Jt;Pa=1,Object.defineProperty(Jt,"__esModule",{value:!0});var d=(function(){function i(c,m){for(var x=0;x<m.length;x++){var h=m[x];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,m,x){return m&&i(c.prototype,m),x&&i(c,x),c}})();function f(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}var b=(function(){function i(c){f(this,i),this.api=c}return d(i,[{key:"handleCatch",value:function(m){if(m.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw m.message;else throw m;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(m){try{var x=m.apply(void 0,arguments);return this.api._options.valid(!0),x}catch(h){return this.handleCatch(h),this.api}}}]),i})();return Jt.default=b,Jt}var cr,Oa;function xn(){if(Oa)return cr;Oa=1;var d=rn(),f=k(d),b=nr(),i=k(b),c=an(),m=k(c),x=sn(),h=k(x),l=un(),t=k(l),r=Ha(),s=k(r),a=hn(),n=k(a),o=Ua(),u=Ga(),g=k(u);function k(S){return S&&S.__esModule?S:{default:S}}var v=function(){},p=function(T,R,P){var I=new v;if(typeof T>"u")throw Error("No element to render on was provided.");return I._renderProperties=(0,t.default)(T),I._encodings=[],I._options=g.default,I._errorHandler=new n.default(I),typeof R<"u"&&(P=P||{},P.format||(P.format=E()),I.options(P)[P.format](R,P).render()),I};p.getModule=function(S){return f.default[S]};for(var _ in f.default)f.default.hasOwnProperty(_)&&O(f.default,_);function O(S,T){v.prototype[T]=v.prototype[T.toUpperCase()]=v.prototype[T.toLowerCase()]=function(R,P){var I=this;return I._errorHandler.wrapBarcodeCall(function(){P.text=typeof P.text>"u"?void 0:""+P.text;var A=(0,i.default)(I._options,P);A=(0,s.default)(A);var H=S[T],U=D(R,H,A);return I._encodings.push(U),I})}}function D(S,T,R){S=""+S;var P=new T(S,R);if(!P.valid())throw new o.InvalidInputException(P.constructor.name,S);var I=P.encode();I=(0,m.default)(I);for(var A=0;A<I.length;A++)I[A].options=(0,i.default)(R,I[A].options);return I}function E(){return f.default.CODE128?"CODE128":Object.keys(f.default)[0]}v.prototype.options=function(S){return this._options=(0,i.default)(this._options,S),this},v.prototype.blank=function(S){var T=new Array(S+1).join("0");return this._encodings.push({data:T}),this},v.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var S;for(var T in this._renderProperties){S=this._renderProperties[T];var R=(0,i.default)(this._options,S.options);R.format=="auto"&&(R.format=E()),this._errorHandler.wrapBarcodeCall(function(){var P=R.value,I=f.default[R.format.toUpperCase()],A=D(P,I,R);C(S,A,R)})}}},v.prototype.render=function(){if(!this._renderProperties)throw new o.NoElementException;if(Array.isArray(this._renderProperties))for(var S=0;S<this._renderProperties.length;S++)C(this._renderProperties[S],this._encodings,this._options);else C(this._renderProperties,this._encodings,this._options);return this},v.prototype._defaults=g.default;function C(S,T,R){T=(0,m.default)(T);for(var P=0;P<T.length;P++)T[P].options=(0,i.default)(R,T[P].options),(0,h.default)(T[P].options);(0,h.default)(R);var I=S.renderer,A=new I(S.element,T,R);A.render(),S.afterRender&&S.afterRender()}return typeof window<"u"&&(window.JsBarcode=p),typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(S,T){var R=[];return jQuery(this).each(function(){R.push(this)}),p(R,S,T)}),cr=p,cr}var mn=xn();const tt=es(mn),ur={"30x20":{width:30,height:20,name:"30√ó20mm (nh·ªè)",barcodeHeight:25,fontSize:7},"40x30":{width:40,height:30,name:"40√ó30mm (ph·ªï bi·∫øn)",barcodeHeight:35,fontSize:8},"50x30":{width:50,height:30,name:"50√ó30mm (v·ª´a)",barcodeHeight:40,fontSize:9},"60x40":{width:60,height:40,name:"60√ó40mm (l·ªõn)",barcodeHeight:45,fontSize:10},"80x50":{width:80,height:50,name:"80√ó50mm (max)",barcodeHeight:55,fontSize:12}},fn=({part:d,currentBranchId:f,onClose:b})=>{const i=y.useRef(null),c=y.useRef(null),[m,x]=y.useState(1),[h,l]=y.useState(!0),[t,r]=y.useState(!0),[s,a]=y.useState("40x30"),[n,o]=y.useState("CODE128"),[u,g]=y.useState(1),k=d.barcode||d.sku||d.id.slice(0,12),v=ur[s];y.useEffect(()=>{if(i.current)try{const _=Math.max(1,(v.width-10)/50);tt(i.current,k,{format:n,width:_,height:v.barcodeHeight,displayValue:!0,fontSize:v.fontSize,margin:2,textMargin:1,font:"monospace"})}catch(_){console.error("Barcode generation error:",_),tt(i.current,k,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}},[k,n,s,v]);const p=()=>{if(!c.current)return;const O=window.open("","_blank");if(!O){alert("Vui l√≤ng cho ph√©p popup ƒë·ªÉ in");return}const D=Math.floor(v.width/3),E=d.name.length>D?d.name.slice(0,D)+"...":d.name,C=Array(m).fill(null).map(()=>{var S;return`
        <div class="label" style="
          width: ${v.width}mm;
          height: ${v.height}mm;
          padding: 1mm;
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          page-break-inside: avoid;
          box-sizing: border-box;
          overflow: hidden;
        ">
          ${t?`<div style="font-size: ${v.fontSize-1}px; font-weight: bold; text-align: center; line-height: 1.1; max-width: 100%; overflow: hidden; white-space: nowrap;">${E}</div>`:""}
          ${((S=i.current)==null?void 0:S.outerHTML)||""}
          ${h?`<div style="font-size: ${v.fontSize}px; font-weight: bold; line-height: 1;">${X(d.retailPrice[f]||0)}</div>`:""}
        </div>
      `}).join("");O.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>In m√£ v·∫°ch - ${d.name}</title>
          <style>
            @page {
              size: ${v.width}mm ${v.height}mm;
              margin: 0;
            }
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            body {
              font-family: Arial, sans-serif;
              margin: 0;
              padding: 0;
              width: ${v.width*u}mm;
            }
            .labels-container {
              display: flex;
              flex-wrap: wrap;
              width: 100%;
            }
            .label {
              border: none;
            }
            svg {
              max-width: ${v.width-4}mm !important;
              height: auto !important;
            }
            @media print {
              body { 
                margin: 0; 
                padding: 0;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
              }
              .label { 
                page-break-after: always;
              }
              .label:last-child {
                page-break-after: avoid;
              }
            }
          </style>
        </head>
        <body>
          <div class="labels-container">
            ${C}
          </div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                window.onafterprint = function() { window.close(); };
              }, 200);
            };
          <\/script>
        </body>
      </html>
    `),O.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(tr,{className:"w-5 h-5 text-blue-600"}),"In m√£ v·∫°ch n·ªôi b·ªô"]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:"Xprinter XP-360B (20-82mm)"})]}),e.jsx("button",{onClick:b,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(mr,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:d.name}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono mt-1",children:["M√£: ",k]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 font-semibold mt-1",children:X(d.retailPrice[f]||0)})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 flex flex-col items-center bg-white",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["Xem tr∆∞·ªõc nh√£n (",v.name,")"]}),e.jsxs("div",{ref:c,className:"border-2 border-dashed border-slate-300 rounded flex flex-col items-center justify-center bg-white",style:{width:`${v.width}mm`,height:`${v.height}mm`,padding:"1mm"},children:[t&&e.jsx("p",{className:"font-bold text-center text-slate-900 truncate max-w-full leading-tight",style:{fontSize:`${v.fontSize-1}px`},children:d.name.length>Math.floor(v.width/3)?d.name.slice(0,Math.floor(v.width/3))+"...":d.name}),e.jsx("svg",{ref:i,className:"max-w-full"}),h&&e.jsx("p",{className:"font-bold text-slate-900 leading-tight",style:{fontSize:`${v.fontSize}px`},children:X(d.retailPrice[f]||0)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"K√≠ch th∆∞·ªõc nh√£n (ph√π h·ª£p XP-360B)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(ur).map(_=>e.jsx("button",{onClick:()=>a(_),className:`px-3 py-2 text-xs rounded-lg transition-colors text-left ${s===_?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:ur[_].name},_))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"S·ªë l∆∞·ª£ng nh√£n"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(Math.max(1,m-1)),className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(ms,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:m,onChange:_=>x(Math.max(1,parseInt(_.target.value)||1)),className:"w-16 text-center px-2 py-1 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"1",max:"100"}),e.jsx("button",{onClick:()=>x(Math.min(100,m+1)),className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(er,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Lo·∫°i m√£ v·∫°ch"}),e.jsxs("select",{value:n,onChange:_=>o(_.target.value),className:"px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"CODE128",children:"CODE128 (ph·ªï bi·∫øn)"}),e.jsx("option",{value:"CODE39",children:"CODE39"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:_=>r(_.target.checked),className:"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Hi·ªán t√™n"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:_=>l(_.target.checked),className:"w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Hi·ªán gi√°"})]})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-300",children:[e.jsx("strong",{children:"üí° M·∫πo:"})," C√†i ƒë·∫∑t kh·ªï gi·∫•y trong driver m√°y in tr√πng v·ªõi k√≠ch th∆∞·ªõc nh√£n ƒë√£ ch·ªçn ƒë·ªÉ in ch√≠nh x√°c."]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors",children:"ƒê√≥ng"}),e.jsxs("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),"In ",m," nh√£n"]})]})]})})},hr={"30x20":{width:30,height:20,name:"30√ó20mm",barcodeHeight:25,fontSize:7},"40x30":{width:40,height:30,name:"40√ó30mm",barcodeHeight:35,fontSize:8},"50x30":{width:50,height:30,name:"50√ó30mm",barcodeHeight:40,fontSize:9},"60x40":{width:60,height:40,name:"60√ó40mm",barcodeHeight:45,fontSize:10},"80x50":{width:80,height:50,name:"80√ó50mm",barcodeHeight:55,fontSize:12}},bn=({value:d,format:f,size:b})=>{const i=y.useRef(null);return y.useEffect(()=>{if(i.current)try{tt(i.current,d,{format:f,width:1.5,height:b.barcodeHeight,displayValue:!0,fontSize:b.fontSize,margin:2,textMargin:1,font:"monospace"})}catch{tt(i.current,d,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}},[d,f,b]),e.jsx("svg",{ref:i,className:"max-w-full h-auto"})},gn=({parts:d,currentBranchId:f,onClose:b})=>{const[i,c]=y.useState("select"),[m,x]=y.useState(new Map),[h,l]=y.useState(""),[t,r]=y.useState("all"),[s,a]=y.useState("40x30"),[n,o]=y.useState("CODE128"),[u,g]=y.useState(!0),[k,v]=y.useState(!0),[p,_]=y.useState("stock"),[O,D]=y.useState(1),[E,C]=y.useState(0),S=6,T=y.useMemo(()=>{const w=new Set;return d.forEach(q=>{q.category&&w.add(q.category)}),Array.from(w).sort()},[d]),R=y.useMemo(()=>d.filter(w=>{var de,ie;const q=!h||w.name.toLowerCase().includes(h.toLowerCase())||((de=w.sku)==null?void 0:de.toLowerCase().includes(h.toLowerCase()))||((ie=w.barcode)==null?void 0:ie.toLowerCase().includes(h.toLowerCase())),Y=t==="all"||w.category===t;return q&&Y}),[d,h,t]),P=w=>w.stock[f]||0,I=w=>{const q=new Map(m);if(q.has(w.id))q.delete(w.id);else{const Y=p==="stock"?Math.max(1,P(w)):p==="fixed"?O:1;q.set(w.id,{part:w,quantity:Y})}x(q)},A=()=>{const w=new Map(m);R.forEach(q=>{if(!w.has(q.id)){const Y=p==="stock"?Math.max(1,P(q)):p==="fixed"?O:1;w.set(q.id,{part:q,quantity:Y})}}),x(w)},H=()=>{x(new Map)},U=(w,q)=>{const Y=new Map(m),de=Y.get(w);de&&(Y.set(w,{...de,quantity:Math.max(1,q)}),x(Y))},z=()=>{const w=new Map;m.forEach((q,Y)=>{const de=p==="stock"?Math.max(1,P(q.part)):p==="fixed"?O:q.quantity;w.set(Y,{...q,quantity:de})}),x(w)},W=y.useMemo(()=>{let w=0;return m.forEach(q=>{w+=q.quantity}),w},[m]),J=y.useMemo(()=>{const w=[];return m.forEach(({part:q,quantity:Y})=>{for(let de=0;de<Y;de++)w.push({part:q,index:de})}),w},[m]),oe=y.useMemo(()=>{const w=E*S;return J.slice(w,w+S)},[J,E,S]),ue=Math.ceil(J.length/S),ne=hr[s],ce=w=>{const q=document.createElementNS("http://www.w3.org/2000/svg","svg");try{tt(q,w,{format:n,width:Math.max(1,(ne.width-10)/50),height:ne.barcodeHeight,displayValue:!0,fontSize:ne.fontSize,margin:2,textMargin:1,font:"monospace"})}catch{tt(q,w,{format:"CODE128",width:1.2,height:35,displayValue:!0,fontSize:8,margin:2})}return q.outerHTML},M=()=>{if(m.size===0){alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 s·∫£n ph·∫©m");return}const w=window.open("","_blank");if(!w){alert("Vui l√≤ng cho ph√©p popup ƒë·ªÉ in");return}let q="";m.forEach(({part:Y,quantity:de})=>{const ie=Y.barcode||Y.sku||Y.id.slice(0,12),Me=ce(ie);for(let fe=0;fe<de;fe++)q+=`
          <div class="label" style="
            width: ${ne.width}mm;
            height: ${ne.height}mm;
            padding: 1mm;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            page-break-inside: avoid;
            box-sizing: border-box;
            overflow: hidden;
          ">
            ${k?`<div style="font-size: ${Math.max(7,ne.fontSize-1)}px; font-weight: bold; text-align: center; line-height: 1.2; max-width: 100%; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; word-break: break-word;">${Y.name}</div>`:""}
            ${Me}
            ${u?`<div style="font-size: ${ne.fontSize}px; font-weight: bold; line-height: 1;">${X(Y.retailPrice[f]||0)}</div>`:""}
          </div>
        `}),w.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>In m√£ v·∫°ch h√†ng lo·∫°t - ${m.size} s·∫£n ph·∫©m</title>
          <style>
            @page {
              size: ${ne.width}mm ${ne.height}mm;
              margin: 0;
            }
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
              font-family: Arial, sans-serif;
              margin: 0;
              padding: 0;
            }
            .labels-container {
              display: flex;
              flex-wrap: wrap;
              width: 100%;
            }
            .label { border: none; }
            svg { max-width: ${ne.width-4}mm !important; height: auto !important; }
            @media print {
              body { margin: 0; padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
              .label { page-break-after: always; }
              .label:last-child { page-break-after: avoid; }
            }
          </style>
        </head>
        <body>
          <div class="labels-container">${q}</div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                window.onafterprint = function() { window.close(); };
              }, 300);
            };
          <\/script>
        </body>
      </html>
    `),w.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-2 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(tr,{className:"w-5 h-5 text-blue-600"}),"In m√£ v·∫°ch h√†ng lo·∫°t"]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:i==="select"?"B∆∞·ªõc 1: Ch·ªçn s·∫£n ph·∫©m v√† c√†i ƒë·∫∑t":"B∆∞·ªõc 2: Xem tr∆∞·ªõc v√† ch·ªânh s·ª≠a"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-700 rounded-lg p-0.5",children:[e.jsxs("button",{onClick:()=>c("select"),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors flex items-center gap-1.5 ${i==="select"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:[e.jsx(ps,{className:"w-3.5 h-3.5"}),"Ch·ªçn SP"]}),e.jsxs("button",{onClick:()=>{c("preview"),C(0)},disabled:m.size===0,className:`px-3 py-1.5 text-xs font-medium rounded-md transition-colors flex items-center gap-1.5 ${i==="preview"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:[e.jsx(_r,{className:"w-3.5 h-3.5"}),"Xem tr∆∞·ªõc"]})]}),e.jsx("button",{onClick:b,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(mr,{className:"w-5 h-5"})})]})]}),i==="select"?e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col border-r border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 space-y-2 shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:h,onChange:w=>l(w.target.value),placeholder:"T√¨m s·∫£n ph·∫©m, SKU, m√£ v·∫°ch...",className:"w-full pl-9 pr-3 py-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:w=>r(w.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),T.map(w=>e.jsx("option",{value:w,children:w},w))]}),e.jsx("button",{onClick:A,className:"px-3 py-1.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50",children:"Ch·ªçn t·∫•t c·∫£"}),e.jsx("button",{onClick:H,className:"px-3 py-1.5 text-xs bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600",children:"B·ªè ch·ªçn"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:R.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}):e.jsx("div",{className:"space-y-1",children:R.map(w=>{const q=m.has(w.id),Y=P(w);return e.jsxs("div",{onClick:()=>I(w),className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${q?"bg-blue-50 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700":"bg-slate-50 dark:bg-slate-900/50 border border-transparent hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center shrink-0 ${q?"bg-blue-600 text-white":"border-2 border-slate-300 dark:border-slate-600"}`,children:q&&e.jsx(ts,{className:"w-3 h-3"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100 truncate",children:w.name}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-mono",children:w.barcode||w.sku})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªìn kho"}),e.jsx("p",{className:`text-sm font-bold ${Y>0?"text-green-600":"text-red-500"}`,children:Y})]})]},w.id)})})})]}),e.jsxs("div",{className:"w-full md:w-80 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 space-y-3 shrink-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"C√†i ƒë·∫∑t in"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"S·ªë l∆∞·ª£ng nh√£n"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{_("stock")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${p==="stock"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"= T·ªìn kho"}),e.jsx("button",{onClick:()=>{_("fixed")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${p==="fixed"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"C·ªë ƒë·ªãnh"}),e.jsx("button",{onClick:()=>{_("custom")},className:`flex-1 px-2 py-1.5 text-xs rounded-lg ${p==="custom"?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:"T√πy ch·ªânh"})]}),p==="fixed"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"M·ªói SP in:"}),e.jsx("input",{type:"number",value:O,onChange:w=>D(Math.max(1,parseInt(w.target.value)||1)),className:"w-16 px-2 py-1 text-sm text-center border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",min:"1"}),e.jsx("span",{className:"text-xs text-slate-500",children:"nh√£n"})]}),m.size>0&&p!=="custom"&&e.jsxs("button",{onClick:z,className:"mt-2 w-full px-2 py-1 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded hover:bg-amber-200",children:["√Åp d·ª•ng cho ",m.size," SP ƒë√£ ch·ªçn"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"K√≠ch th∆∞·ªõc nh√£n"}),e.jsx("select",{value:s,onChange:w=>a(w.target.value),className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700",children:Object.entries(hr).map(([w,q])=>e.jsx("option",{value:w,children:q.name},w))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:w=>v(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"T√™n"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:w=>g(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Gi√°"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-2 px-1",children:["ƒê√£ ch·ªçn: ",m.size," SP ‚Ä¢ ",W," nh√£n"]}),m.size===0?e.jsxs("div",{className:"text-center py-4 text-slate-400 text-xs",children:[e.jsx(Zt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"Ch∆∞a ch·ªçn s·∫£n ph·∫©m n√†o"]}):e.jsx("div",{className:"space-y-1",children:Array.from(m.values()).map(({part:w,quantity:q})=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-xs font-medium text-slate-900 dark:text-slate-100 truncate",children:w.name})}),p==="custom"?e.jsx("input",{type:"number",value:q,onChange:Y=>U(w.id,parseInt(Y.target.value)||1),onClick:Y=>Y.stopPropagation(),className:"w-14 px-1 py-0.5 text-xs text-center border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",min:"1"}):e.jsxs("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:["√ó",q]}),e.jsx("button",{onClick:Y=>{Y.stopPropagation(),I(w)},className:"text-red-500 hover:text-red-700",children:e.jsx(mr,{className:"w-4 h-4"})})]},w.id))})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 flex flex-wrap items-center gap-3 shrink-0 bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"K√≠ch th∆∞·ªõc:"}),e.jsx("select",{value:s,onChange:w=>a(w.target.value),className:"px-2 py-1 text-sm border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700",children:Object.entries(hr).map(([w,q])=>e.jsx("option",{value:w,children:q.name},w))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:w=>v(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"T√™n SP"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:w=>g(w.target.checked),className:"w-3.5 h-3.5 rounded"}),e.jsx("span",{className:"text-xs text-slate-700 dark:text-slate-300",children:"Gi√°"})]})]}),e.jsxs("div",{className:"ml-auto text-xs text-slate-500 dark:text-slate-400",children:["T·ªïng:"," ",e.jsx("span",{className:"font-bold text-blue-600",children:W})," ","nh√£n"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 max-w-3xl mx-auto",children:oe.map(({part:w,index:q})=>{const Y=w.barcode||w.sku||w.id.slice(0,12);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-md p-2 flex flex-col items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600",style:{minHeight:`${ne.height*2.5}px`,aspectRatio:`${ne.width}/${ne.height}`},children:[k&&e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-slate-100 text-center w-full mb-1 line-clamp-2 leading-tight",style:{fontSize:`${Math.max(9,ne.fontSize-1)}px`},children:w.name}),e.jsx(bn,{value:Y,format:n,size:ne}),u&&e.jsx("p",{className:"text-xs font-bold text-slate-900 dark:text-slate-100 mt-1",children:X(w.retailPrice[f]||0)})]},`${w.id}-${q}`)})})}),ue>1&&e.jsxs("div",{className:"flex items-center justify-center gap-3 p-3 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[e.jsx("button",{onClick:()=>C(w=>Math.max(0,w-1)),disabled:E===0,className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(Cr,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Trang ",e.jsx("span",{className:"font-bold",children:E+1})," /"," ",ue]}),e.jsx("button",{onClick:()=>C(w=>Math.min(ue-1,w+1)),disabled:E>=ue-1,className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(rs,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-slate-200 dark:border-slate-700 shrink-0",children:[e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:m.size})," ","s·∫£n ph·∫©m ‚Ä¢",e.jsx("span",{className:"font-semibold text-green-600 ml-1",children:W})," ","nh√£n"]}),e.jsx("div",{className:"flex gap-3",children:i==="select"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg",children:"ƒê√≥ng"}),e.jsxs("button",{onClick:()=>{c("preview"),C(0)},disabled:m.size===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed rounded-lg flex items-center gap-2",children:[e.jsx(_r,{className:"w-4 h-4"}),"Xem tr∆∞·ªõc (",W,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c("select"),className:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg flex items-center gap-2",children:[e.jsx(Cr,{className:"w-4 h-4"}),"Quay l·∫°i ch·ªânh s·ª≠a"]}),e.jsxs("button",{onClick:M,disabled:m.size===0,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-slate-400 disabled:cursor-not-allowed rounded-lg flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),"In ",W," nh√£n"]})]})})]})]})})},Ie=5,Ka=({isOpen:d,onClose:f,onSave:b})=>{const[i,c]=y.useState(""),[m,x]=y.useState(""),[h,l]=y.useState(""),[t,r]=y.useState(""),[s,a]=y.useState(1),[n,o]=y.useState(0),[u,g]=y.useState(0),[k,v]=y.useState(0),[p,_]=y.useState("th√°ng"),[O,D]=y.useState(!1),{data:E=[]}=vr(),C=$a(),[S,T]=y.useState(!1),[R,P]=y.useState(""),I=()=>{if(!i.trim()){B.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}b({name:i.trim(),description:m.trim(),barcode:h.trim(),category:t||"Ch∆∞a ph√¢n lo·∫°i",quantity:Number(s)||1,importPrice:Number(n)||0,retailPrice:Number(u)||0,warranty:Number(k)||0,warrantyUnit:p}),c(""),x(""),l(""),r(""),a(1),o(0),g(0),v(0),D(!1),_("th√°ng")};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m m·ªõi"}),e.jsx("button",{onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-xl",children:"√ó"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:i,onChange:A=>c(A.target.value),className:"w-full px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"Nh·∫≠p t√™n s·∫£n ph·∫©m"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c s·∫£n ph·∫©m"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("select",{value:t,onChange:A=>r(A.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),E.map(A=>e.jsx("option",{value:A.name,children:A.name},A.id))]}),e.jsx("button",{type:"button",onClick:()=>T(!0),className:"w-8 h-8 flex items-center justify-center bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600","aria-label":"Th√™m danh m·ª•c m·ªõi",children:e.jsx("span",{className:"text-lg text-slate-600 dark:text-slate-300",children:"+"})})]})]})]}),S&&e.jsxs("form",{onSubmit:async A=>{A.preventDefault();const H=R.trim();if(!H){B.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");return}if(H.length<2){B.warning("T√™n qu√° ng·∫Øn");return}try{const U=await C.mutateAsync({name:H});r(U.name),P(""),T(!1)}catch(U){B.error((U==null?void 0:U.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:R,onChange:A=>P(A.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("button",{type:"submit",className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs font-medium",children:"L∆∞u"}),e.jsx("button",{type:"button",onClick:()=>{T(!1),P("")},className:"px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg text-xs bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{value:m,onChange:A=>x(A.target.value),rows:2,className:"w-full px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"M√¥ t·∫£ s·∫£n ph·∫©m"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√£ s·∫£n ph·∫©m"}),e.jsx("input",{type:"text",value:h,onChange:A=>l(A.target.value),placeholder:"VD: 06455-KYJ-841 (Honda), 5S9-F2101-00 (Yamaha)",className:"w-full px-3 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-mono"}),e.jsx("p",{className:"mt-0.5 text-[10px] text-slate-500 dark:text-slate-400",children:"Nh·∫≠p m√£ h√£ng (Honda/Yamaha) ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ t·ª± sinh m√£ n·ªôi b·ªô PT-xxxxx"})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Th√¥ng tin nh·∫≠p kho:"}),e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-600 dark:text-slate-400 mb-0.5",children:"S·ªë l∆∞·ª£ng"}),e.jsx(De,{value:s,onValue:A=>{const H=fr(n,A);H.warnings.length&&H.warnings.forEach(U=>B.warning(U)),a(Math.max(1,H.clean.quantity))},className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-600 dark:text-slate-400 mb-0.5",children:"Gi√° nh·∫≠p"}),e.jsx(De,{value:n,onValue:A=>{const H=fr(A,s);H.warnings.length&&H.warnings.forEach(U=>B.warning(U)),o(H.clean.importPrice),O||g(Math.round(H.clean.importPrice*1.5))},className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-600 dark:text-slate-400 mb-0.5",children:"Gi√° b√°n l·∫ª"}),e.jsx(De,{value:u,onValue:A=>{g(Math.max(0,Math.round(A))),D(!0)},className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-600 dark:text-slate-400 mb-0.5",children:"B·∫£o h√†nh"}),e.jsx(De,{value:k,onValue:A=>v(Math.max(0,Math.floor(A))),className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-slate-600 dark:text-slate-400 mb-0.5",children:"ƒê∆°n v·ªã"}),e.jsxs("select",{value:p,onChange:A=>_(A.target.value),className:"w-full px-2 py-1.5 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"th√°ng",children:"th√°ng"}),e.jsx("option",{value:"nƒÉm",children:"nƒÉm"}),e.jsx("option",{value:"ng√†y",children:"ng√†y"})]})]})]})]})]})}),e.jsx("div",{className:"px-4 py-3 border-t border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:I,className:"w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium text-sm",children:"L∆∞u v√† Th√™m v√†o gi·ªè h√†ng"})})]})}):null},pn=({isOpen:d,onClose:f,parts:b,currentBranchId:i,onSave:c})=>{const[m,x]=y.useState([]),[h,l]=y.useState(""),[t,r]=y.useState(""),[s,a]=y.useState(0),[n,o]=y.useState("amount"),[u,g]=y.useState("cash"),[k,v]=y.useState("full"),[p,_]=y.useState(0),[O,D]=y.useState(!1),E=pr();console.log("üì¶ GoodsReceiptMobileWrapper - parts received:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üì¶ currentBranchId:",i),y.useEffect(()=>{d||(x([]),l(""),r(""),a(0),o("amount"),g("cash"),v("full"),_(0))},[d]);const C=T=>{(async()=>{var R;try{const P=await E.mutateAsync({name:T.name,sku:T.sku||`PT-${Date.now()}`,barcode:T.barcode||"",category:T.category,stock:{[i]:T.quantity},costPrice:{[i]:T.importPrice},retailPrice:{[i]:T.retailPrice},wholesalePrice:{[i]:T.wholesalePrice||0}});if(!P.ok)throw new Error(((R=P.error)==null?void 0:R.message)||"Failed to create part");x(I=>[...I,{partId:P.data.id,partName:T.name,sku:T.sku||`PT-${Date.now()}`,quantity:T.quantity,importPrice:T.importPrice,sellingPrice:T.retailPrice,wholesalePrice:T.wholesalePrice||0}]),B.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(P){B.error((P==null?void 0:P.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{D(!1)}})()},S=()=>{if(!h){B.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(m.length===0){B.error("Vui l√≤ng th√™m s·∫£n ph·∫©m");return}const T=m.reduce((A,H)=>A+H.quantity*H.importPrice,0),R=n==="percent"?Math.round(T*s/100):s,P=Math.max(0,T-R);let I=0;k==="full"?I=P:k==="partial"&&(I=p),c(m,h,P,"",{paymentMethod:u,paymentType:k,paidAmount:I,discount:R}),clearDraft(),f()};return e.jsxs(e.Fragment,{children:[e.jsx(Cs,{isOpen:d,onClose:f,parts:b,receiptItems:m,setReceiptItems:x,selectedSupplier:h,setSelectedSupplier:l,searchTerm:t,setSearchTerm:r,onSave:S,discount:s,setDiscount:a,discountType:n,setDiscountType:o,paymentMethod:u,setPaymentMethod:g,paymentType:k,setPaymentType:v,partialAmount:p,setPartialAmount:_,showAddProductModal:O,setShowAddProductModal:D,onAddNewProduct:C,currentBranchId:i}),e.jsx(Ka,{isOpen:O,onClose:()=>D(!1),onSave:C})]})},vn=({isOpen:d,onClose:f,parts:b,currentBranchId:i,onSave:c})=>{const[m,x]=y.useState(""),[h,l]=y.useState(""),t=y.useRef(null),[r,s]=y.useState(!1),[a,n]=y.useState(!1),[o,u]=y.useState(""),[g,k]=y.useState(1),{data:v=[]}=kr(),p=Ia(),[_,O]=y.useState(!1),[D,E]=y.useState({name:"",phone:"",address:"",note:""}),C=pr(),[S,T]=y.useState(!1),[R,P]=y.useState([]),[I,A]=y.useState(null),[H,U]=y.useState(null),[z,W]=y.useState(0),[J,oe]=y.useState(0),[ue,ne]=y.useState("amount"),[ce,M]=y.useState(0),w=`goods_receipt_draft_${i}`;y.useEffect(()=>{var N,G;if(d)try{const Z=localStorage.getItem(w);if(Z){const Q=JSON.parse(Z);Q.timestamp&&Date.now()-Q.timestamp<1440*60*1e3?(((N=Q.receiptItems)==null?void 0:N.length)>0||Q.selectedSupplier)&&(window.confirm(`Ph√°t hi·ªán phi·∫øu nh·∫≠p ch∆∞a ho√†n t·∫•t (${((G=Q.receiptItems)==null?void 0:G.length)||0} s·∫£n ph·∫©m).

B·∫°n c√≥ mu·ªën kh√¥i ph·ª•c kh√¥ng?`)?(P(Q.receiptItems||[]),u(Q.selectedSupplier||""),oe(Q.discount||0),ne(Q.discountType||"amount"),M(Q.discountPercent||0),B.success("ƒê√£ kh√¥i ph·ª•c phi·∫øu nh·∫≠p t·ª´ b·∫£n nh√°p")):localStorage.removeItem(w)):localStorage.removeItem(w)}}catch(Z){console.error("L·ªói kh√¥i ph·ª•c draft:",Z)}},[d,w]),y.useEffect(()=>{if(d&&(R.length>0||o)){const N={receiptItems:R,selectedSupplier:o,discount:J,discountType:ue,discountPercent:ce,timestamp:Date.now()};localStorage.setItem(w,JSON.stringify(N))}},[d,R,o,J,ue,ce,w]);const q=()=>{localStorage.removeItem(w)},Y=y.useMemo(()=>{if(console.log("üîç Desktop Modal - parts:",(b==null?void 0:b.length)||0,b==null?void 0:b.slice(0,2)),console.log("üîç Desktop Modal - searchTerm:",m),!b||b.length===0)return console.log("‚ö†Ô∏è parts is empty or undefined"),[];if(!m||m.trim()==="")return console.log("‚úÖ Showing all parts:",b.length),b;const N=m.toLowerCase().trim(),G=b.filter(Z=>{var Q,ae;return((Q=Z.name)==null?void 0:Q.toLowerCase().includes(N))||((ae=Z.sku)==null?void 0:ae.toLowerCase().includes(N))});return console.log("‚úÖ Filtered results:",G.length),G},[b,m]),de=N=>{var Z,Q;R.find(ae=>ae.partId===N.id)?P(ae=>ae.map(ee=>ee.partId===N.id?{...ee,quantity:ee.quantity+1}:ee)):(P([...R,{partId:N.id,partName:N.name,sku:N.sku,quantity:1,importPrice:((Z=N.costPrice)==null?void 0:Z[i])||0,sellingPrice:N.retailPrice[i]||0,wholesalePrice:((Q=N.wholesalePrice)==null?void 0:Q[i])||0}]),B.success(`ƒê√£ th√™m ${N.name} v√†o phi·∫øu nh·∫≠p`)),x(""),setTimeout(()=>{var ae;return(ae=t.current)==null?void 0:ae.focus()},100)},ie=N=>{if(N.preventDefault(),!h.trim())return;const G=h.trim(),Z=ee=>ee.toLowerCase().replace(/[-\s./\\]/g,""),Q=Z(G),ae=b.find(ee=>{var ge,ve,Ve;return Z(ee.barcode||"")===Q||((ge=ee.barcode)==null?void 0:ge.toLowerCase())===G.toLowerCase()||Z(ee.sku||"")===Q||((ve=ee.sku)==null?void 0:ve.toLowerCase())===G.toLowerCase()||((Ve=ee.name)==null?void 0:Ve.toLowerCase().includes(G.toLowerCase()))});ae?(de(ae),l("")):(B.error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m c√≥ m√£: ${G}`),l(""))},Me=N=>{console.log("üì∑ Camera scanned:",N);const G=ae=>ae.toLowerCase().replace(/[-\s./\\]/g,""),Z=G(N),Q=b.find(ae=>{var ee,ge;return G(ae.barcode||"")===Z||((ee=ae.barcode)==null?void 0:ee.toLowerCase())===N.toLowerCase()||G(ae.sku||"")===Z||((ge=ae.sku)==null?void 0:ge.toLowerCase())===N.toLowerCase()});Q?(R.find(ee=>ee.partId===Q.id)?P(ee=>ee.map(ge=>ge.partId===Q.id?{...ge,quantity:ge.quantity+1}:ge)):(P(ee=>{var ge,ve;return[...ee,{partId:Q.id,partName:Q.name,sku:Q.sku,quantity:1,importPrice:((ge=Q.costPrice)==null?void 0:ge[i])||0,sellingPrice:Q.retailPrice[i]||0,wholesalePrice:((ve=Q.wholesalePrice)==null?void 0:ve[i])||0}]}),B.success(`ƒê√£ th√™m ${Q.name}`)),x("")):B.error(`Kh√¥ng t√¨m th·∫•y: ${N}`)};y.useEffect(()=>{a&&setTimeout(()=>{var N;return(N=t.current)==null?void 0:N.focus()},100)},[a]);const fe=(N,G,Z)=>{P(Q=>Q.map(ae=>ae.partId===N?{...ae,[G]:Z}:ae))},Ge=N=>{P(G=>G.filter(Z=>Z.partId!==N))},L=y.useMemo(()=>R.reduce((N,G)=>N+G.importPrice*G.quantity,0),[R]),re=y.useMemo(()=>Math.max(0,L-J),[L,J]),{profile:se}=La(),te=()=>{var G;if(!ns(se==null?void 0:se.role,"part.update_price")){B.error("B·∫°n kh√¥ng c√≥ quy·ªÅn c·∫≠p nh·∫≠t gi√°");return}if(R.length===0){B.warning("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m nh·∫≠p kho");return}(G=v.find(Z=>Z.id===o))!=null&&G.name,c(R,o,re,"",{paymentMethod:I||"cash",paymentType:H||"full",paidAmount:H==="full"?re:H==="partial"?z:0,discount:J}),q(),P([]),u(""),x(""),oe(0),M(0),ne("amount")},be=N=>{(async()=>{var G,Z;try{const Q=((G=N.barcode)==null?void 0:G.trim())||`PT-${Date.now()}`,ae=await C.mutateAsync({name:N.name,sku:Q,barcode:((Z=N.barcode)==null?void 0:Z.trim())||"",category:N.category,description:N.description,stock:{[i]:0},costPrice:{[i]:N.importPrice},retailPrice:{[i]:N.retailPrice},wholesalePrice:{[i]:Math.round(N.retailPrice*.9)}}),ee=(ae==null?void 0:ae.data)||ae,ge=(ee==null?void 0:ee.id)||`temp-${Date.now()}-${Math.random().toString(36).slice(2)}`,ve=(ee==null?void 0:ee.sku)||Q;P(Ve=>[...Ve,{partId:ge,partName:N.name,sku:ve,quantity:N.quantity,importPrice:N.importPrice,sellingPrice:N.retailPrice,wholesalePrice:N.wholesalePrice||0}]),B.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(Q){B.error((Q==null?void 0:Q.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{T(!1)}})()};return d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 w-full max-w-7xl h-[92vh] rounded-2xl shadow-2xl overflow-hidden flex",children:[e.jsxs("div",{className:"w-1/2 flex flex-col bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-r border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200/50 dark:border-slate-700/50 bg-gradient-to-r from-blue-50/50 to-indigo-50/50 dark:from-slate-800/50 dark:to-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:f,className:"w-9 h-9 flex items-center justify-center hover:bg-white/80 dark:hover:bg-slate-700/80 rounded-lg text-slate-600 dark:text-slate-400 transition-all hover:scale-105",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Danh m·ª•c s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"Ch·ªçn ƒë·ªÉ th√™m v√†o gi·ªè"})]})]}),e.jsxs("button",{onClick:()=>T(!0),className:"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-lg shadow-blue-500/30 transition-all hover:scale-105",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Th√™m m·ªõi"})]})]}),e.jsxs("div",{className:"p-3 bg-white/50 dark:bg-slate-800/50 space-y-2",children:[a&&e.jsx("form",{onSubmit:ie,children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),e.jsx("input",{ref:t,type:"text",placeholder:"Qu√©t m√£ v·∫°ch ho·∫∑c nh·∫≠p SKU...",value:h,onChange:N=>l(N.target.value),className:"w-full pl-10 pr-8 py-2.5 border-2 border-blue-300 dark:border-blue-600 rounded-xl bg-blue-50/50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-sm placeholder:text-blue-500/60 dark:placeholder:text-blue-400/60 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all font-mono"}),h&&e.jsx("button",{type:"button",onClick:()=>l(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("button",{type:"button",onClick:()=>{n(!1),l("")},className:"px-3 py-2.5 rounded-xl border-2 border-slate-300 dark:border-slate-600 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",title:"ƒê√≥ng",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:m,onChange:N=>x(N.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm placeholder:text-slate-400 focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})]}),!a&&e.jsx("button",{type:"button",onClick:()=>{n(!0),setTimeout(()=>{var N;return(N=t.current)==null?void 0:N.focus()},100)},className:"px-3 py-2.5 rounded-xl border-2 border-blue-400 text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-600 dark:text-blue-400 font-semibold text-sm flex items-center gap-1.5 transition-all hover:bg-blue-100 dark:hover:bg-blue-900/40",title:"Qu√©t m√£ v·∫°ch",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-3 py-2.5 rounded-xl border-2 border-green-500 text-green-600 bg-green-50 dark:bg-green-900/20 font-semibold text-sm flex items-center gap-1.5 transition-all hover:bg-green-100",title:"Qu√©t b·∫±ng camera",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:Y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-3 opacity-30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-sm font-medium",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),e.jsx("p",{className:"text-xs mt-1",children:"Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c"})]}):e.jsx("div",{className:"space-y-2",children:Y.map(N=>e.jsx("div",{onClick:()=>de(N),className:"group p-3 bg-white dark:bg-slate-800 rounded-xl hover:shadow-lg hover:shadow-blue-500/10 cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-900 dark:text-slate-100 line-clamp-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:N.name}),e.jsxs("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-0.5",children:["SKU: ",e.jsx("span",{className:"font-mono",children:N.sku})]})]}),e.jsx("svg",{className:"w-5 h-5 text-slate-300 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},N.id))})})]}),e.jsxs("div",{className:"w-1/2 bg-white dark:bg-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-emerald-50/30 to-teal-50/30 dark:from-slate-800/50 dark:to-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("label",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),e.jsxs("button",{onClick:()=>{E({name:"",phone:"",address:"",note:""}),O(!0)},className:"ml-auto flex items-center gap-1 text-xs px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:hover:bg-emerald-900/50 font-medium transition-all",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Th√™m NCC"]})]}),e.jsxs("select",{value:o,onChange:N=>u(N.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm font-medium focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all",children:[e.jsx("option",{value:"",children:"Ch·ªçn nh√† cung c·∫•p..."}),v.map(N=>e.jsxs("option",{value:N.id,children:[N.name," ",N.phone?`‚Ä¢ ${N.phone}`:""]},N.id))]})]}),_&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Th√™m nh√† cung c·∫•p"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"T√™n *"}),e.jsx("input",{autoFocus:!0,value:D.name,onChange:N=>E(G=>({...G,name:N.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"T√™n nh√† cung c·∫•p"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒêi·ªán tho·∫°i"}),e.jsx("input",{value:D.phone,onChange:N=>E(G=>({...G,phone:N.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"SƒêT"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{rows:2,value:D.address,onChange:N=>E(G=>({...G,address:N.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"ƒê·ªãa ch·ªâ nh√† cung c·∫•p"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"Ghi ch√∫"}),e.jsx("textarea",{rows:2,value:D.note,onChange:N=>E(G=>({...G,note:N.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"Th√¥ng tin th√™m (t√πy ch·ªçn)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 text-sm rounded border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{onClick:async()=>{var N,G;if(!D.name.trim()){B.warning("Nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const Z=await p.mutateAsync({name:D.name.trim(),phone:((N=D.phone)==null?void 0:N.trim())||void 0,address:((G=D.address)==null?void 0:G.trim())||void 0});u(Z.id),O(!1)}catch{}},className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",disabled:p.isPending,children:p.isPending?"ƒêang l∆∞u...":"L∆∞u"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),e.jsx("h3",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Gi·ªè h√†ng nh·∫≠p"})]}),e.jsxs("span",{className:"text-xs text-white bg-gradient-to-r from-blue-600 to-indigo-600 px-3 py-1 rounded-full font-semibold shadow-lg",children:[R.length," s·∫£n ph·∫©m"]})]}),R.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-12 h-12 text-slate-300 dark:text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Gi·ªè h√†ng tr·ªëng"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ch·ªçn s·∫£n ph·∫©m b√™n tr√°i ƒë·ªÉ th√™m v√†o"})]}):e.jsx("div",{className:"space-y-3",children:R.map((N,G)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-2.5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"text-xs font-bold text-white",children:["#",G+1]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-xs text-slate-900 dark:text-slate-100 truncate",children:N.partName}),e.jsxs("div",{className:"text-[9px] text-slate-500 dark:text-slate-400",children:["SKU: ",N.sku]})]}),e.jsx("button",{onClick:()=>Ge(N.partId),className:"w-6 h-6 flex items-center justify-center bg-red-100 dark:bg-red-900/30 rounded text-red-600 dark:text-red-400 hover:bg-red-200 flex-shrink-0",title:"X√≥a",children:"√ó"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>fe(N.partId,"quantity",Math.max(1,N.quantity-1)),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"-"}),e.jsx("input",{type:"number",value:N.quantity,onChange:Z=>{const Q=parseInt(Z.target.value)||1;fe(N.partId,"quantity",Math.max(1,Q))},className:"w-10 px-1 py-1 text-center border border-blue-300 dark:border-blue-700 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold",min:"1"}),e.jsx("button",{onClick:()=>fe(N.partId,"quantity",N.quantity+1),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"+"})]}),e.jsx(De,{value:N.importPrice,onValue:Z=>{const{clean:Q}=fr(Z,N.quantity),ae=Q.importPrice,ee=Math.round(ae*1.5);P(ge=>ge.map(ve=>ve.partId===N.partId?{...ve,importPrice:ae,sellingPrice:ve.sellingPrice===0||ve.sellingPrice===Math.round((ve.importPrice||0)*1.5)?ee:ve.sellingPrice}:ve))},className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-blue-500",placeholder:"Gi√° nh·∫≠p"}),e.jsx(De,{value:N.sellingPrice,onValue:Z=>fe(N.partId,"sellingPrice",Math.max(0,Math.round(Z))),className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-emerald-500",placeholder:"Gi√° b√°n"}),e.jsx("div",{className:"w-20 text-right",children:e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:X(N.importPrice*N.quantity)})})]})]},N.partId))})]}),e.jsxs("div",{className:"p-3 border-t-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[e.jsx("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-white uppercase",children:"T·ªïng thanh to√°n"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-black text-white",children:X(re)}),e.jsxs("div",{className:"text-[10px] text-white/70",children:[R.length," SP"]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:["Ph∆∞∆°ng th·ª©c thanh to√°n ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>A("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${I==="cash"?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),e.jsx("button",{onClick:()=>A("bank"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${I==="bank"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"H√¨nh th·ª©c thanh to√°n"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[e.jsx("button",{onClick:()=>{U("full"),W(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${H==="full"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"ƒê·ªß"}),e.jsx("button",{onClick:()=>U("partial"),className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${H==="partial"?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"1 ph·∫ßn"}),e.jsx("button",{onClick:()=>{U("note"),W(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${H==="note"?"border-purple-500 bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"C√¥ng n·ª£"})]})]}),H==="partial"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"S·ªë ti·ªÅn kh√°ch tr·∫£"}),e.jsx(De,{value:z,onValue:N=>W(Math.max(0,Math.round(N))),className:"w-full px-3 py-2 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-sm font-bold focus:border-orange-500",placeholder:"Nh·∫≠p s·ªë ti·ªÅn..."}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-slate-500",children:"C√≤n l·∫°i:"}),e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:X(Math.max(0,re-z))})]})]}),H&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"Lo·∫°i h·∫°ch to√°n"}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold focus:border-blue-500",children:[e.jsx("option",{children:"Mua h√†ng/nh·∫≠p kho"}),e.jsx("option",{children:"Nh·∫≠p tr·∫£ h√†ng"}),e.jsx("option",{children:"Kh√°c"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"flex-1 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 px-3 py-2.5 rounded-lg font-bold text-xs transition-all",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"L∆ØU NH√ÅP"]})}),e.jsx("button",{onClick:()=>{if(!I){B.warning("Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n");return}if(!H){B.warning("Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n");return}if(H==="partial"&&z<=0){B.warning("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kh√°ch tr·∫£");return}te()},disabled:!I||!H||H==="partial"&&z<=0,className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white px-3 py-2.5 rounded-lg font-bold text-xs transition-all disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed dark:disabled:bg-slate-600 dark:disabled:text-slate-400",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),"NH·∫¨P KHO"]})})]})]})]})]})}),e.jsx(Aa,{isOpen:r,onClose:()=>s(!1),onScan:Me}),e.jsx(Ka,{isOpen:S,onClose:()=>T(!1),onSave:be})]}):null},kn=({isOpen:d,onClose:f,onSave:b,initialData:i,mode:c})=>{const[m,x]=y.useState((i==null?void 0:i.name)||""),[h,l]=y.useState((i==null?void 0:i.phone)||""),[t,r]=y.useState((i==null?void 0:i.address)||""),[s,a]=y.useState((i==null?void 0:i.email)||"");y.useEffect(()=>{i&&(x(i.name),l(i.phone),r(i.address),a(i.email))},[i]);const n=o=>{if(o.preventDefault(),!m.trim()){B.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}b({name:m.trim(),phone:h.trim(),address:t.trim(),email:s.trim()})};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-md",children:e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:c==="add"?"Th√™m nh√† cung c·∫•p m·ªõi":"Ch·ªânh s·ª≠a nh√† cung c·∫•p"}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√™n nh√† cung c·∫•p *"}),e.jsx("input",{type:"text",value:m,onChange:o=>x(o.target.value),placeholder:"Nh·∫≠p t√™n nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",value:h,onChange:o=>l(o.target.value),placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:s,onChange:o=>a(o.target.value),placeholder:"Nh·∫≠p email",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·ªãa ch·ªâ"}),e.jsx("textarea",{value:t,onChange:o=>r(o.target.value),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:c==="add"?"Th√™m":"L∆∞u"})]})]})})}):null},yn=({isOpen:d,onClose:f,onAdd:b,currentBranchId:i})=>{const[c,m]=y.useState(""),[x,h]=y.useState(null),[l,t]=y.useState(1),[r,s]=y.useState(0),{data:a=[]}=ht({queryKey:["allPartsForReceipt"],queryFn:async()=>{const{data:g,error:k}=await he.from("parts").select("*").order("name");if(k)throw k;return g||[]}}),n=y.useMemo(()=>{if(!c)return[];const g=c.toLowerCase();return a.filter(k=>{var v,p;return k.name.toLowerCase().includes(g)||((v=k.sku)==null?void 0:v.toLowerCase().includes(g))||((p=k.description)==null?void 0:p.toLowerCase().includes(g))})},[a,c]),o=g=>{var k;h(g),s(((k=g.costPrice)==null?void 0:k[i])||0),m(g.name)},u=g=>{if(g.preventDefault(),!x){B.error("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m");return}if(l<=0){B.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}if(r<0){B.error("ƒê∆°n gi√° kh√¥ng ƒë∆∞·ª£c √¢m");return}b({partId:x.id,partName:x.name,sku:x.sku||"",quantity:l,unitPrice:r}),m(""),h(null),t(1),s(0)};return d?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-lg",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m v√†o phi·∫øu"}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√¨m ki·∫øm s·∫£n ph·∫©m *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:g=>{m(g.target.value),h(null)},placeholder:"Nh·∫≠p t√™n ho·∫∑c SKU s·∫£n ph·∫©m...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0}),c&&!x&&n.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:n.map(g=>{var k;return e.jsxs("button",{type:"button",onClick:()=>o(g),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:g.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",g.sku||"N/A"," | Gi√° nh·∫≠p:"," ",X(((k=g.costPrice)==null?void 0:k[i])||0)]})]},g.id)})})]}),x&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded text-sm text-green-800 dark:text-green-200",children:["‚úì ƒê√£ ch·ªçn: ",x.name," (",x.sku,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë l∆∞·ª£ng *"}),e.jsx("input",{type:"number",value:l,onChange:g=>t(Number(g.target.value)),min:"1",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê∆°n gi√° nh·∫≠p *"}),e.jsx(De,{value:r,onValue:s,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Th√†nh ti·ªÅn"}),e.jsx("input",{type:"text",value:X(l*r),readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-bold"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"Th√™m s·∫£n ph·∫©m"})]})]})})}):null},jn=({receipt:d,onClose:f,onSave:b,currentBranchId:i})=>{const[c,m]=y.useState(d.supplier),[x,h]=y.useState(""),[l,t]=y.useState(d.supplier),[r,s]=y.useState(!1),[a,n]=y.useState(!1),[o,u]=y.useState("add"),[g,k]=y.useState(!1),[v,p]=y.useState(null),{data:_=[]}=ht({queryKey:["suppliers"],queryFn:async()=>{const{data:M,error:w}=await he.from("suppliers").select("*").order("name");if(w)throw w;return M||[]}}),O=y.useMemo(()=>{if(!l)return _;const M=l.toLowerCase();return _.filter(w=>w.name.toLowerCase().includes(M))},[_,l]),[D,E]=y.useState(d.items.map(M=>({id:M.id,partName:M.partName,quantity:M.quantity,unitPrice:M.unitPrice||0,totalPrice:M.quantity*(M.unitPrice||0),notes:M.notes||""}))),[C,S]=y.useState([{time:"15:31",date:d.date,payer:"Xu√¢n Nhan",cashier:"(Ti·ªÅn m·∫∑t)",amount:d.total}]),[T,R]=y.useState(!0);ut.useEffect(()=>{var w,q,Y;const M=d.items[0];if((w=M==null?void 0:M.notes)!=null&&w.includes("Phone:")){const de=(Y=(q=M.notes.split("Phone:")[1])==null?void 0:q.split("NV:")[0])==null?void 0:Y.trim();de&&h(de)}},[d.items]),ut.useEffect(()=>{const M=w=>{w.target.closest(".supplier-dropdown-container")||s(!1)};return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[]);const P=D.reduce((M,w)=>M+w.totalPrice,0),I=C.reduce((M,w)=>M+w.amount,0),A=(M,w)=>{const q=[...D];q[M].quantity=w,q[M].totalPrice=w*q[M].unitPrice,E(q)},H=(M,w)=>{const q=[...D];q[M].unitPrice=w,q[M].totalPrice=q[M].quantity*w,E(q)},U=M=>{if(D.length===1){B.error("Ph·∫£i c√≥ √≠t nh·∫•t 1 s·∫£n ph·∫©m");return}const w=D.filter((q,Y)=>Y!==M);E(w),B.success("ƒê√£ x√≥a s·∫£n ph·∫©m")},z=M=>{const w={id:`new-${Date.now()}`,partId:M.partId,partName:M.partName,quantity:M.quantity,unitPrice:M.unitPrice,totalPrice:M.quantity*M.unitPrice,notes:"",sku:M.sku};E([...D,w]),k(!1),B.success(`ƒê√£ th√™m ${M.partName} (s·∫Ω l∆∞u khi b·∫•m L∆ØU)`)},W=M=>{m(M.name),h(M.phone),n(!1),B.success(o==="add"?"ƒê√£ th√™m nh√† cung c·∫•p":"ƒê√£ c·∫≠p nh·∫≠t nh√† cung c·∫•p")},J=()=>{u("edit"),n(!0)},oe=()=>{u("add"),n(!0)},ue=M=>{p(M),B.info("Click v√†o √¥ s·ªë l∆∞·ª£ng ho·∫∑c ƒë∆°n gi√° ƒë·ªÉ ch·ªânh s·ª≠a")},ne=M=>{confirm("B·∫°n c√≥ mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")&&U(M)},ce=M=>{if(M.preventDefault(),!c){B.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(D.some(w=>w.quantity<=0)){B.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}b({supplier:c,supplierPhone:x,items:D,payments:C,isPaid:T})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("form",{onSubmit:ce,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:["[Ch·ªânh s·ª≠a] Phi·∫øu Nh·∫≠p Kho ",d.receiptCode]})]}),e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:[new Date(d.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})," ",new Date(d.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("button",{type:"button",onClick:f,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 dark:hover:bg-slate-700",children:"√ó"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-2",children:"Nh√† cung c·∫•p:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative supplier-dropdown-container",children:[e.jsx("input",{type:"text",value:l,onChange:M=>{t(M.target.value),s(!0)},onFocus:()=>s(!0),placeholder:"T√¨m ki·∫øm v√† ch·ªçn m·ªôt nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),l&&e.jsx("button",{type:"button",onClick:()=>{t(""),m(""),h("")},className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:"√ó"}),r&&O.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:O.map(M=>e.jsxs("button",{type:"button",onClick:()=>{m(M.name),t(M.name),h(M.phone||""),s(!1)},className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:M.name}),M.phone&&e.jsxs("div",{className:"text-xs text-slate-500",children:["Phone: ",M.phone]})]},M.id))})]}),e.jsxs("button",{type:"button",onClick:J,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Ch·ªânh s·ª≠a"]}),e.jsxs("button",{type:"button",onClick:oe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"+"}),"Th√™m m·ªõi"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400",children:"Chi ti·∫øt s·∫£n ph·∫©m nh·∫≠p kho:"}),e.jsxs("button",{type:"button",onClick:()=>k(!0),className:"text-sm text-teal-600 hover:text-teal-700 dark:text-teal-400 flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"+"}),"Th√™m s·∫£n ph·∫©m"]})]}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"-"}),e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"T√™n"}),e.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê∆°n gi√° nh·∫≠p"}),e.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"Th√†nh ti·ªÅn"}),e.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300 w-20"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:D.map((M,w)=>e.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors ${v===w?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsx("td",{className:"px-3 py-3 text-sm text-slate-900 dark:text-slate-100",children:w+1}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("div",{className:"text-sm text-slate-900 dark:text-slate-100",children:M.partName}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"[Kh√°c]"}),e.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n l·∫ª: ",X(7e4)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n s·ªâ: ",X(0)]}),e.jsx("div",{className:"text-xs text-red-500",children:"(ƒê√£ xu·∫•t kho)"})]}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("input",{type:"number",value:M.quantity,onChange:q=>A(w,Number(q.target.value)),onFocus:()=>p(w),onBlur:()=>p(null),min:"1",className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(De,{value:M.unitPrice,onValue:q=>H(w,q),className:"w-28 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),e.jsx("td",{className:"px-3 py-3 text-right text-sm font-medium text-slate-900 dark:text-slate-100",children:X(M.totalPrice)}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>ue(w),className:"p-1 text-blue-400 hover:bg-blue-500/20 rounded",title:"Ch·ªânh s·ª≠a",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{type:"button",onClick:()=>ne(w),className:"p-1 text-slate-400 hover:bg-slate-500/20 rounded",title:"X√≥a s·∫£n ph·∫©m",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})})]},M.id))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªîNG:"}),e.jsx("td",{className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:X(P)}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg p-4",children:[e.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-3",children:"C√¥ng n·ª£:"}),e.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsxs("span",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:["T·ªîNG PH·∫¢I CHI: ",X(P)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"ƒê√£ thanh to√°n ƒë·ªß"]}),e.jsxs("button",{type:"button",className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"+"}),"T·∫°o phi·∫øu chi"]})]})]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-3 flex items-start gap-1",children:[e.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"T·ªïng ph·∫£i chi l√† ph√≠ ch∆∞a ph·∫£i tr·∫£ cho ƒë·ªëi t√°c s·ª≠a ch·ªØa"]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"-"}),e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Th·ªùi gian"}),e.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Ng∆∞·ªùi chi - Ghi ch√∫"}),e.jsx("th",{className:"px-2 py-2 text-right text-slate-700 dark:text-slate-300",children:"S·ªë ti·ªÅn"})]})}),e.jsx("tbody",{children:C.map((M,w)=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:w+1}),e.jsxs("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:[M.time," ",new Date(M.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})]}),e.jsxs("td",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-slate-900 dark:text-slate-100",children:M.payer}),e.jsx("div",{className:"text-xs text-slate-500",children:M.cashier})]}),e.jsx("td",{className:"px-2 py-2 text-right text-slate-900 dark:text-slate-100",children:X(M.amount)})]},w))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªïng ƒë√£ chi"}),e.jsx("td",{className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:X(I)})]})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 p-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"ƒê√ìNG"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"L∆ØU"})]})]}),e.jsx(kn,{isOpen:a,onClose:()=>n(!1),onSave:W,initialData:o==="edit"?{name:c,phone:x,address:"",email:""}:void 0,mode:o}),e.jsx(yn,{isOpen:g,onClose:()=>k(!1),onAdd:z,currentBranchId:i})]})})},wn=({transactions:d})=>{const f=gr(),{data:b=[]}=Da(),[i,c]=y.useState("7days"),[m,x]=y.useState(et(new Date,!0)),[h,l]=y.useState(et(new Date,!0)),[t,r]=y.useState(""),[s,a]=y.useState(null),{currentBranchId:n}=rr(),o=y.useMemo(()=>{console.log("üì¶ [InventoryHistorySection] T·ªïng s·ªë giao d·ªãch:",d.length);let p=d.filter(O=>O.type==="Nh·∫≠p kho");console.log("üì¶ [InventoryHistorySection] Giao d·ªãch 'Nh·∫≠p kho':",p.length);const _=new Date;switch(i){case"7days":const O=new Date(_.getTime()-6048e5);p=p.filter(C=>new Date(C.date)>=O);break;case"30days":const D=new Date(_.getTime()-720*60*60*1e3);p=p.filter(C=>new Date(C.date)>=D);break;case"thisMonth":const E=new Date(_.getFullYear(),_.getMonth(),1);p=p.filter(C=>new Date(C.date)>=E);break;case"custom":p=p.filter(C=>{const S=new Date(C.date);return S>=new Date(m)&&S<=new Date(h)});break}if(t){const O=t.toLowerCase();p=p.filter(D=>D.partName.toLowerCase().includes(O)||D.notes&&D.notes.toLowerCase().includes(O))}return p.sort((O,D)=>new Date(D.date).getTime()-new Date(O.date).getTime())},[d,i,m,h,t]),u=y.useMemo(()=>o.reduce((p,_)=>p+_.totalPrice,0),[o]),g=y.useMemo(()=>{const p=new Map;return o.forEach(_=>{var S,T;const O=new Date(_.date),D=`${O.getFullYear()}-${String(O.getMonth()+1).padStart(2,"0")}-${String(O.getDate()).padStart(2,"0")}`,E=(S=_.notes)!=null&&S.includes("NCC:")?(T=_.notes.split("NCC:")[1])==null?void 0:T.trim():"Kh√¥ng x√°c ƒë·ªãnh",C=`${D}_${E}_${O.getHours()}_${O.getMinutes()}`;p.has(C)||p.set(C,[]),p.get(C).push(_)}),Array.from(p.entries()).map(([_,O],D)=>{var T,R,P;const E=O[0],C=new Date(E.date);let S="";if(E.notes){const I=E.notes.match(/NH-\d{8}-\d{3}/);I&&(S=I[0])}return S||(S=`NH-${`${C.getFullYear()}${String(C.getMonth()+1).padStart(2,"0")}${String(C.getDate()).padStart(2,"0")}`}-${String(p.size-D).padStart(3,"0")}`),{receiptCode:S,date:E.date,supplier:(T=E.notes)!=null&&T.includes("NCC:")?(P=(R=E.notes.split("NCC:")[1])==null?void 0:R.split("|")[0])==null?void 0:P.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:O,total:O.reduce((I,A)=>I+A.totalPrice,0)}}).sort((_,O)=>new Date(O.date).getTime()-new Date(_.date).getTime())},[o]),[k,v]=y.useState(new Set);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-3 sm:p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-slate-100 mb-3 sm:mb-4",children:"L·ªãch s·ª≠ nh·∫≠p kho"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3 sm:mb-4",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(p=>e.jsx("button",{onClick:()=>c(p.key),className:`px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-sm sm:text-base font-medium transition-colors ${i===p.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:p.label},p.key))}),i==="custom"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),e.jsx("input",{type:"date",value:m,onChange:p=>x(p.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),e.jsx("input",{type:"date",value:h,onChange:p=>l(p.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]})]}),e.jsx("input",{type:"text",placeholder:"Nh√† cung c·∫•p, SKU, t√™n ph·ª• t√πng...",value:t,onChange:p=>r(p.target.value),className:"w-full px-3 py-2 sm:px-4 sm:py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),e.jsx("div",{className:"px-3 py-3 sm:px-6 sm:py-4 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:["T·ªïng s·ªë ti·ªÅn:"," ",e.jsx("span",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-slate-100",children:g.length})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"T·ªïng gi√° tr·ªã"}),e.jsx("div",{className:"text-base sm:text-lg font-bold text-blue-600",children:X(u)})]})]})}),e.jsxs("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:[g.length>0&&e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-3 bg-slate-100 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600 sticky top-0 z-10",children:[e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),e.jsx("div",{className:"col-span-4 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thanh to√°n"}),e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]}),g.length===0?e.jsxs("div",{className:"px-3 py-8 sm:px-6 sm:py-12 text-center text-slate-500",children:[e.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:"üì¶"}),e.jsx("div",{className:"text-sm sm:text-base",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"})]}):g.map(p=>{var R,P,I,A,H,U,z;const _=new Date(p.date),O=_.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),D=_.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),E=b.find(W=>{var J;return(J=W.description)==null?void 0:J.includes(p.receiptCode)}),C=E?E.totalAmount-E.remainingAmount:p.total,S=(E==null?void 0:E.remainingAmount)||0,T=S>0;return e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"md:hidden flex flex-col gap-3 bg-white dark:bg-slate-800/60 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-cyan-600 dark:text-cyan-300",children:["üì¶ ",p.receiptCode]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:["üìÖ"," ",e.jsxs("span",{children:[O," ¬∑ ",D]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:X(p.total)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-900/30 rounded-2xl p-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-200 font-semibold text-lg",children:"üè¢"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-white",children:p.supplier}),((R=p.items[0].notes)==null?void 0:R.includes("Phone:"))&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(P=p.items[0].notes.split("Phone:")[1])==null?void 0:P.trim()]})]})]}),e.jsx("div",{className:"space-y-2",children:p.items.map((W,J)=>e.jsxs("div",{className:"flex items-start justify-between text-sm text-slate-700 dark:text-slate-200",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[W.quantity," x ",W.partName]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[X(W.unitPrice||0)," / s·∫£n ph·∫©m"]})]}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:X(W.quantity*(W.unitPrice||0))})]},W.id))}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",X(S)]}):e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200",children:"‚úì ƒê√£ thanh to√°n"})}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-dashed border-slate-200 dark:border-slate-700",children:e.jsx("button",{onClick:()=>a({...p,date:new Date(p.date)}),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Ch·ªânh s·ª≠a"})})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-start",children:[e.jsx("div",{className:"col-span-1 flex items-start pt-1",children:e.jsx("input",{type:"checkbox",checked:k.has(p.receiptCode),onChange:W=>{const J=new Set(k);W.target.checked?J.add(p.receiptCode):J.delete(p.receiptCode),v(J)},className:"w-4 h-4 rounded border-slate-300"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:p.receiptCode}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[O," ",D]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"NV:"})," ",((H=(A=(I=p.items[0].notes)==null?void 0:I.split("NV:")[1])==null?void 0:A.split("NCC:")[0])==null?void 0:H.trim())||"Xu√¢n Nhan"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:p.supplier}),((U=p.items[0].notes)==null?void 0:U.includes("Phone:"))&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(z=p.items[0].notes.split("Phone:")[1])==null?void 0:z.trim()]})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"space-y-1",children:p.items.map((W,J)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:[e.jsxs("span",{className:"font-medium",children:[W.quantity," x"]})," ",W.partName,e.jsxs("span",{className:"text-slate-400 ml-1",children:["(",X(W.unitPrice||0),")"]})]},W.id))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"T·ªïng ti·ªÅn:"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:X(p.total)}),T?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["ƒê√£ tr·∫£: ",X(C)]}),e.jsxs("div",{className:"text-xs font-semibold text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",X(S)]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"‚ö†Ô∏è C√≤n n·ª£"})]}):e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:"‚úì ƒê√£ thanh to√°n"})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>a({...p,date:new Date(p.date)}),className:"p-1.5 text-blue-400 hover:bg-blue-500/20 rounded transition-colors",title:"Ch·ªânh s·ª≠a",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})})]})]},p.receiptCode)})]}),e.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Hi·ªÉn th·ªã ",g.length," phi·∫øu nh·∫≠p"]})}),s&&e.jsx(jn,{receipt:s,onClose:()=>a(null),onSave:async p=>{var _,O,D,E,C,S,T,R,P;try{const I=new Set(s.items.map(z=>z.id)),A=new Set(p.items.filter(z=>!z.id.startsWith("new-")).map(z=>z.id)),H=Array.from(I).filter(z=>!A.has(z));for(const z of H){const W=s.items.find(ne=>ne.id===z);if(!W)continue;const{data:J,error:oe}=await he.from("parts").select("stock").eq("id",W.partId).single();if(oe)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${oe.message}`);if(J){const ce=(((_=J.stock)==null?void 0:_[n])||0)-W.quantity;if(ce<0)throw new Error(`Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m "${W.partName}" v√¨ s·∫Ω l√†m t·ªìn kho √¢m`);const{error:M}=await he.from("parts").update({stock:{...J.stock,[n]:ce}}).eq("id",W.partId);if(M)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${M.message}`)}const{error:ue}=await he.from("inventory_transactions").delete().eq("id",z);if(ue)throw new Error(`Kh√¥ng th·ªÉ x√≥a giao d·ªãch: ${ue.message}`)}for(const z of p.items){if(z.id.startsWith("new-"))continue;const W=s.items.find(oe=>oe.id===z.id),{error:J}=await he.from("inventory_transactions").update({quantity:z.quantity,unitPrice:z.unitPrice,totalPrice:z.totalPrice,notes:`NV:${((E=(D=(O=p.items[0].notes)==null?void 0:O.split("NV:")[1])==null?void 0:D.split("NCC:")[0])==null?void 0:E.trim())||"Xu√¢n Nhan"} NCC:${p.supplier}${p.supplierPhone?` Phone:${p.supplierPhone}`:""}`}).eq("id",z.id);if(J)throw J;if(W&&W.quantity!==z.quantity){const oe=z.quantity-W.quantity,{data:ue,error:ne}=await he.from("parts").select("stock, id").eq("id",W.partId).single();if(ne)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${ne.message}`);if(ue){const ce=((C=ue.stock)==null?void 0:C[n])||0,M=ce+oe;if(M<0)throw new Error(`Kh√¥ng th·ªÉ gi·∫£m s·ªë l∆∞·ª£ng v√¨ s·∫Ω l√†m t·ªìn kho √¢m (hi·ªán c√≥: ${ce})`);const{error:w}=await he.from("parts").update({stock:{...ue.stock,[n]:M}}).eq("id",ue.id);if(w)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${w.message}`)}}}const U=p.items.filter(z=>z.id.startsWith("new-"));for(const z of U){const{data:W,error:J}=await he.from("parts").select("stock, id").eq("id",z.partId).single();if(J)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${J.message}`);if(W){const ne=(((S=W.stock)==null?void 0:S[n])||0)+z.quantity,{error:ce}=await he.from("parts").update({stock:{...W.stock,[n]:ne}}).eq("id",W.id);if(ce)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${ce.message}`)}const{error:oe}=await he.from("inventory_transactions").insert({type:"Nh·∫≠p kho",partId:z.partId,partName:z.partName,quantity:z.quantity,date:s.date.toISOString(),unitPrice:z.unitPrice,totalPrice:z.totalPrice,branchId:n,notes:`NV:${((P=(R=(T=p.items[0].notes)==null?void 0:T.split("NV:")[1])==null?void 0:R.split("NCC:")[0])==null?void 0:P.trim())||"Xu√¢n Nhan"} NCC:${p.supplier}${p.supplierPhone?` Phone:${p.supplierPhone}`:""}`});if(oe)throw new Error(`Kh√¥ng th·ªÉ t·∫°o giao d·ªãch m·ªõi: ${oe.message}`)}B.success(`ƒê√£ c·∫≠p nh·∫≠t phi·∫øu nh·∫≠p kho (${p.items.length} s·∫£n ph·∫©m)`),f.invalidateQueries({queryKey:["inventoryTransactions"]}),f.invalidateQueries({queryKey:["partsRepo"]}),f.invalidateQueries({queryKey:["partsRepoPaged"]}),a(null)}catch(I){B.error(`L·ªói c·∫≠p nh·∫≠t: ${I.message||"Kh√¥ng r√µ"}`)}},currentBranchId:n})]})},Bn=()=>{var Nr;const{currentBranchId:d}=rr(),{mutateAsync:f}=us(),b=hs(),{data:i=[]}=xs({branchId:d}),[c,m]=y.useState("stock"),[x,h]=y.useState(!1),[l,t]=y.useState(""),[r,s]=y.useState("all"),[a,n]=y.useState("all"),[o,u]=y.useState(!1),[g,k]=y.useState(1),[v,p]=y.useState(20),[_,O]=y.useState([]),[D,E]=y.useState(null),[C,S]=y.useState(!1),[T,R]=y.useState(!1),[P,I]=y.useState(null),[A,H]=y.useState(!1),[U,z]=y.useState(null),W=j=>{if(!j)return"#94a3b8";let $=0;for(let K=0;K<j.length;K++)$=j.charCodeAt(K)+(($<<5)-$);const V=($&16777215).toString(16).toUpperCase();return`#${"00000".substring(0,6-V.length)+V}`},{confirm:J,confirmState:oe,handleConfirm:ue,handleCancel:ne}=os(),{data:ce,isLoading:M,isError:w}=Ma({page:g,pageSize:v,search:l,category:r==="all"?void 0:r}),q=(ce==null?void 0:ce.data)||[],Y=((Nr=ce==null?void 0:ce.meta)==null?void 0:Nr.total)||0,de=Math.max(1,Math.ceil(Y/v)),{data:ie,refetch:Me}=ht({queryKey:["allPartsForTotals",d,l,r],queryFn:async()=>{console.log("üîÑ Fetching allPartsForTotals...");let j=he.from("parts").select("id, name, sku, stock, costPrice, retailPrice").order("name");if(r&&r!=="all"&&(j=j.eq("category",r)),l&&l.trim()){const K=l.trim();j=j.or(`name.ilike.%${K}%,sku.ilike.%${K}%`)}const{data:$,error:V}=await j;if(V)throw V;return console.log(`‚úÖ Fetched ${($==null?void 0:$.length)||0} parts`),$||[]},staleTime:5e3}),fe=y.useMemo(()=>{if(!ie)return{totalProducts:0,inStock:0,lowStock:0,outOfStock:0};const j={totalProducts:ie.length,inStock:0,lowStock:0,outOfStock:0},$=d||"";return ie.forEach(V=>{var le;const K=((le=V.stock)==null?void 0:le[$])||0;K>0&&(j.inStock+=1),K===0&&(j.outOfStock+=1),K>0&&K<=Ie&&(j.lowStock+=1)}),j},[ie,d]),Ge=y.useMemo(()=>[{id:"all",label:"T·∫•t c·∫£",description:"To√†n b·ªô kho",count:fe.totalProducts,variant:"neutral"},{id:"in-stock",label:"C√≤n h√†ng",description:"> 0",count:fe.inStock,variant:"success"},{id:"low-stock",label:"S·∫Øp h·∫øt",description:`<= ${Ie}`,count:fe.lowStock,variant:"warning"},{id:"out-of-stock",label:"H·∫øt h√†ng",description:"= 0",count:fe.outOfStock,variant:"danger"}],[fe]),L=y.useMemo(()=>{if(!ie)return new Set;const j=new Map;ie.forEach(V=>{if(!V.sku)return;const K=j.get(V.sku)||0;j.set(V.sku,K+1)});const $=new Set(Array.from(j.entries()).filter(([V,K])=>K>1).map(([V,K])=>V));return console.log(`üîç Detected ${$.size} duplicate product SKUs from ${ie.length} parts`),$.size>0&&console.log("Duplicate SKUs:",Array.from($).slice(0,5)),$},[ie]),re=y.useCallback(j=>L.has(j),[L]),{data:se}=ht({queryKey:["duplicateParts",d,Array.from(L)],queryFn:async()=>{if(L.size===0)return[];console.log(`üîç Fetching all duplicate parts for ${L.size} SKUs...`);const{data:j,error:$}=await he.from("parts").select("*").in("sku",Array.from(L)).order("sku");if($)throw $;return console.log(`‚úÖ Found ${(j==null?void 0:j.length)||0} parts with duplicate SKUs`),j||[]},enabled:o&&L.size>0,staleTime:5e3}),te=y.useMemo(()=>{const j=o&&L.size>0?se||[]:q;if(a==="all")return j;const $=d||"";return j.filter(V=>{var le;const K=((le=V.stock)==null?void 0:le[$])||0;return a==="in-stock"?K>0:a==="low-stock"?K>0&&K<=Ie:a==="out-of-stock"?K===0:!0})},[q,o,L,se,a,d]);y.useEffect(()=>{o&&L.size===0&&u(!1)},[o,L.size]);const be=y.useMemo(()=>ie?ie.reduce((j,$)=>{var V;return j+(((V=$.stock)==null?void 0:V[d])||0)},0):0,[ie,d]),N=y.useMemo(()=>ie?ie.reduce((j,$)=>{var le,ye;const V=((le=$.stock)==null?void 0:le[d])||0,K=((ye=$.costPrice)==null?void 0:ye[d])||0;return j+V*K},0):0,[ie,d]),G=gr(),Z=as();pr();const Q=ss(),{data:ae=[]}=vr(),{profile:ee}=La(),ge=y.useCallback(async(j,$,V,K,le)=>{const ye=new Date,Pe=ye.toISOString().split("T")[0].replace(/-/g,""),Ce=`NH-${Pe}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;console.log("üì¶ Saving goods receipt:",{receiptCode:Ce,supplierId:$,totalAmount:V,paymentInfo:le,itemCount:j.length});const{data:Te}=await he.from("suppliers").select("name").eq("id",$).single(),Le=(Te==null?void 0:Te.name)||"Kh√¥ng x√°c ƒë·ªãnh",Ae=(le==null?void 0:le.paidAmount)||0,Re=V-Ae;try{if(await b.mutateAsync({items:j.map(xe=>({partId:xe.partId,partName:xe.partName,quantity:xe.quantity,importPrice:xe.importPrice,sellingPrice:xe.sellingPrice,wholesalePrice:xe.wholesalePrice||0})),supplierId:$,branchId:d,userId:(ee==null?void 0:ee.id)||"unknown",notes:`${Ce} | NCC: ${Le}${K?" | "+K:""}`}),Re>0&&le){const xe=`DEBT-${Pe}-${Math.random().toString(36).substring(2,5).toUpperCase()}`,{error:Oe}=await he.from("supplier_debts").insert({id:xe,supplier_id:$,supplier_name:Le,branch_id:d,total_amount:Re,paid_amount:0,remaining_amount:Re,description:`Nh·∫≠p kho ${Ce} - Thanh to√°n ${Ae.toLocaleString()}/${V.toLocaleString()} ƒë`,created_date:ye.toISOString().split("T")[0],created_at:ye.toISOString()});Oe?(console.error("‚ùå Error creating debt:",Oe),B.error("L·ªói t·∫°o c√¥ng n·ª£: "+Oe.message)):console.log(`‚úÖ Created supplier debt: ${Re.toLocaleString()} ƒë`)}h(!1),B.success(`Nh·∫≠p kho th√†nh c√¥ng! M√£ phi·∫øu: ${Ce}`),xr((ee==null?void 0:ee.id)||null,{action:"inventory.receipt",tableName:"inventory_transactions",oldData:null,newData:{receiptCode:Ce,supplierId:$,supplierName:Le,items:j.map(xe=>({partId:xe.partId,quantity:xe.quantity,importPrice:xe.importPrice,sellingPrice:xe.sellingPrice})),totalAmount:V,paidAmount:Ae,debtAmount:Re,paymentInfo:le}})}catch(xe){console.error("üõë L·ªói l∆∞u phi·∫øu nh·∫≠p kho:",xe),B.error(`L·ªói: ${xe.message||"Kh√¥ng r√µ"}`)}},[ie,d,Z,f,ee==null?void 0:ee.id]),ve=j=>{O(j?te.map($=>$.id):[])},Ve=(j,$)=>{O($?[..._,j]:_.filter(V=>V!==j))},yr=async j=>{const $=q.find(K=>K.id===j);!$||!await J({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m "${$.name}"?`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"})||Q.mutate({id:j},{onSuccess:async()=>{O(K=>K.filter(le=>le!==j)),await Me(),console.log("üîÑ Refetched allPartsForTotals after delete"),B.success(`ƒê√£ x√≥a ph·ª• t√πng "${$.name}"`)},onError:K=>{console.error("Delete error:",K),B.error(`Kh√¥ng th·ªÉ x√≥a: ${K.message}`)}})},Xa=async()=>{if(_.length===0){B.warning("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m");return}if(!await J({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ${_.length} s·∫£n ph·∫©m ƒë√£ ch·ªçn? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"}))return;let $=0,V=0;const K=_.length;_.forEach((le,ye)=>{Q.mutate({id:le},{onSuccess:async()=>{$++,$+V===K&&(await Me(),console.log("üîÑ Refetched allPartsForTotals after bulk delete"),V===0?B.success(`ƒê√£ x√≥a ${$} ph·ª• t√πng`):B.warning(`ƒê√£ x√≥a ${$}/${K} ph·ª• t√πng (${V} l·ªói)`))},onError:Pe=>{console.error(`Delete error for item ${le}:`,Pe),V++,$+V===K&&($===0?B.error(`Kh√¥ng th·ªÉ x√≥a ${K} ph·ª• t√πng`):B.warning(`ƒê√£ x√≥a ${$}/${K} ph·ª• t√πng (${V} l·ªói)`))}})}),O([])},lr=j=>{k(1),n(j)},Wa=j=>{k(1),s(j)},Qa=fe.lowStock>0&&a!=="low-stock";fe.totalProducts>0&&Math.round(fe.lowStock/fe.totalProducts*100);const jr=()=>{try{const j=new Date,$=`ton-kho-${j.getDate()}-${j.getMonth()+1}-${j.getFullYear()}.xlsx`;vs(q,d,$),B.success("Xu·∫•t file Excel th√†nh c√¥ng!")}catch(j){console.error("Export error:",j),B.error("C√≥ l·ªói khi xu·∫•t file Excel")}},wr=()=>{try{ks(),B.success("T·∫£i template th√†nh c√¥ng! Vui l√≤ng ƒëi·ªÅn th√¥ng tin v√† import l·∫°i.")}catch(j){console.error("Template download error:",j),B.error("C√≥ l·ªói khi t·∫£i template")}};return y.useEffect(()=>{if(typeof document>"u")return;const j=()=>z(null);return document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[]),e.jsxs("div",{className:"h-full flex flex-col bg-slate-50 dark:bg-slate-900 sm:bg-[#1e293b]",children:[e.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-1",children:[{key:"stock",label:"T·ªìn kho",icon:e.jsx(or,{className:"w-3.5 h-3.5"})},{key:"categories",label:"Danh m·ª•c",icon:e.jsx(Zt,{className:"w-3.5 h-3.5"})},{key:"lookup",label:"Tra c·ª©u",icon:e.jsx(dt,{className:"w-3.5 h-3.5"})},{key:"history",label:"L·ªãch s·ª≠",icon:e.jsx(ir,{className:"w-3.5 h-3.5"})}].map(j=>e.jsx("button",{onClick:()=>m(j.key),className:`px-2.5 py-1.5 rounded-md text-xs font-medium transition-colors ${c===j.key?"bg-blue-600 text-white":"text-secondary-text hover:bg-tertiary-bg"}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[j.icon,j.label]})},j.key))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-emerald-600 text-white text-xs font-medium hover:bg-emerald-700 transition",title:"In m√£ v·∫°ch h√†ng lo·∫°t",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"In m√£ v·∫°ch"]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 transition",children:[e.jsx(er,{className:"w-3.5 h-3.5"}),"T·∫°o phi·∫øu nh·∫≠p"]}),e.jsxs("div",{className:"flex items-center gap-0.5 rounded-lg border border-primary-border bg-tertiary-bg px-1 py-0.5",children:[e.jsx("button",{onClick:()=>{B.info("T√≠nh nƒÉng chuy·ªÉn kho ƒëang ph√°t tri·ªÉn")},className:"p-1.5 rounded-md text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Chuy·ªÉn kho",children:e.jsx(Pr,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:jr,className:"p-1.5 rounded-md text-secondary-text hover:text-emerald-600 hover:bg-primary-bg transition",title:"Xu·∫•t Excel",children:e.jsx(bs,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>S(!0),className:"p-1.5 rounded-md text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Nh·∫≠p CSV",children:e.jsx(fs,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:wr,className:"p-1.5 rounded-md text-secondary-text hover:text-amber-600 hover:bg-primary-bg transition",title:"T·∫£i m·∫´u import",children:e.jsx(ir,{className:"w-3.5 h-3.5"})})]})]})]})}),e.jsxs("div",{className:"sm:hidden bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:l,onChange:j=>{k(1),t(j.target.value)},className:"w-full pl-10 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1.5 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition whitespace-nowrap",children:[e.jsx(er,{className:"w-4 h-4"}),"T·∫°o phi·∫øu"]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"T·ªïng:"}),e.jsxs("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:[be.toLocaleString()," sp"]})]}),e.jsx("div",{className:"h-3 w-px bg-slate-300 dark:bg-slate-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gi√° tr·ªã:"}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:X(N)})]})]})})]}),c==="stock"&&e.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-4 py-2",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-blue-500/20 bg-blue-500/5",children:[e.jsx(or,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-bold text-primary-text",children:be.toLocaleString()}),e.jsx("span",{className:"text-[10px] text-secondary-text ml-1",children:"sp"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-emerald-500/20 bg-emerald-500/5",children:[e.jsx(Zt,{className:"w-4 h-4 text-emerald-600"}),e.jsx("div",{children:e.jsx("span",{className:"text-lg font-bold text-primary-text",children:X(N)})})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:l,onChange:j=>{k(1),t(j.target.value)},className:"w-full pl-9 pr-16 py-1.5 text-sm border border-primary-border rounded-lg bg-primary-bg text-primary-text focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-secondary-text",children:[te.length,"/",Y]})]}),e.jsxs("button",{onClick:()=>H(j=>!j),className:`flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded-lg border transition flex-shrink-0 ${A?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-primary-border text-secondary-text hover:text-primary-text"}`,children:[e.jsx(gs,{className:"w-3.5 h-3.5"}),"B·ªô l·ªçc n√¢ng cao"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Ge.map(j=>{const $=a===j.id,V={neutral:$?"bg-slate-600 text-white":"bg-slate-100 dark:bg-slate-800 text-secondary-text hover:bg-slate-200 dark:hover:bg-slate-700",success:$?"bg-emerald-600 text-white":"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-100",warning:$?"bg-amber-600 text-white":"bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 hover:bg-amber-100",danger:$?"bg-red-600 text-white":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 hover:bg-red-100"};return e.jsxs("button",{onClick:()=>lr(j.id),className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium transition ${V[j.variant||"neutral"]}`,children:[e.jsx("span",{children:j.label}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] font-bold ${$?"bg-white/20":"bg-black/10 dark:bg-white/10"}`,children:j.count})]},j.id)}),Qa&&e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-amber-700 dark:text-amber-400",children:[e.jsxs("span",{className:"text-xs",children:["‚ö†Ô∏è ",fe.lowStock," s·∫Øp h·∫øt"]}),e.jsx("button",{onClick:()=>lr("low-stock"),className:"px-2 py-0.5 rounded text-[10px] font-semibold bg-amber-600 text-white hover:bg-amber-700",children:"L·ªçc"})]})]}),A&&e.jsxs("div",{className:"rounded-xl border border-primary-border bg-white/70 dark:bg-slate-900/40 p-3 grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Tr·∫°ng th√°i t·ªìn kho"}),e.jsxs("select",{value:a,onChange:j=>lr(j.target.value),className:"mt-1 w-full rounded-lg border border-secondary-border bg-primary-bg px-3 py-1.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ t·ªìn kho"}),e.jsx("option",{value:"in-stock",children:"C√≤n h√†ng"}),e.jsx("option",{value:"low-stock",children:"S·∫Øp h·∫øt"}),e.jsx("option",{value:"out-of-stock",children:"H·∫øt h√†ng"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Danh m·ª•c"}),e.jsxs("select",{value:r,onChange:j=>Wa(j.target.value),className:"mt-1 w-full rounded-lg border border-secondary-border bg-primary-bg px-3 py-1.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),ae.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("div",{className:"flex flex-col justify-end",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Ph√°t hi·ªán tr√πng m√£"}),e.jsx("button",{onClick:()=>u(j=>!j),className:`mt-1 rounded-lg border px-3 py-1.5 text-sm font-medium transition ${o?"border-orange-500 text-orange-600 bg-orange-50 dark:bg-orange-900/20":"border-secondary-border text-secondary-text hover:text-primary-text"}`,children:o?"ƒêang l·ªçc tr√πng m√£":"L·ªçc tr√πng m√£"})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-3",children:[c==="stock"&&e.jsxs("div",{className:"space-y-2",children:[L.size>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 px-3 py-2 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"‚ö†Ô∏è"}),e.jsxs("span",{className:"text-xs font-semibold text-orange-800 dark:text-orange-300",children:["Ph√°t hi·ªán ",L.size," s·∫£n ph·∫©m tr√πng m√£"]})]}),e.jsx("button",{onClick:()=>u(!o),className:`px-2 py-0.5 rounded text-[10px] font-medium transition ${o?"bg-orange-600 text-white":"bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300"}`,children:o?"‚úì ƒêang l·ªçc":"üîç L·ªçc"})]}),e.jsxs("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[_.length>0&&e.jsxs("div",{className:"px-4 py-2 bg-blue-100 dark:bg-blue-900/30 border-b border-primary-border flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs font-medium text-blue-900 dark:text-blue-100",children:["ƒê√£ ch·ªçn ",_.length," s·∫£n ph·∫©m"]}),e.jsxs("button",{onClick:Xa,className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"X√≥a ƒë√£ ch·ªçn"]})]}),e.jsx("div",{className:"block sm:hidden",children:e.jsx("div",{className:"space-y-3 p-3",children:te.map((j,$)=>{const V=j.stock[d]||0,K=j.retailPrice[d]||0,le=re(j.sku||"");return e.jsx("div",{className:`p-3 rounded-xl bg-[#2d3748] border border-slate-600 transition ${le?"border-l-4 border-l-orange-500":""}`,role:"listitem",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[15px] font-medium text-white leading-tight",children:j.name}),e.jsxs("div",{className:"text-[12px] text-slate-400 mt-1 truncate",children:["SKU: ",j.sku]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("div",{className:"text-[13px] text-emerald-400 font-semibold",children:X(K)})})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 text-sm font-bold rounded-lg ${V===0?"text-red-300 bg-red-900/40 border border-red-700/50":V<Ie?"text-yellow-300 bg-yellow-900/40 border border-yellow-700/50":"text-emerald-300 bg-emerald-900/40 border border-emerald-700/50"}`,children:[e.jsx("span",{className:"text-xs opacity-80",children:"SL:"}),V]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>I(P===$?null:$),"aria-haspopup":"true","aria-expanded":P===$,"aria-label":"Th√™m h√†nh ƒë·ªông",className:"p-2.5 -m-1 text-slate-400 hover:bg-slate-600 rounded-lg transition active:bg-slate-500",children:e.jsx(Er,{className:"w-5 h-5"})}),P===$&&e.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-50",children:[e.jsxs("button",{onClick:()=>{E(j),I(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-white","aria-label":`Ch·ªânh s·ª≠a ${j.name}`,children:[e.jsx(Or,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{children:"Ch·ªânh s·ª≠a"})]}),e.jsxs("button",{onClick:()=>{yr(j.id),I(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-red-400","aria-label":`X√≥a ${j.name}`,children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsx("span",{children:"X√≥a"})]})]})]})]})]})},j.id)})})}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-tertiary-bg",children:e.jsxs("tr",{className:"border-b border-primary-border text-[10px] font-semibold uppercase tracking-wider text-secondary-text",children:[e.jsx("th",{className:"px-3 py-2.5 text-center w-10",children:e.jsx("input",{type:"checkbox",checked:_.length===te.length&&te.length>0,onChange:j=>ve(j.target.checked),className:"w-3.5 h-3.5 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),e.jsx("th",{className:"px-3 py-2.5 text-left",children:"S·∫£n ph·∫©m"}),e.jsx("th",{className:"px-3 py-2.5 text-center",children:"T·ªìn kho"}),e.jsx("th",{className:"px-3 py-2.5 text-right",children:"Gi√° nh·∫≠p"}),e.jsx("th",{className:"px-3 py-2.5 text-right",children:"Gi√° b√°n l·∫ª"}),e.jsx("th",{className:"px-3 py-2.5 text-right",children:"Gi√° b√°n s·ªâ"}),e.jsx("th",{className:"px-3 py-2.5 text-right",children:"Gi√° tr·ªã t·ªìn"}),e.jsx("th",{className:"px-3 py-2.5 text-center w-14",children:"H√†nh ƒë·ªông"})]})}),e.jsx("tbody",{className:"bg-primary-bg divide-y divide-primary-border",children:te.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-4 py-6 text-center text-tertiary-text",children:[e.jsx("div",{className:"text-4xl mb-2",children:"üóÇÔ∏è"}),e.jsx("div",{className:"text-sm",children:"Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o"}),e.jsx("div",{className:"text-xs",children:"H√£y th·ª≠ m·ªôt b·ªô l·ªçc kh√°c ho·∫∑c th√™m s·∫£n ph·∫©m m·ªõi"})]})}):te.map(j=>{var Be,rt,Ue,Ke,Xe,We;const $=d||"",V=((Be=j.stock)==null?void 0:Be[$])||0,K=((rt=j.retailPrice)==null?void 0:rt[$])||0,le=((Ue=j.wholesalePrice)==null?void 0:Ue[$])||0,ye=((Ke=j.costPrice)==null?void 0:Ke[$])||0,Pe=V*K,Ce=_.includes(j.id),Te=re(j.sku||""),Le=V===0?"border-red-300 bg-red-50 text-red-700 dark:border-red-700 dark:bg-red-950/50 dark:text-red-300":V<=Ie?"border-amber-300 bg-amber-50 text-amber-700 dark:border-amber-600 dark:bg-amber-950/50 dark:text-amber-300":"border-emerald-300 bg-emerald-50 text-emerald-700 dark:border-emerald-600 dark:bg-emerald-950/50 dark:text-emerald-300",Ae=V===0?"H·∫øt h√†ng":V<=Ie?"S·∫Øp h·∫øt":"·ªîn ƒë·ªãnh",Re=V===0?"text-red-600 dark:text-red-400":V<=Ie?"text-amber-600 dark:text-amber-400":"text-emerald-700 dark:text-emerald-400",xe=((We=(Xe=j.name)==null?void 0:Xe.charAt(0))==null?void 0:We.toUpperCase())||"?",Oe=Ce?"bg-blue-900/20 dark:bg-blue-900/20":Te?"bg-orange-500/10 border-l-4 border-l-orange-500":"";return e.jsxs("tr",{className:`border-b border-primary-border hover:bg-tertiary-bg transition-colors ${Oe}`,children:[e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("input",{type:"checkbox",checked:Ce,onChange:je=>Ve(j.id,je.target.checked),className:"w-3.5 h-3.5 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),e.jsx("td",{className:"px-3 py-2 min-w-[180px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg overflow-hidden flex items-center justify-center text-sm font-semibold text-white flex-shrink-0",style:j.imageUrl?void 0:{backgroundColor:W(j.category)},children:j.imageUrl?e.jsx("img",{src:j.imageUrl,alt:j.name,className:"h-full w-full object-cover"}):e.jsx("span",{children:xe})}),e.jsxs("div",{className:"flex flex-col gap-0.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold text-primary-text truncate",children:[j.name,Te&&e.jsx("span",{className:"inline-flex items-center gap-0.5 rounded-full border border-orange-300 bg-orange-50 px-1.5 py-0 text-[9px] font-semibold text-orange-700 dark:bg-orange-900/30 flex-shrink-0",title:"S·∫£n ph·∫©m c√≥ m√£ tr√πng l·∫∑p",children:"‚ö†Ô∏è Tr√πng"})]}),e.jsx("div",{className:"text-[10px] text-tertiary-text font-mono",children:j.barcode?e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["M√£: ",j.barcode]}):e.jsxs("span",{children:["SKU: ",j.sku||"N/A"]})}),e.jsx("div",{className:"text-[10px] text-tertiary-text truncate",children:j.category||"Ch∆∞a ph√¢n lo·∫°i"})]})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("span",{className:`text-sm font-semibold ${Re}`,children:V.toLocaleString()}),e.jsxs("span",{className:`inline-flex items-center gap-0.5 rounded-full border px-1.5 py-0 text-[9px] font-semibold ${Le}`,children:[e.jsx("span",{className:`h-1 w-1 rounded-full ${V===0?"bg-red-500":V<=Ie?"bg-amber-500":"bg-emerald-500"}`}),Ae]})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right text-xs text-secondary-text",children:X(ye)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right text-xs font-medium text-primary-text",children:X(K)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right text-xs text-secondary-text",children:X(le)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-right text-xs font-semibold text-primary-text",children:X(Pe)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-center",children:e.jsxs("div",{className:"relative flex justify-end",children:[e.jsx("button",{onClick:je=>{je.stopPropagation(),z(F=>F===j.id?null:j.id)},className:"rounded-full border border-transparent p-2 text-secondary-text hover:border-secondary-border hover:text-primary-text transition","aria-haspopup":"menu","aria-expanded":U===j.id,title:"Thao t√°c nhanh",children:e.jsx(Er,{className:"w-5 h-5"})}),U===j.id&&e.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-44 overflow-hidden rounded-xl border border-primary-border bg-white shadow-xl dark:bg-slate-800",onClick:je=>je.stopPropagation(),children:[e.jsxs("button",{onClick:je=>{je.stopPropagation(),E(j),z(null)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm hover:bg-blue-50 dark:hover:bg-slate-700",children:[e.jsx(Or,{className:"h-4 w-4 text-blue-500"}),"Ch·ªânh s·ª≠a"]}),e.jsxs("button",{onClick:je=>{je.stopPropagation(),z(null),yr(j.id)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-red-500 hover:bg-red-50 dark:hover:bg-slate-700/70",children:[e.jsx(Sr,{className:"h-4 w-4"}),"X√≥a"]})]})]})})]},j.id)})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 px-3 sm:px-6 py-3 sm:py-4 border-t border-primary-border bg-primary-bg",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-secondary-text text-center sm:text-left",children:[e.jsxs("span",{className:"font-medium",children:["Trang ",g,"/",de]}),e.jsx("span",{className:"mx-1",children:"‚Ä¢"}),e.jsxs("span",{children:[Y," ph·ª• t√πng"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("button",{disabled:g===1||M,onClick:()=>k(j=>Math.max(1,j-1)),className:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm border border-secondary-border rounded disabled:opacity-40 hover:bg-slate-700/50 transition-colors",children:"‚Üê"}),e.jsx("span",{className:"px-2 py-1 text-xs sm:text-sm font-medium text-slate-300 min-w-[2rem] text-center",children:g}),e.jsx("button",{disabled:g>=de||M,onClick:()=>k(j=>Math.min(de,j+1)),className:"px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm border border-secondary-border rounded disabled:opacity-40 hover:bg-slate-700/50 transition-colors",children:"‚Üí"}),e.jsx("select",{value:v,onChange:j=>{const $=Number(j.target.value)||20;p($),k(1)},className:"px-1.5 sm:px-2 py-1.5 text-xs sm:text-sm border border-secondary-border rounded bg-slate-800 text-slate-200",children:[10,20,50,100].map(j=>e.jsx("option",{value:j,children:j},j))})]})]})]})]}),c==="history"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(wn,{transactions:i})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Es,{transactions:i})})]}),c==="categories"&&e.jsx("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:e.jsx(is,{})}),c==="lookup"&&e.jsxs("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(cs,{})}),e.jsx("div",{className:"sm:hidden",children:e.jsx(js,{})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(vn,{isOpen:x,onClose:()=>h(!1),parts:ie||[],currentBranchId:d,onSave:ge})}),e.jsx(pn,{isOpen:x,onClose:()=>h(!1),parts:ie||[],currentBranchId:d,onSave:ge}),T&&e.jsx(gn,{parts:ie||[],currentBranchId:d,onClose:()=>R(!1)}),D&&e.jsx(_n,{part:D,onClose:()=>E(null),onSave:j=>{console.log("üíæ Saving part updates:",j);const $={name:j.name,barcode:j.barcode,category:j.category,stock:j.stock,retailPrice:j.retailPrice,wholesalePrice:j.wholesalePrice};j.costPrice&&($.costPrice=j.costPrice),console.log("üì§ Sending updates:",$),Z.mutate({id:j.id,updates:$}),E(null)},currentBranchId:d}),C&&e.jsx(Nn,{onClose:()=>S(!1),onDownloadTemplate:wr,onImport:async j=>{var $,V;try{const{items:K,errors:le}=await ys(j,d);if(K.length===0){const F=le.length?`Kh√¥ng import ƒë∆∞·ª£c: ${le.slice(0,3).join("; ")}`:"File kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá";throw new Error(F)}const ye=K.map(F=>F.sku);console.log(`üîç Checking ${ye.length} SKUs...`);const Pe=new Map;ye.forEach(F=>{Pe.set(F,(Pe.get(F)||0)+1)});const Ce=Array.from(Pe.entries()).filter(([F,pe])=>pe>1).map(([F,pe])=>`${F}(${pe}x)`);Ce.length>0&&console.warn(`‚ö†Ô∏è Duplicate SKUs in file: ${Ce.slice(0,5).join(", ")}`);const Te=Array.from(new Set(ye)),Le=100,Ae=[];for(let F=0;F<Te.length;F+=Le){const pe=Te.slice(F,F+Le),{data:Se,error:Qe}=await he.from("parts").select("*").in("sku",pe);if(Qe)throw console.error(`‚ùå Fetch chunk ${F/Le+1} error:`,Qe),new Error(`L·ªói ki·ªÉm tra ph·ª• t√πng: ${Qe.message}`);Se&&Ae.push(...Se)}console.log(`‚úÖ Found ${Ae.length} existing parts`);const Re=new Map(Ae.map(F=>[F.sku,F])),xe=[],Oe=[],Be=[],rt=new Set;let Ue=0,Ke=0,Xe=0;const We=new Date().toISOString();for(const F of K){if(rt.has(F.sku)){console.warn(`‚ö†Ô∏è Skipping duplicate SKU in file: ${F.sku}`),Xe++;continue}rt.add(F.sku);const pe=Re.get(F.sku);if(pe)Ke+=1,Oe.push({id:pe.id,stock:{...pe.stock,[d]:(pe.stock[d]||0)+F.quantity},costPrice:{...pe.costPrice,[d]:F.costPrice},retailPrice:{...pe.retailPrice,[d]:F.retailPrice},wholesalePrice:{...pe.wholesalePrice,[d]:F.wholesalePrice}}),Be.push({type:"Nh·∫≠p kho",date:We,branchId:d,partId:pe.id,partName:F.name,quantity:F.quantity,unitPrice:F.retailPrice,totalPrice:F.quantity*F.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"});else{Ue+=1;const Se=(($=crypto==null?void 0:crypto.randomUUID)==null?void 0:$.call(crypto))||`${Math.random().toString(36).slice(2)}-${Date.now()}`;xe.push({id:Se,name:F.name,sku:F.sku,category:F.category,description:F.description,stock:{[d]:F.quantity},costPrice:{[d]:F.costPrice},retailPrice:{[d]:F.retailPrice},wholesalePrice:{[d]:F.wholesalePrice}}),Be.push({type:"Nh·∫≠p kho",date:We,branchId:d,partId:Se,partName:F.name,quantity:F.quantity,unitPrice:F.retailPrice,totalPrice:F.quantity*F.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"})}}if(xe.length>0){const{data:F,error:pe}=await he.from("parts").insert(xe).select();if(pe)throw console.error("‚ùå Batch create error:",pe),new Error(`L·ªói t·∫°o ph·ª• t√πng: ${pe.message}`);console.log(`‚úÖ Created ${(F==null?void 0:F.length)||0} parts`)}if(Oe.length>0){let F=0,pe=0;for(const Se of Oe){const{error:Qe}=await he.from("parts").update({stock:Se.stock,costPrice:Se.costPrice,retailPrice:Se.retailPrice,wholesalePrice:Se.wholesalePrice}).eq("id",Se.id);Qe?(console.error(`‚ùå Update error for part ${Se.id}:`,Qe),pe++):F++}console.log(`‚úÖ Updated ${F}/${Oe.length} parts`)}if(Be.length>0){const{error:F}=await he.from("inventory_transactions").insert(Be);F&&console.warn("‚ö†Ô∏è Inventory transactions error:",F)}G.invalidateQueries({queryKey:["partsRepo"]}),G.invalidateQueries({queryKey:["partsRepoPaged"]});try{const{data:F}=await he.auth.getUser();await xr(((V=F==null?void 0:F.user)==null?void 0:V.id)||null,{action:"inventory.import",tableName:"inventory_transactions",oldData:null,newData:{totalRows:K.length+le.length,created:Ue,updated:Ke,skipped:le.length,sampleErrors:le.slice(0,10),branchId:d,at:We}})}catch{}S(!1);let je=`Import: t·∫°o m·ªõi ${Ue}, c·∫≠p nh·∫≠t ${Ke}`;Xe>0&&(je+=`, b·ªè qua ${Xe} SKU tr√πng`),le.length>0&&(je+=`, ${le.length} d√≤ng l·ªói`),B.success(je)}catch(K){console.error("‚ùå Import error:",K),B.error(`L·ªói import: ${K}`)}}}),e.jsx(ds,{isOpen:oe.isOpen,title:oe.title,message:oe.message,confirmText:oe.confirmText,cancelText:oe.cancelText,confirmColor:oe.confirmColor,onConfirm:ue,onCancel:ne}),e.jsxs("div",{className:"sm:hidden fixed bottom-20 right-4 z-40 flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>h(!0),className:"w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-full shadow-lg shadow-green-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"T·∫°o phi·∫øu nh·∫≠p",children:e.jsx(er,{className:"w-5 h-5"})}),e.jsx("button",{onClick:jr,className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-full shadow-lg shadow-orange-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"Xu·∫•t Excel",children:e.jsx(Pr,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 z-50 safe-area-bottom",children:[e.jsx("div",{className:"absolute inset-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg -z-10"}),e.jsxs("div",{className:"grid grid-cols-4 gap-1 px-2 py-2",children:[e.jsxs("button",{onClick:()=>m("stock"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="stock"?"bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(or,{className:`w-5 h-5 ${c==="stock"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="stock"?"font-semibold":""}`,children:"T·ªìn kho"})]}),e.jsxs("button",{onClick:()=>m("categories"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="categories"?"bg-purple-100 dark:bg-purple-900/40 text-purple-600 dark:text-purple-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(Zt,{className:`w-5 h-5 ${c==="categories"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="categories"?"font-semibold":""}`,children:"Danh m·ª•c"})]}),e.jsxs("button",{onClick:()=>m("lookup"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="lookup"?"bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(dt,{className:`w-5 h-5 ${c==="lookup"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="lookup"?"font-semibold":""}`,children:"Tra c·ª©u"})]}),e.jsxs("button",{onClick:()=>m("history"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${c==="history"?"bg-green-100 dark:bg-green-900/40 text-green-600 dark:text-green-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[e.jsx(ir,{className:`w-5 h-5 ${c==="history"?"scale-110":""} transition-transform`}),e.jsx("span",{className:`text-[10px] font-medium ${c==="history"?"font-semibold":""}`,children:"L·ªãch s·ª≠"})]})]})]})]})},Nn=({onClose:d,onDownloadTemplate:f,onImport:b})=>{const[i,c]=y.useState(null),[m,x]=y.useState(!1),h=t=>{var s,a;const r=(s=t.target.files)==null?void 0:s[0];if(r){const n=(a=r.name.split(".").pop())==null?void 0:a.toLowerCase();n==="xlsx"||n==="xls"||n==="csv"?c(r):B.warning("Vui l√≤ng ch·ªçn file Excel (.xlsx, .xls) ho·∫∑c CSV (.csv)")}},l=async()=>{if(!i){B.warning("Vui l√≤ng ch·ªçn file ƒë·ªÉ import");return}x(!0);try{await b(i)}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Nh·∫≠p t·ªìn kho t·ª´ Excel/CSV"}),e.jsx("button",{onClick:d,disabled:m,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng"}),e.jsxs("ol",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"T·∫£i file template m·∫´u"}),e.jsx("li",{children:"ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m v√†o file"}),e.jsx("li",{children:"L∆∞u file v√† ch·ªçn ƒë·ªÉ import"})]}),e.jsx("button",{onClick:f,className:"mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"üì• T·∫£i Template Excel"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ch·ªçn file ƒë·ªÉ import"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:h,disabled:m,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-slate-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Click ƒë·ªÉ ch·ªçn file Excel ho·∫∑c CSV"}),i&&e.jsxs("span",{className:"mt-2 text-sm font-medium text-blue-600 dark:text-blue-400",children:["‚úì ",i.name]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:d,disabled:m,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"H·ªßy"}),e.jsx("button",{onClick:l,disabled:!i||m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"ƒêang x·ª≠ l√Ω...":"Import"})]})]})]})})},_n=({part:d,onClose:f,onSave:b,currentBranchId:i})=>{var u,g;const[c,m]=y.useState({name:d.name,barcode:d.barcode||"",category:d.category||"",retailPrice:d.retailPrice[i]||0,wholesalePrice:((u=d.wholesalePrice)==null?void 0:u[i])||0,costPrice:((g=d.costPrice)==null?void 0:g[i])||0,stock:d.stock[i]||0}),[x,h]=y.useState(!1),{data:l=[]}=vr(),t=$a(),[r,s]=y.useState(!1),[a,n]=y.useState(""),o=k=>{if(k.preventDefault(),!c.name.trim()){B.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}b({id:d.id,name:c.name.trim(),barcode:c.barcode.trim()||void 0,category:c.category.trim()||void 0,stock:{...d.stock,[i]:c.stock},costPrice:{...d.costPrice,[i]:c.costPrice},retailPrice:{...d.retailPrice,[i]:c.retailPrice},wholesalePrice:{...d.wholesalePrice,[i]:c.wholesalePrice}})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Ch·ªânh s·ª≠a s·∫£n ph·∫©m"}),e.jsx("button",{onClick:f,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.name,onChange:k=>m({...c,name:k.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√£ s·∫£n ph·∫©m"}),e.jsx("input",{type:"text",value:c.barcode,onChange:k=>m({...c,barcode:k.target.value}),placeholder:"VD: 06455-KYJ-841 (Honda), 5S9-F2101-00 (Yamaha)",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-mono"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Nh·∫≠p m√£ h√£ng (Honda/Yamaha) ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ t·ª± sinh m√£ n·ªôi b·ªô PT-xxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c.category,onChange:k=>m({...c,category:k.target.value}),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),l.map(k=>e.jsx("option",{value:k.name,children:k.name},k.id))]}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600",title:"Th√™m danh m·ª•c m·ªõi",children:"+"})]}),r&&e.jsxs("form",{onSubmit:async k=>{k.preventDefault();const v=a.trim();if(!v)return B.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");try{const p=await t.mutateAsync({name:v});m({...c,category:p.name}),n(""),s(!1)}catch(p){B.error((p==null?void 0:p.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text",value:a,onChange:k=>n(k.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-sm text-slate-900 dark:text-slate-100"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"L∆∞u"}),e.jsx("button",{type:"button",onClick:()=>{s(!1),n("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° nh·∫≠p"}),e.jsx("input",{type:"number",value:c.costPrice||0,onChange:k=>m({...c,costPrice:Number(k.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n l·∫ª"}),e.jsx("input",{type:"number",value:c.retailPrice,onChange:k=>m({...c,retailPrice:Number(k.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n s·ªâ"}),e.jsx("input",{type:"number",value:c.wholesalePrice,onChange:k=>m({...c,wholesalePrice:Number(k.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ªìn kho hi·ªán t·∫°i"}),e.jsx("input",{type:"number",value:c.stock,onChange:k=>m({...c,stock:Number(k.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"S·ªë l∆∞·ª£ng t·ªìn kho t·∫°i chi nh√°nh hi·ªán t·∫°i"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("div",{className:"font-medium mb-1",children:"L∆∞u √Ω:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a tr·ª±c ti·∫øp gi√° nh·∫≠p, gi√° b√°n v√† t·ªìn kho"}),e.jsx("li",{children:'Ho·∫∑c s·ª≠ d·ª•ng "T·∫°o phi·∫øu nh·∫≠p" ƒë·ªÉ ghi nh·∫≠n l·ªãch s·ª≠ nh·∫≠p kho chi ti·∫øt'})]})]})}),e.jsxs("div",{className:"flex justify-between gap-3 pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"px-4 py-2 border border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"In m√£ v·∫°ch"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"L∆∞u thay ƒë·ªïi"})]})]})]}),x&&e.jsx(fn,{part:d,currentBranchId:i,onClose:()=>h(!1)})]})})};export{gn as BatchPrintBarcodeModal,Bn as default};
