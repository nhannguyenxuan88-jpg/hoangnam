import{c as It,r as o,W as Fe,L as Qt,R as Yt,j as e,X as Xe,M as ge,N as Mt,i as m,A as Nt,C as At,O as Jt,h as Ct,J as wt,Q as zt,U as Zt,V as qt,Y as Ht,l as Bt,T as Ut,x as Ot,a as St,y as _t,s as M,n as ct,P as Dt,F as es,u as ts,e as ss,Z as as,$ as ls,_ as $t,a0 as ns}from"./index-9wxNecOd.js";import{g as ut}from"./categoryColors-BepW_45H.js";import{u as is,a as rs,b as ds,c as Kt,d as Gt}from"./useWorkOrdersRepository-D2Ec2NwQ.js";import{a as os,c as cs}from"./useDebtsRepository-Dok2KRq3.js";import{p as xs}from"./print-TOU0k1YY.js";import{P as ot}from"./plus-DCVw7leC.js";import{M as ms}from"./minus-CRXpUkq6.js";import{c as hs}from"./permissions-BO4i-gjC.js";import{C as us}from"./clipboard-list-C-qj3PH9.js";import{H as Ft}from"./history-D1Kthsdy.js";import{P as ps}from"./phone-CUjQud_I.js";import{P as kt}from"./printer-CZA7AzvW.js";import{P as bs}from"./pen-DaXgMpdd.js";import{S as Vt}from"./share-2-D3zDEdhk.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=It("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=It("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=It("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Rt=({isOpen:a,onClose:S,onSave:I,workOrder:r,customers:G,parts:ee,employees:Qe,currentBranchId:Le,upsertCustomer:pe,viewMode:ke=!1,onSwitchToEdit:ze})=>{var $,X,Ee,Tt,Ne,Ge;const h=o.useMemo(()=>{var g;if(!r)return null;const t=G.find(W=>W.phone===r.customerPhone||W.name===r.customerName);return!t&&r.customerName?{id:`temp-${Date.now()}`,name:r.customerName,phone:r.customerPhone||"",vehicles:r.licensePlate?[{id:`temp-veh-${Date.now()}`,licensePlate:r.licensePlate,model:r.vehicleModel||""}]:[]}:t&&r.licensePlate&&!((g=t.vehicles)==null?void 0:g.some(Q=>Q.licensePlate===r.licensePlate))?{...t,vehicles:[...t.vehicles||[],{id:`temp-veh-${Date.now()}`,licensePlate:r.licensePlate,model:r.vehicleModel||""}]}:t||null},[r,G]),T=o.useMemo(()=>h!=null&&h.vehicles?h.vehicles:[],[h]),me=o.useMemo(()=>{if(!r||!T.length)return null;let t=T.find(g=>g.licensePlate===r.licensePlate);return!t&&r.vehicleModel&&(t=T.find(g=>g.model===r.vehicleModel)),t||(r.licensePlate||r.vehicleModel?{id:`temp-veh-${Date.now()}`,licensePlate:r.licensePlate||"",model:r.vehicleModel||"",customerId:(h==null?void 0:h.id)||""}:T[0]||null)},[r,T,h]),[f,ne]=o.useState((r==null?void 0:r.status)||Fe.RECEIVED),[qe,n]=o.useState((($=Qe.find(t=>t.name===(r==null?void 0:r.technicianName)))==null?void 0:$.id)||""),[y,j]=o.useState(null),[P,_]=o.useState(null);o.useEffect(()=>{console.log("[WorkOrderMobileModal] workOrder:",r),console.log("[WorkOrderMobileModal] initialCustomer:",h),console.log("[WorkOrderMobileModal] initialVehicle:",me),r?(j(h),_(me),r.currentKm?ie(r.currentKm.toString()):me!=null&&me.currentKm&&ie(me.currentKm.toString()),d(!h),r.depositAmount&&r.depositAmount>0?(Ye(r.depositAmount),V(!0)):(Ye(0),V(!1))):(j(null),_(null),ie(""),d(!0),Ye(0),V(!1))},[r,h,me]);const[se,ie]=o.useState(((X=r==null?void 0:r.currentKm)==null?void 0:X.toString())||""),[we,J]=o.useState((r==null?void 0:r.issueDescription)||""),[re,U]=o.useState(((Ee=r==null?void 0:r.partsUsed)==null?void 0:Ee.map(t=>({partId:t.partId||"",partName:t.partName,quantity:t.quantity,sellingPrice:t.price||0,costPrice:t.costPrice||0,sku:t.sku||"",category:t.category||""})))||[]),[de,Ce]=o.useState(((Tt=r==null?void 0:r.additionalServices)==null?void 0:Tt.map(t=>({id:t.id||`srv-${Date.now()}-${Math.random()}`,name:t.description||"",costPrice:t.costPrice||0,sellingPrice:t.price||0})))||[]),[Se,c]=o.useState((r==null?void 0:r.laborCost)||0),[N,E]=o.useState((r==null?void 0:r.discount)||0),[R,ve]=o.useState("amount"),[K,V]=o.useState(!1),[fe,Ye]=o.useState(0),[Y,xt]=o.useState("cash"),[he,lt]=o.useState(!1),[Ie,je]=o.useState(0),[nt,d]=o.useState(!h),[ye,Ve]=o.useState(""),[mt,i]=o.useState(!1),[He,Je]=o.useState(""),[pt,Z]=o.useState(!1),[te,oe]=o.useState(""),[Ze,Be]=o.useState(0),[$e,it]=o.useState(0),[Oe,et]=o.useState(1),[Ue,z]=o.useState(!1),[ae,tt]=o.useState(""),[ce,Pe]=o.useState(""),[Te,ht]=o.useState(!1),[rt,st]=o.useState(""),[Ke,Re]=o.useState(""),[l,b]=o.useState(""),[k,q]=o.useState(""),[D,u]=o.useState(!1),[O,F]=o.useState(""),[H,B]=o.useState(""),A=t=>{if(t===0||t==="0")return"0";if(!t)return"";const g=t.toString().replace(/\D/g,"");return g?g.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""},Me=t=>{const g=t.replace(/\./g,"");return g?Number(g):0},dt=o.useMemo(()=>{if(console.log("[WorkOrderMobileModal] Total customers:",G==null?void 0:G.length,G),!ye)return G;const t=ye.toLowerCase(),g=G.filter(W=>{var Q;return W.name.toLowerCase().includes(t)||((Q=W.phone)==null?void 0:Q.toLowerCase().includes(t))||W.vehicles&&W.vehicles.some(Ae=>{var ft;return(ft=Ae.licensePlate)==null?void 0:ft.toLowerCase().includes(t)})});return console.log("[WorkOrderMobileModal] Filtered customers:",g.length,"Search term:",ye),g},[G,ye]),at=o.useMemo(()=>{if(!He)return ee;const t=He.toLowerCase();return ee.filter(g=>{var W;return g.name.toLowerCase().includes(t)||((W=g.sku)==null?void 0:W.toLowerCase().includes(t))})},[ee,He]),bt=o.useMemo(()=>{if(!y)return[];const t=y.vehicles||[];return P&&!t.find(g=>g.id===P.id)?[...t,P]:t},[y,P]),jt=o.useMemo(()=>{if(!P)return[];const t={...P,currentKm:se?parseInt(se):P.currentKm};return Qt(t)},[P,se]);Yt.useEffect(()=>{if(bt.length===1&&!P){const t=bt[0];_(t),t.currentKm&&ie(t.currentKm.toString())}},[bt,P]);const yt=o.useMemo(()=>re.reduce((t,g)=>t+g.quantity*g.sellingPrice,0),[re]),vt=o.useMemo(()=>de.reduce((t,g)=>t+g.sellingPrice,0),[de]),gt=yt+vt+Se,s=o.useMemo(()=>R==="percent"?gt*N/100:N,[gt,N,R]),x=Math.max(0,gt-s),w=t=>{j(t),d(!1),Ve(""),_(null),ie(""),u(!1),F(t.name),B(t.phone||"")},C=()=>{if(!y)return;if(!O.trim()){alert("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!H.trim()){alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}const t={...y,name:O.trim(),phone:H.trim()};pe&&pe(t),j(t),u(!1)},L=t=>{_(t),t.currentKm?ie(t.currentKm.toString()):ie("")},p=t=>{var W,Q;const g=re.find(Ae=>Ae.partId===t.id);U(g?re.map(Ae=>Ae.partId===t.id?{...Ae,quantity:Ae.quantity+1}:Ae):[...re,{partId:t.id,partName:t.name,quantity:1,sellingPrice:((W=t.retailPrice)==null?void 0:W[Le])||0,costPrice:((Q=t.costPrice)==null?void 0:Q[Le])||0,sku:t.sku||"",category:t.category||""}]),i(!1),Je("")},v=(t,g)=>{U(W=>W.map(Q=>Q.partId===t?{...Q,quantity:Q.quantity+g}:Q).filter(Q=>Q.quantity>0))},ue=()=>{!te||$e<=0||(Ce([...de,{id:`srv-${Date.now()}`,name:te,costPrice:Ze,sellingPrice:$e}]),oe(""),Be(0),it(0),Z(!1))},xe=t=>{Ce(de.filter(g=>g.id!==t))},_e=()=>{if(!ae||!ce)return;const t={id:`veh-${Date.now()}`,licensePlate:ae,model:ce};if(y){const g=[...y.vehicles||[],t],W={...y,vehicles:g};pe&&pe(W),j(W),_(t)}tt(""),Pe(""),z(!1)},be=()=>{if(!rt||!Ke)return;const t=`CUST-${Date.now()}`,g=`VEH-${Date.now()}`,W=[];(l||k)&&W.push({id:g,model:l||"",licensePlate:k||"",isPrimary:!0});const Q={id:t,name:rt,phone:Ke,vehicles:W,vehicleModel:l,licensePlate:k,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()};pe&&pe(Q),j(Q),W.length>0&&_(W[0]),d(!1),ht(!1),st(""),Re(""),b(""),q(""),Ve("")},De=()=>{if(!y||!P){alert("Vui l√≤ng ch·ªçn kh√°ch h√†ng v√† xe");return}const t=K?fe:0,W=t+(he?Ie:0),Q=x-W,Ae=re.map(We=>({partId:We.partId,partName:We.partName,quantity:We.quantity,price:We.sellingPrice,costPrice:We.costPrice||0,sku:We.sku||"",category:We.category||""})),ft=de.map(We=>({id:We.id,description:We.name,quantity:1,price:We.sellingPrice,costPrice:We.costPrice})),Xt={status:f,technicianId:qe,customer:y,vehicle:P,currentKm:parseInt(se)||0,issueDescription:we,parts:Ae,additionalServices:ft,laborCost:Se,discount:s,total:x,depositAmount:t,paymentMethod:Y,totalPaid:f===Fe.DELIVERED?W:void 0,remainingAmount:f===Fe.DELIVERED?Q:void 0};I(Xt)},le=t=>{switch(t){case Fe.RECEIVED:return"bg-blue-500";case Fe.IN_PROGRESS:return"bg-yellow-500";case Fe.COMPLETED:return"bg-green-500";case Fe.DELIVERED:return"bg-green-500";default:return"bg-gray-500"}};return o.useEffect(()=>(a?document.body.classList.add("hide-bottom-nav"):document.body.classList.remove("hide-bottom-nav"),()=>{document.body.classList.remove("hide-bottom-nav")}),[a]),a?ke&&r?e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end md:items-center justify-center",children:[e.jsxs("div",{className:"md:hidden w-full h-full bg-[#151521] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gradient-to-r from-blue-600 to-blue-700 px-3 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:S,className:"w-8 h-8 flex items-center justify-center rounded-full bg-white/20 text-white",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsxs("h2",{className:"text-sm font-bold text-white",children:["üìã Chi ti·∫øt phi·∫øu #",ge(r.id)]}),ze&&e.jsx("button",{onClick:ze,className:"px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-white text-xs font-medium flex items-center gap-1",children:"‚úèÔ∏è S·ª≠a"}),!ze&&e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-[#151521]",children:[e.jsxs("div",{className:"p-3 bg-[#1e1e2d] border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-bold ${le(r.status)}`,children:r.status}),e.jsxs("span",{className:"text-xs text-slate-400",children:[new Date(r.creationDate).toLocaleDateString("vi-VN")," ",new Date(r.creationDate).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),r.assignedTechnician&&e.jsxs("div",{className:"mt-2 text-xs text-slate-300",children:["üë§ KTV: ",e.jsx("span",{className:"font-medium text-white",children:r.assignedTechnician})]})]}),e.jsxs("div",{className:"p-3 border-b border-slate-700",children:[e.jsx("h3",{className:"text-xs font-semibold text-blue-400 mb-2",children:"üë§ KH√ÅCH H√ÄNG"}),e.jsxs("div",{className:"bg-[#1e1e2d] rounded-xl p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-medium",children:r.customerName||"‚Äî"}),r.customerPhone&&e.jsxs("a",{href:`tel:${r.customerPhone}`,className:"text-blue-400 text-sm",children:["üìû ",r.customerPhone]})]}),e.jsxs("div",{className:"text-sm text-slate-300",children:["üèçÔ∏è ",r.vehicleModel||"‚Äî"," ‚Ä¢ ",e.jsx("span",{className:"text-yellow-400 font-mono",children:r.licensePlate||"‚Äî"})]}),r.currentKm&&e.jsxs("div",{className:"text-xs text-slate-400",children:["üìè S·ªë km hi·ªán t·∫°i: ",Mt(r.currentKm)," km"]})]})]}),r.description&&e.jsxs("div",{className:"p-3 border-b border-slate-700",children:[e.jsx("h3",{className:"text-xs font-semibold text-orange-400 mb-2",children:"üìù M√î T·∫¢ V·∫§N ƒê·ªÄ"}),e.jsx("div",{className:"bg-[#1e1e2d] rounded-xl p-3 text-sm text-slate-300 whitespace-pre-wrap",children:r.description})]}),r.partsUsed&&r.partsUsed.length>0&&e.jsxs("div",{className:"p-3 border-b border-slate-700",children:[e.jsxs("h3",{className:"text-xs font-semibold text-emerald-400 mb-2",children:["üîß PH·ª§ T√ôNG (",r.partsUsed.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.partsUsed.map((t,g)=>e.jsxs("div",{className:"bg-[#1e1e2d] rounded-xl p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-white font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["SL: ",t.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold text-emerald-400",children:m(t.price*t.quantity)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[m(t.price),"/c√°i"]})]})]},g))})]}),r.additionalServices&&r.additionalServices.length>0&&e.jsxs("div",{className:"p-3 border-b border-slate-700",children:[e.jsxs("h3",{className:"text-xs font-semibold text-purple-400 mb-2",children:["üõ†Ô∏è D·ªäCH V·ª§ (",r.additionalServices.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.additionalServices.map((t,g)=>e.jsxs("div",{className:"bg-[#1e1e2d] rounded-xl p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-white font-medium",children:t.name}),t.quantity>1&&e.jsxs("div",{className:"text-xs text-slate-400",children:["SL: ",t.quantity]})]}),e.jsx("div",{className:"text-sm font-bold text-purple-400",children:m(t.price*(t.quantity||1))})]},g))})]}),r.note&&e.jsxs("div",{className:"p-3 border-b border-slate-700",children:[e.jsx("h3",{className:"text-xs font-semibold text-yellow-400 mb-2",children:"üí¨ GHI CH√ö"}),e.jsx("div",{className:"bg-[#1e1e2d] rounded-xl p-3 text-sm text-slate-300 whitespace-pre-wrap",children:r.note})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"bg-gradient-to-r from-emerald-900/50 to-emerald-800/30 rounded-xl p-4 border border-emerald-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-300",children:"T·ªïng ph·ª• t√πng"}),e.jsx("span",{className:"text-white font-medium",children:m(((Ne=r.partsUsed)==null?void 0:Ne.reduce((t,g)=>t+g.price*g.quantity,0))||0)})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-300",children:"T·ªïng d·ªãch v·ª•"}),e.jsx("span",{className:"text-white font-medium",children:m(((Ge=r.additionalServices)==null?void 0:Ge.reduce((t,g)=>t+g.price*(g.quantity||1),0))||0)})]}),(r.discount||0)>0&&e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-300",children:"Gi·∫£m gi√°"}),e.jsxs("span",{className:"text-red-400 font-medium",children:["-",m(r.discount||0)]})]}),e.jsxs("div",{className:"border-t border-emerald-600 pt-2 mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-white",children:"T·ªîNG C·ªòNG"}),e.jsx("span",{className:"text-2xl font-black text-emerald-400",children:m(r.total)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Tr·∫°ng th√°i thanh to√°n"}),e.jsx("span",{className:`font-medium ${r.paymentStatus==="paid"?"text-emerald-400":"text-yellow-400"}`,children:r.paymentStatus==="paid"?"‚úÖ ƒê√£ thanh to√°n":"‚è≥ Ch∆∞a thanh to√°n"})]})]})})]}),ze&&e.jsx("div",{className:"flex-shrink-0 p-3 bg-[#1e1e2d] border-t border-slate-700",children:e.jsx("button",{onClick:ze,className:"w-full py-3.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-bold text-base flex items-center justify-center gap-2",children:"‚úèÔ∏è Ch·ªânh s·ª≠a phi·∫øu"})})]}),e.jsxs("div",{className:"hidden md:block max-w-2xl w-full max-h-[90vh] bg-white dark:bg-slate-800 rounded-xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:["Chi ti·∫øt phi·∫øu #",ge(r.id)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ze&&e.jsx("button",{onClick:ze,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"‚úèÔ∏è Ch·ªânh s·ª≠a"}),e.jsx("button",{onClick:S,className:"text-slate-400 hover:text-slate-600",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-60px)]",children:e.jsx("div",{className:"text-center text-slate-500 py-8",children:'Vui l√≤ng b·∫•m "Ch·ªânh s·ª≠a" ƒë·ªÉ xem v√† s·ª≠a chi ti·∫øt phi·∫øu'})})]})]}):e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end md:items-center justify-center",children:[e.jsxs("div",{className:"md:hidden w-full h-full bg-[#151521] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 bg-[#1e1e2d] px-3 py-2.5 flex items-center justify-between border-b border-slate-700",children:[e.jsx("button",{onClick:S,className:"text-slate-400",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:r?`‚úèÔ∏è S·ª≠a phi·∫øu #${ge(r.id)}`:"T·∫°o phi·∫øu s·ª≠a ch·ªØa"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-32",children:[e.jsx("div",{className:"p-3 space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:f,onChange:t=>ne(t.target.value),className:`w-full px-2.5 py-2 rounded-lg text-white text-xs font-medium appearance-none pr-7 ${le(f)}`,children:[e.jsx("option",{value:Fe.RECEIVED,children:"üîß Ti·∫øp nh·∫≠n"}),e.jsx("option",{value:Fe.IN_PROGRESS,children:"‚öôÔ∏è ƒêang s·ª≠a"}),e.jsx("option",{value:Fe.COMPLETED,children:"‚úÖ ƒê√£ s·ª≠a xong"}),e.jsx("option",{value:Fe.DELIVERED,children:"üöó Tr·∫£ xe"})]}),e.jsx(Lt,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-white pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:qe,onChange:t=>n(t.target.value),className:"w-full px-2.5 py-2 bg-[#2b2b40] rounded-lg text-white text-xs appearance-none pr-7",children:[e.jsx("option",{value:"",children:"üë§ Ch·ªçn KTV"}),Qe.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(Lt,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400 pointer-events-none"})]})]})}),e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"Kh√°ch h√†ng"}),nt?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{type:"text",value:ye,onChange:t=>Ve(t.target.value),placeholder:"üîç T√¨m t√™n ho·∫∑c SƒêT kh√°ch...",className:"w-full pl-9 pr-3 py-2 bg-[#2b2b40] rounded-lg text-white text-xs placeholder-slate-500",autoFocus:!0})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2",children:[dt.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>w(t),className:"p-3 bg-[#1e1e2d] rounded-lg cursor-pointer hover:bg-[#2b2b40] transition-colors",children:[e.jsx("div",{className:"text-white font-medium",children:t.name}),e.jsx("div",{className:"text-xs text-slate-400",children:t.phone})]},t.id)),ye&&dt.length===0&&e.jsx("div",{className:"text-center py-3 text-slate-400 text-xs",children:"Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng"}),e.jsxs("button",{type:"button",onClick:()=>{ht(!0),/^[0-9]+$/.test(ye)?(Re(ye),st("")):(st(ye),Re(""))},className:"w-full p-3 bg-green-500/20 border-2 border-dashed border-green-500/50 rounded-lg text-green-400 font-medium flex items-center justify-center gap-2 hover:bg-green-500/30 transition-colors",children:[e.jsx(ot,{className:"w-4 h-4"}),"Th√™m kh√°ch h√†ng m·ªõi"]})]})]}):y?e.jsx("div",{className:"p-2.5 bg-[#1e1e2d] rounded-lg",children:D?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-slate-400 mb-1",children:"T√™n kh√°ch h√†ng"}),e.jsx("input",{type:"text",value:O,onChange:t=>F(t.target.value),className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs",placeholder:"Nh·∫≠p t√™n kh√°ch h√†ng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-slate-400 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",value:H,onChange:t=>B(t.target.value),className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs",placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx("button",{onClick:()=>{u(!1),F(y.name),B(y.phone||"")},className:"flex-1 py-1.5 bg-[#2b2b40] text-slate-300 rounded-lg text-[10px] font-medium",children:"H·ªßy"}),e.jsx("button",{onClick:C,className:"flex-1 py-1.5 bg-green-600 text-white rounded-lg text-[10px] font-medium",children:"üíæ L∆∞u"})]})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-semibold text-xs",children:y.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-xs",children:y.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["üìû ",y.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{F(y.name),B(y.phone||""),u(!0)},className:"p-1 text-blue-400 hover:text-blue-300",title:"S·ª≠a th√¥ng tin kh√°ch h√†ng",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>{j(null),_(null),d(!0),u(!1)},className:"p-1 text-slate-400 hover:text-white",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})}):null,y&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xs font-semibold text-white mt-3 uppercase tracking-wide",children:"XE C·ª¶A KH√ÅCH (Ch·ªçn 1):"}),e.jsxs("div",{className:"space-y-2",children:[bt.map(t=>{const g=(P==null?void 0:P.id)===t.id;return e.jsx("div",{onClick:()=>L(t),className:`p-3 rounded-lg cursor-pointer transition-all ${g?"bg-blue-500/20 border-2 border-blue-500":"bg-[#1e1e2d] border-2 border-transparent"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"text-2xl",children:g?e.jsx(At,{className:"w-4 h-4 text-blue-400"}):"üèçÔ∏è"}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-semibold ${g?"text-blue-400":"text-white"}`,children:[t.model,g&&" (ƒêANG CH·ªåN)"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["BKS: ",t.licensePlate]})]})]})})},t.id)}),e.jsxs("button",{onClick:()=>z(!0),className:"w-full py-1.5 border border-dashed border-slate-600 rounded-lg text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-colors flex items-center justify-center gap-1.5 text-xs",children:[e.jsx(ot,{className:"w-3.5 h-3.5"}),"Th√™m xe m·ªõi"]})]})]}),P&&e.jsxs("div",{className:"space-y-2 mt-2.5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"S·ªë KM hi·ªán t·∫°i"}),e.jsx("input",{type:"number",value:se,onChange:t=>ie(t.target.value),placeholder:"Nh·∫≠p s·ªë KM",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),jt.length>0&&e.jsxs("div",{className:"p-2.5 bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Jt,{className:"w-3.5 h-3.5 text-orange-400"}),e.jsx("span",{className:"text-xs font-semibold text-orange-400",children:"C·∫ßn b·∫£o d∆∞·ª°ng"})]}),e.jsx("div",{className:"space-y-1.5",children:jt.map(t=>e.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 rounded text-xs ${t.isOverdue?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"}`,children:[e.jsxs("span",{children:[t.icon," ",t.name]}),e.jsx("span",{className:"font-medium",children:t.isOverdue?`Qu√° ${Mt(Math.abs(t.kmUntilDue))}`:`C√≤n ${Mt(t.kmUntilDue)}`})]},t.type))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"M√¥ t·∫£ s·ª± c·ªë"}),e.jsx("textarea",{value:we,onChange:t=>J(t.target.value),placeholder:"Thay nh·ªõt, k√™u c√≤...",rows:3,className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs resize-none"})]})]})]}),y&&P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"PH·ª§ T√ôNG S·ª¨ D·ª§NG"}),re.length>0&&e.jsx("div",{className:"space-y-2",children:re.map((t,g)=>e.jsxs("div",{className:"p-3 bg-[#1e1e2d] rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-white text-xs font-medium",children:[g+1,". ",t.partName]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5 flex-wrap",children:[t.sku&&e.jsx("span",{className:"text-[11px] text-blue-400 font-mono",children:t.sku}),t.category&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-[9px] font-medium ${ut(t.category).bg} ${ut(t.category).text}`,children:t.category})]}),e.jsxs("div",{className:"text-[11px] text-slate-400 mt-0.5",children:[m(t.sellingPrice)," / c√°i"]})]}),e.jsx("div",{className:"text-[#50cd89] font-bold",children:m(t.quantity*t.sellingPrice)})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(t.partId,-1),className:"w-8 h-8 bg-[#2b2b40] rounded-lg flex items-center justify-center text-white hover:bg-red-500/20 hover:text-red-400",children:e.jsx(ms,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center text-white font-semibold",children:t.quantity}),e.jsx("button",{onClick:()=>v(t.partId,1),className:"w-8 h-8 bg-[#2b2b40] rounded-lg flex items-center justify-center text-white hover:bg-blue-500/20 hover:text-blue-400",children:e.jsx(ot,{className:"w-4 h-4"})})]})})]},t.partId))}),e.jsxs("button",{onClick:()=>i(!0),className:"w-full py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium flex items-center justify-center gap-1.5 transition-colors text-xs",children:[e.jsx(ot,{className:"w-4 h-4"}),"+ TH√äM PH·ª§ T√ôNG"]})]}),e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"B√ÅO GI√Å (GIA C√îNG, ƒê·∫∂T NGO√ÄI)"}),de.length>0&&e.jsx("div",{className:"space-y-2",children:de.map((t,g)=>e.jsxs("div",{className:"p-3 bg-[#1e1e2d] rounded-lg border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"üõ†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-400 mt-0.5",children:["1 x ",m(t.sellingPrice)]})]})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-2 mt-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Th√†nh ti·ªÅn:"}),e.jsxs("div",{className:"text-[#50cd89] font-bold text-sm",children:["üíµ ",m(t.sellingPrice)]}),t.costPrice>0&&e.jsxs("div",{className:"text-[10px] text-slate-600 mt-0.5",children:["(V·ªën: ",m(t.costPrice),")"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{Z(!0)},className:"p-1.5 text-blue-400 hover:bg-blue-500/20 rounded-lg",children:"‚úèÔ∏è"}),e.jsx("button",{onClick:()=>xe(t.id),className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded-lg",children:"üóëÔ∏è"})]})]})]},t.id))}),e.jsxs("button",{onClick:()=>Z(!0),className:"w-full py-3 border border-dashed border-[#009ef7] rounded-lg text-[#009ef7] font-medium flex items-center justify-center gap-2 transition-all hover:bg-[#009ef7]/10 text-xs",children:[e.jsx(ot,{className:"w-4 h-4"}),"TH√äM C√îNG VI·ªÜC KH√ÅC (GIA C√îNG)"]})]}),e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"THANH TO√ÅN"}),e.jsxs("div",{className:"p-4 bg-[#1e1e2d] rounded-lg space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Ti·ªÅn c√¥ng"}),e.jsx("input",{type:"text",value:A(Se),onChange:t=>c(Me(t.target.value)),placeholder:"0",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#2b2b40] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üí≥"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:"ƒê·∫∑t c·ªçc tr∆∞·ªõc"})]}),e.jsx("button",{onClick:()=>V(!K),className:`relative w-12 h-6 rounded-full transition-colors ${K?"bg-[#009ef7]":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-md transition-transform ${K?"right-0.5":"left-0.5"}`,children:K&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[#009ef7] text-[10px] font-bold",children:"ON"})})})]}),K&&e.jsxs("div",{className:"mt-3 p-3 bg-[#151521] border-2 border-[#009ef7] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"üíµ"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"Nh·∫≠p s·ªë ti·ªÅn c·ªçc..."})]}),e.jsx("input",{type:"text",value:A(fe),onChange:t=>Ye(Me(t.target.value)),placeholder:"0",className:"w-full px-3 py-2.5 bg-[#2b2b40] border border-slate-600 rounded-lg text-white text-sm focus:border-[#009ef7] focus:outline-none transition-colors"})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>xt("cash"),className:`relative p-3 rounded-lg transition-all border-2 ${Y==="cash"?"bg-emerald-500/10 border-emerald-500 shadow-lg shadow-emerald-500/20":"bg-[#2b2b40] border-transparent hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xl ${Y==="cash"?"scale-110":""} transition-transform`,children:"üíµ"}),e.jsx("span",{className:`text-xs font-medium ${Y==="cash"?"text-emerald-400":"text-slate-400"}`,children:"Ti·ªÅn m·∫∑t"})]}),Y==="cash"&&e.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 bg-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsxs("button",{onClick:()=>xt("bank"),className:`relative p-3 rounded-lg transition-all border-2 ${Y==="bank"?"bg-blue-500/10 border-blue-500 shadow-lg shadow-blue-500/20":"bg-[#2b2b40] border-transparent hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xl ${Y==="bank"?"scale-110":""} transition-transform`,children:"üè¶"}),e.jsx("span",{className:`text-xs font-medium ${Y==="bank"?"text-blue-400":"text-slate-400"}`,children:"Chuy·ªÉn kho·∫£n"})]}),Y==="bank"&&e.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})]}),f==="Tr·∫£ m√°y"&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#2b2b40] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"‚úÖ"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Thanh to√°n khi tr·∫£ xe"})]}),e.jsx("button",{onClick:()=>{const t=!he;lt(t),t||je(0)},className:`relative w-12 h-6 rounded-full transition-colors ${he?"bg-emerald-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-md transition-transform ${he?"right-0.5":"left-0.5"}`,children:he&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-emerald-500 text-[10px] font-bold",children:"ON"})})})]}),he&&e.jsxs("div",{className:"mt-3 p-3 bg-[#151521] border-2 border-emerald-500 rounded-lg",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"S·ªë ti·ªÅn thanh to√°n th√™m:"}),e.jsx("input",{type:"text",value:A(Ie),onChange:t=>je(Me(t.target.value)),placeholder:"0",className:"w-full px-3 py-2.5 bg-[#2b2b40] border border-slate-600 rounded-lg text-white text-sm focus:border-emerald-500 focus:outline-none transition-colors mb-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>je(0),className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg text-xs font-medium transition-colors",children:"0%"}),e.jsx("button",{onClick:()=>{const t=x-(K?fe:0);je(Math.round(t*.5))},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg text-xs font-medium transition-colors",children:"50%"}),e.jsx("button",{onClick:()=>{const t=x-(K?fe:0);je(t)},className:"flex-1 px-3 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg text-xs font-medium transition-colors",children:"100%"})]})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-blue-500/20 flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-blue-400 text-xs",children:"‚ÑπÔ∏è"})}),e.jsxs("p",{className:"text-blue-300 text-xs leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"L∆∞u √Ω:"}),' Ch·ªâ thanh to√°n khi tr·∫£ xe, ch·ªâ kh·∫£ d·ª•ng khi tr·∫°ng th√°i "Tr·∫£ m√°y"']})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-700 space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-300 mb-2",children:"T·ªïng k·∫øt"}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{className:"text-white font-medium",children:m(Se)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{className:"text-white font-medium",children:m(yt)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Gia c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{className:"text-white font-medium",children:m(vt)})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-700",children:[e.jsxs("div",{className:"flex gap-2 items-center justify-between mb-2",children:[e.jsx("label",{className:"text-red-400 text-xs font-medium",children:"Gi·∫£m gi√°:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:A(N),onChange:t=>E(Me(t.target.value)),placeholder:"0",className:"w-20 px-2 py-1.5 bg-[#2b2b40] border border-slate-600 rounded text-white text-xs text-right focus:border-red-500 focus:outline-none"}),e.jsxs("select",{value:R,onChange:t=>ve(t.target.value),className:"px-2 py-1.5 bg-[#2b2b40] border border-slate-600 rounded text-white text-xs focus:border-red-500 focus:outline-none",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),R==="percent"&&e.jsx("div",{className:"flex gap-1.5 justify-end",children:[5,10,15,20].map(t=>e.jsxs("button",{onClick:()=>E(t),className:"px-2.5 py-1 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors",children:[t,"%"]},t))}),R==="percent"&&N>0&&e.jsxs("div",{className:"text-xs text-slate-400 text-right mt-1",children:["= ",m(s)]})]}),e.jsxs("div",{className:"pt-2 border-t-2 border-slate-600",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"text-white",children:"T·ªïng c·ªông:"}),e.jsx("span",{className:"text-blue-400 text-base",children:m(x)})]}),(K&&fe>0||he&&Ie>0)&&e.jsxs("div",{className:"space-y-1 pt-2 border-t border-slate-700",children:[K&&fe>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-green-400",children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsxs("span",{className:"font-medium text-green-400",children:["-",m(fe)]})]}),he&&Ie>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-green-400",children:"Thanh to√°n th√™m:"}),e.jsxs("span",{className:"font-medium text-green-400",children:["-",m(Ie)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-700",children:[e.jsx("span",{className:"text-sm font-bold text-white",children:x-(K?fe:0)-(he?Ie:0)>0?"C√≤n ph·∫£i thu:":"ƒê√£ thanh to√°n ƒë·ªß"}),e.jsx("span",{className:`text-base font-bold ${x-(K?fe:0)-(he?Ie:0)>0?"text-red-400":"text-green-400"}`,children:m(x-(K?fe:0)-(he?Ie:0))})]})]})]})]})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 bg-[#1e1e2d] border-t border-slate-700 p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 bg-[#2b2b40] text-slate-300 rounded-lg font-medium hover:bg-slate-700 transition-colors text-xs",children:"H·ªßy"}),e.jsx("button",{onClick:De,className:`flex-1 py-2 rounded-lg font-medium text-white transition-colors text-xs ${f==="Tr·∫£ m√°y"?"bg-green-600 hover:bg-green-700":K?"bg-purple-600 hover:bg-purple-700":"bg-blue-600 hover:bg-blue-700"}`,children:f==="Tr·∫£ m√°y"?"‚úÖ THANH TO√ÅN & TR·∫¢ XE":K?"üí∞ L∆ØU & ƒê·∫∂T C·ªåC":"üíæ L∆ØU PHI·∫æU"})]})})]}),e.jsx("div",{className:"hidden md:block"}),mt&&e.jsxs("div",{className:"fixed inset-0 bg-black/70 z-[110] flex flex-col",children:[e.jsx("div",{className:"flex-1 min-h-[10vh]",onClick:()=>{i(!1),Je("")}}),e.jsxs("div",{className:"w-full bg-[#151521] rounded-t-2xl flex flex-col",style:{maxHeight:"70vh"},children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Ch·ªçn ph·ª• t√πng"}),e.jsx("button",{onClick:()=>{i(!1),Je("")},className:"p-1.5 text-slate-400",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-shrink-0 p-3 bg-[#151521] sticky top-0 z-10",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{type:"text",value:He,onChange:t=>Je(t.target.value),placeholder:"T√¨m t√™n ho·∫∑c SKU...",className:"w-full pl-9 pr-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-3 overscroll-contain",children:e.jsx("div",{className:"space-y-2",children:at.slice(0,20).map(t=>{var Q,Ae;const g=((Q=t.stock)==null?void 0:Q[Le])||0,W=((Ae=t.retailPrice)==null?void 0:Ae[Le])||0;return e.jsx("div",{onClick:()=>p(t),className:"p-2.5 bg-[#1e1e2d] rounded-lg cursor-pointer hover:bg-[#2b2b40] transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-white font-medium text-xs",children:t.name}),e.jsxs("div",{className:"text-[11px] text-blue-400 font-mono mt-0.5",children:["SKU: ",t.sku," ‚Ä¢ T·ªìn: ",g]}),t.category&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 mt-1 rounded-full text-[9px] font-medium ${ut(t.category).bg} ${ut(t.category).text}`,children:t.category})]}),e.jsx("div",{className:"text-[#50cd89] font-bold text-xs flex-shrink-0",children:m(W)})]})},t.id)})})})]})]}),pt&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-end md:items-center md:justify-center",children:e.jsxs("div",{className:"w-full md:max-w-md bg-[#1e1e2d] rounded-t-2xl md:rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsx("h3",{className:"text-white font-semibold text-base",children:"TH√äM D·ªäCH V·ª§ GIA C√îNG"}),e.jsx("button",{onClick:()=>{Z(!1),oe(""),Be(0),it(0),et(1)},className:"p-1.5 text-slate-400 hover:text-white",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"T√™n c√¥ng vi·ªác / M√¥ t·∫£:"}),e.jsx("input",{type:"text",value:te,onChange:t=>oe(t.target.value),placeholder:"Nh·∫≠p t√™n (VD: H√†n y·∫øm, S∆°n...)",className:"w-full px-4 py-3 bg-[#151521] border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-[#009ef7] focus:outline-none transition-colors",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"S·ªë l∆∞·ª£ng:"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>et(Math.max(1,Oe-1)),className:"w-12 h-12 bg-[#2b2b40] hover:bg-slate-700 rounded-lg flex items-center justify-center text-white text-2xl font-bold transition-colors",children:"‚àí"}),e.jsx("div",{className:"w-20 h-12 bg-[#151521] border border-slate-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl font-bold",children:Oe})}),e.jsx("button",{onClick:()=>et(Oe+1),className:"w-12 h-12 bg-[#2b2b40] hover:bg-slate-700 rounded-lg flex items-center justify-center text-white text-2xl font-bold transition-colors",children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wide",children:"CHI PH√ç & GI√Å B√ÅN"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1.5",children:"Gi√° nh·∫≠p (V·ªën):"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:A(Ze),onChange:t=>Be(Me(t.target.value)),placeholder:"0",className:"w-full px-3 py-3 pr-8 bg-[#151521] border border-slate-700 rounded-lg text-slate-400 text-sm focus:border-slate-600 focus:outline-none transition-colors"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs",children:"ƒë"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-[#ffc700] mb-1.5 font-medium",children:"ƒê∆°n gi√° (B√°o kh√°ch):"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:A($e),onChange:t=>it(Me(t.target.value)),placeholder:"0",className:"w-full px-3 py-3 pr-8 bg-gradient-to-br from-[#009ef7]/10 to-purple-600/10 border-2 border-[#009ef7] rounded-lg text-white text-sm font-semibold focus:border-[#0077c7] focus:outline-none transition-colors"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#009ef7] text-xs font-bold",children:"ƒë"})]})]})]})]}),e.jsx("div",{className:"p-4 bg-[#151521] border border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Th√†nh ti·ªÅn (T·ª± t√≠nh):"}),e.jsx("span",{className:"text-[#50cd89] text-xl font-bold",children:m($e*Oe)})]})})]}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx("button",{onClick:ue,disabled:!te.trim()||$e<=0,className:"w-full py-4 bg-gradient-to-r from-[#009ef7] to-purple-600 hover:from-[#0077c7] hover:to-purple-700 disabled:from-slate-700 disabled:to-slate-700 disabled:cursor-not-allowed text-white font-bold text-sm rounded-lg transition-all shadow-lg",children:"L∆ØU V√ÄO PHI·∫æU"})})]})}),Ue&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-[#1e1e2d] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Th√™m xe m·ªõi"}),e.jsx("button",{onClick:()=>z(!1),className:"p-1.5 text-slate-400",children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Bi·ªÉn s·ªë xe"}),e.jsx("input",{type:"text",value:ae,onChange:t=>tt(t.target.value),placeholder:"59G1-123.45",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"T√™n xe"}),e.jsx("input",{type:"text",value:ce,onChange:t=>Pe(t.target.value),placeholder:"Honda Wave RSX",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{className:"flex gap-2 pt-1.5",children:[e.jsx("button",{onClick:()=>z(!1),className:"flex-1 py-2 bg-[#2b2b40] text-slate-300 rounded-lg font-medium text-xs",children:"H·ªßy"}),e.jsx("button",{onClick:_e,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg font-medium text-xs",children:"Th√™m xe"})]})]})]})}),Te&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-[#1e1e2d] rounded-xl p-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Th√™m kh√°ch h√†ng m·ªõi"}),e.jsx("button",{onClick:()=>{ht(!1),st(""),Re(""),b(""),q("")},className:"p-1.5 text-slate-400",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-[#2b2b40]/50 rounded-lg p-3 space-y-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-blue-400 uppercase tracking-wide",children:"Th√¥ng tin kh√°ch h√†ng"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:["T√™n kh√°ch h√†ng ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:rt,onChange:t=>st(t.target.value),placeholder:"Nguy·ªÖn VƒÉn A",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:["S·ªë ƒëi·ªán tho·∫°i ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"tel",value:Ke,onChange:t=>Re(t.target.value),placeholder:"0901234567",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm"})]})]}),e.jsxs("div",{className:"bg-[#2b2b40]/50 rounded-lg p-3 space-y-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-green-400 uppercase tracking-wide",children:"üèçÔ∏è Th√¥ng tin xe"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Lo·∫°i xe"}),e.jsx("input",{type:"text",value:l,onChange:t=>b(t.target.value),placeholder:"Wave, Exciter, Vision...",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Bi·ªÉn s·ªë xe"}),e.jsx("input",{type:"text",value:k,onChange:t=>q(t.target.value.toUpperCase()),placeholder:"59G1-12345",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm uppercase"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{ht(!1),st(""),Re(""),b(""),q("")},className:"flex-1 py-2.5 bg-[#2b2b40] text-slate-300 rounded-lg font-medium text-sm",children:"H·ªßy"}),e.jsx("button",{onClick:be,disabled:!rt||!Ke,className:"flex-1 py-2.5 bg-green-600 text-white rounded-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"üíæ L∆∞u kh√°ch h√†ng"})]})]})]})})]}):null};function fs({workOrders:a,onCreateWorkOrder:S,onEditWorkOrder:I,onDeleteWorkOrder:r,onCallCustomer:G,onPrintWorkOrder:ee,onOpenTemplates:Qe,currentBranchId:Le}){const{profile:pe}=Ct(),[ke,ze]=o.useState(""),[h,T]=o.useState("all"),[me,f]=o.useState(!1),ne=o.useMemo(()=>{const j=a.filter(U=>U.status==="Ti·∫øp nh·∫≠n").length,P=a.filter(U=>U.status==="ƒêang s·ª≠a").length,_=a.filter(U=>U.status==="ƒê√£ s·ª≠a xong").length,se=a.filter(U=>U.status==="Tr·∫£ m√°y").length,ie=new Date().toDateString(),we=a.filter(U=>U.paymentStatus==="paid"&&new Date(U.creationDate).toDateString()===ie),J=we.reduce((U,de)=>U+(de.total||0),0),re=we.reduce((U,de)=>{var c,N;const Ce=((c=de.partsUsed)==null?void 0:c.reduce((E,R)=>E+(R.costPrice||0)*(R.quantity||1),0))||0,Se=((N=de.additionalServices)==null?void 0:N.reduce((E,R)=>E+(R.costPrice||0)*(R.quantity||1),0))||0;return U+((de.total||0)-Ce-Se)},0);return{tiepNhan:j,dangSua:P,daHoanThanh:_,traMay:se,doanhThu:J,loiNhuan:re}},[a]),qe=o.useMemo(()=>{let j=a;if(h!=="all"&&(j=j.filter(P=>P.status===h)),ke.trim()){const P=ke.toLowerCase();j=j.filter(_=>{var se,ie,we,J;return((se=_.customerName)==null?void 0:se.toLowerCase().includes(P))||((ie=_.customerPhone)==null?void 0:ie.toLowerCase().includes(P))||((we=_.licensePlate)==null?void 0:we.toLowerCase().includes(P))||((J=_.id)==null?void 0:J.toLowerCase().includes(P))})}return j.sort((P,_)=>{const se=new Date(P.creationDate||0).getTime();return new Date(_.creationDate||0).getTime()-se})},[a,h,ke]),n=j=>{switch(j){case"Ti·∫øp nh·∫≠n":return"bg-[#009ef7]/10 text-[#009ef7] border-[#009ef7]/30";case"ƒêang s·ª≠a":return"bg-[#f1416c]/10 text-[#f1416c] border-[#f1416c]/30";case"ƒê√£ s·ª≠a xong":return"bg-[#50cd89]/10 text-[#50cd89] border-[#50cd89]/30";case"Tr·∫£ m√°y":return"bg-purple-500/10 text-purple-500 border-purple-500/30";default:return"bg-gray-500/10 text-gray-500 border-gray-500/30"}},y=j=>{switch(j){case"Ti·∫øp nh·∫≠n":return e.jsx(wt,{className:"w-4 h-4"});case"ƒêang s·ª≠a":return e.jsx(zt,{className:"w-4 h-4"});case"ƒê√£ s·ª≠a xong":return e.jsx(At,{className:"w-4 h-4"});case"Tr·∫£ m√°y":return e.jsx(Et,{className:"w-4 h-4"});default:return e.jsx(wt,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"md:hidden flex flex-col h-screen bg-[#151521]",children:[e.jsxs("div",{className:"bg-[#1e1e2d] border-b border-gray-800 p-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>T(h==="Ti·∫øp nh·∫≠n"?"all":"Ti·∫øp nh·∫≠n"),className:`p-3 rounded-xl text-left transition-all ${h==="Ti·∫øp nh·∫≠n"?"bg-gradient-to-br from-[#009ef7]/20 to-[#009ef7]/10 border-2 border-[#009ef7] shadow-lg shadow-[#009ef7]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#009ef7]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Ti·∫øp nh·∫≠n"}),e.jsx(wt,{className:"w-4 h-4 text-[#009ef7]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:ne.tiepNhan})]}),e.jsxs("button",{onClick:()=>T(h==="ƒêang s·ª≠a"?"all":"ƒêang s·ª≠a"),className:`p-3 rounded-xl text-left transition-all ${h==="ƒêang s·ª≠a"?"bg-gradient-to-br from-[#f1416c]/20 to-[#f1416c]/10 border-2 border-[#f1416c] shadow-lg shadow-[#f1416c]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#f1416c]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"ƒêang s·ª≠a"}),e.jsx(zt,{className:"w-4 h-4 text-[#f1416c]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:ne.dangSua})]}),e.jsxs("button",{onClick:()=>T(h==="ƒê√£ s·ª≠a xong"?"all":"ƒê√£ s·ª≠a xong"),className:`p-3 rounded-xl text-left transition-all ${h==="ƒê√£ s·ª≠a xong"?"bg-gradient-to-br from-[#50cd89]/20 to-[#50cd89]/10 border-2 border-[#50cd89] shadow-lg shadow-[#50cd89]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#50cd89]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"ƒê√£ s·ª≠a xong"}),e.jsx(At,{className:"w-4 h-4 text-[#50cd89]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:ne.daHoanThanh})]}),e.jsxs("button",{onClick:()=>T(h==="Tr·∫£ m√°y"?"all":"Tr·∫£ m√°y"),className:`p-3 rounded-xl text-left transition-all ${h==="Tr·∫£ m√°y"?"bg-gradient-to-br from-purple-500/20 to-purple-500/10 border-2 border-purple-500 shadow-lg shadow-purple-500/20":"bg-[#2b2b40] border border-gray-700 hover:border-purple-500/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Tr·∫£ m√°y"}),e.jsx(Et,{className:"w-4 h-4 text-purple-500"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:ne.traMay})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-br from-emerald-900/30 to-emerald-800/20 border border-emerald-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-emerald-400 font-medium",children:"Doanh thu h√¥m nay"}),e.jsx(Zt,{className:"w-4 h-4 text-emerald-400"})]}),e.jsx("div",{className:"text-base font-black text-emerald-300",children:m(ne.doanhThu)})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"L·ª£i nhu·∫≠n h√¥m nay"}),e.jsx(qt,{className:"w-4 h-4 text-blue-400"})]}),e.jsx("div",{className:"text-base font-black text-blue-300",children:m(ne.loiNhuan)})]})]})]}),e.jsxs("div",{className:"bg-[#1e1e2d] border-b border-gray-800 px-3 py-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"T√¨m t√™n, SƒêT, bi·ªÉn s·ªë...",value:ke,onChange:j=>ze(j.target.value),className:"w-full pl-10 pr-3 py-2.5 bg-[#2b2b40] border border-gray-700 rounded-xl text-white placeholder-gray-500 text-sm focus:outline-none focus:border-[#009ef7]"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:Qe,className:"flex-1 flex items-center justify-center gap-1.5 py-2 bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/50 rounded-lg transition-colors",children:[e.jsx(us,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-xs font-medium text-purple-300",children:"M·∫´u SC"})]}),e.jsxs(Ht,{to:"/service-history",className:"flex-1 flex items-center justify-center gap-1.5 py-2 bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/50 rounded-lg transition-colors",children:[e.jsx(Ft,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-xs font-medium text-cyan-300",children:"L·ªãch s·ª≠ SC"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-2 space-y-2 pb-20 scrollbar-hide",children:qe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[e.jsx("div",{className:"w-32 h-32 mb-6 flex items-center justify-center",children:e.jsx("svg",{className:"w-full h-full text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-300 mb-2",children:"Ch∆∞a c√≥ phi·∫øu s·ª≠a ch·ªØa n√†o!"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"H√£y t·∫°o phi·∫øu ƒë·∫ßu ti√™n ƒë·ªÉ qu·∫£n l√Ω d·ªãch v·ª• s·ª≠a ch·ªØa"}),e.jsx("button",{onClick:S,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg shadow-blue-500/30",children:"+ T·∫°o phi·∫øu m·ªõi"})]}):qe.map(j=>e.jsxs("div",{onClick:()=>I(j),className:"bg-[#1e1e2d] rounded-xl border border-gray-800 overflow-hidden active:scale-[0.99] transition-transform",children:[e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[#009ef7] font-mono text-sm font-semibold mb-0.5",children:ge(j.id)}),e.jsx("div",{className:"text-xs text-gray-500",children:Bt(j.creationDate)})]}),e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg border text-xs font-semibold ${n(j.status)}`,children:[y(j.status),j.status]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üë§"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-white font-medium text-sm truncate",children:j.customerName}),e.jsx("div",{className:"text-gray-400 text-xs",children:j.customerPhone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üèçÔ∏è"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-gray-300 text-sm truncate",children:j.vehicleModel}),e.jsx("div",{className:"text-[#009ef7] text-xs font-mono",children:j.licensePlate})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-gray-800 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["KTV:"," ",e.jsx("span",{className:"text-gray-300",children:j.technicianName||"Ch∆∞a ph√¢n"})]}),e.jsx("div",{className:"text-white font-bold text-base",children:m(j.total||0)})]}),(j.depositAmount&&j.depositAmount>0||j.additionalPayment&&j.additionalPayment>0)&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-green-400",children:["üí∞ ƒê√£ thu:"," ",m((j.depositAmount||0)+(j.additionalPayment||0))]}),(j.remainingAmount??0)>0&&e.jsxs("span",{className:"text-amber-400",children:["C√≤n l·∫°i:"," ",m(j.remainingAmount||0)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 border-t border-gray-800",children:[e.jsxs("button",{onClick:P=>{P.stopPropagation(),G(j.customerPhone||"")},className:"flex items-center justify-center gap-1 py-3 bg-green-500/10 hover:bg-green-500/20 transition-colors border-r border-gray-800",children:[e.jsx(ps,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-green-500",children:"G·ªçi"})]}),e.jsxs("button",{onClick:P=>{P.stopPropagation(),ee(j)},className:"flex items-center justify-center gap-1 py-3 bg-purple-500/10 hover:bg-purple-500/20 transition-colors border-r border-gray-800",children:[e.jsx(kt,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-purple-500",children:"In"})]}),e.jsxs("button",{onClick:P=>{P.stopPropagation(),I(j)},className:"flex items-center justify-center gap-1 py-3 bg-[#009ef7]/10 hover:bg-[#009ef7]/20 transition-colors border-r border-gray-800",children:[e.jsx(bs,{className:"w-4 h-4 text-[#009ef7]"}),e.jsx("span",{className:"text-[11px] font-semibold text-[#009ef7]",children:"S·ª≠a"})]}),hs(pe==null?void 0:pe.role,"work_order.delete")&&e.jsxs("button",{onClick:P=>{P.stopPropagation(),r(j)},className:"flex items-center justify-center gap-1 py-3 bg-[#f1416c]/10 hover:bg-[#f1416c]/20 transition-colors",children:[e.jsx(Ut,{className:"w-4 h-4 text-[#f1416c]"}),e.jsx("span",{className:"text-[11px] font-semibold text-[#f1416c]",children:"X√≥a"})]})]})]},j.id))}),e.jsx("button",{onClick:S,className:"fixed bottom-20 right-4 w-12 h-12 bg-gradient-to-br from-[#009ef7] to-[#0077b6] rounded-full shadow-xl shadow-[#009ef7]/50 flex items-center justify-center hover:from-[#0077b6] hover:to-[#005a8a] transition-all z-[60] active:scale-95","aria-label":"T·∫°o phi·∫øu m·ªõi",children:e.jsx(ot,{className:"w-5 h-5 text-white"})}),me&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center md:justify-center",children:e.jsxs("div",{className:"bg-[#1e1e2d] rounded-t-3xl md:rounded-2xl w-full md:max-w-md p-6 space-y-4 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"B·ªô l·ªçc n√¢ng cao"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-300",children:"‚úï"})]}),e.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"C√°c t√πy ch·ªçn l·ªçc s·∫Ω ƒë∆∞·ª£c b·ªï sung..."})]})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
      `})]})}const Pt="repair_templates";function js(){const{profile:a}=Ct(),S=a==null?void 0:a.branch_id;return Ot({queryKey:[Pt,S],queryFn:async()=>{const I=S&&S.includes("-");let r=ct.from("repair_templates").select("*").eq("is_active",!0).order("name",{ascending:!0});I?r=r.or(`branch_id.is.null,branch_id.eq.${S}`):r=r.is("branch_id",null);const{data:G,error:ee}=await r;if(ee)throw console.error("Error fetching repair templates:",ee),ee;return G||[]},enabled:!!a,staleTime:300*1e3})}function ys(){const a=St(),{profile:S}=Ct();return _t({mutationFn:async I=>{const{data:r,error:G}=await ct.from("repair_templates").insert({branch_id:S==null?void 0:S.branch_id,name:I.name,description:I.description||null,duration:I.duration||30,labor_cost:I.labor_cost||0,parts:I.parts||[],is_active:I.is_active!==!1,created_by:S==null?void 0:S.id}).select().single();if(G)throw console.error("Error creating repair template:",G),G;return r},onSuccess:I=>{a.invalidateQueries({queryKey:[Pt]}),M.success(`ƒê√£ t·∫°o m·∫´u "${I.name}"`)},onError:I=>{M.error(`L·ªói t·∫°o m·∫´u: ${I.message}`)}})}function vs(){const a=St();return _t({mutationFn:async({id:S,updates:I})=>{const{data:r,error:G}=await ct.from("repair_templates").update({name:I.name,description:I.description,duration:I.duration,labor_cost:I.labor_cost,parts:I.parts,is_active:I.is_active}).eq("id",S).select().single();if(G)throw console.error("Error updating repair template:",G),G;return r},onSuccess:S=>{a.invalidateQueries({queryKey:[Pt]}),M.success(`ƒê√£ c·∫≠p nh·∫≠t m·∫´u "${S.name}"`)},onError:S=>{M.error(`L·ªói c·∫≠p nh·∫≠t: ${S.message}`)}})}function Ns(){const a=St();return _t({mutationFn:async S=>{const{error:I}=await ct.from("repair_templates").update({is_active:!1}).eq("id",S);if(I)throw console.error("Error deleting repair template:",I),I;return S},onSuccess:()=>{a.invalidateQueries({queryKey:[Pt]}),M.success("ƒê√£ x√≥a m·∫´u s·ª≠a ch·ªØa")},onError:S=>{M.error(`L·ªói x√≥a m·∫´u: ${S.message}`)}})}function Wt({isOpen:a,onClose:S,onApplyTemplate:I,parts:r,currentBranchId:G}){const{data:ee,isLoading:Qe}=js(),Le=ys(),pe=vs(),ke=Ns(),[ze,h]=o.useState(!1),[T,me]=o.useState(null),[f,ne]=o.useState({id:"",name:"",description:"",duration:30,laborCost:0,parts:[]}),[qe,n]=o.useState(!1),[y,j]=o.useState(""),P=o.useMemo(()=>ee?ee.map(c=>({id:c.id,name:c.name,description:c.description||"",duration:c.duration,laborCost:c.labor_cost,parts:c.parts||[]})):[],[ee]),_=o.useMemo(()=>{const c=y.toLowerCase().trim();return c?r.filter(N=>{var E,R;return N.name.toLowerCase().includes(c)||((E=N.sku)==null?void 0:E.toLowerCase().includes(c))||((R=N.barcode)==null?void 0:R.toLowerCase().includes(c))}).slice(0,20):r.slice(0,20)},[r,y]),se=()=>{me(null),ne({id:"",name:"",description:"",duration:30,laborCost:0,parts:[]}),h(!0)},ie=c=>{me(c),ne({id:c.id,name:c.name,description:c.description,duration:c.duration,laborCost:c.laborCost,parts:[...c.parts]}),h(!0)},we=async()=>{if(f.name.trim())try{T?await pe.mutateAsync({id:T.id,updates:{name:f.name,description:f.description,duration:f.duration,labor_cost:f.laborCost,parts:f.parts}}):await Le.mutateAsync({name:f.name,description:f.description,duration:f.duration,labor_cost:f.laborCost,parts:f.parts}),h(!1),me(null)}catch(c){console.error("Error saving template:",c)}},J=async c=>{if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·∫´u s·ª≠a ch·ªØa n√†y?"))try{await ke.mutateAsync(c)}catch(N){console.error("Error deleting template:",N)}},re=()=>{j(""),n(!0)},U=c=>{var E;const N=f.parts.findIndex(R=>R.name===c.name);if(N>=0){const R=[...f.parts];R[N].quantity+=1,ne({...f,parts:R})}else ne({...f,parts:[...f.parts,{name:c.name,quantity:1,price:((E=c.retailPrice)==null?void 0:E[G||""])||0,unit:"c√°i"}]});n(!1)},de=c=>{ne({...f,parts:f.parts.filter((N,E)=>E!==c)})},Ce=(c,N)=>{const E=[...f.parts];E[c].quantity=Math.max(1,N),ne({...f,parts:E})};if(!a)return null;const Se=typeof window<"u"&&window.innerWidth<768;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-0 md:p-4",children:e.jsxs("div",{className:`bg-white dark:bg-[#1e1e2d] w-full h-full md:rounded-xl md:max-w-4xl md:max-h-[90vh] md:h-auto overflow-hidden flex flex-col ${Se?"":"rounded-xl"}`,children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-[#1e1e2d] border-b border-slate-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between z-10",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-slate-900 dark:text-white",children:"M·∫´u s·ª≠a ch·ªØa th∆∞·ªùng d√πng"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:se,className:"px-2.5 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs md:text-sm flex items-center gap-1",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"T·∫°o m·∫´u m·ªõi"}),e.jsx("span",{className:"xs:hidden",children:"T·∫°o m·∫´u"})]}),e.jsx("button",{onClick:S,className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg","aria-label":"ƒê√≥ng",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-24 md:pb-6",children:[e.jsx("p",{className:"text-xs md:text-sm text-slate-600 dark:text-gray-400 mb-4",children:"Ch·ªçn m·∫´u s·ª≠a ch·ªØa ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin v√†o phi·∫øu s·ª≠a ch·ªØa"}),Qe?e.jsx("div",{className:"text-center py-12 text-slate-500 dark:text-gray-400",children:"ƒêang t·∫£i..."}):P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-slate-500 dark:text-gray-400 mb-4",children:"Ch∆∞a c√≥ m·∫´u s·ª≠a ch·ªØa n√†o"}),e.jsx("button",{onClick:se,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg",children:"T·∫°o m·∫´u ƒë·∫ßu ti√™n"})]}):e.jsx("div",{className:"space-y-3 md:grid md:grid-cols-2 md:gap-4 md:space-y-0",children:P.map(c=>e.jsxs("div",{className:"bg-[#2b2b40] md:bg-white md:dark:bg-[#2b2b40] border border-gray-700 md:border-slate-200 md:dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-3",children:[e.jsx("h3",{className:"font-semibold text-white md:text-slate-900 md:dark:text-white truncate",children:c.name}),e.jsx("p",{className:"text-sm text-gray-400 md:text-slate-500 md:dark:text-gray-400 line-clamp-2",children:c.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.duration," ph√∫t"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"text-lg font-bold text-blue-400 md:text-blue-600 md:dark:text-blue-400",children:m(c.laborCost+c.parts.reduce((N,E)=>N+E.price*E.quantity,0))})})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 md:border-slate-200 md:dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-300 md:text-slate-600 md:dark:text-gray-300 mb-2",children:"Ph·ª• t√πng c·∫ßn thi·∫øt:"}),c.parts.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"Kh√¥ng c√≥ ph·ª• t√πng"}):e.jsxs("div",{className:"space-y-1",children:[c.parts.slice(0,3).map((N,E)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 md:text-slate-500 md:dark:text-gray-400",children:[e.jsxs("span",{className:"truncate flex-1 mr-2",children:[N.name," x",N.quantity," ",N.unit]}),e.jsx("span",{className:"flex-shrink-0",children:m(N.price*N.quantity)})]},E)),c.parts.length>3&&e.jsxs("p",{className:"text-xs text-gray-500",children:["+",c.parts.length-3," ph·ª• t√πng kh√°c"]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>I(c),className:"flex-1 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"}),e.jsx("button",{onClick:()=>ie(c),className:"px-3 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg text-sm font-medium",children:"S·ª≠a"}),e.jsx("button",{onClick:()=>J(c.id),className:"px-3 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-medium",children:"X√≥a"})]})]})]},c.id))})]})]})}),ze&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-0 md:p-4",children:e.jsxs("div",{className:`bg-white dark:bg-[#1e1e2d] w-full h-full md:rounded-xl md:max-w-3xl md:max-h-[90vh] md:h-auto overflow-hidden flex flex-col ${Se?"":"rounded-xl"}`,children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-[#1e1e2d]",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:T?"S·ª≠a m·∫´u s·ª≠a ch·ªØa":"T·∫°o m·∫´u s·ª≠a ch·ªØa m·ªõi"}),e.jsx("button",{onClick:()=>{h(!1),me(null)},className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 pb-32 md:pb-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:["T√™n m·∫´u ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: Thay d·∫ßu ƒë·ªông c∆°",value:f.name,onChange:c=>ne({...f,name:c.target.value}),className:"w-full px-3 py-2.5 border border-slate-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2b2b40] text-slate-900 dark:text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{rows:2,placeholder:"M√¥ t·∫£ chi ti·∫øt d·ªãch v·ª•...",value:f.description,onChange:c=>ne({...f,description:c.target.value}),className:"w-full px-3 py-2.5 border border-slate-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2b2b40] text-slate-900 dark:text-white resize-none text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"Th·ªùi gian (ph√∫t)"}),e.jsx("input",{type:"number",min:"5",step:"5",value:f.duration,onChange:c=>ne({...f,duration:Number(c.target.value)}),className:"w-full px-3 py-2.5 border border-slate-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2b2b40] text-slate-900 dark:text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300 mb-1",children:"Chi ph√≠ c√¥ng"}),e.jsx("input",{type:"number",min:"0",step:"10000",placeholder:"0",value:f.laborCost||"",onChange:c=>ne({...f,laborCost:Number(c.target.value)}),className:"w-full px-3 py-2.5 border border-slate-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2b2b40] text-slate-900 dark:text-white text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-gray-300",children:"Ph·ª• t√πng c·∫ßn thi·∫øt"}),e.jsxs("button",{onClick:re,className:"px-2.5 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs flex items-center gap-1",children:[e.jsx(ot,{className:"w-3.5 h-3.5"}),"Th√™m"]})]}),f.parts.length===0?e.jsxs("div",{onClick:re,className:"text-center py-6 text-slate-500 dark:text-gray-400 text-sm bg-slate-50 dark:bg-[#2b2b40] rounded-lg cursor-pointer hover:bg-slate-100 dark:hover:bg-[#353550] transition-colors",children:[e.jsx(Dt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),"Ch∆∞a c√≥ ph·ª• t√πng - Nh·∫•n ƒë·ªÉ th√™m"]}):e.jsx("div",{className:"space-y-2",children:f.parts.map((c,N)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-[#2b2b40] rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:c.name}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:[m(c.price)," / ",c.unit]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Ce(N,c.quantity-1),className:"w-7 h-7 flex items-center justify-center bg-slate-200 dark:bg-gray-600 hover:bg-slate-300 dark:hover:bg-gray-500 rounded text-slate-700 dark:text-white font-bold",children:"-"}),e.jsx("span",{className:"w-8 text-center text-sm font-medium text-slate-900 dark:text-white",children:c.quantity}),e.jsx("button",{onClick:()=>Ce(N,c.quantity+1),className:"w-7 h-7 flex items-center justify-center bg-slate-200 dark:bg-gray-600 hover:bg-slate-300 dark:hover:bg-gray-500 rounded text-slate-700 dark:text-white font-bold",children:"+"})]}),e.jsx("div",{className:"text-right w-24 flex-shrink-0",children:e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:m(c.price*c.quantity)})}),e.jsx("button",{onClick:()=>de(N),className:"p-1.5 text-red-500 hover:bg-red-500/20 rounded-lg flex-shrink-0",title:"X√≥a",children:e.jsx(Ut,{className:"w-4 h-4"})})]},N))})]}),(f.laborCost>0||f.parts.length>0)&&e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-gray-400",children:"Chi ph√≠ c√¥ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:m(f.laborCost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-gray-400",children:"Ph·ª• t√πng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:m(f.parts.reduce((c,N)=>c+N.price*N.quantity,0))})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-blue-500/30",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:"T·ªïng ∆∞·ªõc t√≠nh:"}),e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:m(f.laborCost+f.parts.reduce((c,N)=>c+N.price*N.quantity,0))})]})]})})]})}),e.jsxs("div",{className:"fixed md:relative bottom-0 left-0 right-0 border-t border-slate-200 dark:border-gray-700 px-4 py-3 flex justify-end gap-3 bg-white dark:bg-[#1e1e2d]",children:[e.jsx("button",{onClick:()=>{h(!1),me(null)},className:"px-4 py-2.5 bg-slate-200 dark:bg-gray-700 hover:bg-slate-300 dark:hover:bg-gray-600 text-slate-700 dark:text-gray-200 rounded-lg text-sm font-medium",children:"H·ªßy"}),e.jsx("button",{onClick:we,disabled:!f.name.trim(),className:"px-6 py-2.5 bg-blue-500 hover:bg-blue-600 disabled:bg-slate-300 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg font-medium text-sm",children:T?"C·∫≠p nh·∫≠t":"T·∫°o m·∫´u"})]})]})}),qe&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-end md:items-center justify-center z-[70]",children:e.jsxs("div",{className:"bg-white dark:bg-[#1e1e2d] w-full md:max-w-lg md:rounded-xl md:mx-4 rounded-t-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900 dark:text-white",children:"Ch·ªçn ph·ª• t√πng"}),e.jsx("button",{onClick:()=>n(!1),className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(Xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 py-3 border-b border-slate-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"T√¨m theo t√™n, m√£ SKU, barcode...",value:y,onChange:c=>j(c.target.value),autoFocus:!0,className:"w-full pl-10 pr-4 py-2.5 border border-slate-300 dark:border-gray-600 rounded-lg bg-white dark:bg-[#2b2b40] text-slate-900 dark:text-white text-sm placeholder-gray-400"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:_.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500 dark:text-gray-400",children:[e.jsx(Dt,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Kh√¥ng t√¨m th·∫•y ph·ª• t√πng"})]}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-gray-700",children:_.map(c=>{var ve,K;const N=((ve=c.stock)==null?void 0:ve[G||""])||0,E=((K=c.retailPrice)==null?void 0:K[G||""])||0,R=f.parts.some(V=>V.name===c.name);return e.jsxs("button",{onClick:()=>U(c),className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-gray-700/50 text-left transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Dt,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:c.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-gray-400",children:[c.sku&&e.jsxs("span",{children:["SKU: ",c.sku]}),e.jsxs("span",{children:["T·ªìn: ",N]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-blue-600 dark:text-blue-400 text-sm",children:m(E)}),R&&e.jsx("span",{className:"text-xs text-green-500",children:"ƒê√£ th√™m"})]})]},c.id)})})})]})})]})}function Rs(){var at,bt,jt,yt,vt,gt;const a=St(),[S,I]=es(),{profile:r}=Ct(),{parts:G,customers:ee,employees:Qe,upsertCustomer:Le,setCashTransactions:pe,setPaymentSources:ke,paymentSources:ze,currentBranchId:h,workOrders:T,setWorkOrders:me}=ts(),{data:f,isLoading:ne}=ss(),{data:qe,isLoading:n}=as(),{data:y,isLoading:j}=is(),[P,_]=o.useState([]);o.useEffect(()=>{(async()=>{const{data:x,error:w}=await ct.from("customers").select("*").order("created_at",{ascending:!1});!w&&x&&_(x)})()},[]);const se=f||G,ie=P.length>0?P:ee,we=qe||Qe,J=y||T;o.useEffect(()=>{console.log("[ServiceManager] fetchedWorkOrders:",y==null?void 0:y.length,y),console.log("[ServiceManager] workOrders from context:",T==null?void 0:T.length,T),y&&me(y)},[y,me]);const[re,U]=o.useState(!1),[de,Ce]=o.useState(!1),[Se,c]=o.useState(!1),[N,E]=o.useState(!1),[R,ve]=o.useState(void 0),[K,V]=o.useState(""),[fe,Ye]=o.useState("all"),[Y,xt]=o.useState("all"),[he,lt]=o.useState(null),[Ie,je]=o.useState({top:0,right:0}),nt=ls();o.useEffect(()=>{S.get("status")==="pending"&&(xt("pending"),S.delete("status"),I(S,{replace:!0}))},[S,I]),o.useEffect(()=>{const s=nt.state;s!=null&&s.editOrder&&(ve(s.editOrder),U(!0),window.history.replaceState({},document.title))},[nt.state]);const[d,ye]=o.useState(null),[Ve,mt]=o.useState(!1),[i,He]=o.useState(null),Je=o.useRef(null),[pt,Z]=o.useState(!1),[te,oe]=o.useState(null),[Ze,Be]=o.useState(!1),[$e,it]=o.useState(""),Oe=async()=>{if(!(!Je.current||!d)){Z(!0);try{const s=(await $t(async()=>{const{default:L}=await import("./html2canvas.esm-QH1iLAAe.js");return{default:L}},[])).default,x=await s(Je.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"}),w=await new Promise(L=>{x.toBlob(p=>L(p),"image/png",1)}),C=`phieu-sua-chua-${ge(d.id)}.png`;if(navigator.share&&navigator.canShare){const L=new File([w],C,{type:"image/png"});navigator.canShare({files:[L]})?(await navigator.share({files:[L],title:`Phi·∫øu s·ª≠a ch·ªØa ${ge(d.id)}`}),M.success("ƒê√£ chia s·∫ª phi·∫øu th√†nh c√¥ng!")):et(w,C)}else et(w,C)}catch(s){s.name!=="AbortError"&&(console.error("Error sharing invoice:",s),M.error("Kh√¥ng th·ªÉ chia s·∫ª phi·∫øu"))}finally{Z(!1)}}},et=(s,x)=>{const w=URL.createObjectURL(s),C=document.createElement("a");C.href=w,C.download=x,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(w),M.success("ƒê√£ t·∫£i phi·∫øu xu·ªëng!")};o.useEffect(()=>{if(!he)return;const s=x=>{x.target.closest(".service-row-menu")||lt(null)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[he]);const Ue=o.useMemo(()=>{let s=J.filter(x=>!x.refunded);return console.log("[ServiceManager] Total displayWorkOrders:",J.length),console.log("[ServiceManager] Work orders status:",J.map(x=>({id:x.id,status:x.status}))),Y==="delivered"?s=s.filter(x=>x.status==="Tr·∫£ m√°y"):(s=s.filter(x=>x.status!=="Tr·∫£ m√°y"),Y==="pending"?s=s.filter(x=>x.status==="Ti·∫øp nh·∫≠n"):Y==="inProgress"?s=s.filter(x=>x.status==="ƒêang s·ª≠a"):Y==="done"&&(s=s.filter(x=>x.status==="ƒê√£ s·ª≠a xong"))),console.log("[ServiceManager] After tab filter:",Y,s.length),K&&(s=s.filter(x=>{var w,C;return x.customerName.toLowerCase().includes(K.toLowerCase())||((w=x.vehicleModel)==null?void 0:w.toLowerCase().includes(K.toLowerCase()))||((C=x.licensePlate)==null?void 0:C.toLowerCase().includes(K.toLowerCase()))})),s.sort((x,w)=>{const C=x.creationDate||x.creationdate,L=w.creationDate||w.creationdate;return!C||!L?0:new Date(L).getTime()-new Date(C).getTime()})},[J,Y,K]),z=o.useMemo(()=>{const s=J.filter(v=>v.status==="Ti·∫øp nh·∫≠n").length,x=J.filter(v=>v.status==="ƒêang s·ª≠a").length,w=J.filter(v=>v.status==="ƒê√£ s·ª≠a xong").length,C=J.filter(v=>v.status==="Tr·∫£ m√°y").length,L=J.filter(v=>v.paymentStatus==="paid"&&new Date(v.creationDate).toDateString()===new Date().toDateString()).reduce((v,ue)=>v+ue.total,0),p=J.filter(v=>v.paymentStatus==="paid"&&new Date(v.creationDate).toDateString()===new Date().toDateString()).reduce((v,ue)=>{var be,De;const xe=((be=ue.partsUsed)==null?void 0:be.reduce((le,$)=>le+($.costPrice||0)*($.quantity||1),0))||0,_e=((De=ue.additionalServices)==null?void 0:De.reduce((le,$)=>le+($.costPrice||0)*($.quantity||1),0))||0;return v+(ue.total-xe-_e)},0);return{pending:s,inProgress:x,done:w,delivered:C,todayRevenue:L,todayProfit:p}},[J]),ae=z.pending+z.inProgress+z.done,tt=z.pending+z.inProgress,ce=ae?Math.round(tt/ae*100):0,Pe=ae?Math.round(z.done/ae*100):0,Te=z.todayRevenue?Math.round(z.todayProfit/z.todayRevenue*100):0,ht={slate:"bg-slate-100 text-slate-600 dark:bg-slate-900/30 dark:text-slate-200",blue:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300",orange:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-300",green:"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300",purple:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-300"},rt=o.useMemo(()=>[{key:"all",label:"T·∫•t c·∫£",color:"slate",count:J.filter(s=>s.status!=="Tr·∫£ m√°y"&&!s.refunded).length},{key:"pending",label:"Ti·∫øp nh·∫≠n",color:"blue",count:z.pending},{key:"inProgress",label:"ƒêang s·ª≠a",color:"orange",count:z.inProgress},{key:"done",label:"ƒê√£ s·ª≠a xong",color:"green",count:z.done},{key:"delivered",label:"ƒê√£ tr·∫£ m√°y",color:"purple",count:z.delivered}],[J,z.delivered,z.done,z.inProgress,z.pending]),st=[{key:"pending",label:"Ti·∫øp nh·∫≠n",value:z.pending,subtitle:"Ch·ªù ph√¢n c√¥ng",accent:"from-sky-50 via-sky-50 to-white dark:from-sky-900/30 dark:via-sky-900/10",dot:"bg-sky-500"},{key:"inProgress",label:"ƒêang s·ª≠a",value:z.inProgress,subtitle:"ƒêang thi c√¥ng",accent:"from-amber-50 via-amber-50 to-white dark:from-amber-900/30 dark:via-amber-900/10",dot:"bg-amber-500"},{key:"done",label:"ƒê√£ s·ª≠a xong",value:z.done,subtitle:"Ch·ªù giao kh√°ch",accent:"from-emerald-50 via-emerald-50 to-white dark:from-emerald-900/30 dark:via-emerald-900/10",dot:"bg-emerald-500"},{key:"delivered",label:"Tr·∫£ m√°y",value:z.delivered,subtitle:"Ho√†n t·∫•t",accent:"from-purple-50 via-purple-50 to-white dark:from-purple-900/30 dark:via-purple-900/10",dot:"bg-purple-500"}],Ke=s=>{ve(s||{id:"",customerName:"",customerPhone:"",vehicleModel:"",licensePlate:"",issueDescription:"",technicianName:"",status:"Ti·∫øp nh·∫≠n",laborCost:0,discount:0,partsUsed:[],total:0,branchId:h,paymentStatus:"unpaid",creationDate:new Date().toISOString()}),U(!0)},Re=async s=>{ye(s);try{const{data:x,error:w}=await ct.from("store_settings").select("*").limit(1).single();!w&&x&&He(x)}catch(x){console.error("Error loading store settings:",x)}mt(!0)},l=()=>{setTimeout(()=>{xs("work-order-receipt")},100)},{mutateAsync:b}=rs(),{mutateAsync:k}=ds(),q=os();cs();const D=async(s,x,w,C)=>{var L;if(!(x<=0)){console.log("[createCustomerDebtIfNeeded] CALLED with:",{workOrderId:s.id,totalAmount:w,paidAmount:C,remainingAmount:x,customerName:s.customerName,timestamp:new Date().toISOString()});try{const p=s.customerPhone||s.id||`CUST-ANON-${Date.now()}`,v=((L=s.customerName)==null?void 0:L.trim())||s.customerPhone||"Kh√°ch v√£ng lai",ue=ge(s.id,i==null?void 0:i.work_order_prefix).split("-").pop()||"";let xe=`${s.vehicleModel||"Xe"} (Phi·∫øu s·ª≠a ch·ªØa #${ue})`;s.issueDescription&&(xe+=`
V·∫•n ƒë·ªÅ: ${s.issueDescription}`),s.partsUsed&&s.partsUsed.length>0&&(xe+=`

Ph·ª• t√πng ƒë√£ thay:`,s.partsUsed.forEach(le=>{xe+=`
  ‚Ä¢ ${le.quantity} x ${le.partName} - ${m(le.price*le.quantity)}`})),s.additionalServices&&s.additionalServices.length>0&&(xe+=`

D·ªãch v·ª•:`,s.additionalServices.forEach(le=>{xe+=`
  ‚Ä¢ ${le.quantity} x ${le.description} - ${m(le.price*le.quantity)}`})),s.laborCost&&s.laborCost>0&&(xe+=`

C√¥ng lao ƒë·ªông: ${m(s.laborCost)}`),s.discount&&s.discount>0&&(xe+=`
Gi·∫£m gi√°: -${m(s.discount)}`);const _e=(r==null?void 0:r.full_name)||"N/A";xe+=`

NV: ${_e}`,s.technicianName&&(xe+=`
NVK·ªπ thu·∫≠t: ${s.technicianName}`);const be={customerId:p,customerName:v,phone:s.customerPhone||null,licensePlate:s.licensePlate||null,description:xe,totalAmount:w,paidAmount:C,remainingAmount:x,createdDate:new Date().toISOString().split("T")[0],branchId:h,workOrderId:s.id};console.log("[ServiceManager] createCustomerDebt payload:",be);const De=await q.mutateAsync(be);console.log("[ServiceManager] createCustomerDebt result:",De),M.success(`ƒê√£ t·∫°o/c·∫≠p nh·∫≠t c√¥ng n·ª£ ${x.toLocaleString()}ƒë (M√£: ${(De==null?void 0:De.id)||"N/A"})`)}catch(p){console.error("Error creating/updating customer debt:",p),M.error("Kh√¥ng th·ªÉ t·∫°o/c·∫≠p nh·∫≠t c√¥ng n·ª£ t·ª± ƒë·ªông")}}},{mutateAsync:u}=Kt(),{mutateAsync:O}=Gt(),F=async s=>{var x,w;try{if(console.log("[handleMobileSave] Mobile Work Order Data:",s),!((x=s.customer)!=null&&x.name)){M.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((w=s.customer)!=null&&w.phone)){M.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}const{status:C,customer:L,vehicle:p,currentKm:v=0,issueDescription:ue,technicianId:xe,parts:_e=[],additionalServices:be=[],laborCost:De=0,discount:le=0,total:$=0,depositAmount:X=0,paymentMethod:Ee,paymentType:Tt,totalPaid:Ne=0,remainingAmount:Ge=0}=s;let t="unpaid";Ne>=$?t="paid":Ne>0&&(t="partial");const g=we.find(Q=>Q.id===xe),W=(g==null?void 0:g.name)||"";if(R!=null&&R.id){const Q=await O({id:R.id,customerName:L.name,customerPhone:L.phone,vehicleModel:(p==null?void 0:p.model)||"",licensePlate:(p==null?void 0:p.licensePlate)||"",vehicleId:(p==null?void 0:p.id)||"",currentKm:v>0?v:void 0,issueDescription:ue||"",technicianName:W,status:C,laborCost:De,discount:le,partsUsed:_e,additionalServices:be.length>0?be:void 0,total:$,branchId:h,paymentStatus:t,paymentMethod:Ee,depositAmount:X>0?X:void 0,additionalPayment:Ne>X?Ne-X:void 0,totalPaid:Ne>0?Ne:void 0,remainingAmount:Ge}),Ae={...R,customerName:L.name,customerPhone:L.phone,vehicleModel:(p==null?void 0:p.model)||"",licensePlate:(p==null?void 0:p.licensePlate)||"",vehicleId:(p==null?void 0:p.id)||"",currentKm:v>0?v:void 0,issueDescription:ue||"",technicianName:W,status:C,laborCost:De,discount:le,partsUsed:_e,additionalServices:be.length>0?be:void 0,total:$,paymentStatus:t,paymentMethod:Ee,totalPaid:Ne>0?Ne:void 0,remainingAmount:Ge};v>0&&(L!=null&&L.id)&&(p!=null&&p.id)&&await updateVehicleKmAndMaintenance(L,p.id,v,_e,be,ue),C==="Tr·∫£ m√°y"&&Ge>0&&await D(Ae,Ge,$,Ne),M.success("C·∫≠p nh·∫≠t phi·∫øu s·ª≠a ch·ªØa th√†nh c√¥ng!")}else{const Q=`${(i==null?void 0:i.work_order_prefix)||"SC"}-${Date.now()}`,Ae=await u({id:Q,customerName:L.name,customerPhone:L.phone,vehicleModel:(p==null?void 0:p.model)||"",licensePlate:(p==null?void 0:p.licensePlate)||"",vehicleId:(p==null?void 0:p.id)||"",currentKm:v>0?v:void 0,issueDescription:ue||"",technicianName:W,status:C,laborCost:De,discount:le,partsUsed:_e,additionalServices:be.length>0?be:void 0,total:$,branchId:h,paymentStatus:t,paymentMethod:Ee,depositAmount:X>0?X:void 0,additionalPayment:Ne>X?Ne-X:void 0,totalPaid:Ne>0?Ne:void 0,remainingAmount:Ge,creationDate:new Date().toISOString()}),ft={id:Q,customerName:L.name,customerPhone:L.phone,vehicleModel:(p==null?void 0:p.model)||"",licensePlate:(p==null?void 0:p.licensePlate)||"",vehicleId:(p==null?void 0:p.id)||"",currentKm:v>0?v:void 0,issueDescription:ue||"",technicianName:W,status:C,laborCost:De,discount:le,partsUsed:_e,additionalServices:be.length>0?be:void 0,total:$,branchId:h,depositAmount:X>0?X:void 0,paymentStatus:t,paymentMethod:Ee,totalPaid:Ne>0?Ne:void 0,remainingAmount:Ge,creationDate:new Date().toISOString()};v>0&&(L!=null&&L.id)&&(p!=null&&p.id)&&await updateVehicleKmAndMaintenance(L,p.id,v,_e,be,ue),C==="Tr·∫£ m√°y"&&Ge>0&&await D(ft,Ge,$,Ne),M.success("T·∫°o phi·∫øu s·ª≠a ch·ªØa th√†nh c√¥ng!")}Ce(!1),ve(void 0)}catch(C){console.error("[handleMobileSave] Error:",C),M.error(`L·ªói: ${C.message||"Kh√¥ng th·ªÉ l∆∞u phi·∫øu s·ª≠a ch·ªØa"}`)}},H=s=>{oe(s),it(""),Be(!0)},B=async()=>{if(te){if(!$e.trim()){M.error("Vui l√≤ng nh·∫≠p l√Ω do h·ªßy");return}try{console.log("[handleConfirmRefund] Starting refund for order:",te.id),console.log("[handleConfirmRefund] Refund reason:",$e);const s=await b({orderId:te.id,refundReason:$e});if(console.log("[handleConfirmRefund] Refund result:",s),!s||s.error){console.error("[handleConfirmRefund] Refund failed:",s),M.error("Kh√¥ng th·ªÉ h·ªßy ƒë∆°n s·ª≠a ch·ªØa");return}if(s&&"refund_transaction_id"in s&&"refundAmount"in s&&s.refund_transaction_id&&s.refundAmount){const x=s.refundAmount;pe(w=>[...w,{id:s.refund_transaction_id,type:"refund",category:"refund",amount:-x,date:new Date().toISOString(),description:`Ho√†n ti·ªÅn h·ªßy phi·∫øu #${(ge(te.id,i==null?void 0:i.work_order_prefix)||"").split("-").pop()} - ${$e}`,branchId:h,paymentSource:te.paymentMethod,reference:te.id}]),te.paymentMethod&&ke(w=>w.map(C=>C.id===te.paymentMethod?{...C,balance:{...C.balance,[h]:(C.balance[h]||0)-x}}:C))}me(x=>x.map(w=>w.id===te.id?{...w,refunded:!0,status:"ƒê√£ h·ªßy"}:w)),M.success("ƒê√£ h·ªßy ƒë∆°n s·ª≠a ch·ªØa th√†nh c√¥ng"),Be(!1),oe(null),it("")}catch(s){console.error("Error refunding work order:",s),M.error("L·ªói khi h·ªßy ƒë∆°n s·ª≠a ch·ªØa")}}},A=s=>{s&&(window.location.href=`tel:${s}`)},Me=async s=>{if(confirm(`X√°c nh·∫≠n x√≥a phi·∫øu ${ge(s.id)}?`))try{await k({id:s.id})}catch(x){console.error("Error deleting work order:",x)}};return window.innerWidth<768?e.jsxs(e.Fragment,{children:[e.jsx(fs,{workOrders:J||[],onCreateWorkOrder:()=>{ve(void 0),c(!1),Ce(!0)},onEditWorkOrder:s=>{ve(s),c(!0),Ce(!0)},onDeleteWorkOrder:Me,onCallCustomer:A,onPrintWorkOrder:Re,onOpenTemplates:()=>E(!0),currentBranchId:h}),de&&e.jsx(Rt,{isOpen:de,onClose:()=>{Ce(!1),ve(void 0),c(!1)},onSave:F,workOrder:R,customers:ie,parts:f||[],employees:we,currentBranchId:h,upsertCustomer:Le,viewMode:Se,onSwitchToEdit:()=>c(!1)}),Ve&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200] p-2",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-full max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Xem tr∆∞·ªõc phi·∫øu"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:async()=>{try{M.info("ƒêang t·∫°o h√¨nh ·∫£nh...");const s=(await $t(async()=>{const{default:p}=await import("./html2canvas.esm-QH1iLAAe.js");return{default:p}},[])).default,x=document.getElementById("mobile-print-preview-content");if(!x){M.error("Kh√¥ng t√¨m th·∫•y n·ªôi dung phi·∫øu!");return}const w=await s(x,{scale:2,backgroundColor:"#ffffff",useCORS:!0,logging:!1}),C=await new Promise(p=>{w.toBlob(v=>p(v),"image/png",1)}),L=`Phieu_${ge(d.id,i==null?void 0:i.work_order_prefix)}.png`;if(navigator.share&&navigator.canShare){const v={files:[new File([C],L,{type:"image/png"})],title:`Phi·∫øu s·ª≠a ch·ªØa - ${ge(d.id,i==null?void 0:i.work_order_prefix)}`};if(navigator.canShare(v))await navigator.share(v),M.success("Chia s·∫ª th√†nh c√¥ng!");else{const ue=URL.createObjectURL(C),xe=document.createElement("a");xe.href=ue,xe.download=L,xe.click(),URL.revokeObjectURL(ue),M.success("ƒê√£ t·∫£i h√¨nh ·∫£nh!")}}else{const p=URL.createObjectURL(C),v=document.createElement("a");v.href=p,v.download=L,v.click(),URL.revokeObjectURL(p),M.success("ƒê√£ t·∫£i h√¨nh ·∫£nh!")}}catch(s){console.error("Share failed:",s),M.error("Kh√¥ng th·ªÉ chia s·∫ª. Vui l√≤ng th·ª≠ l·∫°i!")}},className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-1.5 transition text-sm",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Chia s·∫ª"]}),e.jsxs("button",{onClick:l,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-1.5 transition text-sm",children:[e.jsx(kt,{className:"w-4 h-4"}),"In"]}),e.jsx("button",{onClick:()=>{mt(!1),ye(null)},className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 bg-slate-100 dark:bg-slate-700 rounded-lg","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-100 dark:bg-slate-900",children:e.jsxs("div",{id:"mobile-print-preview-content",className:"bg-white shadow-lg mx-auto",style:{maxWidth:"100%",color:"#000",padding:"4mm"},children:[e.jsxs("div",{style:{display:"flex",gap:"3mm",marginBottom:"3mm",borderBottom:"2px solid #3b82f6",paddingBottom:"2mm",alignItems:"flex-start"},children:[(i==null?void 0:i.logo_url)&&e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{src:i.logo_url,alt:"Logo",style:{height:"15mm",width:"auto",objectFit:"contain"},crossOrigin:"anonymous"})}),e.jsxs("div",{style:{flex:1,fontSize:"9pt"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"12pt",color:"#1e40af",marginBottom:"1mm"},children:(i==null?void 0:i.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#ef4444",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsx("span",{children:(i==null?void 0:i.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"})]}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#16a34a",children:e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})}),e.jsx("span",{children:(i==null?void 0:i.phone)||"0947.747.907"})]})]})]}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"3mm"},children:[e.jsx("h1",{style:{fontSize:"14pt",fontWeight:"bold",margin:"0",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"}),e.jsxs("div",{style:{fontSize:"9pt",color:"#666",marginTop:"1mm"},children:["M√£:"," ",ge(d.id,i==null?void 0:i.work_order_prefix)]}),e.jsx("div",{style:{fontSize:"8pt",color:"#666"},children:new Date(d.creationDate).toLocaleString("vi-VN")})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"2mm",borderRadius:"2mm",backgroundColor:"#f8fafc",fontSize:"9pt"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Kh√°ch h√†ng:"})," ",d.customerName," -"," ",d.customerPhone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Xe:"})," ",d.vehicleModel," -"," ",e.jsx("span",{style:{color:"#3b82f6"},children:d.licensePlate})]})]}),d.issueDescription&&e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"2mm",borderRadius:"2mm",fontSize:"9pt"},children:[e.jsx("strong",{children:"M√¥ t·∫£ s·ª± c·ªë:"})," ",d.issueDescription]}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"2mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 1mm 0",fontSize:"10pt"},children:"Ph·ª• t√πng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd",fontSize:"9pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"left"},children:"T√™n"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"center",width:"12%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"right",width:"28%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((s,x)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm"},children:s.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"center"},children:s.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"right",fontWeight:"bold"},children:m(s.price*s.quantity)})]},x))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"2mm",fontSize:"9pt"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 1mm 0",fontSize:"10pt"},children:"D·ªãch v·ª• b·ªï sung:"}),d.additionalServices.map((s,x)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:s.description}),e.jsx("span",{style:{fontWeight:"bold"},children:m(s.price*(s.quantity||1))})]},x))]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",borderRadius:"2mm",backgroundColor:"#f9f9f9",fontSize:"9pt"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{children:m(((at=d.partsUsed)==null?void 0:at.reduce((s,x)=>s+x.price*x.quantity,0))||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{children:m(d.laborCost||0)})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{children:m(d.additionalServices.reduce((s,x)=>s+(x.price||0)*(x.quantity||1),0))})]}),d.discount!=null&&d.discount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm",color:"#e74c3c"},children:[e.jsx("span",{children:"Gi·∫£m gi√°:"}),e.jsxs("span",{children:["-",m(d.discount)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"2mm",borderTop:"2px solid #3b82f6",fontSize:"12pt",fontWeight:"bold",color:"#1e40af"},children:[e.jsx("span",{children:"T·ªîNG C·ªòNG:"}),e.jsx("span",{children:m(d.total||0)})]}),d.depositAmount!=null&&d.depositAmount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1mm",color:"#16a34a"},children:[e.jsx("span",{children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsx("span",{children:m(d.depositAmount)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",color:"#dc2626"},children:[e.jsx("span",{children:"C√≤n l·∫°i:"}),e.jsx("span",{children:m(d.remainingAmount||d.total-d.depositAmount)})]})]})]}),(i==null?void 0:i.bank_name)&&e.jsx("div",{style:{marginTop:"3mm",border:"1px solid #ddd",padding:"2mm",borderRadius:"2mm",backgroundColor:"#f0f9ff",fontSize:"9pt"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"3mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#1e40af"},children:"üè¶ Th√¥ng tin thanh to√°n"}),e.jsxs("div",{style:{color:"#000"},children:["Ng√¢n h√†ng: ",i.bank_name]}),i.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK:"," ",e.jsx("strong",{children:i.bank_account_number})]}),i.bank_account_holder&&e.jsxs("div",{style:{color:"#000"},children:["Ch·ªß TK: ",i.bank_account_holder]}),i.bank_branch&&e.jsxs("div",{style:{color:"#666",fontSize:"8pt"},children:["Chi nh√°nh: ",i.bank_branch]})]}),i.bank_qr_url&&e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{src:i.bank_qr_url,alt:"QR Banking",style:{height:"20mm",width:"20mm",objectFit:"contain"},crossOrigin:"anonymous"})})]})}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"8pt",textAlign:"center"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"2mm",fontSize:"9pt",textAlign:"right",color:"#666"},children:["KTV: ",d.technicianName||"Ch∆∞a ph√¢n c√¥ng"]})]})})]})}),e.jsx(Wt,{isOpen:N,onClose:()=>E(!1),onApplyTemplate:s=>{const x={id:`WO-${Date.now()}`,customerName:"",customerPhone:"",vehicleModel:"",issueDescription:s.description,status:"Ti·∫øp nh·∫≠n",creationDate:new Date().toISOString(),estimatedCompletion:new Date(Date.now()+s.duration*6e4).toISOString(),assignedTechnician:"",laborCost:s.laborCost,partsUsed:s.parts.map(w=>({partId:"",partName:w.name,quantity:w.quantity,unitPrice:w.price})),notes:"",total:0};ve(x),E(!1),Ce(!0)},parts:f||[],currentBranchId:h})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-[2fr,1fr]",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Phi·∫øu c·∫ßn x·ª≠ l√Ω"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:tt}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Chi·∫øm ",ce,"% c·ªßa ",ae||0," phi·∫øu ƒëang m·ªü"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Ho√†n th√†nh"}),e.jsxs("p",{className:"text-xl font-semibold text-emerald-600 dark:text-emerald-400",children:[Pe,"%"]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[z.done," phi·∫øu ch·ªù giao"]})]})]}),e.jsx("div",{className:"mt-4 grid gap-2 sm:grid-cols-2 lg:grid-cols-4",children:st.map(s=>e.jsx("button",{onClick:()=>xt(Y===s.key?"all":s.key),className:`text-left rounded-lg border p-3 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/50 ${Y===s.key?"border-blue-500 bg-blue-50/60 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700"}`,children:e.jsxs("div",{className:`rounded-lg bg-gradient-to-br ${s.accent} p-2`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:s.label}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:s.value})]}),e.jsx("span",{className:`h-2 w-2 rounded-full ${s.dot}`})]}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500 dark:text-slate-400",children:s.subtitle})]})},s.key))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 p-3 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold uppercase tracking-wide text-white/80",children:"Doanh thu h√¥m nay"}),e.jsx("p",{className:"mt-1 text-xl font-semibold",children:m(z.todayRevenue)})]}),e.jsx(ns,{className:"w-6 h-6 text-white/80"})]}),e.jsx("p",{className:"mt-1.5 text-[10px] text-white/80",children:"Bao g·ªìm c√°c phi·∫øu ƒë√£ thanh to√°n trong ng√†y"})]}),e.jsxs("div",{className:"rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold uppercase tracking-wide text-slate-400",children:"L·ª£i nhu·∫≠n h√¥m nay"}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-slate-900 dark:text-slate-100",children:m(z.todayProfit)})]}),e.jsx(qt,{className:"w-6 h-6 text-blue-500"})]}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Bi√™n l·ª£i nhu·∫≠n"}),e.jsxs("span",{className:"font-semibold text-emerald-600 dark:text-emerald-400",children:[Te,"%"]})]})]})]})]}),e.jsxs("div",{className:"lg:hidden bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Tr·∫°ng th√°i nhanh"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:rt.map(s=>e.jsxs("button",{onClick:()=>xt(Y===s.key?"all":s.key),className:`inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm transition ${Y===s.key?"border-blue-500 bg-blue-50 text-blue-600 dark:bg-blue-900/20":"border-slate-200 text-slate-600 hover:border-slate-300 dark:border-slate-700 dark:text-slate-300"}`,children:[e.jsx("span",{children:s.label}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${ht[s.color]}`,children:s.count})]},s.key))})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[180px] max-w-[280px]",children:[e.jsx("input",{type:"text",placeholder:"M√£ phi·∫øu, t√™n kh√°ch...",value:K,onChange:s=>V(s.target.value),className:"w-full pl-8 pr-3 py-1.5 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-xs text-slate-900 dark:text-slate-100 placeholder-slate-400"}),e.jsx(Nt,{className:"absolute left-2.5 top-2 w-3.5 h-3.5 text-slate-400","aria-hidden":"true"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"T·∫•t c·∫£ ng√†y"}),e.jsx("option",{children:"H√¥m nay"}),e.jsx("option",{children:"7 ng√†y qua"}),e.jsx("option",{children:"30 ng√†y qua"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"T·∫•t c·∫£ KTV"}),e.jsx("option",{children:"KTV 1"}),e.jsx("option",{children:"KTV 2"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"Thanh to√°n"}),e.jsx("option",{children:"ƒê√£ TT"}),e.jsx("option",{children:"Ch∆∞a TT"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>E(!0),className:"px-2.5 py-1.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-xs font-medium flex items-center gap-1","aria-label":"M·ªü danh s√°ch m·∫´u s·ª≠a ch·ªØa",children:[e.jsx(wt,{className:"w-3.5 h-3.5"})," M·∫´u SC"]}),e.jsxs(Ht,{to:"/service-history",className:"px-2.5 py-1.5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg text-xs font-medium flex items-center gap-1 transition-colors",children:[e.jsx(Ft,{className:"w-3.5 h-3.5"})," L·ªãch s·ª≠ SC"]}),e.jsxs("button",{onClick:()=>{window.innerWidth<768?Ce(!0):Ke()},className:"px-2.5 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-medium flex items-center gap-1","aria-label":"T·∫°o phi·∫øu s·ª≠a ch·ªØa m·ªõi",children:[e.jsx(ot,{className:"w-3.5 h-3.5"})," Th√™m Phi·∫øu"]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300 w-12",children:e.jsx("input",{type:"checkbox",className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Kh√°ch h√†ng"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Thanh to√°n & tr·∫°ng th√°i"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-800",children:Ue.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-slate-400",children:"Kh√¥ng c√≥ phi·∫øu s·ª≠a ch·ªØa n√†o."})}):Ue.map(s=>{var ue,xe,_e,be,De,le;(ue=s.partsUsed)!=null&&ue.reduce(($,X)=>$+X.quantity*X.price,0),(xe=s.additionalServices)!=null&&xe.reduce(($,X)=>$+(X.price||0)*(X.quantity||1),0),s.laborCost;const x=s.total||0,w=x-(s.remainingAmount||0),C=x?Math.min(100,Math.round(w/x*100)):0,L=s.paymentStatus==="paid"?"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-300",p=((_e=s.partsUsed)==null?void 0:_e.slice(0,2))||[];(((be=s.partsUsed)==null?void 0:be.length)||0)-p.length;const v=((De=s.additionalServices)==null?void 0:De.slice(0,2))||[];return(((le=s.additionalServices)==null?void 0:le.length)||0)-v.length,e.jsxs("tr",{onClick:()=>Ke(s),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/30 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-2 py-4 align-top",onClick:$=>$.stopPropagation(),children:e.jsx("input",{type:"checkbox",className:"rounded"})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-mono font-bold text-blue-600 dark:text-blue-400 text-sm",children:ge(s.id,i==null?void 0:i.work_order_prefix)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsx("span",{children:"Ng√†y: "}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:Bt(s.creationDate,!0)})]}),e.jsxs("div",{className:"text-xs text-cyan-600 dark:text-cyan-400",children:["NV: ",s.technicianName||"Ch∆∞a ph√¢n c√¥ng"]})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold text-base text-slate-900 dark:text-slate-100",children:s.customerName}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:s.customerPhone}),e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"Xe: "}),e.jsx("span",{children:s.vehicleModel||"N/A"}),s.licensePlate&&e.jsxs("span",{className:"ml-1",children:["- ",s.licensePlate]})]}),e.jsx("div",{className:"text-xs text-slate-500 italic mt-1",children:s.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-1.5 max-w-[180px]",children:[p.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["üîß"," "]}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300",children:[p.slice(0,2).map(($,X)=>{var Ee;return e.jsxs("span",{children:[((Ee=$.partName)==null?void 0:Ee.length)>20?$.partName.substring(0,20)+"...":$.partName,$.quantity>1&&` x${$.quantity}`,X<Math.min(p.length,2)-1&&", "]},X)}),p.length>2&&e.jsxs("span",{className:"text-slate-400",children:[" ","+",p.length-2]})]})]}),v.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["‚öôÔ∏è"," "]}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300",children:[v.slice(0,2).map(($,X)=>{var Ee;return e.jsxs("span",{children:[((Ee=$.description)==null?void 0:Ee.length)>15?$.description.substring(0,15)+"...":$.description,X<Math.min(v.length,2)-1&&", "]},X)}),v.length>2&&e.jsxs("span",{className:"text-slate-400",children:[" ","+",v.length-2]})]})]}),p.length===0&&v.length===0&&e.jsx("div",{className:"text-xs text-slate-400 italic",children:"‚Äî"})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-800 dark:text-slate-200",children:m(x)}),x>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-1.5 w-full rounded-full bg-slate-200 dark:bg-slate-700",children:e.jsx("div",{className:`h-full rounded-full transition-all ${C>=100?"bg-emerald-500":C>0?"bg-blue-500":"bg-slate-300"}`,style:{width:`${Math.min(C,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["ƒê√£ thu:"," ",m(Math.max(0,w))]}),s.remainingAmount!==void 0&&s.remainingAmount>0&&e.jsxs("span",{className:"text-red-500 font-medium",children:["C√≤n"," ",m(s.remainingAmount)]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx(ks,{status:s.status}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${L}`,children:s.paymentStatus==="paid"?"ƒê√£ TT":s.paymentStatus==="partial"?"TT m·ªôt ph·∫ßn":"Ch∆∞a TT"})]})]})}),e.jsx("td",{className:"px-4 py-4 align-top overflow-visible",onClick:$=>$.stopPropagation(),children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsxs("div",{className:"relative service-row-menu",children:[e.jsx("button",{onClick:$=>{$.stopPropagation();const X=$.currentTarget.getBoundingClientRect();je({top:X.bottom+4,right:window.innerWidth-X.right}),lt(he===s.id?null:s.id)},"aria-haspopup":"menu","aria-expanded":he===s.id,className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 hover:text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:e.jsx(Lt,{className:"w-4 h-4"})}),he===s.id&&e.jsxs("div",{className:"fixed w-48 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 shadow-xl z-[9999]",style:{top:Ie.top,right:Ie.right},children:[e.jsxs("button",{onClick:()=>{Re(s),lt(null)},className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-slate-600 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-slate-700 rounded-t-lg",children:[e.jsx(kt,{className:"w-4 h-4"})," In phi·∫øu"]}),e.jsxs("button",{onClick:()=>{A(s.customerPhone||""),lt(null)},className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-slate-600 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-slate-700",children:[e.jsx(gs,{className:"w-4 h-4"})," G·ªçi kh√°ch"]}),!s.refunded&&e.jsx("button",{onClick:()=>{H(s),lt(null)},className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-b-lg",children:"H·ªßy/Ho√†n ti·ªÅn"})]})]})})})]},s.id)})})]})})}),e.jsx(Wt,{isOpen:N,onClose:()=>E(!1),onApplyTemplate:s=>{const x={id:`WO-${Date.now()}`,customerName:"",customerPhone:"",vehicleModel:"",issueDescription:s.description,status:"Ti·∫øp nh·∫≠n",creationDate:new Date().toISOString(),estimatedCompletion:new Date(Date.now()+s.duration*6e4).toISOString(),assignedTechnician:"",laborCost:s.laborCost,partsUsed:s.parts.map(w=>({partId:"",partName:w.name,quantity:w.quantity,unitPrice:w.price})),notes:"",total:0};ve(x),E(!1),U(!0)},parts:f||[],currentBranchId:h}),re&&R&&e.jsx(ws,{order:R,onClose:()=>{U(!1),ve(void 0)},onSave:()=>{U(!1),ve(void 0)},parts:se,partsLoading:ne,customers:ie,employees:we,upsertCustomer:Le,setCashTransactions:pe,setPaymentSources:ke,paymentSources:ze,currentBranchId:h,storeSettings:i,invalidateWorkOrders:()=>a.invalidateQueries({queryKey:["workOrdersRepo"]})}),e.jsx(Rt,{isOpen:de,onClose:()=>{Ce(!1),ve(void 0)},onSave:F,workOrder:R,customers:ie,parts:f||[],employees:we||[],currentBranchId:h}),Ve&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Xem tr∆∞·ªõc phi·∫øu in"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Oe,disabled:pt,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white rounded-lg flex items-center gap-2 transition",children:[e.jsx(Vt,{className:"w-4 h-4"}),pt?"ƒêang x·ª≠ l√Ω...":"Chia s·∫ª"]}),e.jsxs("button",{onClick:l,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition",children:[e.jsx(kt,{className:"w-4 h-4"}),"In phi·∫øu"]}),e.jsx("button",{onClick:()=>{mt(!1),ye(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{ref:Je,className:"bg-white shadow-lg mx-auto",style:{width:"148mm",minHeight:"210mm",color:"#000"},children:e.jsxs("div",{style:{padding:"10mm"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"4mm",marginBottom:"4mm",borderBottom:"2px solid #3b82f6",paddingBottom:"3mm"},children:[(i==null?void 0:i.logo_url)&&e.jsx("img",{src:i.logo_url,alt:"Logo",style:{height:"18mm",width:"18mm",objectFit:"contain",flexShrink:0}}),e.jsxs("div",{style:{fontSize:"8.5pt",lineHeight:"1.4",flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",marginBottom:"1mm",color:"#1e40af"},children:(i==null?void 0:i.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#ef4444",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsx("span",{children:(i==null?void 0:i.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"})]}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#16a34a",children:e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})}),e.jsx("span",{children:(i==null?void 0:i.phone)||"0947.747.907"})]}),(i==null?void 0:i.email)&&e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#3b82f6",children:e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})}),e.jsx("span",{children:i.email})]})]}),e.jsx("div",{style:{fontSize:"8pt",lineHeight:"1.4",textAlign:"right",flexShrink:0},children:(i==null?void 0:i.bank_name)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#000",display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#0891b2",children:e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"})}),e.jsx("span",{children:i.bank_name})]}),i.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK: ",i.bank_account_number]}),i.bank_account_holder&&e.jsx("div",{style:{color:"#000",fontSize:"7.5pt"},children:i.bank_account_holder}),i.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm",display:"inline-block"},children:e.jsx("img",{src:i.bank_qr_url,alt:"QR Banking",style:{height:"15mm",width:"15mm",objectFit:"contain"}})})]})})]}),e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"2mm"},children:e.jsx("h1",{style:{fontSize:"16pt",fontWeight:"bold",margin:"0",textTransform:"uppercase",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9pt",color:"#666"},children:[e.jsx("div",{children:new Date(d.creationDate).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontWeight:"bold"},children:["M√£:"," ",ge(d.id,i==null?void 0:i.work_order_prefix)]})]})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"3mm",marginBottom:"3mm",borderRadius:"2mm",backgroundColor:"#f8fafc",color:"#000",fontSize:"9pt"},children:[e.jsxs("div",{style:{display:"flex",gap:"4mm",marginBottom:"1.5mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Kh√°ch h√†ng:"})," ",d.customerName]}),e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"SƒêT:"})," ",d.customerPhone]})]}),e.jsxs("div",{style:{display:"flex",gap:"4mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Lo·∫°i xe:"})," ",d.vehicleModel]}),e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bi·ªÉn s·ªë:"})," ",d.licensePlate]})]})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",color:"#000"},children:e.jsxs("div",{style:{display:"flex",gap:"3mm"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:"20%",flexShrink:0},children:"M√¥ t·∫£ s·ª± c·ªë:"}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap"},children:d.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"4mm",color:"#000"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"Ph·ª• t√πng s·ª≠ d·ª•ng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"left",fontSize:"10pt"},children:"T√™n ph·ª• t√πng"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt",width:"15%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"ƒê∆°n gi√°"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((s,x)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",fontSize:"10pt"},children:s.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt"},children:s.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt"},children:m(s.price)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",fontWeight:"bold"},children:m(s.price*s.quantity)})]},x))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"4mm",color:"#000"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt",color:"#000"},children:"D·ªãch v·ª• b·ªï sung:"}),e.jsx("ul",{style:{margin:"0",paddingLeft:"5mm",color:"#000"},children:d.additionalServices.map((s,x)=>e.jsxs("li",{style:{marginBottom:"1mm"},children:[s.description," -"," ",m(s.price)," x"," ",s.quantity]},x))})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",backgroundColor:"#f9f9f9",color:"#000"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0",color:"#000"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:m(((bt=d.partsUsed)==null?void 0:bt.reduce((s,x)=>s+x.price*x.quantity,0))||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:m(d.laborCost||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:m(((jt=d.additionalServices)==null?void 0:jt.reduce((s,x)=>s+(x.price||0)*(x.quantity||1),0))||0)})]}),d.discount!=null&&d.discount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:"Gi·∫£m gi√°:"}),e.jsxs("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:["-",m(d.discount)]})]}),e.jsxs("tr",{style:{borderTop:"2px solid #333"},children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"12pt"},children:"T·ªîNG C·ªòNG:"}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"12pt",fontWeight:"bold",color:"#2563eb"},children:[m(d.total)," ‚Ç´"]})]}),d.totalPaid!=null&&d.totalPaid>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:"ƒê√£ thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:m(d.totalPaid)})]}),d.remainingAmount!=null&&d.remainingAmount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",fontSize:"11pt",color:"#dc2626"},children:"C√≤n l·∫°i:"}),e.jsx("td",{style:{textAlign:"right",fontSize:"11pt",fontWeight:"bold",color:"#dc2626"},children:m(d.remainingAmount)})]}),d.paymentMethod&&e.jsxs("tr",{children:[e.jsx("td",{style:{paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:"H√¨nh th·ª©c thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:d.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":d.paymentMethod==="bank"?"Chuy·ªÉn kho·∫£n":d.paymentMethod})]})]})})}),e.jsx("div",{style:{marginTop:"8mm",paddingTop:"4mm",borderTop:"1px dashed #999",color:"#000"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10pt"},children:[e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0",color:"#000"},children:"Kh√°ch h√†ng"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0",color:"#000"},children:"Nh√¢n vi√™n"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:d.technicianName||"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]})]})}),e.jsxs("div",{style:{marginTop:"4mm",padding:"3mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"9pt",textAlign:"center",color:"#000"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic",color:"#000"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic",color:"#000"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",fontSize:"8pt",color:"#666",borderTop:"1px solid #e5e7eb",lineHeight:"1.4"},children:[e.jsx("p",{style:{margin:"0 0 1mm 0",fontWeight:"bold"},children:"Ch√≠nh s√°ch b·∫£o h√†nh:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"5mm",listStyleType:"disc"},children:[e.jsx("li",{children:"B·∫£o h√†nh √°p d·ª•ng cho ph·ª• t√πng ch√≠nh h√£ng v√† l·ªói k·ªπ thu·∫≠t do th·ª£"}),e.jsx("li",{children:"Kh√¥ng b·∫£o h√†nh ƒë·ªëi v·ªõi va ch·∫°m, ng√£ xe, ng·∫≠p n∆∞·ªõc sau khi nh·∫≠n xe"}),e.jsx("li",{children:"Mang theo phi·∫øu n√†y khi ƒë·∫øn b·∫£o h√†nh. Li√™n h·ªá hotline n·∫øu c√≥ th·∫Øc m·∫Øc"})]})]})]})})})]})}),d&&e.jsxs("div",{id:"work-order-receipt",className:"hidden print:block",style:{width:"148mm",margin:"0 auto",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"11pt",color:"#000",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"4mm",borderBottom:"2px solid #3b82f6",paddingBottom:"3mm",marginBottom:"4mm"},children:[(i==null?void 0:i.logo_url)&&e.jsx("img",{src:i.logo_url,alt:"Logo",style:{height:"18mm",width:"18mm",objectFit:"contain",flexShrink:0}}),e.jsxs("div",{style:{fontSize:"8.5pt",lineHeight:"1.4",flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",marginBottom:"1mm",color:"#1e40af"},children:(i==null?void 0:i.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#ef4444",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsx("span",{children:(i==null?void 0:i.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"})]}),e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#16a34a",children:e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})}),e.jsx("span",{children:(i==null?void 0:i.phone)||"0947.747.907"})]}),(i==null?void 0:i.email)&&e.jsxs("div",{style:{color:"#000",display:"flex",alignItems:"center",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#3b82f6",children:e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})}),e.jsx("span",{children:i.email})]})]}),e.jsx("div",{style:{fontSize:"8pt",lineHeight:"1.4",textAlign:"right",flexShrink:0},children:(i==null?void 0:i.bank_name)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#000",display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"1mm"},children:[e.jsx("svg",{style:{width:"10px",height:"10px",flexShrink:0},viewBox:"0 0 24 24",fill:"#0891b2",children:e.jsx("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"})}),e.jsx("span",{children:i.bank_name})]}),i.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK: ",i.bank_account_number]}),i.bank_account_holder&&e.jsx("div",{style:{color:"#000",fontSize:"7.5pt"},children:i.bank_account_holder}),i.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm",display:"inline-block"},children:e.jsx("img",{src:i.bank_qr_url,alt:"QR Banking",style:{height:"15mm",width:"15mm",objectFit:"contain"}})})]})})]}),e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"2mm"},children:e.jsx("h1",{style:{fontSize:"16pt",fontWeight:"bold",margin:"0",textTransform:"uppercase",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9pt",color:"#666"},children:[e.jsx("div",{children:new Date(d.creationDate).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontWeight:"bold"},children:["M√£:"," ",ge(d.id,i==null?void 0:i.work_order_prefix)]})]})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",width:"20%",paddingBottom:"2mm"},children:"Kh√°ch h√†ng:"}),e.jsx("td",{style:{paddingBottom:"2mm",width:"30%"},children:d.customerName}),e.jsx("td",{style:{fontWeight:"bold",width:"15%",paddingBottom:"2mm",paddingLeft:"3mm"},children:"Thanh L·ªôc"}),e.jsx("td",{style:{paddingBottom:"2mm"},children:d.customerPhone})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm"},children:"Lo·∫°i xe:"}),e.jsx("td",{style:{paddingBottom:"2mm"},colSpan:3,children:d.vehicleModel})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold"},children:"Bi·ªÉn s·ªë:"}),e.jsx("td",{colSpan:3,children:d.licensePlate})]})]})})}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm"},children:e.jsxs("div",{style:{display:"flex",gap:"3mm"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:"20%",flexShrink:0},children:"M√¥ t·∫£ s·ª± c·ªë:"}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap"},children:d.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"Ph·ª• t√πng s·ª≠ d·ª•ng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"left",fontSize:"10pt"},children:"T√™n ph·ª• t√πng"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt",width:"15%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"ƒê∆°n gi√°"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((s,x)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",fontSize:"10pt"},children:s.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt"},children:s.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt"},children:m(s.price)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",fontWeight:"bold"},children:m(s.price*s.quantity)})]},x))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"D·ªãch v·ª• b·ªï sung:"}),e.jsx("ul",{style:{margin:"0",paddingLeft:"5mm"},children:d.additionalServices.map((s,x)=>e.jsxs("li",{style:{marginBottom:"1mm"},children:[s.description," - ",m(s.price)," x"," ",s.quantity]},x))})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",backgroundColor:"#f9f9f9"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:m(((yt=d.partsUsed)==null?void 0:yt.reduce((s,x)=>s+x.price*x.quantity,0))||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:m(((vt=d.additionalServices)==null?void 0:vt.reduce((s,x)=>s+(x.price||0)*(x.quantity||1),0))||0)})]}),d.discount!=null&&d.discount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:"Gi·∫£m gi√°:"}),e.jsxs("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:["-",m(d.discount)]})]}),e.jsxs("tr",{style:{borderTop:"2px solid #333"},children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"12pt"},children:"T·ªîNG C·ªòNG:"}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"12pt",fontWeight:"bold",color:"#2563eb"},children:[m(d.total)," ‚Ç´"]})]}),d.totalPaid!=null&&d.totalPaid>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:"ƒê√£ thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:m(d.totalPaid)})]}),d.remainingAmount!=null&&d.remainingAmount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",fontSize:"11pt",color:"#dc2626"},children:"C√≤n l·∫°i:"}),e.jsx("td",{style:{textAlign:"right",fontSize:"11pt",fontWeight:"bold",color:"#dc2626"},children:m(d.remainingAmount)})]}),d.paymentMethod&&e.jsxs("tr",{children:[e.jsx("td",{style:{paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:"H√¨nh th·ª©c thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:d.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":d.paymentMethod==="bank"?"Chuy·ªÉn kho·∫£n":d.paymentMethod})]})]})})}),e.jsx("div",{style:{marginTop:"8mm",paddingTop:"4mm",borderTop:"1px dashed #999"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10pt"},children:[e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0"},children:"Kh√°ch h√†ng"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0"},children:"Nh√¢n vi√™n"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:d.technicianName||"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]})]})}),e.jsxs("div",{style:{marginTop:"4mm",padding:"3mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"9pt",textAlign:"center"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",fontSize:"8pt",color:"#666",borderTop:"1px solid #e5e7eb",lineHeight:"1.4"},children:[e.jsx("p",{style:{margin:"0 0 1mm 0",fontWeight:"bold"},children:"Ch√≠nh s√°ch b·∫£o h√†nh:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"5mm",listStyleType:"disc"},children:[e.jsx("li",{children:"B·∫£o h√†nh √°p d·ª•ng cho ph·ª• t√πng ch√≠nh h√£ng v√† l·ªói k·ªπ thu·∫≠t do th·ª£"}),e.jsx("li",{children:"Kh√¥ng b·∫£o h√†nh ƒë·ªëi v·ªõi va ch·∫°m, ng√£ xe, ng·∫≠p n∆∞·ªõc sau khi nh·∫≠n xe"}),e.jsx("li",{children:"Mang theo phi·∫øu n√†y khi ƒë·∫øn b·∫£o h√†nh. Li√™n h·ªá hotline n·∫øu c√≥ th·∫Øc m·∫Øc"})]})]})]}),Ze&&te&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-md",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"X√°c nh·∫≠n h·ªßy phi·∫øu"}),e.jsx("button",{onClick:()=>{Be(!1),oe(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:"‚úï"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"C·∫£nh b√°o:"})," H√†nh ƒë·ªông n√†y s·∫Ω:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-300 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Ho√†n tr·∫£ t·ªìn kho c√°c ph·ª• t√πng ƒë√£ s·ª≠ d·ª•ng"}),e.jsxs("li",{children:["Ho√†n ti·ªÅn ",m(te.totalPaid||0)," ","cho kh√°ch"]}),e.jsx("li",{children:'ƒê√°nh d·∫•u phi·∫øu l√† "ƒê√£ h·ªßy"'})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["L√Ω do h·ªßy phi·∫øu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:$e,onChange:s=>it(s.target.value),placeholder:"Vd: Kh√°ch h√†ng kh√¥ng ƒë·ªìng √Ω chi ph√≠, s·ª≠a nh·∫ßm xe...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none",rows:3})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Phi·∫øu:"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:["#",ge(te.id,i==null?void 0:i.work_order_prefix).split("-").pop()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Kh√°ch h√†ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:te.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ph·ª• t√πng:"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:[((gt=te.partsUsed)==null?void 0:gt.length)||0," m√≥n"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-slate-200 dark:border-slate-600 pt-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"S·ªë ti·ªÅn ho√†n:"}),e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:m(te.totalPaid||0)})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-6 py-4 flex justify-end gap-3 rounded-b-xl",children:[e.jsx("button",{onClick:()=>{Be(!1),oe(null)},className:"px-4 py-2 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg font-medium",children:"H·ªßy b·ªè"}),e.jsx("button",{onClick:B,disabled:!$e.trim(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-300 dark:disabled:bg-red-900 text-white rounded-lg font-medium disabled:cursor-not-allowed",children:"X√°c nh·∫≠n h·ªßy phi·∫øu"})]})]})})]})}const ws=({order:a,onClose:S,onSave:I,parts:r,partsLoading:G,customers:ee,employees:Qe,upsertCustomer:Le,setCashTransactions:pe,setPaymentSources:ke,paymentSources:ze,currentBranchId:h,storeSettings:T,invalidateWorkOrders:me})=>{const f=["Honda Wave RSX","Honda Wave Alpha","Honda Blade","Honda Future","Honda Winner X","Honda Vision","Honda Air Blade","Honda SH Mode","Honda SH 125i","Honda SH 150i","Honda SH 160i","Honda SH 350i","Honda Vario","Honda Lead","Honda PCX","Honda ADV","Yamaha Exciter","Yamaha Sirius","Yamaha Jupiter","Yamaha Grande","Yamaha Janus","Yamaha FreeGo","Yamaha Latte","Yamaha NVX","Yamaha XSR","Suzuki Raider","Suzuki Axelo","Suzuki Satria","Suzuki GD110","Suzuki Impulse","Suzuki Address","Suzuki Revo","SYM Elite","SYM Galaxy","SYM Star","SYM Attila","SYM Angela","SYM Passing","Piaggio Liberty","Piaggio Medley","Vespa Sprint","Vespa Primavera","Vespa GTS","VinFast Klara","VinFast Evo200","VinFast Ludo","VinFast Impes","VinFast Theon","Kh√°c"],{mutateAsync:ne}=Kt(),{mutateAsync:qe}=Gt(),[n,y]=o.useState(()=>a!=null&&a.id?a:{id:(a==null?void 0:a.id)||"",customerName:(a==null?void 0:a.customerName)||"",customerPhone:(a==null?void 0:a.customerPhone)||"",vehicleModel:(a==null?void 0:a.vehicleModel)||"",licensePlate:(a==null?void 0:a.licensePlate)||"",vehicleId:(a==null?void 0:a.vehicleId)||"",issueDescription:(a==null?void 0:a.issueDescription)||"",technicianName:(a==null?void 0:a.technicianName)||"",status:(a==null?void 0:a.status)||"Ti·∫øp nh·∫≠n",laborCost:(a==null?void 0:a.laborCost)||0,discount:(a==null?void 0:a.discount)||0,partsUsed:(a==null?void 0:a.partsUsed)||[],total:(a==null?void 0:a.total)||0,branchId:(a==null?void 0:a.branchId)||h,paymentStatus:(a==null?void 0:a.paymentStatus)||"unpaid",creationDate:(a==null?void 0:a.creationDate)||new Date().toISOString()}),[j,P]=o.useState(""),[_,se]=o.useState([]),[ie,we]=o.useState(!1),[J,re]=o.useState(0),[U,de]=o.useState(!1),[Ce,Se]=o.useState(!1),[c,N]=o.useState(0),[E,R]=o.useState(!1),[ve,K]=o.useState(!1),[V,fe]=o.useState({name:"",phone:"",vehicleModel:"",licensePlate:""}),[Ye,Y]=o.useState(""),[xt,he]=o.useState(!1),[lt,Ie]=o.useState(!1),[je,nt]=o.useState({model:"",licensePlate:""}),d=ee.find(l=>l.phone===n.customerPhone),ye=(d==null?void 0:d.vehicles)||[];ye.length>1;const[Ve,mt]=o.useState("amount"),[i,He]=o.useState(0),[Je,pt]=o.useState(!1),[Z,te]=o.useState([]),[oe,Ze]=o.useState({description:"",quantity:1,price:0,costPrice:0});o.useEffect(()=>{a!=null&&a.partsUsed?se(a.partsUsed):se([]),a!=null&&a.customerName?Y(a.customerName):Y(""),a!=null&&a.additionalServices?te(a.additionalServices):te([]),a!=null&&a.depositAmount?(N(a.depositAmount),R(!0)):(N(0),R(!1)),a!=null&&a.additionalPayment?(re(a.additionalPayment),de(!0)):(re(0),de(!1)),mt("amount"),He(0)},[a]);const Be=o.useMemo(()=>{if(!Ye.trim())return ee.slice(0,10);const l=Ye.toLowerCase();return ee.filter(b=>{var k;return b.name.toLowerCase().includes(l)||((k=b.phone)==null?void 0:k.toLowerCase().includes(l))||b.vehicles&&b.vehicles.some(q=>{var D;return(D=q.licensePlate)==null?void 0:D.toLowerCase().includes(l)})})},[ee,Ye]);o.useEffect(()=>{const l=b=>{const k=b.target;k.closest(".customer-search-container")||he(!1),k.closest(".vehicle-search-container")||Se(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const $e=l=>{y({...n,vehicleId:l.id,vehicleModel:l.model,licensePlate:l.licensePlate}),Se(!1)},it=()=>{if(!d)return;if(!je.model.trim()||!je.licensePlate.trim()){M.error("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß lo·∫°i xe v√† bi·ªÉn s·ªë");return}const l=`VEH-${Date.now()}`,b=d.vehicles||[],k=[...b,{id:l,model:je.model.trim(),licensePlate:je.licensePlate.trim(),isPrimary:b.length===0}];Le({...d,vehicles:k}),y({...n,vehicleId:l,vehicleModel:je.model.trim(),licensePlate:je.licensePlate.trim()}),nt({model:"",licensePlate:""}),Ie(!1),M.success("ƒê√£ th√™m xe m·ªõi")},Oe=_.reduce((l,b)=>l+(b.price||0)*(b.quantity||0),0),et=Z.reduce((l,b)=>l+(b.price||0)*(b.quantity||0),0),Ue=(n.laborCost||0)+Oe+et,z=n.discount||0,ae=Math.max(0,Ue-z);console.log("Tinh toan:",{laborCost:n.laborCost,partsTotal:Oe,servicesTotal:et,subtotal:Ue,discount:z,total:ae});const tt=c||0,ce=U?J:0,Pe=tt+ce,Te=Math.max(0,ae-Pe),ht=async()=>{var q,D;if(!((q=n.customerName)!=null&&q.trim())){M.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((D=n.customerPhone)!=null&&D.trim())){M.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}if(!/^[0-9]{10,11}$/.test(n.customerPhone.trim())){M.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (c·∫ßn 10-11 ch·ªØ s·ªë)");return}if(n.customerName&&n.customerPhone&&!ee.find(O=>O.phone===n.customerPhone)){const O=ee.find(B=>B.phone===n.customerPhone&&n.customerName&&B.name.toLowerCase()!==n.customerName.toLowerCase());O&&M.warning(`SƒêT ƒë√£ t·ªìn t·∫°i cho kh√°ch "${O.name}". C√≥ th·ªÉ tr√πng l·∫∑p?`);const F=`VEH-${Date.now()}`,H=[];(n.vehicleModel||n.licensePlate)&&H.push({id:F,model:n.vehicleModel||"",licensePlate:n.licensePlate||"",isPrimary:!0}),Le({id:`CUST-${Date.now()}`,name:n.customerName,phone:n.customerPhone,vehicles:H.length>0?H:void 0,vehicleModel:n.vehicleModel,licensePlate:n.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()})}let b="unpaid";const k=((a==null?void 0:a.depositAmount)||0)+((a==null?void 0:a.additionalPayment)||0);k>=ae?b="paid":k>0&&(b="partial");try{const O={id:(a==null?void 0:a.id)||`${(T==null?void 0:T.work_order_prefix)||"SC"}-${Date.now()}`,customername:n.customerName||"",customerphone:n.customerPhone||"",vehicleid:n.vehicleId,vehiclemodel:n.vehicleModel||"",licenseplate:n.licensePlate||"",issuedescription:n.issueDescription||"",technicianname:n.technicianName||"",status:n.status||"Ti·∫øp nh·∫≠n",laborcost:n.laborCost||0,discount:z,partsused:_,additionalservices:Z.length>0?Z:void 0,total:ae,branchid:h,paymentstatus:b,paymentmethod:n.paymentMethod||null,depositamount:(a==null?void 0:a.depositAmount)||null,totalpaid:k>0?k:null,remainingamount:ae-k,creationdate:(a==null?void 0:a.creationDate)||new Date().toISOString()};if(a!=null&&a.id){const{data:F,error:H}=await ct.from("work_orders").update(O).eq("id",a.id).select();if(H)throw console.error("[UPDATE ERROR]",H),H;console.log("[UPDATE SUCCESS]",F)}else{console.log("[INSERT] Attempting to insert:",O);const{data:F,error:H}=await ct.from("work_orders").insert(O).select();if(H)throw console.error("[INSERT ERROR]",H),console.error("[INSERT ERROR DETAILS]",JSON.stringify(H,null,2)),H;console.log("[INSERT SUCCESS]",F)}me&&me(),I(O),M.success(a!=null&&a.id?"ƒê√£ c·∫≠p nh·∫≠t phi·∫øu":"ƒê√£ l∆∞u phi·∫øu th√†nh c√¥ng"),S()}catch(u){console.error("Error saving work order:",u),M.error("L·ªói khi l∆∞u phi·∫øu: "+(u.message||u.hint||"Kh√¥ng x√°c ƒë·ªãnh"))}},rt=async()=>{var l,b;if(Je){console.log("[handleSave] Already submitting, skipping...");return}pt(!0);try{if(!((l=n.customerName)!=null&&l.trim())){M.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((b=n.customerPhone)!=null&&b.trim())){M.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}if(!/^[0-9]{10,11}$/.test(n.customerPhone.trim())){M.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (c·∫ßn 10-11 ch·ªØ s·ªë)");return}if(ae<=0){M.error("T·ªïng ti·ªÅn ph·∫£i l·ªõn h∆°n 0");return}if(n.customerName&&n.customerPhone&&!ee.find(u=>u.phone===n.customerPhone)){const u=ee.find(H=>H.phone===n.customerPhone&&n.customerName&&H.name.toLowerCase()!==n.customerName.toLowerCase());u&&M.warning(`SƒêT ƒë√£ t·ªìn t·∫°i cho kh√°ch "${u.name}". C√≥ th·ªÉ tr√πng l·∫∑p?`);const O=`VEH-${Date.now()}`,F=[];(n.vehicleModel||n.licensePlate)&&F.push({id:O,model:n.vehicleModel||"",licensePlate:n.licensePlate||"",isPrimary:!0}),Le({id:`CUST-${Date.now()}`,name:n.customerName,phone:n.customerPhone,vehicles:F.length>0?F:void 0,vehicleModel:n.vehicleModel,licensePlate:n.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()})}let q="unpaid";if(Pe>=ae?q="paid":Pe>0&&(q="partial"),!(a!=null&&a.id)&&(_.length>0||Z.length>0||c>0)){try{const D=`${(T==null?void 0:T.work_order_prefix)||"SC"}-${Date.now()}`,u=await ne({id:D,customerName:n.customerName||"",customerPhone:n.customerPhone||"",vehicleModel:n.vehicleModel||"",licensePlate:n.licensePlate||"",issueDescription:n.issueDescription||"",technicianName:n.technicianName||"",status:n.status||"Ti·∫øp nh·∫≠n",laborCost:n.laborCost||0,discount:z,partsUsed:_,additionalServices:Z.length>0?Z:void 0,total:ae,branchId:h,paymentStatus:q,paymentMethod:n.paymentMethod,depositAmount:c>0?c:void 0,additionalPayment:ce>0?ce:void 0,totalPaid:Pe>0?Pe:void 0,remainingAmount:Te,creationDate:new Date().toISOString()}),O=u==null?void 0:u.depositTransactionId,F=u==null?void 0:u.paymentTransactionId,H={id:D,customerName:n.customerName||"",customerPhone:n.customerPhone||"",vehicleModel:n.vehicleModel||"",licensePlate:n.licensePlate||"",issueDescription:n.issueDescription||"",technicianName:n.technicianName||"",status:n.status||"Ti·∫øp nh·∫≠n",laborCost:n.laborCost||0,discount:z,partsUsed:_,additionalServices:Z.length>0?Z:void 0,total:ae,branchId:h,depositAmount:c>0?c:void 0,depositDate:c>0?new Date().toISOString():void 0,depositTransactionId:O,paymentStatus:q,paymentMethod:n.paymentMethod,additionalPayment:ce>0?ce:void 0,totalPaid:Pe>0?Pe:void 0,remainingAmount:Te,cashTransactionId:F,paymentDate:F?new Date().toISOString():void 0,creationDate:new Date().toISOString()};if(O&&c>0&&(pe(B=>[...B,{id:O,type:"income",category:"service_deposit",amount:c,date:new Date().toISOString(),description:`ƒê·∫∑t c·ªçc s·ª≠a ch·ªØa #${(ge(D,T==null?void 0:T.work_order_prefix)||"").split("-").pop()} - ${n.customerName}`,branchId:h,paymentSource:n.paymentMethod,reference:D}]),ke(B=>B.map(A=>A.id===n.paymentMethod?{...A,balance:{...A.balance,[h]:(A.balance[h]||0)+c}}:A))),F&&ce>0&&(pe(B=>[...B,{id:F,type:"income",category:"service_income",amount:ce,date:new Date().toISOString(),description:`Thu ti·ªÅn s·ª≠a ch·ªØa #${(ge(D,T==null?void 0:T.work_order_prefix)||"").split("-").pop()} - ${n.customerName}`,branchId:h,paymentSource:n.paymentMethod,reference:D}]),ke(B=>B.map(A=>A.id===n.paymentMethod?{...A,balance:{...A.balance,[h]:(A.balance[h]||0)+ce}}:A))),Z.length>0){const B=Z.reduce((A,Me)=>A+(Me.costPrice||0)*Me.quantity,0);if(B>0){const A=`EXPENSE-${Date.now()}`;try{console.log("[Outsourcing] Inserting expense transaction:",{id:A,amount:-B,branchid:h});const{error:Me}=await ct.from("cash_transactions").insert({id:A,type:"expense",category:"outsourcing",amount:-B,date:new Date().toISOString(),description:`Chi ph√≠ gia c√¥ng b√™n ngo√†i - Phi·∫øu #${D.split("-").pop()} - ${Z.map(dt=>dt.description).join(", ")}`,branchid:h,paymentsource:"cash",reference:D});Me?(console.error("[Outsourcing] Insert FAILED:",Me),M.error(`L·ªói t·∫°o phi·∫øu chi gia c√¥ng: ${Me.message}`)):(console.log("[Outsourcing] Insert SUCCESS"),pe(dt=>[...dt,{id:A,type:"expense",category:"outsourcing",amount:-B,date:new Date().toISOString(),description:`Chi ph√≠ gia c√¥ng b√™n ngo√†i - Phi·∫øu #${D.split("-").pop()}`,branchId:h,paymentSource:"cash",reference:D}]),ke(dt=>dt.map(at=>at.id==="cash"?{...at,balance:{...at.balance,[h]:(at.balance[h]||0)-B}}:at)),M.info(`ƒê√£ t·∫°o phi·∫øu chi ${m(B)} cho gia c√¥ng b√™n ngo√†i`))}catch(Me){console.error("Error creating outsourcing expense:",Me)}}}I(H),n.status==="Tr·∫£ m√°y"&&Te>0&&(console.log("[handleSave] Creating debt with finalOrder:",{id:H.id,customerName:H.customerName,customerPhone:H.customerPhone,licensePlate:H.licensePlate,vehicleModel:H.vehicleModel}),await createCustomerDebtIfNeeded(H,Te,ae,Pe)),S()}catch(D){console.error("Error creating work order (atomic):",D)}return}if(a!=null&&a.id){console.log("[handleSave] UPDATE block - Order ID:",a.id,"Status:",n.status);try{console.log("[handleSave] Calling updateWorkOrderAtomicAsync...");const D=await qe({id:a.id,customerName:n.customerName||"",customerPhone:n.customerPhone||"",vehicleModel:n.vehicleModel||"",licensePlate:n.licensePlate||"",issueDescription:n.issueDescription||"",technicianName:n.technicianName||"",status:n.status||"Ti·∫øp nh·∫≠n",laborCost:n.laborCost||0,discount:z,partsUsed:_,additionalServices:Z.length>0?Z:void 0,total:ae,branchId:h,paymentStatus:q,paymentMethod:n.paymentMethod,depositAmount:c>0?c:void 0,additionalPayment:ce>0?ce:void 0,totalPaid:Pe>0?Pe:void 0,remainingAmount:Te}),u=D.workOrder,O=D==null?void 0:D.depositTransactionId,F=D==null?void 0:D.paymentTransactionId,H=u?{id:u.id||a.id,customerName:u.customername||u.customerName||a.customerName,customerPhone:u.customerphone||u.customerPhone||a.customerPhone,vehicleModel:u.vehiclemodel||u.vehicleModel||a.vehicleModel,licensePlate:u.licenseplate||u.licensePlate||a.licensePlate,issueDescription:u.issuedescription||u.issueDescription||a.issueDescription||"",technicianName:u.technicianname||u.technicianName||a.technicianName||"",status:u.status||a.status,laborCost:u.laborcost||u.laborCost||a.laborCost||0,discount:u.discount||a.discount||0,partsUsed:u.partsused||u.partsUsed||a.partsUsed||[],additionalServices:u.additionalservices||u.additionalServices||a.additionalServices,total:u.total||a.total,branchId:u.branchid||u.branchId||a.branchId,depositAmount:u.depositamount||u.depositAmount||a.depositAmount,depositDate:u.depositdate||u.depositDate||a.depositDate,depositTransactionId:O||a.depositTransactionId,paymentStatus:u.paymentstatus||u.paymentStatus||a.paymentStatus,paymentMethod:u.paymentmethod||u.paymentMethod||a.paymentMethod,additionalPayment:u.additionalpayment||u.additionalPayment||a.additionalPayment,totalPaid:u.totalpaid||u.totalPaid||a.totalPaid,remainingAmount:u.remainingamount||u.remainingAmount||a.remainingAmount,cashTransactionId:F||a.cashTransactionId,paymentDate:u.paymentdate||u.paymentDate||a.paymentDate,creationDate:u.creationdate||u.creationDate||a.creationDate}:{...a,customerName:n.customerName||a.customerName,customerPhone:n.customerPhone||a.customerPhone,vehicleModel:n.vehicleModel||a.vehicleModel,licensePlate:n.licensePlate||a.licensePlate,issueDescription:n.issueDescription||a.issueDescription,technicianName:n.technicianName||a.technicianName,status:n.status||a.status,laborCost:n.laborCost||a.laborCost,discount:z,partsUsed:_,additionalServices:Z.length>0?Z:a.additionalServices,total:ae,depositAmount:c,depositTransactionId:O||a.depositTransactionId,paymentStatus:q,paymentMethod:n.paymentMethod||a.paymentMethod,additionalPayment:ce,totalPaid:Pe,remainingAmount:Te,cashTransactionId:F||a.cashTransactionId,paymentDate:F?new Date().toISOString():a.paymentDate};O&&c>a.depositAmount&&(pe(B=>[...B,{id:O,type:"income",category:"service_deposit",amount:c-(a.depositAmount||0),date:new Date().toISOString(),description:`ƒê·∫∑t c·ªçc b·ªï sung #${(ge(a.id,T==null?void 0:T.work_order_prefix)||"").split("-").pop()} - ${n.customerName}`,branchId:h,paymentSource:n.paymentMethod,reference:a.id}]),ke(B=>B.map(A=>A.id===n.paymentMethod?{...A,balance:{...A.balance,[h]:(A.balance[h]||0)+(c-(a.depositAmount||0))}}:A))),F&&ce>(a.additionalPayment||0)&&(pe(B=>[...B,{id:F,type:"income",category:"service_income",amount:ce-(a.additionalPayment||0),date:new Date().toISOString(),description:`Thu ti·ªÅn b·ªï sung #${(ge(a.id,T==null?void 0:T.work_order_prefix)||"").split("-").pop()} - ${n.customerName}`,branchId:h,paymentSource:n.paymentMethod,reference:a.id}]),ke(B=>B.map(A=>A.id===n.paymentMethod?{...A,balance:{...A.balance,[h]:(A.balance[h]||0)+(ce-(a.additionalPayment||0))}}:A))),console.log("[handleSave] updateWorkOrderAtomicAsync SUCCESS - Response:",D),I(H),n.status==="Tr·∫£ m√°y"&&Te>0&&await createCustomerDebtIfNeeded(H,Te,ae,Pe),S()}catch(D){console.error("[handleSave] Error updating work order (atomic):",D)}return}console.warn("[handleSave] Unexpected code path - no atomic create/update was called")}finally{pt(!1)}},st=l=>{var k;const b=_.find(q=>q.partId===l.id);se(b?_.map(q=>q.partId===l.id?{...q,quantity:q.quantity+1}:q):[..._,{partId:l.id,partName:l.name,sku:l.sku||"",category:l.category||"",quantity:1,price:l.retailPrice[h]||0,costPrice:((k=l.costPrice)==null?void 0:k[h])||0}]),we(!1),P("")},Ke=o.useMemo(()=>r.filter(l=>{var k;return(((k=l.stock)==null?void 0:k[h])||0)>0}),[r,h]),Re=o.useMemo(()=>j.trim()?Ke.filter(l=>{var b;return l.name.toLowerCase().includes(j.toLowerCase())||((b=l.sku)==null?void 0:b.toLowerCase().includes(j.toLowerCase()))}):Ke,[Ke,j]);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-0 md:p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full h-full md:h-auto md:max-h-[90vh] md:max-w-5xl rounded-t-3xl md:rounded-xl shadow-2xl md:shadow-lg flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3 md:px-6 md:py-4 flex items-center justify-between rounded-t-3xl md:rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:n.id?`Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa - ${ge(n.id,T==null?void 0:T.work_order_prefix)}`:"T·∫°o phi·∫øu s·ª≠a ch·ªØa m·ªõi"}),e.jsx("button",{onClick:S,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-4 py-5 md:px-6 md:py-6 space-y-6 overflow-y-auto flex-1 pb-24 md:pb-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Th√¥ng tin Kh√°ch h√†ng & S·ª± c·ªë"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Kh√°ch h√†ng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative customer-search-container",children:[e.jsx("input",{type:"text",placeholder:"T√¨m kh√°ch h√†ng...",value:Ye,onChange:l=>{Y(l.target.value),he(!0),y({...n,customerName:l.target.value})},onFocus:()=>he(!0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),xt&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:Be.length>0?Be.map(l=>e.jsx("button",{type:"button",onClick:()=>{var k,q;const b=((k=l.vehicles)==null?void 0:k.find(D=>D.isPrimary))||((q=l.vehicles)==null?void 0:q[0]);y({...n,customerName:l.name,customerPhone:l.phone,vehicleId:b==null?void 0:b.id,vehicleModel:(b==null?void 0:b.model)||l.vehicleModel||"",licensePlate:(b==null?void 0:b.licensePlate)||l.licensePlate||""}),Y(l.name),he(!1)},className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-600 border-b border-slate-200 dark:border-slate-600 last:border-0",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm truncate",children:l.name}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-0.5",children:["üì± ",l.phone]}),(l.vehicleModel||l.licensePlate)&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-0.5 flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"6",cy:"17",r:"2"}),e.jsx("circle",{cx:"18",cy:"17",r:"2"}),e.jsx("path",{d:"M4 17h2l4-6h2l2 3h4"})]}),l.vehicleModel&&e.jsx("span",{children:l.vehicleModel}),l.licensePlate&&e.jsxs("span",{className:"font-mono font-medium",children:[l.vehicleModel&&"‚Ä¢"," ",l.licensePlate]})]})]})})},l.id)):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-slate-500 dark:text-slate-400",children:ee.length===0?"Ch∆∞a c√≥ kh√°ch h√†ng n√†o. Nh·∫•n '+' ƒë·ªÉ th√™m kh√°ch h√†ng m·ªõi.":"Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng ph√π h·ª£p"})})]}),e.jsx("button",{type:"button",onClick:()=>K(!0),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium text-xl",title:"Th√™m kh√°ch h√†ng m·ªõi",children:"+"})]}),n.customerName&&n.customerPhone&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:n.customerName}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-3.5 h-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15 .828 0 1.5-.672 1.5-1.5v-2.25a1.5 1.5 0 00-1.5-1.5h-1.158a1.5 1.5 0 00-1.092.468l-.936.996a1.5 1.5 0 01-1.392.444 12.035 12.035 0 01-7.29-7.29 1.5 1.5 0 01.444-1.392l.996-.936a1.5 1.5 0 00.468-1.092V6.75A1.5 1.5 0 006.75 5.25H4.5c-.828 0-1.5.672-1.5 1.5z"})}),n.customerPhone]})}),(n.vehicleModel||n.licensePlate)&&e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-3.5 h-3.5",children:[e.jsx("circle",{cx:"6",cy:"17",r:"2"}),e.jsx("circle",{cx:"18",cy:"17",r:"2"}),e.jsx("path",{d:"M4 17h2l4-6h2l2 3h4"})]}),n.vehicleModel," ",n.licensePlate&&`- ${n.licensePlate}`]})})]}),e.jsx("button",{type:"button",onClick:()=>{Y(""),y({...n,customerName:"",customerPhone:"",vehicleId:void 0,vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-red-500 text-sm flex items-center",title:"X√≥a kh√°ch h√†ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),d&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:[ye.length>0?"Ch·ªçn xe":"Xe c·ªßa kh√°ch h√†ng",ye.length>0&&e.jsxs("span",{className:"text-xs text-slate-500 ml-1",children:["(",ye.length," xe)"]})]}),e.jsx("button",{type:"button",onClick:()=>Ie(!0),className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium",title:"Th√™m xe m·ªõi",children:"+ Th√™m xe"})]}),ye.length>0?e.jsx("div",{className:"space-y-2",children:ye.map(l=>{const b=n.vehicleId===l.id,k=l.isPrimary;return e.jsx("button",{type:"button",onClick:()=>$e(l),className:`w-full text-left px-3 py-2.5 rounded-lg border-2 transition-all ${b?"border-blue-500 bg-blue-50 dark:bg-blue-900/30":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-slate-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[k&&e.jsx("span",{className:"text-yellow-500",title:"Xe ch√≠nh",children:"‚≠ê"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-slate-900 dark:text-slate-100",children:l.model}),e.jsx("div",{className:"text-xs font-mono text-slate-600 dark:text-slate-400 mt-0.5",children:l.licensePlate})]}),b&&e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})]})},l.id)})}):e.jsx("div",{className:"text-center py-4 px-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-dashed border-slate-300 dark:border-slate-600",children:e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:'Ch∆∞a c√≥ xe n√†o. Click "+ Th√™m xe" ƒë·ªÉ th√™m.'})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë KM hi·ªán t·∫°i"}),e.jsx("input",{type:"number",placeholder:"15000",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£ s·ª± c·ªë"}),e.jsx("textarea",{rows:4,placeholder:"B·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥, thay nh·ªõt...",value:n.issueDescription||"",onChange:l=>y({...n,issueDescription:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Chi ti·∫øt D·ªãch v·ª•"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tr·∫°ng th√°i"}),e.jsxs("select",{value:n.status||"Ti·∫øp nh·∫≠n",onChange:l=>y({...n,status:l.target.value}),className:`w-full px-3 py-2 border rounded-lg font-medium ${n.status==="Ti·∫øp nh·∫≠n"?"bg-blue-100 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700 text-blue-700 dark:text-blue-300":n.status==="ƒêang s·ª≠a"?"bg-orange-100 dark:bg-orange-900/30 border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300":n.status==="ƒê√£ s·ª≠a xong"?"bg-purple-100 dark:bg-purple-900/30 border-purple-300 dark:border-purple-700 text-purple-700 dark:text-purple-300":"bg-green-100 dark:bg-green-900/30 border-green-300 dark:border-green-700 text-green-700 dark:text-green-300"}`,children:[e.jsx("option",{value:"Ti·∫øp nh·∫≠n",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"Ti·∫øp nh·∫≠n"}),e.jsx("option",{value:"ƒêang s·ª≠a",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"ƒêang s·ª≠a"}),e.jsx("option",{value:"ƒê√£ s·ª≠a xong",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"ƒê√£ s·ª≠a xong"}),e.jsx("option",{value:"Tr·∫£ m√°y",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"Tr·∫£ m√°y"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"K·ªπ thu·∫≠t vi√™n"}),e.jsxs("select",{value:n.technicianName||"",onChange:l=>y({...n,technicianName:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn k·ªπ thu·∫≠t vi√™n --"}),Qe.filter(l=>{var b,k;return l.status==="active"&&(((b=l.department)==null?void 0:b.toLowerCase().includes("k·ªπ thu·∫≠t"))||((k=l.position)==null?void 0:k.toLowerCase().includes("k·ªπ thu·∫≠t")))}).map(l=>e.jsx("option",{value:l.name,children:l.name},l.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ph√≠ d·ªãch v·ª• (C√¥ng th·ª£)"}),e.jsx("input",{type:"number",placeholder:"100.000",value:n.laborCost||"",onChange:l=>y({...n,laborCost:Number(l.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ghi ch√∫ n·ªôi b·ªô"}),e.jsx("textarea",{rows:4,placeholder:"VD: Kh√°ch y√™u c·∫ßu ki·ªÉm tra th√™m h·ªá th·ªëng ƒëi·ªán",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Ph·ª• t√πng s·ª≠ d·ª•ng"}),e.jsx("button",{onClick:()=>we(!ie),className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm flex items-center gap-1",children:"‚ûï Th√™m ph·ª• t√πng"})]}),ie&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm ph·ª• t√πng theo t√™n ho·∫∑c SKU...",value:j,onChange:l=>P(l.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0}),e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-10",children:G?e.jsx("div",{className:"px-4 py-3 text-sm text-slate-500",children:"ƒêang t·∫£i ph·ª• t√πng..."}):Re.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-slate-500",children:"Kh√¥ng t√¨m th·∫•y ph·ª• t√πng"}):Re.slice(0,10).map(l=>e.jsxs("button",{onClick:()=>st(l),className:"w-full px-4 py-2.5 text-left hover:bg-slate-100 dark:hover:bg-slate-600 flex items-center justify-between border-b border-slate-100 dark:border-slate-600 last:border-b-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 font-mono",children:l.sku}),l.category&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0 rounded-full text-[9px] font-medium ${ut(l.category).bg} ${ut(l.category).text}`,children:l.category})]})]}),e.jsx("div",{className:"text-sm font-semibold text-emerald-600 dark:text-emerald-400",children:m(l.retailPrice[h]||0)})]},l.id))})]}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"T√™n"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"ƒê.Gi√°"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"T.Ti·ªÅn"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-600",children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-slate-400",children:"Ch∆∞a c√≥ ph·ª• t√πng n√†o"})}):_.map((l,b)=>e.jsxs("tr",{className:"bg-white dark:bg-slate-800",children:[e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("div",{className:"text-sm text-slate-900 dark:text-slate-100 font-medium",children:l.partName}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[l.sku&&e.jsx("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 font-mono",children:l.sku}),l.category&&e.jsx("span",{className:`inline-flex items-center px-1.5 py-0 rounded-full text-[9px] font-medium ${ut(l.category).bg} ${ut(l.category).text}`,children:l.category})]})]}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"1",value:l.quantity,onChange:k=>{const q=Number(k.target.value);se(_.map((D,u)=>u===b?{...D,quantity:q}:D))},className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-900 dark:text-slate-100",children:m(l.price)}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:m(l.price*l.quantity)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>se(_.filter((k,q)=>q!==b)),className:"text-red-500 hover:text-red-700","aria-label":"X√≥a ph·ª• t√πng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6h18M9 6V4h6v2m-7 4v8m4-8v8m4-8v8"})})})})]},b))})]})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3",children:"B√°o gi√° (Gia c√¥ng, ƒê·∫∑t h√†ng)"}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"M√¥ t·∫£"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"Gi√° nh·∫≠p"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"ƒê∆°n gi√°"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"Th√†nh ti·ªÅn"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:e.jsx("button",{onClick:()=>{oe.description&&oe.price>0&&(te([...Z,{...oe,id:`SRV-${Date.now()}`}]),Ze({description:"",quantity:1,price:0,costPrice:0}))},className:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs",children:"Th√™m"})})]})}),e.jsxs("tbody",{children:[Z.map(l=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-slate-900 dark:text-slate-100",children:l.description}),e.jsx("td",{className:"px-4 py-2 text-center text-sm text-slate-900 dark:text-slate-100",children:l.quantity}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-orange-600 dark:text-orange-400",children:l.costPrice?m(l.costPrice):"-"}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-900 dark:text-slate-100",children:m(l.price)}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:m(l.price*l.quantity)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>te(Z.filter(b=>b.id!==l.id)),className:"text-red-500 hover:text-red-700 text-sm","aria-label":"X√≥a d·ªãch v·ª•",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6h18M9 6V4h6v2m-7 4v8m4-8v8m4-8v8"})})})})]},l.id)),e.jsxs("tr",{className:"bg-white dark:bg-slate-800",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",placeholder:"M√¥ t·∫£...",value:oe.description,onChange:l=>Ze({...oe,description:l.target.value}),className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:oe.quantity,onChange:l=>Ze({...oe,quantity:Number(l.target.value)}),className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",placeholder:"Gi√° nh·∫≠p",value:oe.costPrice||"",onChange:l=>Ze({...oe,costPrice:Number(l.target.value)}),className:"w-full px-2 py-1 border border-orange-300 dark:border-orange-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",placeholder:"ƒê∆°n gi√°",value:oe.price||"",onChange:l=>Ze({...oe,price:Number(l.target.value)}),className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-400",children:oe.price>0?m(oe.price*oe.quantity):"Th√†nh ti·ªÅn"}),e.jsx("td",{className:"px-4 py-2 text-center"})]})]})]})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4 mt-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Thanh to√°n"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:l=>{R(l.target.checked),l.target.checked||N(0)},disabled:!!(a!=null&&a.depositAmount),className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:["ƒê·∫∑t c·ªçc"," ",a!=null&&a.depositAmount?`(ƒê√£ c·ªçc: ${m(a.depositAmount)})`:""]})]}),E&&!(a!=null&&a.depositAmount)&&e.jsx("div",{className:"pl-6",children:e.jsx("input",{type:"number",placeholder:"S·ªë ti·ªÅn ƒë·∫∑t c·ªçc",value:c||"",onChange:l=>N(Number(l.target.value)),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Ph∆∞∆°ng th·ª©c thanh to√°n:"}),e.jsxs("div",{className:"flex items-center gap-4 pl-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:n.paymentMethod==="cash",onChange:l=>y({...n,paymentMethod:"cash"}),className:"w-4 h-4"}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2",ry:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),"Ti·ªÅn m·∫∑t"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:n.paymentMethod==="bank",onChange:l=>y({...n,paymentMethod:"bank"}),className:"w-4 h-4"}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 21h18M3 10h18M7 6h10l2 4H5l2-4Zm2 4v11m6-11v11"})}),"Chuy·ªÉn kho·∫£n"]})]})]})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3"}),n.status==="Tr·∫£ m√°y"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:l=>{de(l.target.checked),l.target.checked||re(0)},className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Thanh to√°n khi tr·∫£ xe"})]}),U&&e.jsxs("div",{className:"pl-6 space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600 dark:text-slate-400",children:"S·ªë ti·ªÅn thanh to√°n th√™m:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:"0",value:J||"",onChange:l=>re(Number(l.target.value)),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("button",{onClick:()=>re(0),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"0%"}),e.jsx("button",{onClick:()=>re(Math.round(Te*.5)),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"50%"}),e.jsx("button",{onClick:()=>re(Te),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"100%"})]})]})]})]}),n.status!=="Tr·∫£ m√°y"&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:'* Thanh to√°n khi tr·∫£ xe ch·ªâ kh·∫£ d·ª•ng khi tr·∫°ng th√°i l√† "Tr·∫£ m√°y"'})]}),e.jsxs("div",{className:"space-y-3 bg-slate-50 dark:bg-slate-700/30 border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"T·ªïng k·∫øt"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:m(n.laborCost||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:m(Oe)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gia c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:m(et)})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-300 dark:border-slate-600",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-red-600 font-medium",children:"Gi·∫£m gi√°:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:"0",value:Ve==="amount"?n.discount||"":i,onChange:l=>{const b=Number(l.target.value)||0;if(Ve==="amount")y({...n,discount:Math.min(b,Ue)});else{const k=Math.min(b,100);He(k),y({...n,discount:Math.round(Ue*k/100)})}},className:"w-20 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",min:"0",max:Ve==="amount"?Ue:100}),e.jsxs("select",{value:Ve,onChange:l=>{const b=l.target.value;mt(b),y({...n,discount:0}),He(0)},className:"px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),Ve==="percent"&&e.jsx("div",{className:"flex gap-1 justify-end mt-2",children:[5,10,15,20].map(l=>e.jsxs("button",{onClick:()=>{He(l),y({...n,discount:Math.round(Ue*l/100)})},className:"px-2 py-1 text-xs bg-slate-100 dark:bg-slate-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-slate-700 dark:text-slate-300 rounded transition-colors",children:[l,"%"]},l))}),Ve==="percent"&&i>0&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 text-right mt-1",children:["= ",m(n.discount||0)]})]}),e.jsxs("div",{className:"pt-2 border-t-2 border-slate-400 dark:border-slate-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"T·ªïng c·ªông:"}),e.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:m(ae)})]}),(tt>0||ce>0)&&e.jsxs("div",{className:"space-y-1 pt-2 border-t border-slate-300 dark:border-slate-600",children:[tt>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["-",m(tt)]})]}),ce>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Thanh to√°n th√™m:"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["-",m(ce)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-300 dark:border-slate-600",children:[e.jsx("span",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:Te>0?"C√≤n ph·∫£i thu:":"ƒê√£ thanh to√°n ƒë·ªß"}),e.jsx("span",{className:`text-lg font-bold ${Te>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:m(Te)})]})]})]})]})]})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 px-4 py-4 md:px-6 flex items-center justify-end gap-3 bg-white md:bg-slate-50 dark:bg-slate-800/70 md:dark:bg-slate-800/50 rounded-b-3xl md:rounded-b-xl flex-shrink-0",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:ht,className:"px-6 py-2 bg-slate-500 hover:bg-slate-600 text-white rounded-lg font-medium",children:"L∆∞u Phi·∫øu"}),n.status!=="Tr·∫£ m√°y"&&E&&e.jsxs("button",{onClick:rt,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ƒê·∫∑t c·ªçc"]}),n.status==="Tr·∫£ m√°y"&&e.jsxs("button",{onClick:rt,className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),"Thanh to√°n"]})]})]}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-md p-6 m-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"Th√™m kh√°ch h√†ng"}),e.jsx("button",{onClick:()=>{K(!1),fe({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√™n kh√°ch"}),e.jsx("input",{type:"text",placeholder:"Nh·∫≠p t√™n kh√°ch",value:V.name,onChange:l=>fe({...V,name:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",placeholder:"VD: 09xxxx",value:V.phone,onChange:l=>fe({...V,phone:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative vehicle-search-container",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"D√≤ng xe"}),e.jsx("input",{type:"text",placeholder:"Ch·ªçn ho·∫∑c nh·∫≠p d√≤ng xe",value:V.vehicleModel,onChange:l=>{fe({...V,vehicleModel:l.target.value}),Se(!0)},onFocus:()=>Se(!0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),Ce&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-[200px] overflow-y-auto",children:f.filter(l=>l.toLowerCase().includes(V.vehicleModel.toLowerCase())).map(l=>e.jsx("button",{type:"button",onClick:()=>{fe({...V,vehicleModel:l}),Se(!1)},className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-600 text-sm border-b border-slate-200 dark:border-slate-600 last:border-0 text-slate-900 dark:text-slate-100",children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Bi·ªÉn s·ªë"}),e.jsx("input",{type:"text",placeholder:"VD: 59A1-123.45",value:V.licensePlate,onChange:l=>fe({...V,licensePlate:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{K(!1),fe({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:()=>{if(V.name&&V.phone){const l=`CUST-${Date.now()}`,b=`VEH-${Date.now()}`,k=[];(V.vehicleModel||V.licensePlate)&&k.push({id:b,model:V.vehicleModel||"",licensePlate:V.licensePlate||"",isPrimary:!0}),Le({id:l,name:V.name,phone:V.phone,vehicles:k.length>0?k:void 0,vehicleModel:V.vehicleModel,licensePlate:V.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()}),y({...n,customerName:V.name,customerPhone:V.phone,vehicleId:k.length>0?b:void 0,vehicleModel:V.vehicleModel,licensePlate:V.licensePlate}),Y(V.name),K(!1),fe({name:"",phone:"",vehicleModel:"",licensePlate:""})}},className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium",disabled:!V.name||!V.phone,children:"L∆∞u"})]})]})}),lt&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl max-w-md w-full p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:["Th√™m xe cho ",d.name]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Lo·∫°i xe ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: Exciter, Vision, Wave...",value:je.model,onChange:l=>nt({...je,model:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Bi·ªÉn s·ªë ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: 29A 12345",value:je.licensePlate,onChange:l=>nt({...je,licensePlate:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:"üí° Xe m·ªõi s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ch·ªçn sau khi th√™m"})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{Ie(!1),nt({model:"",licensePlate:""})},className:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:it,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium",disabled:!je.model.trim()||!je.licensePlate.trim(),children:"Th√™m xe"})]})]})})]})},ks=({status:a})=>{const S={"Ti·∫øp nh·∫≠n":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400","ƒêang s·ª≠a":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400","ƒê√£ s·ª≠a xong":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400","Tr·∫£ m√°y":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${S[a]}`,children:a})};export{Rs as default};
