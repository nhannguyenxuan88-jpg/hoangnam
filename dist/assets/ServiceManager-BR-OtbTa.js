import{c as xt,r as o,K as Mt,R as Dt,j as e,X as et,L as pe,A as ct,C as ut,M as At,N as jt,i as x,I as dt,W as vt,O as Lt,Q as kt,l as wt,T as Ct,h as bt,x as _t,a as mt,y as gt,s as A,n as Xe,u as It,e as zt,U as Wt,_ as $t,V as Vt,Y as Rt}from"./index-omObMK_Y.js";import{u as qt,a as Ht,b as Et,c as St,d as Pt}from"./useWorkOrdersRepository-C7mweNLM.js";import{a as Tt,c as Kt}from"./useDebtsRepository-seOctDoy.js";import{p as Bt}from"./print-TOU0k1YY.js";import{P as Ge}from"./plus-CTNJ_OT8.js";import{M as Ut}from"./minus-QLRBDB4k.js";import{P as Ft}from"./phone-UfDOLgan.js";import{P as ot}from"./printer-ZAAXeFsS.js";import{P as Gt}from"./pen-D6K0HcAD.js";import{H as Xt}from"./history-BPDGPt6Z.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=xt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=xt("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=xt("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=xt("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),Nt=({isOpen:s,onClose:T,onSave:L,workOrder:u,customers:q,parts:Y,employees:Re,currentBranchId:H,upsertCustomer:ae})=>{var lt,st,Oe,rt;const M=o.useMemo(()=>{var w;if(!u)return null;const n=q.find(R=>R.phone===u.customerPhone||R.name===u.customerName);return!n&&u.customerName?{id:`temp-${Date.now()}`,name:u.customerName,phone:u.customerPhone||"",vehicles:u.licensePlate?[{id:`temp-veh-${Date.now()}`,licensePlate:u.licensePlate,model:u.vehicleModel||""}]:[]}:n&&u.licensePlate&&!((w=n.vehicles)==null?void 0:w.some(E=>E.licensePlate===u.licensePlate))?{...n,vehicles:[...n.vehicles||[],{id:`temp-veh-${Date.now()}`,licensePlate:u.licensePlate,model:u.vehicleModel||""}]}:n||null},[u,q]),ce=o.useMemo(()=>M!=null&&M.vehicles?M.vehicles:[],[M]),C=o.useMemo(()=>{if(!u||!ce.length)return null;let n=ce.find(w=>w.licensePlate===u.licensePlate);return!n&&u.vehicleModel&&(n=ce.find(w=>w.model===u.vehicleModel)),n||(u.licensePlate||u.vehicleModel?{id:`temp-veh-${Date.now()}`,licensePlate:u.licensePlate||"",model:u.vehicleModel||"",customerId:(M==null?void 0:M.id)||""}:ce[0]||null)},[u,ce,M]),[P,he]=o.useState((u==null?void 0:u.status)||"Ti·∫øp nh·∫≠n"),[y,ue]=o.useState(((lt=Re.find(n=>n.name===(u==null?void 0:u.technicianName)))==null?void 0:lt.id)||""),[K,l]=o.useState(null),[g,$]=o.useState(null);o.useEffect(()=>{console.log("[WorkOrderMobileModal] workOrder:",u),console.log("[WorkOrderMobileModal] initialCustomer:",M),console.log("[WorkOrderMobileModal] initialVehicle:",C),u?(l(M),$(C),u.currentKm?k(u.currentKm.toString()):C!=null&&C.currentKm&&k(C.currentKm.toString()),X(!M)):(l(null),$(null),k(""),X(!0))},[u,M,C]);const[G,k]=o.useState(((st=u==null?void 0:u.currentKm)==null?void 0:st.toString())||""),[ie,be]=o.useState((u==null?void 0:u.issueDescription)||""),[z,re]=o.useState(((Oe=u==null?void 0:u.partsUsed)==null?void 0:Oe.map(n=>({partId:n.partId||"",partName:n.partName,quantity:n.quantity,sellingPrice:n.price||0})))||[]),[de,Se]=o.useState(((rt=u==null?void 0:u.additionalServices)==null?void 0:rt.map(n=>({id:n.id||`srv-${Date.now()}-${Math.random()}`,name:n.description||"",costPrice:n.costPrice||0,sellingPrice:n.price||0})))||[]),[Q,ge]=o.useState((u==null?void 0:u.laborCost)||0),[h,f]=o.useState((u==null?void 0:u.discount)||0),[D,fe]=o.useState("amount"),[I,at]=o.useState(!1),[J,_]=o.useState(0),[d,De]=o.useState("cash"),[Z,tt]=o.useState(!1),[r,qe]=o.useState(0),[O,X]=o.useState(!M),[je,xe]=o.useState(""),[ve,ke]=o.useState(!1),[_e,V]=o.useState(""),[Pe,He]=o.useState(!1),[Ee,U]=o.useState(""),[Ke,le]=o.useState(0),[we,Ye]=o.useState(0),[Be,Qe]=o.useState(1),[Je,Ie]=o.useState(!1),[Te,Me]=o.useState(""),[ne,ze]=o.useState(""),[ee,oe]=o.useState(!1),[te,We]=o.useState(""),[Ze,Ae]=o.useState(""),[$e,Ue]=o.useState(""),[Le,Ve]=o.useState(""),a=n=>{if(n===0||n==="0")return"0";if(!n)return"";const w=n.toString().replace(/\D/g,"");return w?w.replace(/\B(?=(\d{3})+(?!\d))/g,"."):""},t=n=>{const w=n.replace(/\./g,"");return w?Number(w):0},i=o.useMemo(()=>{if(console.log("[WorkOrderMobileModal] Total customers:",q==null?void 0:q.length,q),!je)return q;const n=je.toLowerCase(),w=q.filter(R=>{var E;return R.name.toLowerCase().includes(n)||((E=R.phone)==null?void 0:E.toLowerCase().includes(n))||R.vehicles&&R.vehicles.some(nt=>{var ft;return(ft=nt.licensePlate)==null?void 0:ft.toLowerCase().includes(n)})});return console.log("[WorkOrderMobileModal] Filtered customers:",w.length,"Search term:",je),w},[q,je]),v=o.useMemo(()=>{if(!_e)return Y;const n=_e.toLowerCase();return Y.filter(w=>{var R;return w.name.toLowerCase().includes(n)||((R=w.sku)==null?void 0:R.toLowerCase().includes(n))})},[Y,_e]),p=o.useMemo(()=>{if(!K)return[];const n=K.vehicles||[];return g&&!n.find(w=>w.id===g.id)?[...n,g]:n},[K,g]),c=o.useMemo(()=>{if(!g)return[];const n={...g,currentKm:G?parseInt(G):g.currentKm};return Mt(n)},[g,G]);Dt.useEffect(()=>{if(p.length===1&&!g){const n=p[0];$(n),n.currentKm&&k(n.currentKm.toString())}},[p,g]);const m=o.useMemo(()=>z.reduce((n,w)=>n+w.quantity*w.sellingPrice,0),[z]),b=o.useMemo(()=>de.reduce((n,w)=>n+w.sellingPrice,0),[de]),j=m+b+Q,S=o.useMemo(()=>D==="percent"?j*h/100:h,[j,h,D]),N=Math.max(0,j-S),W=n=>{l(n),X(!1),xe(""),$(null),k("")},B=n=>{$(n),n.currentKm?k(n.currentKm.toString()):k("")},ye=n=>{var R;const w=z.find(E=>E.partId===n.id);re(w?z.map(E=>E.partId===n.id?{...E,quantity:E.quantity+1}:E):[...z,{partId:n.id,partName:n.name,quantity:1,sellingPrice:((R=n.retailPrice)==null?void 0:R[H])||0}]),ke(!1),V("")},Ce=(n,w)=>{re(R=>R.map(E=>E.partId===n?{...E,quantity:E.quantity+w}:E).filter(E=>E.quantity>0))},Ne=()=>{!Ee||we<=0||(Se([...de,{id:`srv-${Date.now()}`,name:Ee,costPrice:Ke,sellingPrice:we}]),U(""),le(0),Ye(0),He(!1))},Fe=n=>{Se(de.filter(w=>w.id!==n))},it=()=>{if(!Te||!ne)return;const n={id:`veh-${Date.now()}`,licensePlate:Te,model:ne};if(K){const w=[...K.vehicles||[],n],R={...K,vehicles:w};ae&&ae(R),l(R),$(n)}Me(""),ze(""),Ie(!1)},se=()=>{if(!te||!Ze)return;const n=`CUST-${Date.now()}`,w=`VEH-${Date.now()}`,R=[];($e||Le)&&R.push({id:w,model:$e||"",licensePlate:Le||"",isPrimary:!0});const E={id:n,name:te,phone:Ze,vehicles:R,vehicleModel:$e,licensePlate:Le,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()};ae&&ae(E),l(E),R.length>0&&$(R[0]),X(!1),oe(!1),We(""),Ae(""),Ue(""),Ve(""),xe("")},F=()=>{if(!K||!g){alert("Vui l√≤ng ch·ªçn kh√°ch h√†ng v√† xe");return}const n=I?J:0,R=n+(Z?r:0),E=N-R,nt={status:P,technicianId:y,customer:K,vehicle:g,currentKm:parseInt(G)||0,issueDescription:ie,parts:z,additionalServices:de,laborCost:Q,discount:S,total:N,depositAmount:n,paymentMethod:d,totalPaid:P==="Tr·∫£ m√°y"?R:void 0,remainingAmount:P==="Tr·∫£ m√°y"?E:void 0};L(nt)},me=n=>{switch(n){case"Ti·∫øp nh·∫≠n":return"bg-blue-500";case"ƒêang s·ª≠a":return"bg-yellow-500";case"ƒê√£ s·ª≠a xong":return"bg-green-500";case"Tr·∫£ m√°y":return"bg-green-500";default:return"bg-gray-500"}};return o.useEffect(()=>(s?document.body.classList.add("hide-bottom-nav"):document.body.classList.remove("hide-bottom-nav"),()=>{document.body.classList.remove("hide-bottom-nav")}),[s]),s?e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end md:items-center justify-center",children:[e.jsxs("div",{className:"md:hidden w-full h-full bg-[#151521] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 bg-[#1e1e2d] px-3 py-2.5 flex items-center justify-between border-b border-slate-700",children:[e.jsx("button",{onClick:T,className:"text-slate-400",children:e.jsx(et,{className:"w-4 h-4"})}),e.jsx("h2",{className:"text-sm font-semibold text-white",children:u?`Phi·∫øu #${pe(u.id)}`:"T·∫°o phi·∫øu s·ª≠a ch·ªØa"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-32",children:[e.jsx("div",{className:"p-3 space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:P,onChange:n=>he(n.target.value),className:`w-full px-2.5 py-2 rounded-lg text-white text-xs font-medium appearance-none pr-7 ${me(P)}`,children:[e.jsx("option",{value:"Ti·∫øp nh·∫≠n",children:"üîß Ti·∫øp nh·∫≠n"}),e.jsx("option",{value:"ƒêang s·ª≠a",children:"‚öôÔ∏è ƒêang s·ª≠a"}),e.jsx("option",{value:"ƒê√£ s·ª≠a xong",children:"‚úÖ ƒê√£ s·ª≠a xong"}),e.jsx("option",{value:"Tr·∫£ m√°y",children:"üöó Tr·∫£ xe"})]}),e.jsx(pt,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-white pointer-events-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:y,onChange:n=>ue(n.target.value),className:"w-full px-2.5 py-2 bg-[#2b2b40] rounded-lg text-white text-xs appearance-none pr-7",children:[e.jsx("option",{value:"",children:"üë§ Ch·ªçn KTV"}),Re.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsx(pt,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400 pointer-events-none"})]})]})}),e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"Kh√°ch h√†ng"}),O?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{type:"text",value:je,onChange:n=>xe(n.target.value),placeholder:"üîç T√¨m t√™n ho·∫∑c SƒêT kh√°ch...",className:"w-full pl-9 pr-3 py-2 bg-[#2b2b40] rounded-lg text-white text-xs placeholder-slate-500",autoFocus:!0})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2",children:[i.slice(0,5).map(n=>e.jsxs("div",{onClick:()=>W(n),className:"p-3 bg-[#1e1e2d] rounded-lg cursor-pointer hover:bg-[#2b2b40] transition-colors",children:[e.jsx("div",{className:"text-white font-medium",children:n.name}),e.jsx("div",{className:"text-xs text-slate-400",children:n.phone})]},n.id)),je&&i.length===0&&e.jsx("div",{className:"text-center py-3 text-slate-400 text-xs",children:"Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng"}),e.jsxs("button",{type:"button",onClick:()=>{oe(!0),/^[0-9]+$/.test(je)?(Ae(je),We("")):(We(je),Ae(""))},className:"w-full p-3 bg-green-500/20 border-2 border-dashed border-green-500/50 rounded-lg text-green-400 font-medium flex items-center justify-center gap-2 hover:bg-green-500/30 transition-colors",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Th√™m kh√°ch h√†ng m·ªõi"]})]})]}):K?e.jsxs("div",{className:"p-2.5 bg-[#1e1e2d] rounded-lg flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-semibold text-xs",children:K.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-xs",children:K.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["üìû ",K.phone]})]})]}),e.jsx("button",{onClick:()=>{l(null),$(null),X(!0)},className:"p-1 text-slate-400 hover:text-white",children:e.jsx(et,{className:"w-4 h-4"})})]}):null,K&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-xs font-semibold text-white mt-3 uppercase tracking-wide",children:"XE C·ª¶A KH√ÅCH (Ch·ªçn 1):"}),e.jsxs("div",{className:"space-y-2",children:[p.map(n=>{const w=(g==null?void 0:g.id)===n.id;return e.jsx("div",{onClick:()=>B(n),className:`p-3 rounded-lg cursor-pointer transition-all ${w?"bg-blue-500/20 border-2 border-blue-500":"bg-[#1e1e2d] border-2 border-transparent"}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"text-2xl",children:w?e.jsx(ut,{className:"w-4 h-4 text-blue-400"}):"üèçÔ∏è"}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-semibold ${w?"text-blue-400":"text-white"}`,children:[n.model,w&&" (ƒêANG CH·ªåN)"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["BKS: ",n.licensePlate]})]})]})})},n.id)}),e.jsxs("button",{onClick:()=>Ie(!0),className:"w-full py-1.5 border border-dashed border-slate-600 rounded-lg text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-colors flex items-center justify-center gap-1.5 text-xs",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"}),"Th√™m xe m·ªõi"]})]})]}),g&&e.jsxs("div",{className:"space-y-2 mt-2.5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"S·ªë KM hi·ªán t·∫°i"}),e.jsx("input",{type:"number",value:G,onChange:n=>k(n.target.value),placeholder:"Nh·∫≠p s·ªë KM",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),c.length>0&&e.jsxs("div",{className:"p-2.5 bg-gradient-to-r from-orange-500/10 to-red-500/10 border border-orange-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(At,{className:"w-3.5 h-3.5 text-orange-400"}),e.jsx("span",{className:"text-xs font-semibold text-orange-400",children:"C·∫ßn b·∫£o d∆∞·ª°ng"})]}),e.jsx("div",{className:"space-y-1.5",children:c.map(n=>e.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 rounded text-xs ${n.isOverdue?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"}`,children:[e.jsxs("span",{children:[n.icon," ",n.name]}),e.jsx("span",{className:"font-medium",children:n.isOverdue?`Qu√° ${jt(Math.abs(n.kmUntilDue))}`:`C√≤n ${jt(n.kmUntilDue)}`})]},n.type))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"M√¥ t·∫£ s·ª± c·ªë"}),e.jsx("textarea",{value:ie,onChange:n=>be(n.target.value),placeholder:"Thay nh·ªõt, k√™u c√≤...",rows:3,className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs resize-none"})]})]})]}),K&&g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"PH·ª§ T√ôNG S·ª¨ D·ª§NG"}),z.length>0&&e.jsx("div",{className:"space-y-2",children:z.map((n,w)=>e.jsxs("div",{className:"p-3 bg-[#1e1e2d] rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-white text-xs font-medium",children:[w+1,". ",n.partName]}),n.sku&&e.jsxs("div",{className:"text-[10px] text-slate-500 font-mono",children:["SKU: ",n.sku]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[x(n.sellingPrice)," / c√°i"]})]}),e.jsx("div",{className:"text-[#50cd89] font-bold",children:x(n.quantity*n.sellingPrice)})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ce(n.partId,-1),className:"w-8 h-8 bg-[#2b2b40] rounded-lg flex items-center justify-center text-white hover:bg-red-500/20 hover:text-red-400",children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center text-white font-semibold",children:n.quantity}),e.jsx("button",{onClick:()=>Ce(n.partId,1),className:"w-8 h-8 bg-[#2b2b40] rounded-lg flex items-center justify-center text-white hover:bg-blue-500/20 hover:text-blue-400",children:e.jsx(Ge,{className:"w-4 h-4"})})]})})]},n.partId))}),e.jsxs("button",{onClick:()=>ke(!0),className:"w-full py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium flex items-center justify-center gap-1.5 transition-colors text-xs",children:[e.jsx(Ge,{className:"w-4 h-4"}),"+ TH√äM PH·ª§ T√ôNG"]})]}),e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"B√ÅO GI√Å (GIA C√îNG, ƒê·∫∂T NGO√ÄI)"}),de.length>0&&e.jsx("div",{className:"space-y-2",children:de.map((n,w)=>e.jsxs("div",{className:"p-3 bg-[#1e1e2d] rounded-lg border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"üõ†Ô∏è"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:n.name}),e.jsxs("div",{className:"text-xs text-slate-400 mt-0.5",children:["1 x ",x(n.sellingPrice)]})]})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-2 mt-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Th√†nh ti·ªÅn:"}),e.jsxs("div",{className:"text-[#50cd89] font-bold text-sm",children:["üíµ ",x(n.sellingPrice)]}),n.costPrice>0&&e.jsxs("div",{className:"text-[10px] text-slate-600 mt-0.5",children:["(V·ªën: ",x(n.costPrice),")"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{He(!0)},className:"p-1.5 text-blue-400 hover:bg-blue-500/20 rounded-lg",children:"‚úèÔ∏è"}),e.jsx("button",{onClick:()=>Fe(n.id),className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded-lg",children:"üóëÔ∏è"})]})]})]},n.id))}),e.jsxs("button",{onClick:()=>He(!0),className:"w-full py-3 border border-dashed border-[#009ef7] rounded-lg text-[#009ef7] font-medium flex items-center justify-center gap-2 transition-all hover:bg-[#009ef7]/10 text-xs",children:[e.jsx(Ge,{className:"w-4 h-4"}),"TH√äM C√îNG VI·ªÜC KH√ÅC (GIA C√îNG)"]})]}),e.jsxs("div",{className:"px-3 pb-3 space-y-2.5",children:[e.jsx("h3",{className:"text-xs font-semibold text-white uppercase tracking-wide",children:"THANH TO√ÅN"}),e.jsxs("div",{className:"p-4 bg-[#1e1e2d] rounded-lg space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Ti·ªÅn c√¥ng"}),e.jsx("input",{type:"text",value:a(Q),onChange:n=>ge(t(n.target.value)),placeholder:"0",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#2b2b40] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üí≥"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:"ƒê·∫∑t c·ªçc tr∆∞·ªõc"})]}),e.jsx("button",{onClick:()=>at(!I),className:`relative w-12 h-6 rounded-full transition-colors ${I?"bg-[#009ef7]":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-md transition-transform ${I?"right-0.5":"left-0.5"}`,children:I&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[#009ef7] text-[10px] font-bold",children:"ON"})})})]}),I&&e.jsxs("div",{className:"mt-3 p-3 bg-[#151521] border-2 border-[#009ef7] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:"üíµ"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"Nh·∫≠p s·ªë ti·ªÅn c·ªçc..."})]}),e.jsx("input",{type:"text",value:a(J),onChange:n=>_(t(n.target.value)),placeholder:"0",className:"w-full px-3 py-2.5 bg-[#2b2b40] border border-slate-600 rounded-lg text-white text-sm focus:border-[#009ef7] focus:outline-none transition-colors"})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>De("cash"),className:`relative p-3 rounded-lg transition-all border-2 ${d==="cash"?"bg-emerald-500/10 border-emerald-500 shadow-lg shadow-emerald-500/20":"bg-[#2b2b40] border-transparent hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xl ${d==="cash"?"scale-110":""} transition-transform`,children:"üíµ"}),e.jsx("span",{className:`text-xs font-medium ${d==="cash"?"text-emerald-400":"text-slate-400"}`,children:"Ti·ªÅn m·∫∑t"})]}),d==="cash"&&e.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 bg-emerald-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsxs("button",{onClick:()=>De("bank"),className:`relative p-3 rounded-lg transition-all border-2 ${d==="bank"?"bg-blue-500/10 border-blue-500 shadow-lg shadow-blue-500/20":"bg-[#2b2b40] border-transparent hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`text-xl ${d==="bank"?"scale-110":""} transition-transform`,children:"üè¶"}),e.jsx("span",{className:`text-xs font-medium ${d==="bank"?"text-blue-400":"text-slate-400"}`,children:"Chuy·ªÉn kho·∫£n"})]}),d==="bank"&&e.jsx("div",{className:"absolute top-1 right-1 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})]}),P==="Tr·∫£ m√°y"&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#2b2b40] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"‚úÖ"})}),e.jsx("span",{className:"text-white font-medium text-sm",children:"Thanh to√°n khi tr·∫£ xe"})]}),e.jsx("button",{onClick:()=>{const n=!Z;tt(n),n||qe(0)},className:`relative w-12 h-6 rounded-full transition-colors ${Z?"bg-emerald-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full shadow-md transition-transform ${Z?"right-0.5":"left-0.5"}`,children:Z&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-emerald-500 text-[10px] font-bold",children:"ON"})})})]}),Z&&e.jsxs("div",{className:"mt-3 p-3 bg-[#151521] border-2 border-emerald-500 rounded-lg",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"S·ªë ti·ªÅn thanh to√°n th√™m:"}),e.jsx("input",{type:"text",value:a(r),onChange:n=>qe(t(n.target.value)),placeholder:"0",className:"w-full px-3 py-2.5 bg-[#2b2b40] border border-slate-600 rounded-lg text-white text-sm focus:border-emerald-500 focus:outline-none transition-colors mb-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>qe(0),className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg text-xs font-medium transition-colors",children:"0%"}),e.jsx("button",{onClick:()=>{const n=N-(I?J:0);qe(Math.round(n*.5))},className:"flex-1 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg text-xs font-medium transition-colors",children:"50%"}),e.jsx("button",{onClick:()=>{const n=N-(I?J:0);qe(n)},className:"flex-1 px-3 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg text-xs font-medium transition-colors",children:"100%"})]})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-blue-500/20 flex items-center justify-center mt-0.5",children:e.jsx("span",{className:"text-blue-400 text-xs",children:"‚ÑπÔ∏è"})}),e.jsxs("p",{className:"text-blue-300 text-xs leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"L∆∞u √Ω:"}),' Ch·ªâ thanh to√°n khi tr·∫£ xe, ch·ªâ kh·∫£ d·ª•ng khi tr·∫°ng th√°i "Tr·∫£ m√°y"']})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-700 space-y-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-300 mb-2",children:"T·ªïng k·∫øt"}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{className:"text-white font-medium",children:x(Q)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{className:"text-white font-medium",children:x(m)})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Gia c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{className:"text-white font-medium",children:x(b)})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-700",children:[e.jsxs("div",{className:"flex gap-2 items-center justify-between mb-2",children:[e.jsx("label",{className:"text-red-400 text-xs font-medium",children:"Gi·∫£m gi√°:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a(h),onChange:n=>f(t(n.target.value)),placeholder:"0",className:"w-20 px-2 py-1.5 bg-[#2b2b40] border border-slate-600 rounded text-white text-xs text-right focus:border-red-500 focus:outline-none"}),e.jsxs("select",{value:D,onChange:n=>fe(n.target.value),className:"px-2 py-1.5 bg-[#2b2b40] border border-slate-600 rounded text-white text-xs focus:border-red-500 focus:outline-none",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),D==="percent"&&e.jsx("div",{className:"flex gap-1.5 justify-end",children:[5,10,15,20].map(n=>e.jsxs("button",{onClick:()=>f(n),className:"px-2.5 py-1 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors",children:[n,"%"]},n))}),D==="percent"&&h>0&&e.jsxs("div",{className:"text-xs text-slate-400 text-right mt-1",children:["= ",x(S)]})]}),e.jsxs("div",{className:"pt-2 border-t-2 border-slate-600",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-2",children:[e.jsx("span",{className:"text-white",children:"T·ªïng c·ªông:"}),e.jsx("span",{className:"text-blue-400 text-base",children:x(N)})]}),(I&&J>0||Z&&r>0)&&e.jsxs("div",{className:"space-y-1 pt-2 border-t border-slate-700",children:[I&&J>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-green-400",children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsxs("span",{className:"font-medium text-green-400",children:["-",x(J)]})]}),Z&&r>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-green-400",children:"Thanh to√°n th√™m:"}),e.jsxs("span",{className:"font-medium text-green-400",children:["-",x(r)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-700",children:[e.jsx("span",{className:"text-sm font-bold text-white",children:N-(I?J:0)-(Z?r:0)>0?"C√≤n ph·∫£i thu:":"ƒê√£ thanh to√°n ƒë·ªß"}),e.jsx("span",{className:`text-base font-bold ${N-(I?J:0)-(Z?r:0)>0?"text-red-400":"text-green-400"}`,children:x(N-(I?J:0)-(Z?r:0))})]})]})]})]})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 bg-[#1e1e2d] border-t border-slate-700 p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,className:"px-4 py-2 bg-[#2b2b40] text-slate-300 rounded-lg font-medium hover:bg-slate-700 transition-colors text-xs",children:"H·ªßy"}),e.jsx("button",{onClick:F,className:`flex-1 py-2 rounded-lg font-medium text-white transition-colors text-xs ${P==="Tr·∫£ m√°y"?"bg-green-600 hover:bg-green-700":I?"bg-purple-600 hover:bg-purple-700":"bg-blue-600 hover:bg-blue-700"}`,children:P==="Tr·∫£ m√°y"?"‚úÖ THANH TO√ÅN & TR·∫¢ XE":I?"üí∞ L∆ØU & ƒê·∫∂T C·ªåC":"üíæ L∆ØU PHI·∫æU"})]})})]}),e.jsx("div",{className:"hidden md:block"}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-end",children:e.jsxs("div",{className:"w-full bg-[#151521] rounded-t-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Ch·ªçn ph·ª• t√πng"}),e.jsx("button",{onClick:()=>{ke(!1),V("")},className:"p-1.5 text-slate-400",children:e.jsx(et,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-400"}),e.jsx("input",{type:"text",value:_e,onChange:n=>V(n.target.value),placeholder:"T√¨m t√™n ho·∫∑c SKU...",className:"w-full pl-9 pr-3 py-2 bg-[#2b2b40] rounded-lg text-white text-xs",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-3",children:e.jsx("div",{className:"space-y-2",children:v.slice(0,20).map(n=>{var E,nt;const w=((E=n.stock)==null?void 0:E[H])||0,R=((nt=n.retailPrice)==null?void 0:nt[H])||0;return e.jsx("div",{onClick:()=>ye(n),className:"p-2.5 bg-[#1e1e2d] rounded-lg cursor-pointer hover:bg-[#2b2b40] transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium text-xs",children:n.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["SKU: ",n.sku," ‚Ä¢ T·ªìn: ",w]})]}),e.jsx("div",{className:"text-[#50cd89] font-bold text-xs",children:x(R)})]})},n.id)})})})]})}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-end md:items-center md:justify-center",children:e.jsxs("div",{className:"w-full md:max-w-md bg-[#1e1e2d] rounded-t-2xl md:rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[e.jsx("h3",{className:"text-white font-semibold text-base",children:"TH√äM D·ªäCH V·ª§ GIA C√îNG"}),e.jsx("button",{onClick:()=>{He(!1),U(""),le(0),Ye(0),Qe(1)},className:"p-1.5 text-slate-400 hover:text-white",children:e.jsx(et,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"T√™n c√¥ng vi·ªác / M√¥ t·∫£:"}),e.jsx("input",{type:"text",value:Ee,onChange:n=>U(n.target.value),placeholder:"Nh·∫≠p t√™n (VD: H√†n y·∫øm, S∆°n...)",className:"w-full px-4 py-3 bg-[#151521] border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-[#009ef7] focus:outline-none transition-colors",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"S·ªë l∆∞·ª£ng:"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>Qe(Math.max(1,Be-1)),className:"w-12 h-12 bg-[#2b2b40] hover:bg-slate-700 rounded-lg flex items-center justify-center text-white text-2xl font-bold transition-colors",children:"‚àí"}),e.jsx("div",{className:"w-20 h-12 bg-[#151521] border border-slate-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl font-bold",children:Be})}),e.jsx("button",{onClick:()=>Qe(Be+1),className:"w-12 h-12 bg-[#2b2b40] hover:bg-slate-700 rounded-lg flex items-center justify-center text-white text-2xl font-bold transition-colors",children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wide",children:"CHI PH√ç & GI√Å B√ÅN"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1.5",children:"Gi√° nh·∫≠p (V·ªën):"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a(Ke),onChange:n=>le(t(n.target.value)),placeholder:"0",className:"w-full px-3 py-3 pr-8 bg-[#151521] border border-slate-700 rounded-lg text-slate-400 text-sm focus:border-slate-600 focus:outline-none transition-colors"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs",children:"ƒë"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-[#ffc700] mb-1.5 font-medium",children:"ƒê∆°n gi√° (B√°o kh√°ch):"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a(we),onChange:n=>Ye(t(n.target.value)),placeholder:"0",className:"w-full px-3 py-3 pr-8 bg-gradient-to-br from-[#009ef7]/10 to-purple-600/10 border-2 border-[#009ef7] rounded-lg text-white text-sm font-semibold focus:border-[#0077c7] focus:outline-none transition-colors"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#009ef7] text-xs font-bold",children:"ƒë"})]})]})]})]}),e.jsx("div",{className:"p-4 bg-[#151521] border border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"Th√†nh ti·ªÅn (T·ª± t√≠nh):"}),e.jsx("span",{className:"text-[#50cd89] text-xl font-bold",children:x(we*Be)})]})})]}),e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx("button",{onClick:Ne,disabled:!Ee.trim()||we<=0,className:"w-full py-4 bg-gradient-to-r from-[#009ef7] to-purple-600 hover:from-[#0077c7] hover:to-purple-700 disabled:from-slate-700 disabled:to-slate-700 disabled:cursor-not-allowed text-white font-bold text-sm rounded-lg transition-all shadow-lg",children:"L∆ØU V√ÄO PHI·∫æU"})})]})}),Je&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-[#1e1e2d] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Th√™m xe m·ªõi"}),e.jsx("button",{onClick:()=>Ie(!1),className:"p-1.5 text-slate-400",children:e.jsx(et,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Bi·ªÉn s·ªë xe"}),e.jsx("input",{type:"text",value:Te,onChange:n=>Me(n.target.value),placeholder:"59G1-123.45",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"T√™n xe"}),e.jsx("input",{type:"text",value:ne,onChange:n=>ze(n.target.value),placeholder:"Honda Wave RSX",className:"w-full px-2.5 py-1.5 bg-[#2b2b40] rounded-lg text-white text-xs"})]}),e.jsxs("div",{className:"flex gap-2 pt-1.5",children:[e.jsx("button",{onClick:()=>Ie(!1),className:"flex-1 py-2 bg-[#2b2b40] text-slate-300 rounded-lg font-medium text-xs",children:"H·ªßy"}),e.jsx("button",{onClick:it,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg font-medium text-xs",children:"Th√™m xe"})]})]})]})}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[110] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-[#1e1e2d] rounded-xl p-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white font-semibold",children:"Th√™m kh√°ch h√†ng m·ªõi"}),e.jsx("button",{onClick:()=>{oe(!1),We(""),Ae(""),Ue(""),Ve("")},className:"p-1.5 text-slate-400",children:e.jsx(et,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-[#2b2b40]/50 rounded-lg p-3 space-y-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-blue-400 uppercase tracking-wide",children:"Th√¥ng tin kh√°ch h√†ng"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:["T√™n kh√°ch h√†ng ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:te,onChange:n=>We(n.target.value),placeholder:"Nguy·ªÖn VƒÉn A",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:["S·ªë ƒëi·ªán tho·∫°i ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"tel",value:Ze,onChange:n=>Ae(n.target.value),placeholder:"0901234567",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm"})]})]}),e.jsxs("div",{className:"bg-[#2b2b40]/50 rounded-lg p-3 space-y-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-green-400 uppercase tracking-wide",children:"üèçÔ∏è Th√¥ng tin xe"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Lo·∫°i xe"}),e.jsx("input",{type:"text",value:$e,onChange:n=>Ue(n.target.value),placeholder:"Wave, Exciter, Vision...",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Bi·ªÉn s·ªë xe"}),e.jsx("input",{type:"text",value:Le,onChange:n=>Ve(n.target.value.toUpperCase()),placeholder:"59G1-12345",className:"w-full px-3 py-2.5 bg-[#2b2b40] rounded-lg text-white text-sm uppercase"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>{oe(!1),We(""),Ae(""),Ue(""),Ve("")},className:"flex-1 py-2.5 bg-[#2b2b40] text-slate-300 rounded-lg font-medium text-sm",children:"H·ªßy"}),e.jsx("button",{onClick:se,disabled:!te||!Ze,className:"flex-1 py-2.5 bg-green-600 text-white rounded-lg font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"üíæ L∆∞u kh√°ch h√†ng"})]})]})]})})]}):null};function Jt({workOrders:s,onCreateWorkOrder:T,onEditWorkOrder:L,onDeleteWorkOrder:u,onCallCustomer:q,onPrintWorkOrder:Y,currentBranchId:Re}){const[H,ae]=o.useState(""),[M,ce]=o.useState("all"),[C,P]=o.useState(!1),he=o.useMemo(()=>{const l=s.filter(z=>z.status==="Ti·∫øp nh·∫≠n").length,g=s.filter(z=>z.status==="ƒêang s·ª≠a").length,$=s.filter(z=>z.status==="ƒê√£ s·ª≠a xong").length,G=s.filter(z=>z.status==="Tr·∫£ m√°y").length,k=s.filter(z=>z.status==="ƒê√£ s·ª≠a xong"||z.status==="Tr·∫£ m√°y"),ie=k.reduce((z,re)=>z+(re.total||0),0),be=k.reduce((z,re)=>z+(re.total||0),0);return{tiepNhan:l,dangSua:g,daHoanThanh:$,traMay:G,doanhThu:ie,loiNhuan:be}},[s]),y=o.useMemo(()=>{let l=s;if(M!=="all"&&(l=l.filter(g=>g.status===M)),H.trim()){const g=H.toLowerCase();l=l.filter($=>{var G,k,ie,be;return((G=$.customerName)==null?void 0:G.toLowerCase().includes(g))||((k=$.customerPhone)==null?void 0:k.toLowerCase().includes(g))||((ie=$.licensePlate)==null?void 0:ie.toLowerCase().includes(g))||((be=$.id)==null?void 0:be.toLowerCase().includes(g))})}return l.sort((g,$)=>{const G=new Date(g.creationDate||0).getTime();return new Date($.creationDate||0).getTime()-G})},[s,M,H]),ue=l=>{switch(l){case"Ti·∫øp nh·∫≠n":return"bg-[#009ef7]/10 text-[#009ef7] border-[#009ef7]/30";case"ƒêang s·ª≠a":return"bg-[#f1416c]/10 text-[#f1416c] border-[#f1416c]/30";case"ƒê√£ s·ª≠a xong":return"bg-[#50cd89]/10 text-[#50cd89] border-[#50cd89]/30";case"Tr·∫£ m√°y":return"bg-purple-500/10 text-purple-500 border-purple-500/30";default:return"bg-gray-500/10 text-gray-500 border-gray-500/30"}},K=l=>{switch(l){case"Ti·∫øp nh·∫≠n":return e.jsx(dt,{className:"w-4 h-4"});case"ƒêang s·ª≠a":return e.jsx(vt,{className:"w-4 h-4"});case"ƒê√£ s·ª≠a xong":return e.jsx(ut,{className:"w-4 h-4"});case"Tr·∫£ m√°y":return e.jsx(yt,{className:"w-4 h-4"});default:return e.jsx(dt,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"md:hidden flex flex-col h-screen bg-[#151521]",children:[e.jsxs("div",{className:"bg-[#1e1e2d] border-b border-gray-800 p-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>ce(M==="Ti·∫øp nh·∫≠n"?"all":"Ti·∫øp nh·∫≠n"),className:`p-3 rounded-xl text-left transition-all ${M==="Ti·∫øp nh·∫≠n"?"bg-gradient-to-br from-[#009ef7]/20 to-[#009ef7]/10 border-2 border-[#009ef7] shadow-lg shadow-[#009ef7]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#009ef7]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Ti·∫øp nh·∫≠n"}),e.jsx(dt,{className:"w-4 h-4 text-[#009ef7]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:he.tiepNhan})]}),e.jsxs("button",{onClick:()=>ce(M==="ƒêang s·ª≠a"?"all":"ƒêang s·ª≠a"),className:`p-3 rounded-xl text-left transition-all ${M==="ƒêang s·ª≠a"?"bg-gradient-to-br from-[#f1416c]/20 to-[#f1416c]/10 border-2 border-[#f1416c] shadow-lg shadow-[#f1416c]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#f1416c]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"ƒêang s·ª≠a"}),e.jsx(vt,{className:"w-4 h-4 text-[#f1416c]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:he.dangSua})]}),e.jsxs("button",{onClick:()=>ce(M==="ƒê√£ s·ª≠a xong"?"all":"ƒê√£ s·ª≠a xong"),className:`p-3 rounded-xl text-left transition-all ${M==="ƒê√£ s·ª≠a xong"?"bg-gradient-to-br from-[#50cd89]/20 to-[#50cd89]/10 border-2 border-[#50cd89] shadow-lg shadow-[#50cd89]/20":"bg-[#2b2b40] border border-gray-700 hover:border-[#50cd89]/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"ƒê√£ s·ª≠a xong"}),e.jsx(ut,{className:"w-4 h-4 text-[#50cd89]"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:he.daHoanThanh})]}),e.jsxs("button",{onClick:()=>ce(M==="Tr·∫£ m√°y"?"all":"Tr·∫£ m√°y"),className:`p-3 rounded-xl text-left transition-all ${M==="Tr·∫£ m√°y"?"bg-gradient-to-br from-purple-500/20 to-purple-500/10 border-2 border-purple-500 shadow-lg shadow-purple-500/20":"bg-[#2b2b40] border border-gray-700 hover:border-purple-500/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Tr·∫£ m√°y"}),e.jsx(yt,{className:"w-4 h-4 text-purple-500"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:he.traMay})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-br from-emerald-900/30 to-emerald-800/20 border border-emerald-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-emerald-400 font-medium",children:"Doanh thu h√¥m nay"}),e.jsx(Lt,{className:"w-4 h-4 text-emerald-400"})]}),e.jsx("div",{className:"text-base font-black text-emerald-300",children:x(he.doanhThu)})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"L·ª£i nhu·∫≠n h√¥m nay"}),e.jsx(kt,{className:"w-4 h-4 text-blue-400"})]}),e.jsx("div",{className:"text-base font-black text-blue-300",children:x(he.loiNhuan)})]})]})]}),e.jsx("div",{className:"bg-[#1e1e2d] border-b border-gray-800 px-3 py-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"T√¨m t√™n, SƒêT, bi·ªÉn s·ªë...",value:H,onChange:l=>ae(l.target.value),className:"w-full pl-10 pr-3 py-2.5 bg-[#2b2b40] border border-gray-700 rounded-xl text-white placeholder-gray-500 text-sm focus:outline-none focus:border-[#009ef7]"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto py-2 space-y-2 pb-20 scrollbar-hide",children:y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-6",children:[e.jsx("div",{className:"w-32 h-32 mb-6 flex items-center justify-center",children:e.jsx("svg",{className:"w-full h-full text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-300 mb-2",children:"Ch∆∞a c√≥ phi·∫øu s·ª≠a ch·ªØa n√†o!"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"H√£y t·∫°o phi·∫øu ƒë·∫ßu ti√™n ƒë·ªÉ qu·∫£n l√Ω d·ªãch v·ª• s·ª≠a ch·ªØa"}),e.jsx("button",{onClick:T,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg shadow-blue-500/30",children:"+ T·∫°o phi·∫øu m·ªõi"})]}):y.map(l=>e.jsxs("div",{onClick:()=>L(l),className:"bg-[#1e1e2d] rounded-xl border border-gray-800 overflow-hidden active:scale-[0.99] transition-transform",children:[e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[#009ef7] font-mono text-sm font-semibold mb-0.5",children:pe(l.id)}),e.jsx("div",{className:"text-xs text-gray-500",children:wt(l.creationDate)})]}),e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg border text-xs font-semibold ${ue(l.status)}`,children:[K(l.status),l.status]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üë§"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-white font-medium text-sm truncate",children:l.customerName}),e.jsx("div",{className:"text-gray-400 text-xs",children:l.customerPhone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üèçÔ∏è"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-gray-300 text-sm truncate",children:l.vehicleModel}),e.jsx("div",{className:"text-[#009ef7] text-xs font-mono",children:l.licensePlate})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-800",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["KTV:"," ",e.jsx("span",{className:"text-gray-300",children:l.technicianName||"Ch∆∞a ph√¢n"})]}),e.jsx("div",{className:"text-white font-bold text-base",children:x(l.total||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-4 border-t border-gray-800",children:[e.jsxs("button",{onClick:g=>{g.stopPropagation(),q(l.customerPhone||"")},className:"flex items-center justify-center gap-1 py-3 bg-green-500/10 hover:bg-green-500/20 transition-colors border-r border-gray-800",children:[e.jsx(Ft,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-green-500",children:"G·ªçi"})]}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),Y(l)},className:"flex items-center justify-center gap-1 py-3 bg-purple-500/10 hover:bg-purple-500/20 transition-colors border-r border-gray-800",children:[e.jsx(ot,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-purple-500",children:"In"})]}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),L(l)},className:"flex items-center justify-center gap-1 py-3 bg-[#009ef7]/10 hover:bg-[#009ef7]/20 transition-colors border-r border-gray-800",children:[e.jsx(Gt,{className:"w-4 h-4 text-[#009ef7]"}),e.jsx("span",{className:"text-[11px] font-semibold text-[#009ef7]",children:"S·ª≠a"})]}),e.jsxs("button",{onClick:g=>{g.stopPropagation(),u(l)},className:"flex items-center justify-center gap-1 py-3 bg-[#f1416c]/10 hover:bg-[#f1416c]/20 transition-colors",children:[e.jsx(Ct,{className:"w-4 h-4 text-[#f1416c]"}),e.jsx("span",{className:"text-[11px] font-semibold text-[#f1416c]",children:"X√≥a"})]})]})]},l.id))}),e.jsx("button",{onClick:T,className:"fixed bottom-20 right-4 w-12 h-12 bg-gradient-to-br from-[#009ef7] to-[#0077b6] rounded-full shadow-xl shadow-[#009ef7]/50 flex items-center justify-center hover:from-[#0077b6] hover:to-[#005a8a] transition-all z-[60] active:scale-95","aria-label":"T·∫°o phi·∫øu m·ªõi",children:e.jsx(Ge,{className:"w-5 h-5 text-white"})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center md:justify-center",children:e.jsxs("div",{className:"bg-[#1e1e2d] rounded-t-3xl md:rounded-2xl w-full md:max-w-md p-6 space-y-4 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"B·ªô l·ªçc n√¢ng cao"}),e.jsx("button",{onClick:()=>P(!1),className:"text-gray-500 hover:text-gray-300",children:"‚úï"})]}),e.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"C√°c t√πy ch·ªçn l·ªçc s·∫Ω ƒë∆∞·ª£c b·ªï sung..."})]})}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
      `})]})}const ht="repair_templates";function Zt(){const{profile:s}=bt(),T=s==null?void 0:s.branch_id;return _t({queryKey:[ht,T],queryFn:async()=>{const{data:L,error:u}=await Xe.from("repair_templates").select("*").or(`branch_id.is.null,branch_id.eq.${T}`).eq("is_active",!0).order("name",{ascending:!0});if(u)throw console.error("Error fetching repair templates:",u),u;return L||[]},enabled:!!s,staleTime:300*1e3})}function Ot(){const s=mt(),{profile:T}=bt();return gt({mutationFn:async L=>{const{data:u,error:q}=await Xe.from("repair_templates").insert({branch_id:T==null?void 0:T.branch_id,name:L.name,description:L.description||null,duration:L.duration||30,labor_cost:L.labor_cost||0,parts:L.parts||[],is_active:L.is_active!==!1,created_by:T==null?void 0:T.id}).select().single();if(q)throw console.error("Error creating repair template:",q),q;return u},onSuccess:L=>{s.invalidateQueries({queryKey:[ht]}),A.success(`ƒê√£ t·∫°o m·∫´u "${L.name}"`)},onError:L=>{A.error(`L·ªói t·∫°o m·∫´u: ${L.message}`)}})}function es(){const s=mt();return gt({mutationFn:async({id:T,updates:L})=>{const{data:u,error:q}=await Xe.from("repair_templates").update({name:L.name,description:L.description,duration:L.duration,labor_cost:L.labor_cost,parts:L.parts,is_active:L.is_active}).eq("id",T).select().single();if(q)throw console.error("Error updating repair template:",q),q;return u},onSuccess:T=>{s.invalidateQueries({queryKey:[ht]}),A.success(`ƒê√£ c·∫≠p nh·∫≠t m·∫´u "${T.name}"`)},onError:T=>{A.error(`L·ªói c·∫≠p nh·∫≠t: ${T.message}`)}})}function ts(){const s=mt();return gt({mutationFn:async T=>{const{error:L}=await Xe.from("repair_templates").update({is_active:!1}).eq("id",T);if(L)throw console.error("Error deleting repair template:",L),L;return T},onSuccess:()=>{s.invalidateQueries({queryKey:[ht]}),A.success("ƒê√£ x√≥a m·∫´u s·ª≠a ch·ªØa")},onError:T=>{A.error(`L·ªói x√≥a m·∫´u: ${T.message}`)}})}function ss({isOpen:s,onClose:T,onApplyTemplate:L,parts:u,currentBranchId:q}){const{data:Y,isLoading:Re}=Zt(),H=Ot(),ae=es(),M=ts(),[ce,C]=o.useState(!1),[P,he]=o.useState(null),[y,ue]=o.useState({id:"",name:"",description:"",duration:30,laborCost:0,parts:[]}),[K,l]=o.useState(null),[g,$]=o.useState(""),G=o.useMemo(()=>Y?Y.map(h=>({id:h.id,name:h.name,description:h.description||"",duration:h.duration,laborCost:h.labor_cost,parts:h.parts||[]})):[],[Y]),k=o.useMemo(()=>{if(K===null)return[];const h=g.toLowerCase();return h?u.filter(f=>f.name.toLowerCase().includes(h)).slice(0,10):u.slice(0,5)},[u,K,g]);o.useEffect(()=>{const h=f=>{f.target.closest(".template-part-input")||l(null)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const ie=()=>{he(null),ue({id:"",name:"",description:"",duration:30,laborCost:0,parts:[]}),C(!0)},be=h=>{he(h),ue({id:h.id,name:h.name,description:h.description,duration:h.duration,laborCost:h.laborCost,parts:[...h.parts]}),C(!0)},z=async()=>{if(y.name.trim())try{P?await ae.mutateAsync({id:P.id,updates:{name:y.name,description:y.description,duration:y.duration,labor_cost:y.laborCost,parts:y.parts}}):await H.mutateAsync({name:y.name,description:y.description,duration:y.duration,labor_cost:y.laborCost,parts:y.parts}),C(!1),he(null)}catch(h){console.error("Error saving template:",h)}},re=async h=>{if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·∫´u s·ª≠a ch·ªØa n√†y?"))try{await M.mutateAsync(h)}catch(f){console.error("Error deleting template:",f)}},de=()=>{ue({...y,parts:[...y.parts,{name:"",quantity:1,price:0,unit:"c√°i"}]})},Se=h=>{ue({...y,parts:y.parts.filter((f,D)=>D!==h)})},Q=(h,f,D)=>{const fe=[...y.parts];fe[h]={...fe[h],[f]:D},ue({...y,parts:fe}),f==="name"&&(l(h),$(D))},ge=(h,f)=>{var fe;const D=[...y.parts];D[h]={...D[h],name:f.name,price:((fe=f.retailPrice)==null?void 0:fe[q||""])||0,unit:"c√°i"},ue({...y,parts:D}),l(null),$("")};return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"M·∫´u s·ª≠a ch·ªØa th∆∞·ªùng d√πng"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ie,className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),"T·∫°o m·∫´u m·ªõi"]}),e.jsx("button",{onClick:T,className:"text-slate-400 hover:text-slate-600","aria-label":"ƒê√≥ng",children:e.jsx(et,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Ch·ªçn m·∫´u s·ª≠a ch·ªØa ƒë·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin v√†o phi·∫øu s·ª≠a ch·ªØa"}),Re?e.jsx("div",{className:"text-center py-12 text-slate-500",children:"ƒêang t·∫£i..."}):G.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-4",children:"Ch∆∞a c√≥ m·∫´u s·ª≠a ch·ªØa n√†o"}),e.jsx("button",{onClick:ie,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg",children:"T·∫°o m·∫´u ƒë·∫ßu ti√™n"})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:G.map(h=>e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100",children:h.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:h.description}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[h.duration," ph√∫t"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:x(h.laborCost+h.parts.reduce((f,D)=>f+D.price*D.quantity,0))})})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 mb-2",children:"Ph·ª• t√πng c·∫ßn thi·∫øt:"}),h.parts.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:"Kh√¥ng c√≥ ph·ª• t√πng"}):h.parts.map((f,D)=>e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:[f.name," x",f.quantity," ",f.unit]}),e.jsx("span",{children:x(f.price*f.quantity)})]},D)),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>L(h),className:"flex-1 px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",children:"√Åp d·ª•ng"}),e.jsx("button",{onClick:()=>be(h),className:"px-3 py-1.5 bg-purple-50 dark:bg-purple-900/20 hover:bg-purple-100 dark:hover:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded text-sm",children:"S·ª≠a"}),e.jsx("button",{onClick:()=>re(h.id),className:"px-3 py-1.5 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 rounded text-sm",children:"X√≥a"})]})]})]},h.id))})]})]})}),ce&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:P?"S·ª≠a m·∫´u s·ª≠a ch·ªØa":"T·∫°o m·∫´u s·ª≠a ch·ªØa m·ªõi"}),e.jsx("button",{onClick:()=>{C(!1),he(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx(et,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n m·∫´u ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: Thay d·∫ßu ƒë·ªông c∆°",value:y.name,onChange:h=>ue({...y,name:h.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{rows:2,placeholder:"M√¥ t·∫£ chi ti·∫øt d·ªãch v·ª•...",value:y.description,onChange:h=>ue({...y,description:h.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Th·ªùi gian (ph√∫t)"}),e.jsx("input",{type:"number",min:"5",step:"5",value:y.duration,onChange:h=>ue({...y,duration:Number(h.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Chi ph√≠ c√¥ng"}),e.jsx("input",{type:"number",min:"0",step:"10000",placeholder:"0",value:y.laborCost||"",onChange:h=>ue({...y,laborCost:Number(h.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Ph·ª• t√πng c·∫ßn thi·∫øt"}),e.jsxs("button",{onClick:de,className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Th√™m ph·ª• t√πng"]})]}),y.parts.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400 text-sm",children:'Ch∆∞a c√≥ ph·ª• t√πng n√†o. Nh·∫•n "Th√™m ph·ª• t√πng" ƒë·ªÉ th√™m.'}):e.jsx("div",{className:"space-y-2",children:y.parts.map((h,f)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"col-span-2 relative template-part-input",children:[e.jsx("input",{type:"text",placeholder:"T√™n ph·ª• t√πng",value:h.name,onChange:D=>Q(f,"name",D.target.value),onFocus:()=>{l(f),$(h.name)},className:"w-full px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"}),K===f&&e.jsx("div",{className:"absolute z-[70] top-full left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-[200px] overflow-y-auto",children:k.length>0?k.map(D=>{var fe,I;return e.jsx("button",{type:"button",onClick:()=>ge(f,D),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:D.name}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["T·ªìn kho:"," ",((fe=D.stock)==null?void 0:fe[q||""])||0," ","c√°i"]})]}),e.jsx("div",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:x(((I=D.retailPrice)==null?void 0:I[q||""])||0)})]})},D.id)}):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-slate-500 dark:text-slate-400",children:!u||u.length===0?"Kh√¥ng c√≥ ph·ª• t√πng trong kho":"Kh√¥ng t√¨m th·∫•y ph·ª• t√πng ph√π h·ª£p"})})]}),e.jsx("input",{type:"number",min:"1",placeholder:"SL",value:h.quantity,onChange:D=>Q(f,"quantity",Number(D.target.value)),className:"px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"}),e.jsx("input",{type:"number",min:"0",step:"1000",placeholder:"ƒê∆°n gi√°",value:h.price||"",onChange:D=>Q(f,"price",Number(D.target.value)),className:"px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})]}),e.jsx("button",{onClick:()=>Se(f),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"X√≥a",children:e.jsx(Ct,{className:"w-5 h-5"})})]},f))})]}),(y.laborCost>0||y.parts.length>0)&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Chi ph√≠ c√¥ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:x(y.laborCost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ph·ª• t√πng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:x(y.parts.reduce((h,f)=>h+f.price*f.quantity,0))})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-blue-200 dark:border-blue-700",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:"T·ªïng ∆∞·ªõc t√≠nh:"}),e.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:x(y.laborCost+y.parts.reduce((h,f)=>h+f.price*f.quantity,0))})]})]})})]})}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 px-6 py-4 flex justify-end gap-3 bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("button",{onClick:()=>{C(!1),he(null)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:z,disabled:!y.name.trim(),className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:P?"C·∫≠p nh·∫≠t":"T·∫°o m·∫´u"})]})]})})]}):null}function ps(){var Ae,$e,Ue,Le,Ve,a;mt();const{parts:s,customers:T,employees:L,upsertCustomer:u,setCashTransactions:q,setPaymentSources:Y,paymentSources:Re,currentBranchId:H,workOrders:ae,setWorkOrders:M}=It(),{data:ce,isLoading:C}=zt(),{data:P,isLoading:he}=Wt(),{data:y,isLoading:ue}=qt(),[K,l]=o.useState([]);o.useEffect(()=>{(async()=>{const{data:i,error:v}=await Xe.from("customers").select("*").order("created_at",{ascending:!1});!v&&i&&l(i)})()},[]);const g=ce||s,$=K.length>0?K:T,G=P||L,k=y||ae;o.useEffect(()=>{console.log("[ServiceManager] fetchedWorkOrders:",y==null?void 0:y.length,y),console.log("[ServiceManager] workOrders from context:",ae==null?void 0:ae.length,ae),y&&M(y)},[y,M]);const[ie,be]=o.useState(!1),[z,re]=o.useState(!1),[de,Se]=o.useState(!1),[Q,ge]=o.useState(void 0),[h,f]=o.useState(""),[D,fe]=o.useState("all"),[I,at]=o.useState("all"),[J,_]=o.useState(null),[d,De]=o.useState(null),[Z,tt]=o.useState(!1),[r,qe]=o.useState(null),[O,X]=o.useState(null),[je,xe]=o.useState(!1),[ve,ke]=o.useState("");o.useEffect(()=>{if(!J)return;const t=i=>{i.target.closest(".service-row-menu")||_(null)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[J]);const _e=o.useMemo(()=>{let t=k.filter(i=>!i.refunded);return console.log("[ServiceManager] Total displayWorkOrders:",k.length),console.log("[ServiceManager] Work orders status:",k.map(i=>({id:i.id,status:i.status}))),I==="delivered"?t=t.filter(i=>i.status==="Tr·∫£ m√°y"):(t=t.filter(i=>i.status!=="Tr·∫£ m√°y"),I==="pending"?t=t.filter(i=>i.status==="Ti·∫øp nh·∫≠n"):I==="inProgress"?t=t.filter(i=>i.status==="ƒêang s·ª≠a"):I==="done"&&(t=t.filter(i=>i.status==="ƒê√£ s·ª≠a xong"))),console.log("[ServiceManager] After tab filter:",I,t.length),h&&(t=t.filter(i=>{var v,p;return i.customerName.toLowerCase().includes(h.toLowerCase())||((v=i.vehicleModel)==null?void 0:v.toLowerCase().includes(h.toLowerCase()))||((p=i.licensePlate)==null?void 0:p.toLowerCase().includes(h.toLowerCase()))})),t.sort((i,v)=>{const p=i.creationDate||i.creationdate,c=v.creationDate||v.creationdate;return!p||!c?0:new Date(c).getTime()-new Date(p).getTime()})},[k,I,h]),V=o.useMemo(()=>{const t=k.filter(b=>b.status==="Ti·∫øp nh·∫≠n").length,i=k.filter(b=>b.status==="ƒêang s·ª≠a").length,v=k.filter(b=>b.status==="ƒê√£ s·ª≠a xong").length,p=k.filter(b=>b.status==="Tr·∫£ m√°y").length,c=k.filter(b=>b.paymentStatus==="paid"&&new Date(b.creationDate).toDateString()===new Date().toDateString()).reduce((b,j)=>b+j.total,0),m=k.filter(b=>b.paymentStatus==="paid"&&new Date(b.creationDate).toDateString()===new Date().toDateString()).reduce((b,j)=>{var S;return b+(j.total-(((S=j.partsUsed)==null?void 0:S.reduce((N,W)=>N+W.price*W.quantity,0))||0))},0);return{pending:t,inProgress:i,done:v,delivered:p,todayRevenue:c,todayProfit:m}},[k]),Pe=V.pending+V.inProgress+V.done,He=V.pending+V.inProgress,Ee=Pe?Math.round(He/Pe*100):0,U=Pe?Math.round(V.done/Pe*100):0,Ke=V.todayRevenue?Math.round(V.todayProfit/V.todayRevenue*100):0,le={slate:"bg-slate-100 text-slate-600 dark:bg-slate-900/30 dark:text-slate-200",blue:"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-300",orange:"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-300",green:"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300",purple:"bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-300"},we=o.useMemo(()=>[{key:"all",label:"T·∫•t c·∫£",color:"slate",count:k.filter(t=>t.status!=="Tr·∫£ m√°y"&&!t.refunded).length},{key:"pending",label:"Ti·∫øp nh·∫≠n",color:"blue",count:V.pending},{key:"inProgress",label:"ƒêang s·ª≠a",color:"orange",count:V.inProgress},{key:"done",label:"ƒê√£ s·ª≠a xong",color:"green",count:V.done},{key:"delivered",label:"ƒê√£ tr·∫£ m√°y",color:"purple",count:V.delivered}],[k,V.delivered,V.done,V.inProgress,V.pending]),Ye=[{key:"pending",label:"Ti·∫øp nh·∫≠n",value:V.pending,subtitle:"Ch·ªù ph√¢n c√¥ng",accent:"from-sky-50 via-sky-50 to-white dark:from-sky-900/30 dark:via-sky-900/10",dot:"bg-sky-500"},{key:"inProgress",label:"ƒêang s·ª≠a",value:V.inProgress,subtitle:"ƒêang thi c√¥ng",accent:"from-amber-50 via-amber-50 to-white dark:from-amber-900/30 dark:via-amber-900/10",dot:"bg-amber-500"},{key:"done",label:"ƒê√£ s·ª≠a xong",value:V.done,subtitle:"Ch·ªù giao kh√°ch",accent:"from-emerald-50 via-emerald-50 to-white dark:from-emerald-900/30 dark:via-emerald-900/10",dot:"bg-emerald-500"},{key:"delivered",label:"Tr·∫£ m√°y",value:V.delivered,subtitle:"Ho√†n t·∫•t",accent:"from-purple-50 via-purple-50 to-white dark:from-purple-900/30 dark:via-purple-900/10",dot:"bg-purple-500"}],Be=t=>{ge(t||{id:"",customerName:"",customerPhone:"",vehicleModel:"",licensePlate:"",issueDescription:"",technicianName:"",status:"Ti·∫øp nh·∫≠n",laborCost:0,discount:0,partsUsed:[],total:0,branchId:H,paymentStatus:"unpaid",creationDate:new Date().toISOString()}),be(!0)},Qe=async t=>{De(t);try{const{data:i,error:v}=await Xe.from("store_settings").select("*").limit(1).single();!v&&i&&qe(i)}catch(i){console.error("Error loading store settings:",i)}tt(!0)},Je=()=>{setTimeout(()=>{Bt("work-order-receipt")},100)},{mutateAsync:Ie}=Ht(),{mutateAsync:Te}=Et();Tt(),Kt();const{mutateAsync:Me}=St(),{mutateAsync:ne}=Pt(),ze=async t=>{var i,v;try{if(console.log("[handleMobileSave] Mobile Work Order Data:",t),!((i=t.customer)!=null&&i.name)){A.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((v=t.customer)!=null&&v.phone)){A.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}const{status:p,customer:c,vehicle:m,currentKm:b=0,issueDescription:j,technicianId:S,parts:N=[],additionalServices:W=[],laborCost:B=0,discount:ye=0,total:Ce=0,depositAmount:Ne=0,paymentMethod:Fe,paymentType:it,totalPaid:se=0,remainingAmount:F=0}=t;let me="unpaid";se>=Ce?me="paid":se>0&&(me="partial");const lt=G.find(Oe=>Oe.id===S),st=(lt==null?void 0:lt.name)||"";if(Q!=null&&Q.id){const Oe=await ne({id:Q.id,customerName:c.name,customerPhone:c.phone,vehicleModel:(m==null?void 0:m.model)||"",licensePlate:(m==null?void 0:m.licensePlate)||"",vehicleId:(m==null?void 0:m.id)||"",currentKm:b>0?b:void 0,issueDescription:j||"",technicianName:st,status:p,laborCost:B,discount:ye,partsUsed:N,additionalServices:W.length>0?W:void 0,total:Ce,branchId:H,paymentStatus:me,paymentMethod:Fe,depositAmount:Ne>0?Ne:void 0,additionalPayment:se>Ne?se-Ne:void 0,totalPaid:se>0?se:void 0,remainingAmount:F}),rt={...Q,customerName:c.name,customerPhone:c.phone,vehicleModel:(m==null?void 0:m.model)||"",licensePlate:(m==null?void 0:m.licensePlate)||"",vehicleId:(m==null?void 0:m.id)||"",currentKm:b>0?b:void 0,issueDescription:j||"",technicianName:st,status:p,laborCost:B,discount:ye,partsUsed:N,additionalServices:W.length>0?W:void 0,total:Ce,paymentStatus:me,paymentMethod:Fe,totalPaid:se>0?se:void 0,remainingAmount:F};b>0&&(c!=null&&c.id)&&(m!=null&&m.id)&&await updateVehicleKmAndMaintenance(c,m.id,b,N,W,j),p==="Tr·∫£ m√°y"&&F>0&&await createCustomerDebtIfNeeded(rt,F,Ce,se),A.success("C·∫≠p nh·∫≠t phi·∫øu s·ª≠a ch·ªØa th√†nh c√¥ng!")}else{const Oe=`${(r==null?void 0:r.work_order_prefix)||"SC"}-${Date.now()}`,rt=await Me({id:Oe,customerName:c.name,customerPhone:c.phone,vehicleModel:(m==null?void 0:m.model)||"",licensePlate:(m==null?void 0:m.licensePlate)||"",vehicleId:(m==null?void 0:m.id)||"",currentKm:b>0?b:void 0,issueDescription:j||"",technicianName:st,status:p,laborCost:B,discount:ye,partsUsed:N,additionalServices:W.length>0?W:void 0,total:Ce,branchId:H,paymentStatus:me,paymentMethod:Fe,depositAmount:Ne>0?Ne:void 0,additionalPayment:se>Ne?se-Ne:void 0,totalPaid:se>0?se:void 0,remainingAmount:F,creationDate:new Date().toISOString()}),n={id:Oe,customerName:c.name,customerPhone:c.phone,vehicleModel:(m==null?void 0:m.model)||"",licensePlate:(m==null?void 0:m.licensePlate)||"",vehicleId:(m==null?void 0:m.id)||"",currentKm:b>0?b:void 0,issueDescription:j||"",technicianName:st,status:p,laborCost:B,discount:ye,partsUsed:N,additionalServices:W.length>0?W:void 0,total:Ce,branchId:H,depositAmount:Ne>0?Ne:void 0,paymentStatus:me,paymentMethod:Fe,totalPaid:se>0?se:void 0,remainingAmount:F,creationDate:new Date().toISOString()};b>0&&(c!=null&&c.id)&&(m!=null&&m.id)&&await updateVehicleKmAndMaintenance(c,m.id,b,N,W,j),p==="Tr·∫£ m√°y"&&F>0&&await createCustomerDebtIfNeeded(n,F,Ce,se),A.success("T·∫°o phi·∫øu s·ª≠a ch·ªØa th√†nh c√¥ng!")}re(!1),ge(void 0)}catch(p){console.error("[handleMobileSave] Error:",p),A.error(`L·ªói: ${p.message||"Kh√¥ng th·ªÉ l∆∞u phi·∫øu s·ª≠a ch·ªØa"}`)}},ee=t=>{X(t),ke(""),xe(!0)},oe=async()=>{if(O){if(!ve.trim()){A.error("Vui l√≤ng nh·∫≠p l√Ω do h·ªßy");return}try{console.log("[handleConfirmRefund] Starting refund for order:",O.id),console.log("[handleConfirmRefund] Refund reason:",ve);const t=await Ie({orderId:O.id,refundReason:ve});if(console.log("[handleConfirmRefund] Refund result:",t),!t||t.error){console.error("[handleConfirmRefund] Refund failed:",t),A.error("Kh√¥ng th·ªÉ h·ªßy ƒë∆°n s·ª≠a ch·ªØa");return}if(t&&"refund_transaction_id"in t&&"refundAmount"in t&&t.refund_transaction_id&&t.refundAmount){const i=t.refundAmount;q(v=>[...v,{id:t.refund_transaction_id,type:"refund",category:"refund",amount:-i,date:new Date().toISOString(),description:`Ho√†n ti·ªÅn h·ªßy phi·∫øu #${(pe(O.id,r==null?void 0:r.work_order_prefix)||"").split("-").pop()} - ${ve}`,branchId:H,paymentSource:O.paymentMethod,reference:O.id}]),O.paymentMethod&&Y(v=>v.map(p=>p.id===O.paymentMethod?{...p,balance:{...p.balance,[H]:(p.balance[H]||0)-i}}:p))}M(i=>i.map(v=>v.id===O.id?{...v,refunded:!0,status:"ƒê√£ h·ªßy"}:v)),A.success("ƒê√£ h·ªßy ƒë∆°n s·ª≠a ch·ªØa th√†nh c√¥ng"),xe(!1),X(null),ke("")}catch(t){console.error("Error refunding work order:",t),A.error("L·ªói khi h·ªßy ƒë∆°n s·ª≠a ch·ªØa")}}},te=t=>{t&&(window.location.href=`tel:${t}`)},We=async t=>{if(confirm(`X√°c nh·∫≠n x√≥a phi·∫øu ${pe(t.id)}?`))try{await Te({id:t.id})}catch(i){console.error("Error deleting work order:",i)}};return window.innerWidth<768?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{workOrders:k||[],onCreateWorkOrder:()=>{ge(void 0),re(!0)},onEditWorkOrder:t=>{ge(t),re(!0)},onDeleteWorkOrder:We,onCallCustomer:te,onPrintWorkOrder:Qe,currentBranchId:H}),z&&e.jsx(Nt,{isOpen:z,onClose:()=>{re(!1),ge(void 0)},onSave:ze,workOrder:Q,customers:$,parts:ce||[],employees:G,currentBranchId:H,upsertCustomer:u}),Z&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200] p-2",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-full max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Xem tr∆∞·ªõc phi·∫øu"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:async()=>{try{A.info("ƒêang t·∫°o h√¨nh ·∫£nh...");const t=(await $t(async()=>{const{default:m}=await import("./html2canvas.esm-QH1iLAAe.js");return{default:m}},[])).default,i=document.getElementById("mobile-print-preview-content");if(!i){A.error("Kh√¥ng t√¨m th·∫•y n·ªôi dung phi·∫øu!");return}const v=await t(i,{scale:2,backgroundColor:"#ffffff",useCORS:!0,logging:!1}),p=await new Promise(m=>{v.toBlob(b=>m(b),"image/png",1)}),c=`Phieu_${pe(d.id,r==null?void 0:r.work_order_prefix)}.png`;if(navigator.share&&navigator.canShare){const b={files:[new File([p],c,{type:"image/png"})],title:`Phi·∫øu s·ª≠a ch·ªØa - ${pe(d.id,r==null?void 0:r.work_order_prefix)}`};if(navigator.canShare(b))await navigator.share(b),A.success("Chia s·∫ª th√†nh c√¥ng!");else{const j=URL.createObjectURL(p),S=document.createElement("a");S.href=j,S.download=c,S.click(),URL.revokeObjectURL(j),A.success("ƒê√£ t·∫£i h√¨nh ·∫£nh!")}}else{const m=URL.createObjectURL(p),b=document.createElement("a");b.href=m,b.download=c,b.click(),URL.revokeObjectURL(m),A.success("ƒê√£ t·∫£i h√¨nh ·∫£nh!")}}catch(t){console.error("Share failed:",t),A.error("Kh√¥ng th·ªÉ chia s·∫ª. Vui l√≤ng th·ª≠ l·∫°i!")}},className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-1.5 transition text-sm",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Chia s·∫ª"]}),e.jsxs("button",{onClick:Je,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-1.5 transition text-sm",children:[e.jsx(ot,{className:"w-4 h-4"}),"In"]}),e.jsx("button",{onClick:()=>{tt(!1),De(null)},className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 bg-slate-100 dark:bg-slate-700 rounded-lg","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-100 dark:bg-slate-900",children:e.jsxs("div",{id:"mobile-print-preview-content",className:"bg-white shadow-lg mx-auto",style:{maxWidth:"100%",color:"#000",padding:"4mm"},children:[e.jsxs("div",{style:{display:"flex",gap:"3mm",marginBottom:"3mm",borderBottom:"2px solid #3b82f6",paddingBottom:"2mm",alignItems:"flex-start"},children:[(r==null?void 0:r.logo_url)&&e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{src:r.logo_url,alt:"Logo",style:{height:"15mm",width:"auto",objectFit:"contain"},crossOrigin:"anonymous"})}),e.jsxs("div",{style:{flex:1,fontSize:"9pt"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"12pt",color:"#1e40af",marginBottom:"1mm"},children:(r==null?void 0:r.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000"},children:["üìç"," ",(r==null?void 0:r.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"]}),e.jsxs("div",{style:{color:"#000"},children:["üìû ",(r==null?void 0:r.phone)||"0947.747.907"]})]})]}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"3mm"},children:[e.jsx("h1",{style:{fontSize:"14pt",fontWeight:"bold",margin:"0",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"}),e.jsxs("div",{style:{fontSize:"9pt",color:"#666",marginTop:"1mm"},children:["M√£:"," ",pe(d.id,r==null?void 0:r.work_order_prefix)]}),e.jsx("div",{style:{fontSize:"8pt",color:"#666"},children:new Date(d.creationDate).toLocaleString("vi-VN")})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"2mm",borderRadius:"2mm",backgroundColor:"#f8fafc",fontSize:"9pt"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Kh√°ch h√†ng:"})," ",d.customerName," -"," ",d.customerPhone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Xe:"})," ",d.vehicleModel," -"," ",e.jsx("span",{style:{color:"#3b82f6"},children:d.licensePlate})]})]}),d.issueDescription&&e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"2mm",borderRadius:"2mm",fontSize:"9pt"},children:[e.jsx("strong",{children:"M√¥ t·∫£ s·ª± c·ªë:"})," ",d.issueDescription]}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"2mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 1mm 0",fontSize:"10pt"},children:"Ph·ª• t√πng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd",fontSize:"9pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"left"},children:"T√™n"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"center",width:"12%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"right",width:"28%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm"},children:t.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"center"},children:t.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"1.5mm",textAlign:"right",fontWeight:"bold"},children:x(t.price*t.quantity)})]},i))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"2mm",fontSize:"9pt"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 1mm 0",fontSize:"10pt"},children:"D·ªãch v·ª• b·ªï sung:"}),d.additionalServices.map((t,i)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:t.description}),e.jsx("span",{style:{fontWeight:"bold"},children:x(t.price*(t.quantity||1))})]},i))]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",borderRadius:"2mm",backgroundColor:"#f9f9f9",fontSize:"9pt"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{children:x(((Ae=d.partsUsed)==null?void 0:Ae.reduce((t,i)=>t+i.price*i.quantity,0))||0)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{children:x(d.laborCost||0)})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm"},children:[e.jsx("span",{children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{children:x(d.additionalServices.reduce((t,i)=>t+(i.price||0)*(i.quantity||1),0))})]}),d.discount!=null&&d.discount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm",color:"#e74c3c"},children:[e.jsx("span",{children:"Gi·∫£m gi√°:"}),e.jsxs("span",{children:["-",x(d.discount)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"2mm",borderTop:"2px solid #3b82f6",fontSize:"12pt",fontWeight:"bold",color:"#1e40af"},children:[e.jsx("span",{children:"T·ªîNG C·ªòNG:"}),e.jsx("span",{children:x(d.total||0)})]}),d.depositAmount!=null&&d.depositAmount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1mm",color:"#16a34a"},children:[e.jsx("span",{children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsx("span",{children:x(d.depositAmount)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",color:"#dc2626"},children:[e.jsx("span",{children:"C√≤n l·∫°i:"}),e.jsx("span",{children:x(d.remainingAmount||d.total-d.depositAmount)})]})]})]}),(r==null?void 0:r.bank_name)&&e.jsx("div",{style:{marginTop:"3mm",border:"1px solid #ddd",padding:"2mm",borderRadius:"2mm",backgroundColor:"#f0f9ff",fontSize:"9pt"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"3mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#1e40af"},children:"üè¶ Th√¥ng tin thanh to√°n"}),e.jsxs("div",{style:{color:"#000"},children:["Ng√¢n h√†ng: ",r.bank_name]}),r.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK:"," ",e.jsx("strong",{children:r.bank_account_number})]}),r.bank_account_holder&&e.jsxs("div",{style:{color:"#000"},children:["Ch·ªß TK: ",r.bank_account_holder]}),r.bank_branch&&e.jsxs("div",{style:{color:"#666",fontSize:"8pt"},children:["Chi nh√°nh: ",r.bank_branch]})]}),r.bank_qr_url&&e.jsx("div",{style:{flexShrink:0},children:e.jsx("img",{src:r.bank_qr_url,alt:"QR Banking",style:{height:"20mm",width:"20mm",objectFit:"contain"},crossOrigin:"anonymous"})})]})}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"8pt",textAlign:"center"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"2mm",fontSize:"9pt",textAlign:"right",color:"#666"},children:["KTV: ",d.technicianName||"Ch∆∞a ph√¢n c√¥ng"]})]})})]})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-[2fr,1fr]",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Phi·∫øu c·∫ßn x·ª≠ l√Ω"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:He}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Chi·∫øm ",Ee,"% c·ªßa ",Pe||0," phi·∫øu ƒëang m·ªü"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Ho√†n th√†nh"}),e.jsxs("p",{className:"text-xl font-semibold text-emerald-600 dark:text-emerald-400",children:[U,"%"]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[V.done," phi·∫øu ch·ªù giao"]})]})]}),e.jsx("div",{className:"mt-4 grid gap-2 sm:grid-cols-2 lg:grid-cols-4",children:Ye.map(t=>e.jsx("button",{onClick:()=>at(I===t.key?"all":t.key),className:`text-left rounded-lg border p-3 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/50 ${I===t.key?"border-blue-500 bg-blue-50/60 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700"}`,children:e.jsxs("div",{className:`rounded-lg bg-gradient-to-br ${t.accent} p-2`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:t.label}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:t.value})]}),e.jsx("span",{className:`h-2 w-2 rounded-full ${t.dot}`})]}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-500 dark:text-slate-400",children:t.subtitle})]})},t.key))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 p-3 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold uppercase tracking-wide text-white/80",children:"Doanh thu h√¥m nay"}),e.jsx("p",{className:"mt-1 text-xl font-semibold",children:x(V.todayRevenue)})]}),e.jsx(Vt,{className:"w-6 h-6 text-white/80"})]}),e.jsx("p",{className:"mt-1.5 text-[10px] text-white/80",children:"Bao g·ªìm c√°c phi·∫øu ƒë√£ thanh to√°n trong ng√†y"})]}),e.jsxs("div",{className:"rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold uppercase tracking-wide text-slate-400",children:"L·ª£i nhu·∫≠n h√¥m nay"}),e.jsx("p",{className:"mt-1 text-xl font-semibold text-slate-900 dark:text-slate-100",children:x(V.todayProfit)})]}),e.jsx(kt,{className:"w-6 h-6 text-blue-500"})]}),e.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Bi√™n l·ª£i nhu·∫≠n"}),e.jsxs("span",{className:"font-semibold text-emerald-600 dark:text-emerald-400",children:[Ke,"%"]})]})]})]})]}),e.jsxs("div",{className:"lg:hidden bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-slate-400",children:"Tr·∫°ng th√°i nhanh"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:we.map(t=>e.jsxs("button",{onClick:()=>at(I===t.key?"all":t.key),className:`inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm transition ${I===t.key?"border-blue-500 bg-blue-50 text-blue-600 dark:bg-blue-900/20":"border-slate-200 text-slate-600 hover:border-slate-300 dark:border-slate-700 dark:text-slate-300"}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${le[t.color]}`,children:t.count})]},t.key))})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[180px] max-w-[280px]",children:[e.jsx("input",{type:"text",placeholder:"M√£ phi·∫øu, t√™n kh√°ch...",value:h,onChange:t=>f(t.target.value),className:"w-full pl-8 pr-3 py-1.5 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-xs text-slate-900 dark:text-slate-100 placeholder-slate-400"}),e.jsx(ct,{className:"absolute left-2.5 top-2 w-3.5 h-3.5 text-slate-400","aria-hidden":"true"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"T·∫•t c·∫£ ng√†y"}),e.jsx("option",{children:"H√¥m nay"}),e.jsx("option",{children:"7 ng√†y qua"}),e.jsx("option",{children:"30 ng√†y qua"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"T·∫•t c·∫£ KTV"}),e.jsx("option",{children:"KTV 1"}),e.jsx("option",{children:"KTV 2"})]}),e.jsxs("select",{className:"px-2 py-1.5 text-xs bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg",children:[e.jsx("option",{children:"Thanh to√°n"}),e.jsx("option",{children:"ƒê√£ TT"}),e.jsx("option",{children:"Ch∆∞a TT"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>Se(!0),className:"px-2.5 py-1.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-xs font-medium flex items-center gap-1","aria-label":"M·ªü danh s√°ch m·∫´u s·ª≠a ch·ªØa",children:[e.jsx(dt,{className:"w-3.5 h-3.5"})," M·∫´u SC"]}),e.jsxs(Rt,{to:"/service-history",className:"px-2.5 py-1.5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg text-xs font-medium flex items-center gap-1 transition-colors",children:[e.jsx(Xt,{className:"w-3.5 h-3.5"})," L·ªãch s·ª≠ SC"]}),e.jsxs("button",{onClick:()=>{window.innerWidth<768?re(!0):Be()},className:"px-2.5 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-xs font-medium flex items-center gap-1","aria-label":"T·∫°o phi·∫øu s·ª≠a ch·ªØa m·ªõi",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"})," Th√™m Phi·∫øu"]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300 w-12",children:e.jsx("input",{type:"checkbox",className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Kh√°ch h√†ng"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"Thanh to√°n & tr·∫°ng th√°i"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-800",children:_e.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-slate-400",children:"Kh√¥ng c√≥ phi·∫øu s·ª≠a ch·ªØa n√†o."})}):_e.map(t=>{var ye,Ce,Ne,Fe,it,se;const i=((ye=t.partsUsed)==null?void 0:ye.reduce((F,me)=>F+me.quantity*me.price,0))||0,v=((Ce=t.additionalServices)==null?void 0:Ce.reduce((F,me)=>F+(me.price||0)*(me.quantity||1),0))||0,p=t.laborCost||0,c=t.total||0,m=c-(t.remainingAmount||0),b=c?Math.min(100,Math.round(m/c*100)):0,j=t.paymentStatus==="paid"?"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-300",S=((Ne=t.partsUsed)==null?void 0:Ne.slice(0,2))||[],N=(((Fe=t.partsUsed)==null?void 0:Fe.length)||0)-S.length,W=((it=t.additionalServices)==null?void 0:it.slice(0,2))||[],B=(((se=t.additionalServices)==null?void 0:se.length)||0)-W.length;return e.jsxs("tr",{onClick:()=>Be(t),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/30 cursor-pointer transition-colors",children:[e.jsx("td",{className:"px-2 py-4 align-top",onClick:F=>F.stopPropagation(),children:e.jsx("input",{type:"checkbox",className:"rounded"})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-mono font-bold text-blue-600 dark:text-blue-400 text-sm",children:pe(t.id,r==null?void 0:r.work_order_prefix)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsx("span",{children:"Ng√†y: "}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:wt(t.creationDate,!0)})]}),e.jsxs("div",{className:"text-xs text-cyan-600 dark:text-cyan-400",children:["NV: ",t.technicianName||"Ch∆∞a ph√¢n c√¥ng"]})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"font-semibold text-base text-slate-900 dark:text-slate-100",children:t.customerName}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:t.customerPhone}),e.jsxs("div",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:"font-medium",children:"Xe: "}),e.jsx("span",{children:t.vehicleModel||"N/A"}),t.licensePlate&&e.jsxs("span",{className:"ml-1",children:["- ",t.licensePlate]})]}),e.jsx("div",{className:"text-xs text-slate-500 italic mt-1",children:t.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-2",children:[S.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-0.5",children:"Ph·ª• t√πng"}),e.jsxs("div",{className:"space-y-0.5",children:[S.map((F,me)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:["‚Ä¢ ",F.partName," x",F.quantity]},me)),N>0&&e.jsxs("div",{className:"text-xs text-slate-400",children:["+",N," h·∫°ng m·ª•c kh√°c"]})]})]}),W.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-0.5",children:"Gia c√¥ng/ƒê·∫∑t h√†ng"}),e.jsxs("div",{className:"space-y-0.5",children:[W.map((F,me)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:["‚Ä¢ ",F.description," x",F.quantity||1]},me)),B>0&&e.jsxs("div",{className:"text-xs text-slate-400",children:["+",B," d·ªãch v·ª• kh√°c"]})]})]}),S.length===0&&W.length===0&&e.jsx("div",{className:"text-xs text-slate-500 italic",children:"Ch∆∞a c√≥ chi ti·∫øt"})]})}),e.jsx("td",{className:"px-4 py-4 align-top",children:e.jsxs("div",{className:"space-y-3 min-w-[220px]",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[p>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 dark:bg-slate-700 px-2 py-0.5 text-slate-600 dark:text-slate-200",children:["DV ",x(p)]}),i>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 dark:bg-slate-700 px-2 py-0.5 text-slate-600 dark:text-slate-200",children:["P/t√πng ",x(i)]}),v>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 dark:bg-slate-700 px-2 py-0.5 text-slate-600 dark:text-slate-200",children:["C√¥ng ",x(v)]}),t.discount&&t.discount>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-red-50 dark:bg-red-900/30 px-2 py-0.5 text-red-600 dark:text-red-400",children:["Gi·∫£m ",x(t.discount)]})]}),c>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:"ƒê√£ thu"}),e.jsxs("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:[x(Math.max(0,m))," /"," ",x(c)]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-100 dark:bg-slate-700",children:e.jsx("div",{className:`h-full rounded-full ${b>=100?"bg-emerald-500":"bg-blue-500"}`,style:{width:`${b}%`}})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-medium",children:[e.jsx(ls,{status:t.status}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${j}`,children:t.paymentStatus==="paid"?"ƒê√£ thanh to√°n":"Ch∆∞a thanh to√°n"}),t.remainingAmount!==void 0&&t.remainingAmount>0&&e.jsxs("span",{className:"text-red-500",children:["C√≤n ",x(t.remainingAmount)]})]})]})}),e.jsx("td",{className:"px-4 py-4 align-top",onClick:F=>F.stopPropagation(),children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsxs("div",{className:"relative service-row-menu",children:[e.jsx("button",{onClick:()=>_(J===t.id?null:t.id),"aria-haspopup":"menu","aria-expanded":J===t.id,className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 hover:text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:e.jsx(pt,{className:"w-4 h-4"})}),J===t.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 shadow-xl z-10",children:[e.jsxs("button",{onClick:()=>{Qe(t),_(null)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-slate-600 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-slate-700",children:[e.jsx(ot,{className:"w-4 h-4"})," In phi·∫øu"]}),e.jsxs("button",{onClick:()=>{te(t.customerPhone||""),_(null)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-slate-600 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-slate-700",children:[e.jsx(Qt,{className:"w-4 h-4"})," G·ªçi kh√°ch"]}),!t.refunded&&e.jsx("button",{onClick:()=>{ee(t),_(null)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:"H·ªßy/Ho√†n ti·ªÅn"})]})]})})})]},t.id)})})]})})}),e.jsx(ss,{isOpen:de,onClose:()=>Se(!1),onApplyTemplate:t=>{const i={id:`WO-${Date.now()}`,customerName:"",customerPhone:"",vehicleModel:"",issueDescription:t.description,status:"Ti·∫øp nh·∫≠n",creationDate:new Date().toISOString(),estimatedCompletion:new Date(Date.now()+t.duration*6e4).toISOString(),assignedTechnician:"",laborCost:t.laborCost,partsUsed:t.parts.map(v=>({partId:"",partName:v.name,quantity:v.quantity,unitPrice:v.price})),notes:"",total:0};ge(i),Se(!1),be(!0)},parts:ce||[],currentBranchId:H}),ie&&Q&&e.jsx(as,{order:Q,onClose:()=>{be(!1),ge(void 0)},onSave:()=>{be(!1),ge(void 0)},parts:g,partsLoading:C,customers:$,employees:G,upsertCustomer:u,setCashTransactions:q,setPaymentSources:Y,paymentSources:Re,currentBranchId:H,storeSettings:r}),e.jsx(Nt,{isOpen:z,onClose:()=>{re(!1),ge(void 0)},onSave:ze,workOrder:Q,customers:$,parts:ce||[],employees:G||[],currentBranchId:H}),Z&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Xem tr∆∞·ªõc phi·∫øu in"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Je,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition",children:[e.jsx(ot,{className:"w-4 h-4"}),"In phi·∫øu"]}),e.jsx("button",{onClick:()=>{tt(!1),De(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{className:"bg-white shadow-lg mx-auto",style:{width:"148mm",minHeight:"210mm",color:"#000"},children:e.jsxs("div",{style:{padding:"10mm"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"3mm",marginBottom:"4mm",alignItems:"start",borderBottom:"2px solid #3b82f6",paddingBottom:"3mm"},children:[(r==null?void 0:r.logo_url)&&e.jsx("div",{style:{marginRight:"4mm"},children:e.jsx("img",{src:r.logo_url,alt:"Logo",style:{height:"18mm",width:"auto",objectFit:"contain"}})}),e.jsxs("div",{style:{fontSize:"8.5pt",lineHeight:"1.4",flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",marginBottom:"1mm",color:"#1e40af"},children:(r==null?void 0:r.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000"},children:["üìç"," ",(r==null?void 0:r.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"]}),e.jsxs("div",{style:{color:"#000"},children:["üìû ",(r==null?void 0:r.phone)||"0947.747.907"]}),(r==null?void 0:r.email)&&e.jsxs("div",{style:{color:"#000"},children:["‚úâÔ∏è ",r.email]})]}),e.jsx("div",{style:{fontSize:"8pt",lineHeight:"1.4",textAlign:"right"},children:(r==null?void 0:r.bank_name)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#000"},children:["üè¶ ",r.bank_name]}),r.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK: ",r.bank_account_number]}),r.bank_account_holder&&e.jsx("div",{style:{color:"#000",fontSize:"7.5pt"},children:r.bank_account_holder}),r.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm",display:"inline-block"},children:e.jsx("img",{src:r.bank_qr_url,alt:"QR Banking",style:{height:"15mm",width:"15mm",objectFit:"contain"}})})]})})]}),e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"2mm"},children:e.jsx("h1",{style:{fontSize:"16pt",fontWeight:"bold",margin:"0",textTransform:"uppercase",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9pt",color:"#666"},children:[e.jsx("div",{children:new Date(d.creationDate).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontWeight:"bold"},children:["M√£:"," ",pe(d.id,r==null?void 0:r.work_order_prefix)]})]})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"3mm",marginBottom:"3mm",borderRadius:"2mm",backgroundColor:"#f8fafc",color:"#000",fontSize:"9pt"},children:[e.jsxs("div",{style:{display:"flex",gap:"4mm",marginBottom:"1.5mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Kh√°ch h√†ng:"})," ",d.customerName]}),e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"SƒêT:"})," ",d.customerPhone]})]}),e.jsxs("div",{style:{display:"flex",gap:"4mm"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Lo·∫°i xe:"})," ",d.vehicleModel]}),e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bi·ªÉn s·ªë:"})," ",d.licensePlate]})]})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",color:"#000"},children:e.jsxs("div",{style:{display:"flex",gap:"3mm"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:"20%",flexShrink:0},children:"M√¥ t·∫£ s·ª± c·ªë:"}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap"},children:d.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"4mm",color:"#000"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"Ph·ª• t√πng s·ª≠ d·ª•ng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"left",fontSize:"10pt"},children:"T√™n ph·ª• t√πng"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt",width:"15%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"ƒê∆°n gi√°"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",fontSize:"10pt"},children:t.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt"},children:t.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt"},children:x(t.price)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",fontWeight:"bold"},children:x(t.price*t.quantity)})]},i))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"4mm",color:"#000"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt",color:"#000"},children:"D·ªãch v·ª• b·ªï sung:"}),e.jsx("ul",{style:{margin:"0",paddingLeft:"5mm",color:"#000"},children:d.additionalServices.map((t,i)=>e.jsxs("li",{style:{marginBottom:"1mm"},children:[t.description," -"," ",x(t.price)," x"," ",t.quantity]},i))})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",backgroundColor:"#f9f9f9",color:"#000"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0",color:"#000"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:x((($e=d.partsUsed)==null?void 0:$e.reduce((t,i)=>t+i.price*i.quantity,0))||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:x(d.laborCost||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:x(((Ue=d.additionalServices)==null?void 0:Ue.reduce((t,i)=>t+(i.price||0)*(i.quantity||1),0))||0)})]}),d.discount!=null&&d.discount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:"Gi·∫£m gi√°:"}),e.jsxs("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:["-",x(d.discount)]})]}),e.jsxs("tr",{style:{borderTop:"2px solid #333"},children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"12pt"},children:"T·ªîNG C·ªòNG:"}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"12pt",fontWeight:"bold",color:"#2563eb"},children:[x(d.total)," ‚Ç´"]})]}),d.totalPaid!=null&&d.totalPaid>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:"ƒê√£ thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:x(d.totalPaid)})]}),d.remainingAmount!=null&&d.remainingAmount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",fontSize:"11pt",color:"#dc2626"},children:"C√≤n l·∫°i:"}),e.jsx("td",{style:{textAlign:"right",fontSize:"11pt",fontWeight:"bold",color:"#dc2626"},children:x(d.remainingAmount)})]}),d.paymentMethod&&e.jsxs("tr",{children:[e.jsx("td",{style:{paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:"H√¨nh th·ª©c thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:d.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":d.paymentMethod==="bank"?"Chuy·ªÉn kho·∫£n":d.paymentMethod})]})]})})}),e.jsx("div",{style:{marginTop:"8mm",paddingTop:"4mm",borderTop:"1px dashed #999",color:"#000"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10pt"},children:[e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0",color:"#000"},children:"Kh√°ch h√†ng"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0",color:"#000"},children:"Nh√¢n vi√™n"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:d.technicianName||"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]})]})}),e.jsxs("div",{style:{marginTop:"4mm",padding:"3mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"9pt",textAlign:"center",color:"#000"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic",color:"#000"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic",color:"#000"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",fontSize:"8pt",color:"#666",borderTop:"1px solid #e5e7eb",lineHeight:"1.4"},children:[e.jsx("p",{style:{margin:"0 0 1mm 0",fontWeight:"bold"},children:"Ch√≠nh s√°ch b·∫£o h√†nh:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"5mm",listStyleType:"disc"},children:[e.jsx("li",{children:"B·∫£o h√†nh √°p d·ª•ng cho ph·ª• t√πng ch√≠nh h√£ng v√† l·ªói k·ªπ thu·∫≠t do th·ª£"}),e.jsx("li",{children:"Kh√¥ng b·∫£o h√†nh ƒë·ªëi v·ªõi va ch·∫°m, ng√£ xe, ng·∫≠p n∆∞·ªõc sau khi nh·∫≠n xe"}),e.jsx("li",{children:"Mang theo phi·∫øu n√†y khi ƒë·∫øn b·∫£o h√†nh. Li√™n h·ªá hotline n·∫øu c√≥ th·∫Øc m·∫Øc"})]})]})]})})})]})}),d&&e.jsxs("div",{id:"work-order-receipt",className:"hidden print:block",style:{width:"148mm",margin:"0 auto",padding:"10mm",fontFamily:"Arial, sans-serif",fontSize:"11pt",color:"#000",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",borderBottom:"2px solid #3b82f6",paddingBottom:"3mm",marginBottom:"4mm"},children:[(r==null?void 0:r.logo_url)&&e.jsx("div",{style:{marginRight:"4mm"},children:e.jsx("img",{src:r.logo_url,alt:"Logo",style:{height:"18mm",width:"auto",objectFit:"contain"}})}),e.jsxs("div",{style:{fontSize:"8.5pt",lineHeight:"1.4",flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",marginBottom:"1mm",color:"#1e40af"},children:(r==null?void 0:r.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsxs("div",{style:{color:"#000"},children:["üìç"," ",(r==null?void 0:r.address)||"·∫§p Ph√∫ L·ª£i B, X√£ Long Ph√∫ Thu·∫≠n, ƒê√¥ng Th√°p"]}),e.jsxs("div",{style:{color:"#000"},children:["üìû ",(r==null?void 0:r.phone)||"0947.747.907"]}),(r==null?void 0:r.email)&&e.jsxs("div",{style:{color:"#000"},children:["‚úâÔ∏è ",r.email]})]}),e.jsx("div",{style:{fontSize:"8pt",lineHeight:"1.4",textAlign:"right"},children:(r==null?void 0:r.bank_name)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm",color:"#000"},children:["üè¶ ",r.bank_name]}),r.bank_account_number&&e.jsxs("div",{style:{color:"#000"},children:["STK: ",r.bank_account_number]}),r.bank_account_holder&&e.jsx("div",{style:{color:"#000",fontSize:"7.5pt"},children:r.bank_account_holder}),r.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm",display:"inline-block"},children:e.jsx("img",{src:r.bank_qr_url,alt:"QR Banking",style:{height:"15mm",width:"15mm",objectFit:"contain"}})})]})})]}),e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"2mm"},children:e.jsx("h1",{style:{fontSize:"16pt",fontWeight:"bold",margin:"0",textTransform:"uppercase",color:"#1e40af"},children:"PHI·∫æU D·ªäCH V·ª§ S·ª¨A CH·ªÆA"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9pt",color:"#666"},children:[e.jsx("div",{children:new Date(d.creationDate).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontWeight:"bold"},children:["M√£:"," ",pe(d.id,r==null?void 0:r.work_order_prefix)]})]})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",width:"20%",paddingBottom:"2mm"},children:"Kh√°ch h√†ng:"}),e.jsx("td",{style:{paddingBottom:"2mm",width:"30%"},children:d.customerName}),e.jsx("td",{style:{fontWeight:"bold",width:"15%",paddingBottom:"2mm",paddingLeft:"3mm"},children:"Thanh L·ªôc"}),e.jsx("td",{style:{paddingBottom:"2mm"},children:d.customerPhone})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm"},children:"Lo·∫°i xe:"}),e.jsx("td",{style:{paddingBottom:"2mm"},colSpan:3,children:d.vehicleModel})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold"},children:"Bi·ªÉn s·ªë:"}),e.jsx("td",{colSpan:3,children:d.licensePlate})]})]})})}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm"},children:e.jsxs("div",{style:{display:"flex",gap:"3mm"},children:[e.jsx("div",{style:{fontWeight:"bold",minWidth:"20%",flexShrink:0},children:"M√¥ t·∫£ s·ª± c·ªë:"}),e.jsx("div",{style:{flex:1,whiteSpace:"pre-wrap"},children:d.issueDescription||"Kh√¥ng c√≥ m√¥ t·∫£"})]})}),d.partsUsed&&d.partsUsed.length>0&&e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"Ph·ª• t√πng s·ª≠ d·ª•ng:"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ddd"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"left",fontSize:"10pt"},children:"T√™n ph·ª• t√πng"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt",width:"15%"},children:"SL"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"ƒê∆°n gi√°"}),e.jsx("th",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",width:"25%"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:d.partsUsed.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",fontSize:"10pt"},children:t.partName}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"center",fontSize:"10pt"},children:t.quantity}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt"},children:x(t.price)}),e.jsx("td",{style:{border:"1px solid #ddd",padding:"2mm",textAlign:"right",fontSize:"10pt",fontWeight:"bold"},children:x(t.price*t.quantity)})]},i))})]})]}),d.additionalServices&&d.additionalServices.length>0&&e.jsxs("div",{style:{marginBottom:"4mm"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 2mm 0",fontSize:"11pt"},children:"D·ªãch v·ª• b·ªï sung:"}),e.jsx("ul",{style:{margin:"0",paddingLeft:"5mm"},children:d.additionalServices.map((t,i)=>e.jsxs("li",{style:{marginBottom:"1mm"},children:[t.description," - ",x(t.price)," x"," ",t.quantity]},i))})]}),e.jsx("div",{style:{border:"1px solid #ddd",padding:"4mm",marginBottom:"4mm",borderRadius:"2mm",backgroundColor:"#f9f9f9"},children:e.jsx("table",{style:{width:"100%",borderSpacing:"0"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:x(((Le=d.partsUsed)==null?void 0:Le.reduce((t,i)=>t+i.price*i.quantity,0))||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt"},children:"Gi√° c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt"},children:x(((Ve=d.additionalServices)==null?void 0:Ve.reduce((t,i)=>t+(i.price||0)*(i.quantity||1),0))||0)})]}),d.discount!=null&&d.discount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:"Gi·∫£m gi√°:"}),e.jsxs("td",{style:{textAlign:"right",paddingBottom:"2mm",fontSize:"10pt",color:"#e74c3c"},children:["-",x(d.discount)]})]}),e.jsxs("tr",{style:{borderTop:"2px solid #333"},children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"12pt"},children:"T·ªîNG C·ªòNG:"}),e.jsxs("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"12pt",fontWeight:"bold",color:"#2563eb"},children:[x(d.total)," ‚Ç´"]})]}),d.totalPaid!=null&&d.totalPaid>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:"ƒê√£ thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"10pt",color:"#16a34a"},children:x(d.totalPaid)})]}),d.remainingAmount!=null&&d.remainingAmount>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"bold",fontSize:"11pt",color:"#dc2626"},children:"C√≤n l·∫°i:"}),e.jsx("td",{style:{textAlign:"right",fontSize:"11pt",fontWeight:"bold",color:"#dc2626"},children:x(d.remainingAmount)})]}),d.paymentMethod&&e.jsxs("tr",{children:[e.jsx("td",{style:{paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:"H√¨nh th·ª©c thanh to√°n:"}),e.jsx("td",{style:{textAlign:"right",paddingTop:"2mm",fontSize:"9pt",color:"#666"},children:d.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":d.paymentMethod==="bank"?"Chuy·ªÉn kho·∫£n":d.paymentMethod})]})]})})}),e.jsx("div",{style:{marginTop:"8mm",paddingTop:"4mm",borderTop:"1px dashed #999"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10pt"},children:[e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0"},children:"Kh√°ch h√†ng"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"45%"},children:[e.jsx("p",{style:{fontWeight:"bold",margin:"0 0 10mm 0"},children:"Nh√¢n vi√™n"}),e.jsx("p",{style:{margin:"0",fontSize:"9pt",color:"#666"},children:d.technicianName||"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]})]})}),e.jsxs("div",{style:{marginTop:"4mm",padding:"3mm",backgroundColor:"#fff9e6",border:"1px solid #ffd700",borderRadius:"2mm",fontSize:"9pt",textAlign:"center"},children:[e.jsx("p",{style:{margin:"0",fontStyle:"italic"},children:"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!"}),e.jsx("p",{style:{margin:"1mm 0 0 0",fontStyle:"italic"},children:"Vui l√≤ng gi·ªØ phi·∫øu n√†y ƒë·ªÉ ƒë·ªëi chi·∫øu khi nh·∫≠n xe"})]}),e.jsxs("div",{style:{marginTop:"3mm",padding:"2mm",fontSize:"8pt",color:"#666",borderTop:"1px solid #e5e7eb",lineHeight:"1.4"},children:[e.jsx("p",{style:{margin:"0 0 1mm 0",fontWeight:"bold"},children:"Ch√≠nh s√°ch b·∫£o h√†nh:"}),e.jsxs("ul",{style:{margin:"0",paddingLeft:"5mm",listStyleType:"disc"},children:[e.jsx("li",{children:"B·∫£o h√†nh √°p d·ª•ng cho ph·ª• t√πng ch√≠nh h√£ng v√† l·ªói k·ªπ thu·∫≠t do th·ª£"}),e.jsx("li",{children:"Kh√¥ng b·∫£o h√†nh ƒë·ªëi v·ªõi va ch·∫°m, ng√£ xe, ng·∫≠p n∆∞·ªõc sau khi nh·∫≠n xe"}),e.jsx("li",{children:"Mang theo phi·∫øu n√†y khi ƒë·∫øn b·∫£o h√†nh. Li√™n h·ªá hotline n·∫øu c√≥ th·∫Øc m·∫Øc"})]})]})]}),je&&O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-md",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"X√°c nh·∫≠n h·ªßy phi·∫øu"}),e.jsx("button",{onClick:()=>{xe(!1),X(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:"‚úï"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"C·∫£nh b√°o:"})," H√†nh ƒë·ªông n√†y s·∫Ω:"]}),e.jsxs("ul",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-300 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Ho√†n tr·∫£ t·ªìn kho c√°c ph·ª• t√πng ƒë√£ s·ª≠ d·ª•ng"}),e.jsxs("li",{children:["Ho√†n ti·ªÅn ",x(O.totalPaid||0)," ","cho kh√°ch"]}),e.jsx("li",{children:'ƒê√°nh d·∫•u phi·∫øu l√† "ƒê√£ h·ªßy"'})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["L√Ω do h·ªßy phi·∫øu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:ve,onChange:t=>ke(t.target.value),placeholder:"Vd: Kh√°ch h√†ng kh√¥ng ƒë·ªìng √Ω chi ph√≠, s·ª≠a nh·∫ßm xe...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none",rows:3})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Phi·∫øu:"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:["#",pe(O.id,r==null?void 0:r.work_order_prefix).split("-").pop()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Kh√°ch h√†ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:O.customerName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ph·ª• t√πng:"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:[((a=O.partsUsed)==null?void 0:a.length)||0," m√≥n"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-slate-200 dark:border-slate-600 pt-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"S·ªë ti·ªÅn ho√†n:"}),e.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:x(O.totalPaid||0)})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 px-6 py-4 flex justify-end gap-3 rounded-b-xl",children:[e.jsx("button",{onClick:()=>{xe(!1),X(null)},className:"px-4 py-2 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg font-medium",children:"H·ªßy b·ªè"}),e.jsx("button",{onClick:oe,disabled:!ve.trim(),className:"px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-300 dark:disabled:bg-red-900 text-white rounded-lg font-medium disabled:cursor-not-allowed",children:"X√°c nh·∫≠n h·ªßy phi·∫øu"})]})]})})]})}const as=({order:s,onClose:T,onSave:L,parts:u,partsLoading:q,customers:Y,employees:Re,upsertCustomer:H,setCashTransactions:ae,setPaymentSources:M,paymentSources:ce,currentBranchId:C,storeSettings:P})=>{const he=["Honda Wave RSX","Honda Wave Alpha","Honda Blade","Honda Future","Honda Winner X","Honda Vision","Honda Air Blade","Honda SH Mode","Honda SH 125i","Honda SH 150i","Honda SH 160i","Honda SH 350i","Honda Vario","Honda Lead","Honda PCX","Honda ADV","Yamaha Exciter","Yamaha Sirius","Yamaha Jupiter","Yamaha Grande","Yamaha Janus","Yamaha FreeGo","Yamaha Latte","Yamaha NVX","Yamaha XSR","Suzuki Raider","Suzuki Axelo","Suzuki Satria","Suzuki GD110","Suzuki Impulse","Suzuki Address","Suzuki Revo","SYM Elite","SYM Galaxy","SYM Star","SYM Attila","SYM Angela","SYM Passing","Piaggio Liberty","Piaggio Medley","Vespa Sprint","Vespa Primavera","Vespa GTS","VinFast Klara","VinFast Evo200","VinFast Ludo","VinFast Impes","VinFast Theon","Kh√°c"],{profile:y}=bt(),{mutateAsync:ue}=St(),{mutateAsync:K}=Pt(),[l,g]=o.useState(()=>s!=null&&s.id?s:{id:(s==null?void 0:s.id)||"",customerName:(s==null?void 0:s.customerName)||"",customerPhone:(s==null?void 0:s.customerPhone)||"",vehicleModel:(s==null?void 0:s.vehicleModel)||"",licensePlate:(s==null?void 0:s.licensePlate)||"",vehicleId:(s==null?void 0:s.vehicleId)||"",issueDescription:(s==null?void 0:s.issueDescription)||"",technicianName:(s==null?void 0:s.technicianName)||"",status:(s==null?void 0:s.status)||"Ti·∫øp nh·∫≠n",laborCost:(s==null?void 0:s.laborCost)||0,discount:(s==null?void 0:s.discount)||0,partsUsed:(s==null?void 0:s.partsUsed)||[],total:(s==null?void 0:s.total)||0,branchId:(s==null?void 0:s.branchId)||C,paymentStatus:(s==null?void 0:s.paymentStatus)||"unpaid",creationDate:(s==null?void 0:s.creationDate)||new Date().toISOString()}),[$,G]=o.useState(""),[k,ie]=o.useState([]),[be,z]=o.useState(!1),[re,de]=o.useState(0),[Se,Q]=o.useState(!1),[ge,h]=o.useState(!1),[f,D]=o.useState(0),[fe,I]=o.useState(!1),[at,J]=o.useState(!1),[_,d]=o.useState({name:"",phone:"",vehicleModel:"",licensePlate:""}),[De,Z]=o.useState(""),[tt,r]=o.useState(!1),[qe,O]=o.useState(!1),[X,je]=o.useState({model:"",licensePlate:""}),xe=Y.find(a=>a.phone===l.customerPhone),ve=(xe==null?void 0:xe.vehicles)||[];ve.length>1;const[ke,_e]=o.useState("amount"),[V,Pe]=o.useState(0),[He,Ee]=o.useState(!1),[U,Ke]=o.useState([]),[le,we]=o.useState({description:"",quantity:1,price:0,costPrice:0});o.useEffect(()=>{s!=null&&s.partsUsed?ie(s.partsUsed):ie([]),s!=null&&s.customerName?Z(s.customerName):Z(""),s!=null&&s.additionalServices?Ke(s.additionalServices):Ke([]),s!=null&&s.depositAmount?(D(s.depositAmount),I(!0)):(D(0),I(!1)),s!=null&&s.additionalPayment?(de(s.additionalPayment),Q(!0)):(de(0),Q(!1)),_e("amount"),Pe(0)},[s]);const Ye=o.useMemo(()=>{if(!De.trim())return Y.slice(0,10);const a=De.toLowerCase();return Y.filter(t=>{var i;return t.name.toLowerCase().includes(a)||((i=t.phone)==null?void 0:i.toLowerCase().includes(a))||t.vehicles&&t.vehicles.some(v=>{var p;return(p=v.licensePlate)==null?void 0:p.toLowerCase().includes(a)})})},[Y,De]);o.useEffect(()=>{const a=t=>{const i=t.target;i.closest(".customer-search-container")||r(!1),i.closest(".vehicle-search-container")||h(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const Be=a=>{g({...l,vehicleId:a.id,vehicleModel:a.model,licensePlate:a.licensePlate}),h(!1)},Qe=()=>{if(!xe)return;if(!X.model.trim()||!X.licensePlate.trim()){A.error("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß lo·∫°i xe v√† bi·ªÉn s·ªë");return}const a=`VEH-${Date.now()}`,t=xe.vehicles||[],i=[...t,{id:a,model:X.model.trim(),licensePlate:X.licensePlate.trim(),isPrimary:t.length===0}];H({...xe,vehicles:i}),g({...l,vehicleId:a,vehicleModel:X.model.trim(),licensePlate:X.licensePlate.trim()}),je({model:"",licensePlate:""}),O(!1),A.success("ƒê√£ th√™m xe m·ªõi")},Je=k.reduce((a,t)=>a+(t.price||0)*(t.quantity||0),0),Ie=U.reduce((a,t)=>a+(t.price||0)*(t.quantity||0),0),Te=(l.laborCost||0)+Je+Ie,Me=l.discount||0,ne=Math.max(0,Te-Me);console.log("Tinh toan:",{laborCost:l.laborCost,partsTotal:Je,servicesTotal:Ie,subtotal:Te,discount:Me,total:ne});const ze=f||0,ee=Se?re:0,oe=ze+ee,te=Math.max(0,ne-oe),We=Tt(),Ze=async(a,t,i,v)=>{var p;if(!(t<=0)){console.log("[createCustomerDebtIfNeeded] CALLED with:",{workOrderId:a.id,totalAmount:i,paidAmount:v,remainingAmount:t,customerName:a.customerName,timestamp:new Date().toISOString()});try{const c=a.customerPhone||a.id||`CUST-ANON-${Date.now()}`,m=((p=a.customerName)==null?void 0:p.trim())||a.customerPhone||"Kh√°ch v√£ng lai",b=pe(a.id,P==null?void 0:P.work_order_prefix).split("-").pop()||"";let j=`${a.vehicleModel||"Xe"} (Phi·∫øu s·ª≠a ch·ªØa #${b})`;a.issueDescription&&(j+=`
V·∫•n ƒë·ªÅ: ${a.issueDescription}`),a.partsUsed&&a.partsUsed.length>0&&(j+=`

Ph·ª• t√πng ƒë√£ thay:`,a.partsUsed.forEach(B=>{j+=`
  ‚Ä¢ ${B.quantity} x ${B.partName} - ${x(B.price*B.quantity)}`})),a.additionalServices&&a.additionalServices.length>0&&(j+=`

D·ªãch v·ª•:`,a.additionalServices.forEach(B=>{j+=`
  ‚Ä¢ ${B.quantity} x ${B.description} - ${x(B.price*B.quantity)}`})),a.laborCost&&a.laborCost>0&&(j+=`

C√¥ng lao ƒë·ªông: ${x(a.laborCost)}`),a.discount&&a.discount>0&&(j+=`
Gi·∫£m gi√°: -${x(a.discount)}`);const S=(y==null?void 0:y.full_name)||"N/A";j+=`

NV: ${S}`,a.technicianName&&(j+=`
NVK·ªπ thu·∫≠t: ${a.technicianName}`);const N={customerId:c,customerName:m,phone:a.customerPhone||null,licensePlate:a.licensePlate||null,description:j,totalAmount:i,paidAmount:v,remainingAmount:t,createdDate:new Date().toISOString().split("T")[0],branchId:C,workOrderId:a.id};console.log("[ServiceManager] createCustomerDebt payload:",N);const W=await We.mutateAsync(N);console.log("[ServiceManager] createCustomerDebt result:",W),A.success(`ƒê√£ t·∫°o/c·∫≠p nh·∫≠t c√¥ng n·ª£ ${t.toLocaleString()}ƒë (M√£: ${(W==null?void 0:W.id)||"N/A"})`)}catch(c){console.error("Error creating/updating customer debt:",c),A.error("Kh√¥ng th·ªÉ t·∫°o/c·∫≠p nh·∫≠t c√¥ng n·ª£ t·ª± ƒë·ªông")}}},Ae=async()=>{var v,p;if(!((v=l.customerName)!=null&&v.trim())){A.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((p=l.customerPhone)!=null&&p.trim())){A.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}if(!/^[0-9]{10,11}$/.test(l.customerPhone.trim())){A.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (c·∫ßn 10-11 ch·ªØ s·ªë)");return}if(l.customerName&&l.customerPhone&&!Y.find(m=>m.phone===l.customerPhone)){const m=Y.find(S=>S.phone===l.customerPhone&&l.customerName&&S.name.toLowerCase()!==l.customerName.toLowerCase());m&&A.warning(`SƒêT ƒë√£ t·ªìn t·∫°i cho kh√°ch "${m.name}". C√≥ th·ªÉ tr√πng l·∫∑p?`);const b=`VEH-${Date.now()}`,j=[];(l.vehicleModel||l.licensePlate)&&j.push({id:b,model:l.vehicleModel||"",licensePlate:l.licensePlate||"",isPrimary:!0}),H({id:`CUST-${Date.now()}`,name:l.customerName,phone:l.customerPhone,vehicles:j.length>0?j:void 0,vehicleModel:l.vehicleModel,licensePlate:l.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()})}let t="unpaid";const i=((s==null?void 0:s.depositAmount)||0)+((s==null?void 0:s.additionalPayment)||0);i>=ne?t="paid":i>0&&(t="partial");try{const m={id:(s==null?void 0:s.id)||`${(P==null?void 0:P.work_order_prefix)||"SC"}-${Date.now()}`,customername:l.customerName||"",customerphone:l.customerPhone||"",vehicleid:l.vehicleId,vehiclemodel:l.vehicleModel||"",licenseplate:l.licensePlate||"",issuedescription:l.issueDescription||"",technicianname:l.technicianName||"",status:l.status||"Ti·∫øp nh·∫≠n",laborcost:l.laborCost||0,discount:Me,partsused:k,additionalservices:U.length>0?U:void 0,total:ne,branchid:C,paymentstatus:t,paymentmethod:l.paymentMethod||null,depositamount:(s==null?void 0:s.depositAmount)||null,totalpaid:i>0?i:null,remainingamount:ne-i,creationdate:(s==null?void 0:s.creationDate)||new Date().toISOString()};if(s!=null&&s.id){const{data:b,error:j}=await Xe.from("work_orders").update(m).eq("id",s.id).select();if(j)throw console.error("[UPDATE ERROR]",j),j;console.log("[UPDATE SUCCESS]",b)}else{console.log("[INSERT] Attempting to insert:",m);const{data:b,error:j}=await Xe.from("work_orders").insert(m).select();if(j)throw console.error("[INSERT ERROR]",j),console.error("[INSERT ERROR DETAILS]",JSON.stringify(j,null,2)),j;console.log("[INSERT SUCCESS]",b)}L(m),A.success(s!=null&&s.id?"ƒê√£ c·∫≠p nh·∫≠t phi·∫øu":"ƒê√£ l∆∞u phi·∫øu th√†nh c√¥ng"),T()}catch(c){console.error("Error saving work order:",c),A.error("L·ªói khi l∆∞u phi·∫øu: "+(c.message||c.hint||"Kh√¥ng x√°c ƒë·ªãnh"))}},$e=async()=>{var a,t;if(He){console.log("[handleSave] Already submitting, skipping...");return}Ee(!0);try{if(!((a=l.customerName)!=null&&a.trim())){A.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}if(!((t=l.customerPhone)!=null&&t.trim())){A.error("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i");return}if(!/^[0-9]{10,11}$/.test(l.customerPhone.trim())){A.error("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (c·∫ßn 10-11 ch·ªØ s·ªë)");return}if(ne<=0){A.error("T·ªïng ti·ªÅn ph·∫£i l·ªõn h∆°n 0");return}if(l.customerName&&l.customerPhone&&!Y.find(c=>c.phone===l.customerPhone)){const c=Y.find(j=>j.phone===l.customerPhone&&l.customerName&&j.name.toLowerCase()!==l.customerName.toLowerCase());c&&A.warning(`SƒêT ƒë√£ t·ªìn t·∫°i cho kh√°ch "${c.name}". C√≥ th·ªÉ tr√πng l·∫∑p?`);const m=`VEH-${Date.now()}`,b=[];(l.vehicleModel||l.licensePlate)&&b.push({id:m,model:l.vehicleModel||"",licensePlate:l.licensePlate||"",isPrimary:!0}),H({id:`CUST-${Date.now()}`,name:l.customerName,phone:l.customerPhone,vehicles:b.length>0?b:void 0,vehicleModel:l.vehicleModel,licensePlate:l.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()})}let v="unpaid";if(oe>=ne?v="paid":oe>0&&(v="partial"),!(s!=null&&s.id)&&(k.length>0||U.length>0||f>0)){try{const p=`${(P==null?void 0:P.work_order_prefix)||"SC"}-${Date.now()}`,c=await ue({id:p,customerName:l.customerName||"",customerPhone:l.customerPhone||"",vehicleModel:l.vehicleModel||"",licensePlate:l.licensePlate||"",issueDescription:l.issueDescription||"",technicianName:l.technicianName||"",status:l.status||"Ti·∫øp nh·∫≠n",laborCost:l.laborCost||0,discount:Me,partsUsed:k,additionalServices:U.length>0?U:void 0,total:ne,branchId:C,paymentStatus:v,paymentMethod:l.paymentMethod,depositAmount:f>0?f:void 0,additionalPayment:ee>0?ee:void 0,totalPaid:oe>0?oe:void 0,remainingAmount:te,creationDate:new Date().toISOString()}),m=c==null?void 0:c.depositTransactionId,b=c==null?void 0:c.paymentTransactionId,j={id:p,customerName:l.customerName||"",customerPhone:l.customerPhone||"",vehicleModel:l.vehicleModel||"",licensePlate:l.licensePlate||"",issueDescription:l.issueDescription||"",technicianName:l.technicianName||"",status:l.status||"Ti·∫øp nh·∫≠n",laborCost:l.laborCost||0,discount:Me,partsUsed:k,additionalServices:U.length>0?U:void 0,total:ne,branchId:C,depositAmount:f>0?f:void 0,depositDate:f>0?new Date().toISOString():void 0,depositTransactionId:m,paymentStatus:v,paymentMethod:l.paymentMethod,additionalPayment:ee>0?ee:void 0,totalPaid:oe>0?oe:void 0,remainingAmount:te,cashTransactionId:b,paymentDate:b?new Date().toISOString():void 0,creationDate:new Date().toISOString()};if(m&&f>0&&(ae(S=>[...S,{id:m,type:"deposit",category:"service_deposit",amount:f,date:new Date().toISOString(),description:`ƒê·∫∑t c·ªçc s·ª≠a ch·ªØa #${(pe(p,P==null?void 0:P.work_order_prefix)||"").split("-").pop()} - ${l.customerName}`,branchId:C,paymentSource:l.paymentMethod,reference:p}]),M(S=>S.map(N=>N.id===l.paymentMethod?{...N,balance:{...N.balance,[C]:(N.balance[C]||0)+f}}:N))),b&&ee>0&&(ae(S=>[...S,{id:b,type:"income",category:"service_income",amount:ee,date:new Date().toISOString(),description:`Thu ti·ªÅn s·ª≠a ch·ªØa #${(pe(p,P==null?void 0:P.work_order_prefix)||"").split("-").pop()} - ${l.customerName}`,branchId:C,paymentSource:l.paymentMethod,reference:p}]),M(S=>S.map(N=>N.id===l.paymentMethod?{...N,balance:{...N.balance,[C]:(N.balance[C]||0)+ee}}:N))),U.length>0){const S=U.reduce((N,W)=>N+(W.costPrice||0)*W.quantity,0);if(S>0){const N=`EXPENSE-${Date.now()}`;try{const{error:W}=await Xe.from("cash_transactions").insert({id:N,type:"expense",category:"outsourcing",amount:-S,date:new Date().toISOString(),description:`Chi ph√≠ gia c√¥ng b√™n ngo√†i - Phi·∫øu #${p.split("-").pop()} - ${U.map(B=>B.description).join(", ")}`,branchid:C,paymentsource:"cash",reference:p});W||(ae(B=>[...B,{id:N,type:"expense",category:"outsourcing",amount:-S,date:new Date().toISOString(),description:`Chi ph√≠ gia c√¥ng b√™n ngo√†i - Phi·∫øu #${p.split("-").pop()}`,branchId:C,paymentSource:"cash",reference:p}]),M(B=>B.map(ye=>ye.id==="cash"?{...ye,balance:{...ye.balance,[C]:(ye.balance[C]||0)-S}}:ye)),A.info(`ƒê√£ t·∫°o phi·∫øu chi ${x(S)} cho gia c√¥ng b√™n ngo√†i`))}catch(W){console.error("Error creating outsourcing expense:",W)}}}L(j),l.status==="Tr·∫£ m√°y"&&te>0&&(console.log("[handleSave] Creating debt with finalOrder:",{id:j.id,customerName:j.customerName,customerPhone:j.customerPhone,licensePlate:j.licensePlate,vehicleModel:j.vehicleModel}),await Ze(j,te,ne,oe)),T()}catch(p){console.error("Error creating work order (atomic):",p)}return}if(s!=null&&s.id){console.log("[handleSave] UPDATE block - Order ID:",s.id,"Status:",l.status);try{console.log("[handleSave] Calling updateWorkOrderAtomicAsync...");const p=await K({id:s.id,customerName:l.customerName||"",customerPhone:l.customerPhone||"",vehicleModel:l.vehicleModel||"",licensePlate:l.licensePlate||"",issueDescription:l.issueDescription||"",technicianName:l.technicianName||"",status:l.status||"Ti·∫øp nh·∫≠n",laborCost:l.laborCost||0,discount:Me,partsUsed:k,additionalServices:U.length>0?U:void 0,total:ne,branchId:C,paymentStatus:v,paymentMethod:l.paymentMethod,depositAmount:f>0?f:void 0,additionalPayment:ee>0?ee:void 0,totalPaid:oe>0?oe:void 0,remainingAmount:te}),c=p.workOrder,m=p==null?void 0:p.depositTransactionId,b=p==null?void 0:p.paymentTransactionId,j=c?{id:c.id||s.id,customerName:c.customername||c.customerName||s.customerName,customerPhone:c.customerphone||c.customerPhone||s.customerPhone,vehicleModel:c.vehiclemodel||c.vehicleModel||s.vehicleModel,licensePlate:c.licenseplate||c.licensePlate||s.licensePlate,issueDescription:c.issuedescription||c.issueDescription||s.issueDescription||"",technicianName:c.technicianname||c.technicianName||s.technicianName||"",status:c.status||s.status,laborCost:c.laborcost||c.laborCost||s.laborCost||0,discount:c.discount||s.discount||0,partsUsed:c.partsused||c.partsUsed||s.partsUsed||[],additionalServices:c.additionalservices||c.additionalServices||s.additionalServices,total:c.total||s.total,branchId:c.branchid||c.branchId||s.branchId,depositAmount:c.depositamount||c.depositAmount||s.depositAmount,depositDate:c.depositdate||c.depositDate||s.depositDate,depositTransactionId:m||s.depositTransactionId,paymentStatus:c.paymentstatus||c.paymentStatus||s.paymentStatus,paymentMethod:c.paymentmethod||c.paymentMethod||s.paymentMethod,additionalPayment:c.additionalpayment||c.additionalPayment||s.additionalPayment,totalPaid:c.totalpaid||c.totalPaid||s.totalPaid,remainingAmount:c.remainingamount||c.remainingAmount||s.remainingAmount,cashTransactionId:b||s.cashTransactionId,paymentDate:c.paymentdate||c.paymentDate||s.paymentDate,creationDate:c.creationdate||c.creationDate||s.creationDate}:{...s,customerName:l.customerName||s.customerName,customerPhone:l.customerPhone||s.customerPhone,vehicleModel:l.vehicleModel||s.vehicleModel,licensePlate:l.licensePlate||s.licensePlate,issueDescription:l.issueDescription||s.issueDescription,technicianName:l.technicianName||s.technicianName,status:l.status||s.status,laborCost:l.laborCost||s.laborCost,discount:Me,partsUsed:k,additionalServices:U.length>0?U:s.additionalServices,total:ne,depositAmount:f,depositTransactionId:m||s.depositTransactionId,paymentStatus:v,paymentMethod:l.paymentMethod||s.paymentMethod,additionalPayment:ee,totalPaid:oe,remainingAmount:te,cashTransactionId:b||s.cashTransactionId,paymentDate:b?new Date().toISOString():s.paymentDate};m&&f>s.depositAmount&&(ae(S=>[...S,{id:m,type:"deposit",category:"service_deposit",amount:f-(s.depositAmount||0),date:new Date().toISOString(),description:`ƒê·∫∑t c·ªçc b·ªï sung #${(pe(s.id,P==null?void 0:P.work_order_prefix)||"").split("-").pop()} - ${l.customerName}`,branchId:C,paymentSource:l.paymentMethod,reference:s.id}]),M(S=>S.map(N=>N.id===l.paymentMethod?{...N,balance:{...N.balance,[C]:(N.balance[C]||0)+(f-(s.depositAmount||0))}}:N))),b&&ee>(s.additionalPayment||0)&&(ae(S=>[...S,{id:b,type:"income",category:"service_income",amount:ee-(s.additionalPayment||0),date:new Date().toISOString(),description:`Thu ti·ªÅn b·ªï sung #${(pe(s.id,P==null?void 0:P.work_order_prefix)||"").split("-").pop()} - ${l.customerName}`,branchId:C,paymentSource:l.paymentMethod,reference:s.id}]),M(S=>S.map(N=>N.id===l.paymentMethod?{...N,balance:{...N.balance,[C]:(N.balance[C]||0)+(ee-(s.additionalPayment||0))}}:N))),console.log("[handleSave] updateWorkOrderAtomicAsync SUCCESS - Response:",p),L(j),l.status==="Tr·∫£ m√°y"&&te>0&&await Ze(j,te,ne,oe),T()}catch(p){console.error("[handleSave] Error updating work order (atomic):",p)}return}console.warn("[handleSave] Unexpected code path - no atomic create/update was called")}finally{Ee(!1)}},Ue=a=>{const t=k.find(i=>i.partId===a.id);ie(t?k.map(i=>i.partId===a.id?{...i,quantity:i.quantity+1}:i):[...k,{partId:a.id,partName:a.name,sku:a.sku||"",quantity:1,price:a.retailPrice[C]||0}]),z(!1),G("")},Le=o.useMemo(()=>u.filter(a=>{var i;return(((i=a.stock)==null?void 0:i[C])||0)>0}),[u,C]),Ve=o.useMemo(()=>$.trim()?Le.filter(a=>{var t;return a.name.toLowerCase().includes($.toLowerCase())||((t=a.sku)==null?void 0:t.toLowerCase().includes($.toLowerCase()))}):Le,[Le,$]);return e.jsxs("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-0 md:p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full h-full md:h-auto md:max-h-[90vh] md:max-w-5xl rounded-t-3xl md:rounded-xl shadow-2xl md:shadow-lg flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3 md:px-6 md:py-4 flex items-center justify-between rounded-t-3xl md:rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:l.id?`Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa - ${pe(l.id,P==null?void 0:P.work_order_prefix)}`:"T·∫°o phi·∫øu s·ª≠a ch·ªØa m·ªõi"}),e.jsx("button",{onClick:T,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-4 py-5 md:px-6 md:py-6 space-y-6 overflow-y-auto flex-1 pb-24 md:pb-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Th√¥ng tin Kh√°ch h√†ng & S·ª± c·ªë"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Kh√°ch h√†ng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative customer-search-container",children:[e.jsx("input",{type:"text",placeholder:"T√¨m kh√°ch h√†ng...",value:De,onChange:a=>{Z(a.target.value),r(!0),g({...l,customerName:a.target.value})},onFocus:()=>r(!0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),tt&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:Ye.length>0?Ye.map(a=>e.jsx("button",{type:"button",onClick:()=>{var i,v;const t=((i=a.vehicles)==null?void 0:i.find(p=>p.isPrimary))||((v=a.vehicles)==null?void 0:v[0]);g({...l,customerName:a.name,customerPhone:a.phone,vehicleId:t==null?void 0:t.id,vehicleModel:(t==null?void 0:t.model)||a.vehicleModel||"",licensePlate:(t==null?void 0:t.licensePlate)||a.licensePlate||""}),Z(a.name),r(!1)},className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-600 border-b border-slate-200 dark:border-slate-600 last:border-0",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm truncate",children:a.name}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-0.5",children:["üì± ",a.phone]}),(a.vehicleModel||a.licensePlate)&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-0.5 flex items-center gap-1",children:[e.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"6",cy:"17",r:"2"}),e.jsx("circle",{cx:"18",cy:"17",r:"2"}),e.jsx("path",{d:"M4 17h2l4-6h2l2 3h4"})]}),a.vehicleModel&&e.jsx("span",{children:a.vehicleModel}),a.licensePlate&&e.jsxs("span",{className:"font-mono font-medium",children:[a.vehicleModel&&"‚Ä¢"," ",a.licensePlate]})]})]})})},a.id)):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-slate-500 dark:text-slate-400",children:Y.length===0?"Ch∆∞a c√≥ kh√°ch h√†ng n√†o. Nh·∫•n '+' ƒë·ªÉ th√™m kh√°ch h√†ng m·ªõi.":"Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng ph√π h·ª£p"})})]}),e.jsx("button",{type:"button",onClick:()=>J(!0),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium text-xl",title:"Th√™m kh√°ch h√†ng m·ªõi",children:"+"})]}),l.customerName&&l.customerPhone&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:l.customerName}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-3.5 h-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15 .828 0 1.5-.672 1.5-1.5v-2.25a1.5 1.5 0 00-1.5-1.5h-1.158a1.5 1.5 0 00-1.092.468l-.936.996a1.5 1.5 0 01-1.392.444 12.035 12.035 0 01-7.29-7.29 1.5 1.5 0 01.444-1.392l.996-.936a1.5 1.5 0 00.468-1.092V6.75A1.5 1.5 0 006.75 5.25H4.5c-.828 0-1.5.672-1.5 1.5z"})}),l.customerPhone]})}),(l.vehicleModel||l.licensePlate)&&e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-3.5 h-3.5",children:[e.jsx("circle",{cx:"6",cy:"17",r:"2"}),e.jsx("circle",{cx:"18",cy:"17",r:"2"}),e.jsx("path",{d:"M4 17h2l4-6h2l2 3h4"})]}),l.vehicleModel," ",l.licensePlate&&`- ${l.licensePlate}`]})})]}),e.jsx("button",{type:"button",onClick:()=>{Z(""),g({...l,customerName:"",customerPhone:"",vehicleId:void 0,vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-red-500 text-sm flex items-center",title:"X√≥a kh√°ch h√†ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),xe&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:[ve.length>0?"Ch·ªçn xe":"Xe c·ªßa kh√°ch h√†ng",ve.length>0&&e.jsxs("span",{className:"text-xs text-slate-500 ml-1",children:["(",ve.length," xe)"]})]}),e.jsx("button",{type:"button",onClick:()=>O(!0),className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium",title:"Th√™m xe m·ªõi",children:"+ Th√™m xe"})]}),ve.length>0?e.jsx("div",{className:"space-y-2",children:ve.map(a=>{const t=l.vehicleId===a.id,i=a.isPrimary;return e.jsx("button",{type:"button",onClick:()=>Be(a),className:`w-full text-left px-3 py-2.5 rounded-lg border-2 transition-all ${t?"border-blue-500 bg-blue-50 dark:bg-blue-900/30":"border-slate-200 dark:border-slate-600 hover:border-blue-300 dark:hover:border-blue-700 bg-white dark:bg-slate-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsx("span",{className:"text-yellow-500",title:"Xe ch√≠nh",children:"‚≠ê"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-slate-900 dark:text-slate-100",children:a.model}),e.jsx("div",{className:"text-xs font-mono text-slate-600 dark:text-slate-400 mt-0.5",children:a.licensePlate})]}),t&&e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})]})},a.id)})}):e.jsx("div",{className:"text-center py-4 px-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-dashed border-slate-300 dark:border-slate-600",children:e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:'Ch∆∞a c√≥ xe n√†o. Click "+ Th√™m xe" ƒë·ªÉ th√™m.'})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë KM hi·ªán t·∫°i"}),e.jsx("input",{type:"number",placeholder:"15000",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£ s·ª± c·ªë"}),e.jsx("textarea",{rows:4,placeholder:"B·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥, thay nh·ªõt...",value:l.issueDescription||"",onChange:a=>g({...l,issueDescription:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Chi ti·∫øt D·ªãch v·ª•"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tr·∫°ng th√°i"}),e.jsxs("select",{value:l.status||"Ti·∫øp nh·∫≠n",onChange:a=>g({...l,status:a.target.value}),className:`w-full px-3 py-2 border rounded-lg font-medium ${l.status==="Ti·∫øp nh·∫≠n"?"bg-blue-100 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700 text-blue-700 dark:text-blue-300":l.status==="ƒêang s·ª≠a"?"bg-orange-100 dark:bg-orange-900/30 border-orange-300 dark:border-orange-700 text-orange-700 dark:text-orange-300":l.status==="ƒê√£ s·ª≠a xong"?"bg-purple-100 dark:bg-purple-900/30 border-purple-300 dark:border-purple-700 text-purple-700 dark:text-purple-300":"bg-green-100 dark:bg-green-900/30 border-green-300 dark:border-green-700 text-green-700 dark:text-green-300"}`,children:[e.jsx("option",{value:"Ti·∫øp nh·∫≠n",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"Ti·∫øp nh·∫≠n"}),e.jsx("option",{value:"ƒêang s·ª≠a",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"ƒêang s·ª≠a"}),e.jsx("option",{value:"ƒê√£ s·ª≠a xong",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"ƒê√£ s·ª≠a xong"}),e.jsx("option",{value:"Tr·∫£ m√°y",className:"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100",children:"Tr·∫£ m√°y"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"K·ªπ thu·∫≠t vi√™n"}),e.jsxs("select",{value:l.technicianName||"",onChange:a=>g({...l,technicianName:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"",children:"-- Ch·ªçn k·ªπ thu·∫≠t vi√™n --"}),Re.filter(a=>{var t,i;return a.status==="active"&&(((t=a.department)==null?void 0:t.toLowerCase().includes("k·ªπ thu·∫≠t"))||((i=a.position)==null?void 0:i.toLowerCase().includes("k·ªπ thu·∫≠t")))}).map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ph√≠ d·ªãch v·ª• (C√¥ng th·ª£)"}),e.jsx("input",{type:"number",placeholder:"100.000",value:l.laborCost||"",onChange:a=>g({...l,laborCost:Number(a.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ghi ch√∫ n·ªôi b·ªô"}),e.jsx("textarea",{rows:4,placeholder:"VD: Kh√°ch y√™u c·∫ßu ki·ªÉm tra th√™m h·ªá th·ªëng ƒëi·ªán",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Ph·ª• t√πng s·ª≠ d·ª•ng"}),e.jsx("button",{onClick:()=>z(!be),className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm flex items-center gap-1",children:"‚ûï Th√™m ph·ª• t√πng"})]}),be&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm ph·ª• t√πng theo t√™n ho·∫∑c SKU...",value:$,onChange:a=>G(a.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0}),e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-10",children:q?e.jsx("div",{className:"px-4 py-3 text-sm text-slate-500",children:"ƒêang t·∫£i ph·ª• t√πng..."}):Ve.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-slate-500",children:"Kh√¥ng t√¨m th·∫•y ph·ª• t√πng"}):Ve.slice(0,10).map(a=>e.jsxs("button",{onClick:()=>Ue(a),className:"w-full px-4 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-600 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:a.name}),e.jsx("div",{className:"text-xs text-slate-500",children:a.sku})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:x(a.retailPrice[C]||0)})]},a.id))})]}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"T√™n"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"ƒê.Gi√°"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"T.Ti·ªÅn"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-600",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-slate-400",children:"Ch∆∞a c√≥ ph·ª• t√πng n√†o"})}):k.map((a,t)=>e.jsxs("tr",{className:"bg-white dark:bg-slate-800",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-slate-900 dark:text-slate-100",children:a.partName}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"1",value:a.quantity,onChange:i=>{const v=Number(i.target.value);ie(k.map((p,c)=>c===t?{...p,quantity:v}:p))},className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-900 dark:text-slate-100",children:x(a.price)}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:x(a.price*a.quantity)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>ie(k.filter((i,v)=>v!==t)),className:"text-red-500 hover:text-red-700","aria-label":"X√≥a ph·ª• t√πng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6h18M9 6V4h6v2m-7 4v8m4-8v8m4-8v8"})})})})]},t))})]})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3",children:"B√°o gi√° (Gia c√¥ng, ƒê·∫∑t h√†ng)"}),e.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600 dark:text-slate-300",children:"M√¥ t·∫£"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:"SL"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"Gi√° nh·∫≠p"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"ƒê∆°n gi√°"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-slate-600 dark:text-slate-300",children:"Th√†nh ti·ªÅn"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600 dark:text-slate-300",children:e.jsx("button",{onClick:()=>{le.description&&le.price>0&&(Ke([...U,{...le,id:`SRV-${Date.now()}`}]),we({description:"",quantity:1,price:0,costPrice:0}))},className:"px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs",children:"Th√™m"})})]})}),e.jsxs("tbody",{children:[U.map(a=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-slate-900 dark:text-slate-100",children:a.description}),e.jsx("td",{className:"px-4 py-2 text-center text-sm text-slate-900 dark:text-slate-100",children:a.quantity}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-orange-600 dark:text-orange-400",children:a.costPrice?x(a.costPrice):"-"}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-900 dark:text-slate-100",children:x(a.price)}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:x(a.price*a.quantity)}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>Ke(U.filter(t=>t.id!==a.id)),className:"text-red-500 hover:text-red-700 text-sm","aria-label":"X√≥a d·ªãch v·ª•",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6h18M9 6V4h6v2m-7 4v8m4-8v8m4-8v8"})})})})]},a.id)),e.jsxs("tr",{className:"bg-white dark:bg-slate-800",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"text",placeholder:"M√¥ t·∫£...",value:le.description,onChange:a=>we({...le,description:a.target.value}),className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:le.quantity,onChange:a=>we({...le,quantity:Number(a.target.value)}),className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",placeholder:"Gi√° nh·∫≠p",value:le.costPrice||"",onChange:a=>we({...le,costPrice:Number(a.target.value)}),className:"w-full px-2 py-1 border border-orange-300 dark:border-orange-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",placeholder:"ƒê∆°n gi√°",value:le.price||"",onChange:a=>we({...le,price:Number(a.target.value)}),className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm"})}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-slate-400",children:le.price>0?x(le.price*le.quantity):"Th√†nh ti·ªÅn"}),e.jsx("td",{className:"px-4 py-2 text-center"})]})]})]})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4 mt-4",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Thanh to√°n"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:fe,onChange:a=>{I(a.target.checked),a.target.checked||D(0)},disabled:!!(s!=null&&s.depositAmount),className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:["ƒê·∫∑t c·ªçc"," ",s!=null&&s.depositAmount?`(ƒê√£ c·ªçc: ${x(s.depositAmount)})`:""]})]}),fe&&!(s!=null&&s.depositAmount)&&e.jsx("div",{className:"pl-6",children:e.jsx("input",{type:"number",placeholder:"S·ªë ti·ªÅn ƒë·∫∑t c·ªçc",value:f||"",onChange:a=>D(Number(a.target.value)),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Ph∆∞∆°ng th·ª©c thanh to√°n:"}),e.jsxs("div",{className:"flex items-center gap-4 pl-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:l.paymentMethod==="cash",onChange:a=>g({...l,paymentMethod:"cash"}),className:"w-4 h-4"}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2",ry:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),"Ti·ªÅn m·∫∑t"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:l.paymentMethod==="bank",onChange:a=>g({...l,paymentMethod:"bank"}),className:"w-4 h-4"}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 21h18M3 10h18M7 6h10l2 4H5l2-4Zm2 4v11m6-11v11"})}),"Chuy·ªÉn kho·∫£n"]})]})]})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3"}),l.status==="Tr·∫£ m√°y"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Se,onChange:a=>{Q(a.target.checked),a.target.checked||de(0)},className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Thanh to√°n khi tr·∫£ xe"})]}),Se&&e.jsxs("div",{className:"pl-6 space-y-2",children:[e.jsx("label",{className:"text-xs text-slate-600 dark:text-slate-400",children:"S·ªë ti·ªÅn thanh to√°n th√™m:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:"0",value:re||"",onChange:a=>de(Number(a.target.value)),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("button",{onClick:()=>de(0),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"0%"}),e.jsx("button",{onClick:()=>de(Math.round(te*.5)),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"50%"}),e.jsx("button",{onClick:()=>de(te),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-200 rounded text-xs font-medium",children:"100%"})]})]})]})]}),l.status!=="Tr·∫£ m√°y"&&e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:'* Thanh to√°n khi tr·∫£ xe ch·ªâ kh·∫£ d·ª•ng khi tr·∫°ng th√°i l√† "Tr·∫£ m√°y"'})]}),e.jsxs("div",{className:"space-y-3 bg-slate-50 dark:bg-slate-700/30 border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"T·ªïng k·∫øt"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ph√≠ d·ªãch v·ª•:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:x(l.laborCost||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ti·ªÅn ph·ª• t√πng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:x(Je)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gia c√¥ng/ƒê·∫∑t h√†ng:"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:x(Ie)})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-300 dark:border-slate-600",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-red-600 font-medium",children:"Gi·∫£m gi√°:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:"0",value:ke==="amount"?l.discount||"":V,onChange:a=>{const t=Number(a.target.value)||0;if(ke==="amount")g({...l,discount:Math.min(t,Te)});else{const i=Math.min(t,100);Pe(i),g({...l,discount:Math.round(Te*i/100)})}},className:"w-20 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",min:"0",max:ke==="amount"?Te:100}),e.jsxs("select",{value:ke,onChange:a=>{const t=a.target.value;_e(t),g({...l,discount:0}),Pe(0)},className:"px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),ke==="percent"&&e.jsx("div",{className:"flex gap-1 justify-end mt-2",children:[5,10,15,20].map(a=>e.jsxs("button",{onClick:()=>{Pe(a),g({...l,discount:Math.round(Te*a/100)})},className:"px-2 py-1 text-xs bg-slate-100 dark:bg-slate-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-slate-700 dark:text-slate-300 rounded transition-colors",children:[a,"%"]},a))}),ke==="percent"&&V>0&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 text-right mt-1",children:["= ",x(l.discount||0)]})]}),e.jsxs("div",{className:"pt-2 border-t-2 border-slate-400 dark:border-slate-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"T·ªïng c·ªông:"}),e.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:x(ne)})]}),(ze>0||ee>0)&&e.jsxs("div",{className:"space-y-1 pt-2 border-t border-slate-300 dark:border-slate-600",children:[ze>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"ƒê√£ ƒë·∫∑t c·ªçc:"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["-",x(ze)]})]}),ee>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Thanh to√°n th√™m:"}),e.jsxs("span",{className:"font-medium text-green-600 dark:text-green-400",children:["-",x(ee)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-300 dark:border-slate-600",children:[e.jsx("span",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:te>0?"C√≤n ph·∫£i thu:":"ƒê√£ thanh to√°n ƒë·ªß"}),e.jsx("span",{className:`text-lg font-bold ${te>0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:x(te)})]})]})]})]})]})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 px-4 py-4 md:px-6 flex items-center justify-end gap-3 bg-white md:bg-slate-50 dark:bg-slate-800/70 md:dark:bg-slate-800/50 rounded-b-3xl md:rounded-b-xl flex-shrink-0",children:[e.jsx("button",{onClick:T,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:Ae,className:"px-6 py-2 bg-slate-500 hover:bg-slate-600 text-white rounded-lg font-medium",children:"L∆∞u Phi·∫øu"}),l.status!=="Tr·∫£ m√°y"&&fe&&e.jsxs("button",{onClick:$e,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ƒê·∫∑t c·ªçc"]}),l.status==="Tr·∫£ m√°y"&&e.jsxs("button",{onClick:$e,className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),"Thanh to√°n"]})]})]}),at&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-md p-6 m-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"Th√™m kh√°ch h√†ng"}),e.jsx("button",{onClick:()=>{J(!1),d({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√™n kh√°ch"}),e.jsx("input",{type:"text",placeholder:"Nh·∫≠p t√™n kh√°ch",value:_.name,onChange:a=>d({..._,name:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),e.jsx("input",{type:"tel",placeholder:"VD: 09xxxx",value:_.phone,onChange:a=>d({..._,phone:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative vehicle-search-container",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"D√≤ng xe"}),e.jsx("input",{type:"text",placeholder:"Ch·ªçn ho·∫∑c nh·∫≠p d√≤ng xe",value:_.vehicleModel,onChange:a=>{d({..._,vehicleModel:a.target.value}),h(!0)},onFocus:()=>h(!0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),ge&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-[200px] overflow-y-auto",children:he.filter(a=>a.toLowerCase().includes(_.vehicleModel.toLowerCase())).map(a=>e.jsx("button",{type:"button",onClick:()=>{d({..._,vehicleModel:a}),h(!1)},className:"w-full text-left px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-600 text-sm border-b border-slate-200 dark:border-slate-600 last:border-0 text-slate-900 dark:text-slate-100",children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Bi·ªÉn s·ªë"}),e.jsx("input",{type:"text",placeholder:"VD: 59A1-123.45",value:_.licensePlate,onChange:a=>d({..._,licensePlate:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{J(!1),d({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:()=>{if(_.name&&_.phone){const a=`CUST-${Date.now()}`,t=`VEH-${Date.now()}`,i=[];(_.vehicleModel||_.licensePlate)&&i.push({id:t,model:_.vehicleModel||"",licensePlate:_.licensePlate||"",isPrimary:!0}),H({id:a,name:_.name,phone:_.phone,vehicles:i.length>0?i:void 0,vehicleModel:_.vehicleModel,licensePlate:_.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()}),g({...l,customerName:_.name,customerPhone:_.phone,vehicleId:i.length>0?t:void 0,vehicleModel:_.vehicleModel,licensePlate:_.licensePlate}),Z(_.name),J(!1),d({name:"",phone:"",vehicleModel:"",licensePlate:""})}},className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium",disabled:!_.name||!_.phone,children:"L∆∞u"})]})]})}),qe&&xe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl max-w-md w-full p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:["Th√™m xe cho ",xe.name]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Lo·∫°i xe ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: Exciter, Vision, Wave...",value:X.model,onChange:a=>je({...X,model:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Bi·ªÉn s·ªë ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"VD: 29A 12345",value:X.licensePlate,onChange:a=>je({...X,licensePlate:a.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded",children:"üí° Xe m·ªõi s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ch·ªçn sau khi th√™m"})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{O(!1),je({model:"",licensePlate:""})},className:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:"H·ªßy"}),e.jsx("button",{onClick:Qe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium",disabled:!X.model.trim()||!X.licensePlate.trim(),children:"Th√™m xe"})]})]})})]})},ls=({status:s})=>{const T={"Ti·∫øp nh·∫≠n":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400","ƒêang s·ª≠a":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400","ƒê√£ s·ª≠a xong":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400","Tr·∫£ m√°y":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400"};return e.jsx("span",{className:`inline-flex px-2 py-1 rounded-full text-xs font-medium ${T[s]}`,children:s})};export{ps as default};
