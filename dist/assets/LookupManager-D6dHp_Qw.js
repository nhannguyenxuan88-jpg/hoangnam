import{u as E,r as o,t as z,j as e,i as S,l as A}from"./index-9wxNecOd.js";import{g as f}from"./categoryColors-BepW_45H.js";const Q=()=>{var B;const{sales:K,workOrders:O,currentBranchId:i}=E(),[u,T]=o.useState(1),[L]=o.useState(20),{data:x,isLoading:P}=z({page:u,pageSize:L}),m=(x==null?void 0:x.data)||[],M=((B=x==null?void 0:x.meta)==null?void 0:B.total)||0,p=Math.max(1,Math.ceil(M/L)),[k,$]=o.useState(""),[g,U]=o.useState("all"),[h,v]=o.useState(null),[b,W]=o.useState("all"),[N,D]=o.useState(null),q=o.useMemo(()=>{const t=new Set;return m.forEach(s=>{s.category&&t.add(s.category)}),Array.from(t).sort()},[m]),y=o.useMemo(()=>m.filter(t=>{var n,j;if(k){const c=k.toLowerCase(),w=t.name.toLowerCase().includes(c),l=(n=t.sku)==null?void 0:n.toLowerCase().includes(c),r=(j=t.description)==null?void 0:j.toLowerCase().includes(c);if(!w&&!l&&!r)return!1}if(g!=="all"&&t.category!==g)return!1;if(h){const c=t.retailPrice[i]||0;if(c<h.min||c>h.max)return!1}const s=t.stock[i]||0;return!(b==="in-stock"&&s<=0||b==="low-stock"&&s>10||b==="out-of-stock"&&s>0)}),[m,k,g,h,b,i]),a=N?(t=>{const s=m.find(l=>l.id===t);if(!s)return null;const n=K.filter(l=>l.items.some(r=>r.partId===t)),j=O.filter(l=>{var r;return(r=l.partsUsed)==null?void 0:r.some(d=>d.partId===t)}),c=n.reduce((l,r)=>{const d=r.items.find(C=>C.partId===t);return l+((d==null?void 0:d.quantity)||0)},0),w=n.reduce((l,r)=>{const d=r.items.find(C=>C.partId===t);return l+((d==null?void 0:d.sellingPrice)||0)*((d==null?void 0:d.quantity)||0)},0);return{part:s,salesCount:n.length,totalSold:c,revenue:w,lastSold:n.length>0?n.sort((l,r)=>new Date(r.date).getTime()-new Date(l.date).getTime())[0].date:null,workOrdersCount:j.length}})(N):null;return e.jsxs("div",{className:"h-full flex bg-slate-50 dark:bg-[#0f172a]",children:[e.jsxs("div",{className:"w-96 bg-white dark:bg-[#1e293b] border-r border-slate-200 dark:border-slate-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-1",children:"Tra cứu sản phẩm"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Tìm kiếm và xem chi tiết sản phẩm"})]}),e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx("input",{type:"text",value:k,onChange:t=>$(t.target.value),placeholder:"Tìm theo tên, SKU, mô tả...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400"})}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh mục"}),e.jsxs("select",{value:g,onChange:t=>U(t.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100",children:[e.jsx("option",{value:"all",children:"Tất cả danh mục"}),q.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Tồn kho"}),e.jsx("div",{className:"space-y-2",children:[{value:"all",label:"Tất cả"},{value:"in-stock",label:"Còn hàng"},{value:"low-stock",label:"Sắp hết (≤10)"},{value:"out-of-stock",label:"Hết hàng"}].map(t=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"stock",value:t.value,checked:b===t.value,onChange:s=>W(s.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:t.label})]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Khoảng giá"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Từ",onChange:t=>v(s=>({min:Number(t.target.value)||0,max:(s==null?void 0:s.max)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"}),e.jsx("input",{type:"number",placeholder:"Đến",onChange:t=>v(s=>({min:(s==null?void 0:s.min)||0,max:Number(t.target.value)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"})]}),h&&e.jsx("button",{onClick:()=>v(null),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Xóa bộ lọc giá"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Tìm thấy"," ",e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:y.length})," ","sản phẩm"]})})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:y.map(t=>{const s=t.stock[i]||0,n=t.retailPrice[i]||0;return e.jsx("div",{onClick:()=>D(t.id),className:`bg-white dark:bg-[#1e293b] rounded-lg shadow-sm border-2 transition-all cursor-pointer ${N===t.id?"border-blue-500 shadow-md":"border-slate-200 dark:border-slate-700 hover:shadow-md"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100",children:t.name}),s<=0?e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs rounded",children:"Hết hàng"}):s<=10?e.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs rounded",children:"Sắp hết"}):e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 text-xs rounded",children:"Còn hàng"})]}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-mono mb-3",children:["SKU: ",t.sku]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Tồn kho"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:s})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Giá bán"}),e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:S(n)})]})]}),t.category&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium ${f(t.category).bg} ${f(t.category).text}`,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-3 h-3",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5l9-4.5 9 4.5v9l-9 4.5-9-4.5v-9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5l9 4.5 9-4.5"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 12v9"})]}),t.category]})})]})},t.id)})}),y.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"mb-4 text-slate-400 dark:text-slate-500",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-16 h-16",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Không tìm thấy sản phẩm"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm"})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-[#1e293b]",children:[e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Trang ",u,"/",p," • Tổng ",M," sản phẩm"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:u===1||P,onClick:()=>T(t=>Math.max(1,t-1)),className:"px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded disabled:opacity-40 hover:bg-slate-50 dark:hover:bg-slate-700",children:"← Trước"}),e.jsx("button",{disabled:u>=p||P,onClick:()=>T(t=>Math.min(p,t+1)),className:"px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded disabled:opacity-40 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Sau →"})]})]})]}),a&&e.jsxs("div",{className:"w-96 bg-white dark:bg-[#1e293b] border-l border-slate-200 dark:border-slate-700 flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Chi tiết sản phẩm"}),e.jsx("button",{onClick:()=>D(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:a.part.name}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-mono",children:["SKU: ",a.part.sku]}),a.part.category&&e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium mt-1 ${f(a.part.category).bg} ${f(a.part.category).text}`,children:a.part.category})]}),a.part.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Mô tả"}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:a.part.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Tồn kho"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:a.part.stock[i]||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Giá bán lẻ"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:S(a.part.retailPrice[i]||0)})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"Thống kê bán hàng"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mb-1",children:"Tổng đã bán"}),e.jsx("div",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:a.totalSold})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400 mb-1",children:"Doanh thu"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-900 dark:text-emerald-100",children:S(a.revenue)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-amber-600 dark:text-amber-400 mb-1",children:"Số đơn hàng"}),e.jsx("div",{className:"text-3xl font-bold text-amber-900 dark:text-amber-100",children:a.salesCount})]}),a.lastSold&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Bán gần nhất"}),e.jsx("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:A(a.lastSold)})]}),a.workOrdersCount>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Lệnh sửa chữa"}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:a.workOrdersCount})]})]})]})]})]})};export{Q as default};
