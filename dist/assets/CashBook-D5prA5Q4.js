import{u as B,h as I,a5 as A,r as n,j as e,i as b,l as M,s as T}from"./index-oC0AdDfJ.js";import{u as R}from"./usePaymentSourcesRepository-B3CBpIjd.js";const $=()=>{const{cashTransactions:o,paymentSources:p,currentBranchId:r,setCashTransactions:f,setPaymentSources:y}=B();I();const C=A(),w=R(),[u,g]=n.useState("all"),[x,v]=n.useState("all"),[k,N]=n.useState("month"),[S,j]=n.useState(!1),c=n.useMemo(()=>{let t=o.filter(l=>l.branchId===r);u!=="all"&&(t=t.filter(l=>l.type===u)),x!=="all"&&(t=t.filter(l=>l.paymentSourceId===x));const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(k){case"today":t=t.filter(h=>new Date(h.date)>=a);break;case"week":const l=new Date(a);l.setDate(l.getDate()-7),t=t.filter(h=>new Date(h.date)>=l);break;case"month":const d=new Date(a);d.setMonth(d.getMonth()-1),t=t.filter(h=>new Date(h.date)>=d);break}return t.sort((l,d)=>new Date(d.date).getTime()-new Date(l.date).getTime())},[o,r,u,x,k]),m=n.useMemo(()=>{var h,L;const t=c.filter(i=>i.type==="income").reduce((i,D)=>i+D.amount,0),s=c.filter(i=>i.type==="expense").reduce((i,D)=>i+D.amount,0),a=t-s,l=((h=p.find(i=>i.id==="cash"))==null?void 0:h.balance[r])||0,d=((L=p.find(i=>i.id==="bank"))==null?void 0:L.balance[r])||0;return{income:t,expense:s,balance:a,cashBalance:l,bankBalance:d,totalBalance:l+d}},[c,p,r]);return e.jsxs("div",{className:"h-full flex flex-col bg-slate-50 dark:bg-slate-900",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Sổ quỹ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Theo dõi thu chi tiền mặt và chuyển khoản"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{children:"Thêm giao dịch"})]})]})}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400 text-sm font-medium mb-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})}),e.jsx("span",{children:"Thu"})]}),e.jsx("div",{className:"text-green-900 dark:text-green-100 text-2xl font-bold",children:b(m.income)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border-2 border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 text-sm font-medium mb-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 13l-5 5m0 0l-5-5m5 5V6"})}),e.jsx("span",{children:"Chi"})]}),e.jsx("div",{className:"text-red-900 dark:text-red-100 text-2xl font-bold",children:b(m.expense)})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border-2 border-blue-200 dark:border-blue-800",children:[e.jsx("div",{className:"text-blue-600 dark:text-blue-400 text-sm font-medium mb-2",children:"Chênh lệch"}),e.jsx("div",{className:`text-2xl font-bold ${m.balance>=0?"text-blue-900 dark:text-blue-100":"text-red-600 dark:text-red-400"}`,children:b(m.balance)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border-2 border-amber-200 dark:border-amber-800",children:[e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-sm font-medium mb-2",children:"Tiền mặt"}),e.jsx("div",{className:"text-amber-900 dark:text-amber-100 text-2xl font-bold",children:b(m.cashBalance)})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border-2 border-purple-200 dark:border-purple-800",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-400 text-sm font-medium mb-2",children:"Ngân hàng"}),e.jsx("div",{className:"text-purple-900 dark:text-purple-100 text-2xl font-bold",children:b(m.bankBalance)})]})]}),e.jsxs("div",{className:"md:hidden space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Loại"}),e.jsxs("select",{value:u,onChange:t=>g(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"income",children:"Thu"}),e.jsx("option",{value:"expense",children:"Chi"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Nguồn tiền"}),e.jsxs("select",{value:x,onChange:t=>v(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"cash",children:"Tiền mặt"}),e.jsx("option",{value:"bank",children:"Ngân hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1 block",children:"Thời gian"}),e.jsxs("select",{value:k,onChange:t=>N(t.target.value),className:"w-full p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm",children:[e.jsx("option",{value:"today",children:"Hôm nay"}),e.jsx("option",{value:"week",children:"7 ngày qua"}),e.jsx("option",{value:"month",children:"30 ngày qua"}),e.jsx("option",{value:"all",children:"Tất cả"})]})]})]}),e.jsx("div",{className:"hidden md:block bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Loại:"}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"Tất cả"},{value:"income",label:"Thu"},{value:"expense",label:"Chi"}].map(t=>e.jsx("button",{onClick:()=>g(t.value),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${u===t.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t.label},t.value))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Nguồn tiền:"}),e.jsxs("select",{value:x,onChange:t=>v(t.target.value),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md text-sm text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"cash",children:"Tiền mặt"}),e.jsx("option",{value:"bank",children:"Ngân hàng"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Thời gian:"}),e.jsx("div",{className:"flex gap-2",children:[{value:"today",label:"Hôm nay"},{value:"week",label:"7 ngày"},{value:"month",label:"30 ngày"},{value:"all",label:"Tất cả"}].map(t=>e.jsx("button",{onClick:()=>N(t.value),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${k===t.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t.label},t.value))})]})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:c.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:"Không có giao dịch nào"}):c.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:_(t.category)}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:M(new Date(t.date))})]}),e.jsxs("div",{className:`font-bold ${t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[t.type==="income"?"+":"-",b(t.amount)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 truncate max-w-[60%]",children:t.notes||"--"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:t.paymentSourceId==="cash"?"Tiền mặt":"Ngân hàng"})]})]},t.id))}),e.jsx("div",{className:"hidden md:block bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Ngày"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Loại"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Danh mục"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Đối tượng"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Nội dung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Nguồn tiền"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Số tiền"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Thao tác"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-slate-500 dark:text-slate-400",children:"Không có giao dịch nào"})}):c.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100",children:M(new Date(t.date))}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t.type==="income"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:t.type==="income"?"↑ Thu":"↓ Chi"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:_(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100 font-medium",children:t.recipient||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:t.notes||"--"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400",children:t.paymentSourceId==="cash"?"Tiền mặt":"Ngân hàng"}),e.jsxs("td",{className:`px-4 py-3 text-right text-sm font-semibold ${t.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[t.type==="income"?"+":"-",b(t.amount)]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},t.id))})]})})]}),S&&e.jsx(q,{onClose:()=>j(!1),onSave:async t=>{if(!t.amount||t.amount<=0){T.warning("Số tiền phải > 0");return}try{const s=await C.mutateAsync({type:t.type,amount:t.amount,branchId:r,paymentSourceId:t.paymentSourceId,date:t.date,notes:t.notes,category:t.category,recipient:t.recipient});if(s!=null&&s.ok){f(l=>[s.data,...l]);const a=t.type==="income"?t.amount:-t.amount;await w.mutateAsync({id:t.paymentSourceId,branchId:r,delta:a}),y(l=>l.map(d=>d.id===t.paymentSourceId?{...d,balance:{...d.balance,[r]:(d.balance[r]||0)+a}}:d)),T.success("Đã thêm giao dịch sổ quỹ"),j(!1)}else s!=null&&s.error&&T.error(s.error.message||"Ghi giao dịch thất bại")}catch(s){T.error((s==null?void 0:s.message)||"Lỗi không xác định")}}})]})},_=o=>o?{sale_income:"Bán hàng",service_income:"Dịch vụ",other_income:"Thu khác",inventory_purchase:"Mua hàng",salary:"Lương nhân viên",loan_payment:"Trả nợ vay",debt_collection:"Thu nợ khách hàng",debt_payment:"Trả nợ nhà cung cấp",sale_refund:"Hoàn trả",other_expense:"Chi khác"}[o]||o:"--",q=({onClose:o,onSave:p})=>{const[r,f]=n.useState("income"),[y,C]=n.useState("0"),[w,u]=n.useState(""),[g,x]=n.useState("cash"),[v,k]=n.useState(""),[N,S]=n.useState(""),[j,c]=n.useState(new Date().toISOString().split("T")[0]),m=a=>{a.preventDefault(),p({type:r,amount:parseFloat(y),category:w,paymentSourceId:g,recipient:v,notes:N,date:new Date(j).toISOString()})},t=[{value:"sale_income",label:"Tiền bán hàng"},{value:"service_income",label:"Tiền dịch vụ"},{value:"other_income",label:"Thu nhập khác"}],s=[{value:"inventory_purchase",label:"Mua hàng"},{value:"salary",label:"Lương nhân viên"},{value:"rent",label:"Tiền thuê mặt bằng"},{value:"utilities",label:"Điện nước"},{value:"sale_refund",label:"Hoàn trả khách hàng"},{value:"other_expense",label:"Chi phí khác"}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Thêm giao dịch"})}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Loại giao dịch"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"income",checked:r==="income",onChange:a=>f(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Thu tiền"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"expense",checked:r==="expense",onChange:a=>f(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Chi tiền"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Số tiền"}),e.jsx("input",{type:"number",value:y,onChange:a=>C(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh mục"}),e.jsxs("select",{value:w,onChange:a=>u(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Chọn danh mục"}),(r==="income"?t:s).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Đối tượng"}),e.jsx("input",{type:"text",value:v,onChange:a=>k(a.target.value),placeholder:r==="income"?"Thu tiền từ ai?":"Chi tiền cho ai?",className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nguồn tiền"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"cash",checked:g==="cash",onChange:a=>x(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Tiền mặt"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"bank",checked:g==="bank",onChange:a=>x(a.target.value),className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:"Ngân hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ngày giao dịch"}),e.jsx("input",{type:"date",value:j,onChange:a=>c(a.target.value),className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Nội dung"}),e.jsx("textarea",{value:N,onChange:a=>S(a.target.value),rows:3,className:"w-full px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",placeholder:"Ghi chú về giao dịch..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-lg font-medium transition-colors",children:"Hủy"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Lưu giao dịch"})]})]})]})})};export{$ as default};
